var fileNameForFacultyDocs,fileIdForFacultyDocs,facultyClassNameData,facultyFacultyNameData,facultySectionNameData,facultyMeetingNameData,facultyDescNameData,classSuccessfullyCreated=!1,insideClassInsightsPage=!1,classCreationMessageDisplayStatus,studentEnrollMessageDisplayStatus,thumbnailimagepath,lastVisitedClassId="",facultyCreatedClassCode,linkCreatedOnText=!1,linkStartOffset,linkEndOffset,linkSpanId=0,highlightPalletsVisibleOnly=!1,addingLink=!1,displayCommonAnnotationPopover=!1,updatingLink=!1,linkSharedWithClass=!1,linkShareCheckBoxLastStatus=null,linkFetchinguser,linkIconId,linkUrlForStudent,linkUrlCommentsForStudents,linkEditingForproffessor,listOfLinkIcons,globalChapterAnnotationList,caseBookTutorialTeam=!1,tutorialApplicationBookType=!1,sectionDataList=null,rtsIconId=null,loAnchorRtS="",comingFromRtsToStudy=!1,insideStudycenterPage=!1,insidePracticePerfect=!1,insideStaticPage=!1,insideBookshelf=!1,themisAdminlanding,highestPerformance=[],lowestPerformance=[],mostComplete=[],leastComplete=[],alphabetical=[],generalList=[],generalQuartileList=[],lowQuartileList=[],lowMidQuartileList=[],midHighQuartileList=[],highQuartileList=[];function fetchDataFromCDNUrl(e){$("#page-loading-spinner").show(),$.ajax({url:e,type:"GET",async:!1}).then(function(e){var t=(new XMLSerializer).serializeToString(e.documentElement);t.split("</head>")[1]&&$("#tab-section-container").html(t.split("</head>")[1])},function(e){$("#page-loading-spinner").hide(),sessionTimeOut(),alertMessagesModal(exceptionMsg.systemError)})}function fetchAbsoluteCDNPath(e){var t={genericServiceRequestVO:{inputBaseUrl:e}};$.ajax({url:properties[properties.env]+"/manageUrlService/getCDNUrl",type:"POST",contentType:"application/json",accept:"application/json",async:!1,data:JSON.stringify(t)}).then(function(e){"true"===e.status&&(CaseConnect.CDNUrl=e.genericServiceResponseVO.cdnUrl,fetchDataFromCDNUrl(CaseConnect.CDNUrl))},function(e){sessionTimeOut(),alertMessagesModal(exceptionMsg.systemError)})}function fetchTOCData(e){var t={userVO:{userId:CaseConnect.currentUserId,userRole:CaseConnect.currentUserRole,userRoleId:CaseConnect.currentUserRoleId,streamContentRequiredFlag:map.isIE9,userActivityVO:{lastActivityCode:"EREADER_READING_BOOK",pageNavigatingFrom:"EReader",pageNavigatingTo:"EReader",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:CaseConnect.lastViewedOutlineId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},bookVO:{bookId:CaseConnect.currentBookId,pageNumber:e}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/bookContentRetrievalService/getBookContent",type:"POST",contentType:"application/json",accept:"application/json",async:!1,data:JSON.stringify(t)}).then(function(e){if("true"===e.status){e&&localStorage.setItem("ChapterId",e.bookVO.chapterId),"true"==e.resourceFlag&&(CaseConnect.resourceFlag,e.resourceFlag,$(".resourceMenushow").removeClass("resourceMenuhide")),null!=e.hasPCaseAnnotation&&null!=e.hasPCaseAnnotation&&("true"==e.hasPCaseAnnotation?CaseConnect.hasPCaseAnnotation="true":CaseConnect.hasPCaseAnnotation="false"),void 0!==e.casesFlag&&(CaseConnect.casesFlag=e.casesFlag,"true"===CaseConnect.casesFlag?CaseConnect.bookType?"oer"!==CaseConnect.bookType&&$(".hide-case-page-class").show():$(".hide-case-page-class").show():$(".hide-case-page-class").hide()),void 0!==e.newsFeedFlag&&"true"==CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide(),void 0!==e.labelVOList?(CaseConnect.preSetBriefLabelList=e.labelVOList,loadDataListInPopover()):(CaseConnect.preSetBriefLabelList="",loadDataListInPopover()),void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken);var t=e.bookVO.htmlPageContent;null!=t&&t.split("</head>")[1]?$("#tab-section-container").html(t.split("</head>")[1]):fetchDataFromCDNUrl(e.bookVO.tocPath),CaseConnect.tocPath=e.bookVO.tocPath,CaseConnect.bookData=e.bookVO,CaseConnect.bookData.explodedEpubPath=e.bookVO.exploadedEpubPath,CaseConnect.currentChapterId=e.bookVO.lastReadChapterId,CaseConnect.chapterTitle=e.bookVO.chapterTitle,CaseConnect.currentBookId=e.bookVO.bookId,CaseConnect.tocPath=e.bookVO.tocPath,CaseConnect.nextChapterStartPageNumber=e.bookVO.nextChapterStartPageNumber,CaseConnect.previousChapterEndPageNumber=e.bookVO.previousChapterEndPageNumber,CaseConnect.currentChapterEndPageNumber=e.bookVO.chapterEndPageNumber,CaseConnect.nextChapterNumber=e.bookVO.nextChapterNumber,CaseConnect.nextChapterTitle=e.bookVO.nextChapterTitle,CaseConnect.tocPath="/casebook"+CaseConnect.tocPath.split("?")[0].split("/casebook")[1],CaseConnect.bookData.chapterType="toc",scrollTolastVisitedpage(),updateChapterNameandDetails()}sessionTimeOut()},function(e){sessionTimeOut(),sessionAuthFails(e),alertMessagesModal(exceptionMsg.systemError)})}function IsEmail(e){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)}function searchCoProfessor(e){var t=$("#txtSearchByFirstName").val().trim(),a=$("#txtSearchByLastName").val().trim(),o=$("#txtSearchByEmail").val().trim();if($("#txtSearchByEmail").val().length>0){if(!IsEmail(o))return $(".emailValidationText").show(),$("#paginationDetails").hide(),$("#professorSearchPaginationSection").hide(),$(".table-row").remove(),$("#Add-professors").hide(),$("#lblAddtoCladdBtn").show(),$("#chkSelectAllLicence").prop("checked",!1),$(".professorItem").prop("checked",!1),!1;$(".emailValidationText").hide()}else $(".emailValidationText").hide();currentProfSearchResultIndex=0;var s={userVO:{userRole:map.userRole,firstName:map.firstName,lastName:map.lastName,email:map.email,userActivityVO:{lastActivityCode:"ADMIN_USER_SEARCH",pageNavigatingFrom:"USER_SEARCH",pageNavigatingTo:""},sessionVO:{deviceOS:CaseConnect.deviceOS,deviceType:CaseConnect.deviceType,browserName:CaseConnect.browserName,appType:CaseConnect.appType,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")},userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId},userSearchVO:{firstName:t,lastName:a,email:o},classVO:{bookId:CaseConnect.currentBookId,classCode:$("#facultyClassCode").text(),classDescription:$("#faculty-description-detail").val(),classExpirationDate:"3000-12-30 00:00:00.0",classId:CaseConnect.currentClassId,className:$("#faculty-class-name").val(),copiedFromOtherClassFlag:"false",createdBy:classDetailCreatedBy,createdDate:currentClassCreatedDate,meetingTime:$("#faculty-meeting-times").val(),modifiedBy:classDetailCreatedBy,modifiedDate:"2014-11-20 19:02:40.0",schoolId:"119",section:$("#faculty-section-name").val(),semesterYear:$("#faculty-semester-year").val()}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageClassWebService/searchCoProfessors",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(s)}).then(function(e){if(void 0!==e.sessionAuthenticationToken&&(localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),"true"===e.status)){e.userList;null==e.userList?($("#paginationDetails").hide(),$("#professorSearchPaginationSection").hide(),$(".table-row").remove(),$("#Add-professors").hide(),$("#lblAddtoCladdBtn").show(),$("#chkSelectAllLicence").prop("checked",!1),$(".professorItem").prop("checked",!1),$("#page-loading-spinner").hide()):($("#page-loading-spinner").hide(),$("#lblProfName").text(e.userList.firstName+" "+e.userList.lastName),populateSearchResult(e))}sessionTimeOut()},function(e){sessionTimeOut(),sessionAuthFails(e),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function populateSearchResult(e){if(resultsPerPage=5,currentProfSearchResultIndex=0,$(".table-row").remove(),void 0!==e.userList)if(void 0!==e.userList.length)if(e.userList.length<resultsPerPage){$("#lblTotalResultCount").text(e.userList.length),$("#lblCurrentResultCount").text(e.userList.length),$("#professorSearchPaginationSection").hide(),$("#paginationDetails").show();for(var t=0;t<e.userList.length;t++)t%2?$("#professorSearchResultSection").append("<div class='table-row even'><div class='col faculty-search-data resultItem'><div class='row-even-data' style='border-left: 1px solid #fff; padding-left:10px;'>"+e.userList[t].firstName+"</div></div> <div class='col faculty-search-data resultItem'><div class='row-even-data' style='padding-left:10px;'> "+e.userList[t].lastName+"</div></div> <div class='col faculty-search-data resultItem'> <div class='row-even-data' style='padding-left:10px;'>"+e.userList[t].email+"</div></div> <div class='col faculty-search-checkbox resultItem'><div class='row-even-data'> <input class='professorItem' onClick='checkAddButton()' type='checkbox' id='"+e.userList[t].userId+"' /></div></div></div>"):$("#professorSearchResultSection").append("<div class='table-row odd'><div class='col faculty-search-data resultItem'><div class='row-odd-data' style='border-left: 1px solid #fff; padding-left:10px;'>"+e.userList[t].firstName+"</div></div> <div class='col faculty-search-data resultItem'> <div class='row-odd-data' style='padding-left:10px;'> "+e.userList[t].lastName+"</div> </div><div class='col faculty-search-data resultItem'> <div class='row-odd-data' style='padding-left:10px;'>"+e.userList[t].email+"</div></div> <div class='col faculty-search-checkbox resultItem'> <div class='row-odd-data'> <input class='professorItem' onClick='checkAddButton()' type='checkbox' id='"+e.userList[t].userId+"' /></div></div></div>")}else{totalPageCount=Math.ceil(e.userList.length/resultsPerPage),$("#lblTotalResultCount").text(e.userList.length),$("#lblCurrentResultCount").text(resultsPerPage),$("#professorSearchPaginationSection").show(),$("#paginationDetails").show(),$("#lnkPrevResult").addClass("disableLink"),$("#lnkNextResult").removeClass("disableLink"),(1==totalPageCount||totalPageCount<1)&&$("#professorSearchPaginationSection").hide(),fullProfessorSearchResult=e.userList,currentPageNumber=1;for(t=0;t<resultsPerPage;t++)currentProfSearchResultIndex++,t%2?$("#professorSearchResultSection").append("<div class='table-row even'><div class='col faculty-search-data resultItem'><div class='row-even-data' style='border-left: 1px solid #fff; padding-left:10px;'>"+e.userList[t].firstName+"</div></div> <div class='col faculty-search-data resultItem'><div class='row-even-data' style='padding-left:10px;'> "+e.userList[t].lastName+"</div></div> <div class='col faculty-search-data resultItem'> <div class='row-even-data' style='padding-left:10px;'>"+e.userList[t].email+"</div></div> <div class='col faculty-search-checkbox resultItem'><div class='row-even-data'> <input class='professorItem' onClick='checkAddButton()' type='checkbox' id='"+e.userList[t].userId+"' /></div></div></div>"):$("#professorSearchResultSection").append("<div class='table-row odd'><div class='col faculty-search-data resultItem'><div class='row-odd-data' style='border-left: 1px solid #fff; padding-left:10px;'>"+e.userList[t].firstName+"</div></div> <div class='col faculty-search-data resultItem'> <div class='row-odd-data' style='padding-left:10px;'> "+e.userList[t].lastName+"</div> </div><div class='col faculty-search-data resultItem'> <div class='row-odd-data' style='padding-left:10px;'>"+e.userList[t].email+"</div></div> <div class='col faculty-search-checkbox resultItem'> <div class='row-odd-data'> <input class='professorItem' onClick='checkAddButton()' type='checkbox' id='"+e.userList[t].userId+"' /></div></div></div>")}else $("#professorSearchPaginationSection").hide(),$("#paginationDetails").hide(),$("#professorSearchResultSection").append("<div class='table-row'><div class='col faculty-search-data resultItem'><div class='row-odd-data' style='border-left: 1px solid #fff; padding-left:10px;'>"+e.userList.firstName+"</div></div> <div class='col faculty-search-data resultItem'><div class='row-odd-data' style='border-left: 1px solid #fff; padding-left:10px;'> "+e.userList.lastName+"</div></div> <div class='col faculty-search-data resultItem'> <div class='row-odd-data' style='border-left: 1px solid #fff; padding-left:10px;'>"+e.userList.email+"</div></div> <div class='col faculty-search-checkbox resultItem'> <div class='row-odd-data'> <input class='professorItem' onClick='checkAddButton()' type='checkbox' id='"+e.userList.userId+"' /></div></div></div>");$("#chkSelectAllLicence").prop("checked",!1),$("#page-loading-spinner").hide()}function fetchNextSet(){if(currentPageNumber++,currentPageNumber<=totalPageCount){$(".table-row").remove(),$("#chkSelectAllLicence").prop("checked",!1);for(var e=(currentPageNumber-1)*resultsPerPage,t=currentPageNumber*resultsPerPage,a=0,o=e;o<t;o++)o<fullProfessorSearchResult.length&&(a=o,o%2?$("#professorSearchResultSection").append("<div class='table-row even'><div class='col faculty-search-data resultItem'><div class='row-even-data' style='border-left: 1px solid #fff;padding-left:10px;'>"+fullProfessorSearchResult[o].firstName+"</div></div> <div class='col faculty-search-data resultItem'><div class='row-even-data' style='padding-left:10px;'> "+fullProfessorSearchResult[o].lastName+"</div></div> <div class='col faculty-search-data resultItem'> <div class='row-even-data' style='padding-left:10px;'>"+fullProfessorSearchResult[o].email+"</div></div> <div class='col faculty-search-checkbox resultItem'><div class='row-even-data'> <input class='professorItem' onClick='checkAddButton()' type='checkbox' id='"+fullProfessorSearchResult[o].userId+"' /></div></div></div>"):$("#professorSearchResultSection").append("<div class='table-row odd'><div class='col faculty-search-data resultItem'><div class='row-odd-data' style='border-left: 1px solid #fff;padding-left:10px;'>"+fullProfessorSearchResult[o].firstName+"</div></div> <div class='col faculty-search-data resultItem'> <div class='row-odd-data' style='padding-left:10px;'> "+fullProfessorSearchResult[o].lastName+"</div> </div><div class='col faculty-search-data resultItem'> <div class='row-odd-data' style='padding-left:10px;'>"+fullProfessorSearchResult[o].email+"</div></div> <div class='col faculty-search-checkbox resultItem'> <div class='row-odd-data'> <input class='professorItem' onClick='checkAddButton()' type='checkbox' id='"+fullProfessorSearchResult[o].userId+"' /></div></div></div>"));1===currentPageNumber?$("#lnkPrevResult").addClass("disableLink"):$("#lnkPrevResult").removeClass("disableLink"),currentPageNumber===totalPageCount?$("#lnkNextResult").addClass("disableLink"):$("#lnkNextResult").removeClass("disableLink"),$("#lblCurrentResultCount").text(a+1)}else currentPageNumber--}function fetchPreviousResultSet(){if(currentPageNumber--,currentPageNumber>0){$(".table-row").remove(),$("#chkSelectAllLicence").prop("checked",!1);for(var e=(currentPageNumber-1)*resultsPerPage,t=currentPageNumber*resultsPerPage,a=0,o=e;o<t;o++)a=o,o%2?$("#professorSearchResultSection").append("<div class='table-row even'><div class='col faculty-search-data resultItem'><div class='row-even-data' style='border-left: 1px solid #fff; padding-left:10px;'>"+fullProfessorSearchResult[o].firstName+"</div></div> <div class='col faculty-search-data resultItem'><div class='row-even-data' style='padding-left:10px;'> "+fullProfessorSearchResult[o].lastName+"</div></div> <div class='col faculty-search-data resultItem'> <div class='row-even-data' style='padding-left:10px;'>"+fullProfessorSearchResult[o].email+"</div></div> <div class='col faculty-search-checkbox resultItem'><div class='row-even-data'> <input class='professorItem' onClick='checkAddButton()' type='checkbox' id='"+fullProfessorSearchResult[o].userId+"' /></div></div></div>"):$("#professorSearchResultSection").append("<div class='table-row odd'><div class='col faculty-search-data resultItem'><div class='row-odd-data' style='border-left: 1px solid #fff;padding-left:10px;'>"+fullProfessorSearchResult[o].firstName+"</div></div> <div class='col faculty-search-data resultItem'> <div class='row-odd-data' style='padding-left:10px;'> "+fullProfessorSearchResult[o].lastName+"</div> </div><div class='col faculty-search-data resultItem'> <div class='row-odd-data' style='padding-left:10px;'>"+fullProfessorSearchResult[o].email+"</div></div> <div class='col faculty-search-checkbox resultItem'> <div class='row-odd-data'> <input class='professorItem' onClick='checkAddButton()' type='checkbox' id='"+fullProfessorSearchResult[o].userId+"' /></div></div></div>");1===currentPageNumber?$("#lnkPrevResult").addClass("disableLink"):$("#lnkPrevResult").removeClass("disableLink"),currentPageNumber===totalPageCount?$("#lnkNextResult").addClass("disableLink"):$("#lnkNextResult").removeClass("disableLink"),$("#lblCurrentResultCount").text(a+1)}else currentPageNumber++}function addProfessorToClass(){var e=$("input:checkbox.professorItem").filter(":checked").map(function(){return this.id}).get(),t=retriveLocalTimeFromUTC();t=moment(t.toString()).format("YYYY MM DD hh:mm:ss");var a={userVO:{userActivityVO:{lastActivityCode:"CLASS_INSIGHT_ADD_COPROFESSORS",pageNavigatingFrom:"ADMIN_SEARCH",pageNavigatingTo:"ADMIN_SEARCH",lastReadBookId:CaseConnect.currentBookId,lastViewedClassId:CaseConnect.currentClassId},sessionVO:{deviceOS:CaseConnect.deviceOS,deviceType:CaseConnect.deviceType,browserName:CaseConnect.browserName,appType:CaseConnect.appType,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")},userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId},coProfessorIdList:e,classVO:{bookId:CaseConnect.currentBookId,classCode:$("#facultyClassCode").text(),classDescription:$("#faculty-description-detail").val(),classExpirationDate:"3000-12-30 00:00:00.0",classId:CaseConnect.currentClassId,className:$("#faculty-class-name").val(),copiedFromOtherClassFlag:"false",createdBy:classDetailCreatedBy,createdDate:currentClassCreatedDate,meetingTime:$("#faculty-meeting-times").val(),modifiedBy:classDetailCreatedBy,modifiedDate:t,schoolId:"119",section:$("#faculty-section-name").val(),semesterYear:$("#faculty-semester-year").val()}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageClassWebService/addCoProfessorsToClass",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(a)}).then(function(e){if(void 0!==e.sessionAuthenticationToken){if(localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),$("#faculty-search-modal-window").modal("hide"),void 0!==e.coProfessorList)if($("#coTeacherSection").empty(),void 0!==e.coProfessorList.length)for(var t=0;t<e.coProfessorList.length;t++){var a=[];$("#coTeacherSection").find("label").each(function(){a.push(this.id)}),$("#coTeacherSection").append("<div><a id='deleteProf"+e.coProfessorList[t].userId+"' onClick='deleteProfesssor(this.id)'><img src='img/bookshelf/x-delete-button.png' class='faculty-code-info-btn'></a><label class='faculty-co-teachers-list'>"+e.coProfessorList[t].combinedFirstNameAndLastNameForSorting+"</label></div>")}else $("#coTeacherSection").append("<div><a id='deleteProf"+e.coProfessorList.userId+"' onClick='deleteProfesssor(this.id)'><img src='img/bookshelf/x-delete-button.png' class='faculty-code-info-btn'></a><label class='faculty-co-teachers-list'>"+e.coProfessorList.combinedFirstNameAndLastNameForSorting+"</label></div>");$("#page-loading-spinner").hide()}sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function deleteProfesssor(e){profId=e,$("#delete-faculty-confirmation-window").modal("show")}function removeProfessorFromClass(){profId;var e=profId.replace("deleteProf",""),t={userVO:{userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId,userActivityVO:{lastActivityCode:"CLASS_INSIGHT_DELETE_COPROFESSORS",pageNavigatingFrom:"ClassInsight",pageNavigatingTo:"ClassInsight",lastReadBookId:CaseConnect.currentBookId,lastViewedClassId:CaseConnect.currentClassId},sessionVO:{deviceOS:CaseConnect.deviceOS,deviceType:CaseConnect.deviceType,browserName:CaseConnect.browserName,appType:CaseConnect.appType,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},classVO:{classId:CaseConnect.currentClassId,bookId:CaseConnect.currentBookId,coProfessorList:[{classId:CaseConnect.currentClassId,userId:e}]}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageClassWebService/deleteCoProfessors",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(t)}).then(function(e){void 0!==e.sessionAuthenticationToken&&(localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),$("#delete-faculty-confirmation-window").modal("hide"),"true"===e.status&&($("#"+profId).parent().remove(),$("#page-loading-spinner").hide())),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),$("#delete-faculty-confirmation-window").modal("hide"),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function disableUpdateButton(){0===$("#faculty-class-name").val().length?$("#faculty-updated-class-save").attr("disabled","disabled"):$("#faculty-updated-class-save").removeAttr("disabled")}function editClass(){$("#faculty-class-name").val();var e={userVO:{userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId,userActivityVO:{lastActivityCode:"CLASS_INSIGHT_EDIT_CLASS",pageNavigatingFrom:"ClassInsight",pageNavigatingTo:"ClassInsight",lastReadBookId:CaseConnect.currentBookId,lastViewedClassId:CaseConnect.currentClassId},sessionVO:{deviceOS:CaseConnect.deviceOS,deviceType:CaseConnect.deviceType,browserName:CaseConnect.browserName,appType:CaseConnect.appType,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},classVO:{classId:CaseConnect.currentClassId,bookId:CaseConnect.currentBookId,className:$("#faculty-class-name").val(),classDescription:$("#faculty-description-detail").val(),semesterYear:$("#faculty-semester-year").val(),section:$("#faculty-section-name").val(),meetingTime:$("#faculty-meeting-times").val()}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageClassWebService/editClass",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(e)}).then(function(e){void 0!==e.sessionAuthenticationToken&&(localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),$("#page-loading-spinner").hide(),alertMessagesModal("Class details updated successfully"),facultyClassNameData=$("#faculty-class-name").val(),facultyFacultyNameData=$("#faculty-semester-year").val(),facultySectionNameData=$("#faculty-section-name").val(),facultyMeetingNameData=$("#faculty-meeting-times").val(),facultyDescNameData=$("#faculty-description-detail").val(),$("#faculty-copy-button").attr({"class-description":facultyDescNameData,"class-name":"Copy of "+facultyClassNameData})),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function goToCreateClassPage(e){if(localStorage.setItem("eulaValidationCheck",e.currentTarget.getAttribute("eulaFlag")),"true"===localStorage.getItem("eulaValidationCheck")){$("[rel=popover]").popover("hide"),map.overlay.fadeOut(200),$("#eula-validation-modal").modal("show");var t=e.currentTarget.attributes;return $(t).each(function(){var e=this.name,t=this.value;$("#eula-validation-modal button").attr(e,t)}),$(".eula-text-container").load("endUserLisenceAggrement.html"),void $("#eula-validation-modal button").removeAttr("id","class").removeAttr("style").attr({id:"btn-eula-accept",class:"btn btn-default popover-common-btn ereader-btn-custom-gradient",onClick:"saveEulaValidationStatus(event,true)"})}$(".books-thumbnail").popover("hide"),map.overlay.fadeOut(200),$("#page-loading-spinner").show(),map.wk_conatiner.load("professorCreateClass.html?v19895",function(){$(window).scrollTop(0),$("#archivedStudyDashboard,#archivedSeperator,#hyperLinkForArchive").hide(),adjustLeftNavHeight(),insideStaticPage=!1,insideBookshelf=!1,insideThemis=!1,insideThemisAdmin=!1,insideCQuizzing=!1,insidePracticePerfect=!1,insideNewsFeed=!1,insideCasesPage=!1,insideResourcePage=!1,insideOutline=!1,insideStudycenterPage=!1,insideGlobalSearchResult=!1,insideClassInsightsPage=!0,displayTooltipContent(),$("#bookshelflink").show(),$(".tutoriallink").show(),$(".content-top-menu").hide();var t=document.documentElement;if(t.setAttribute("data-useragent",navigator.userAgent),t.setAttribute("data-platform",navigator.platform),navigator.userAgent.match(/Trident\/[6]/i)&&$(".bookshelf-doc-dropdown").css({position:"static","background-image":"none"}),!CaseConnect.bookData&&CaseConnect.navigatingAwayFromNewBookshelf)for(var a=CaseConnect.navigatingAwayFromNewBookshelf,o=0;o<a.length;++o)if(a[o].bookId==CaseConnect.currentBookId){CaseConnect.bookData=a[o];break}if(e.target.getAttribute("copyClassButtonClicked"))document.getElementById("faculty-class-name").value=e.target.getAttribute("class-name"),document.getElementById("faculty-description-detail").value=e.target.getAttribute("class-description"),$(".thumbnail-image").attr("src",e.target.getAttribute("thumbnail-image-path")).attr("alt",e.target.getAttribute("current-book-title")),$(".bookshelf-book-title").html(e.target.getAttribute("current-book-title")),$(".ereader-main-header-title").html(e.target.getAttribute("current-book-title")),$(".read-modal-book-title").html(e.target.getAttribute("current-book-title")),$("#faculty-save-class-btn").removeAttr("data-handler"),$("#faculty-save-class-btn").removeAttr("data-action"),$("#faculty-save-class-btn").attr("onClick","copyClassFromExistingClass()"),"true"==CaseConnect.resourceFlag&&$(".resourceMenushow").removeClass("resourceMenuhide"),"true"===CaseConnect.casesFlag?CaseConnect.bookType?"oer"!==CaseConnect.bookType&&$(".hide-case-page-class").show():$(".hide-case-page-class").show():$(".hide-case-page-class").hide(),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide();else{facultyCreateClassWelcome(),CaseConnect.currentBookId=e.target.getAttribute("bookId"),CaseConnect.bookType=e.target.getAttribute("bookType"),CaseConnect.resourceFlag=e.target.getAttribute("resourceFlag"),CaseConnect.casesFlag=e.target.getAttribute("casesFlag"),CaseConnect.newsFeedFlag=e.target.getAttribute("newsFeedFlag"),CaseConnect.currentProductId=e.target.getAttribute("relatedThemisproductId"),CaseConnect.freeTrialFlag=e.target.getAttribute("freeTrialFlag"),CaseConnect.adminStudyFlag=e.target.getAttribute("adminStudyFlag"),CaseConnect.adminOutlineFlag=e.target.getAttribute("adminOutlineFlag"),CaseConnect.adminInsightsFlag=e.target.getAttribute("adminInsightsFlag"),CaseConnect.adminNewsFlag=e.target.getAttribute("adminNewsFlag"),localStorage.setItem("currentProductId",CaseConnect.currentProductId),localStorage.setItem("freeTrialFlag",CaseConnect.freeTrialFlag),localStorage.setItem("adminStudyFlag",CaseConnect.adminStudyFlag),localStorage.setItem("adminOutlineFlag",CaseConnect.adminOutlineFlag),localStorage.setItem("adminInsightsFlag",CaseConnect.adminInsightsFlag),localStorage.setItem("adminNewsFlag",CaseConnect.adminNewsFlag);var s=e.target.getAttribute("booktitle");thumbnailimagepath=e.target.getAttribute("thumbnailimagepath"),"true"==CaseConnect.resourceFlag&&$(".resourceMenushow").removeClass("resourceMenuhide"),"true"===CaseConnect.casesFlag?CaseConnect.bookType?"oer"!==CaseConnect.bookType&&$(".hide-case-page-class").show():$(".hide-case-page-class").show():$(".hide-case-page-class").hide(),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide(),bookSpecificFeatureDisplay(),null!==CaseConnect.currentBookId&&""!==CaseConnect.currentBookId&&void 0!==CaseConnect.currentBookId&&(checkNewsFeedInApp(),expiryDate()),getMyRequestNoftificationCount(),$(".thumbnail-image").attr("src",thumbnailimagepath).attr("alt",s),$(".bookshelf-book-title").html(s),$(".ereader-main-header-title").html(s),$(".read-modal-book-title").html(s)}$(".faculty-open-book").css("display","none"),$("#page-loading-spinner").hide(),adjustLeftNavHeight(),$(window).trigger("resize"),adminSuppressFunc()})}function getClassDetails(event){event&&localStorage.setItem("eulaValidationCheck",event.currentTarget.getAttribute("eulaFlag"));var eulaValidationElem=localStorage.getItem("eulaValidationCheck");if("true"===eulaValidationElem){if($("[rel=popover]").popover("hide"),map.overlay.fadeOut(200),event)var listOfAttributes=event.currentTarget.attributes;return $("#eula-validation-modal").modal("show"),$(listOfAttributes).each(function(){var e=this.name,t=this.value;$("#eula-validation-modal button").attr(e,t)}),$(".eula-text-container").load("endUserLisenceAggrement.html"),void $("#eula-validation-modal button").removeAttr("id","class").removeAttr("style").attr({id:"btn-eula-accept",class:"btn btn-default popover-common-btn ereader-btn-custom-gradient",onClick:"saveEulaValidationStatus(event,true)"})}$("[rel=popover]").popover("hide"),map.overlay.fadeOut(200),$("#archivedStudyDashboard,#archivedSeperator,#hyperLinkForArchive").hide(),$(".tutoriallink").show(),classSuccessfullyCreated=!1,insideStaticPage=!1,insideBookshelf=!1,enableCopyPaste(),$(".ereader-hidden").hide(),$(".ereader-visible").show(),$(window).trigger("resize");var windowWidth=$(window).width(),containerWidth=$(".main-container").width();if(windowWidth<768&&windowWidth>=containerWidth?$("#header-wrapper").hide():$("#header-wrapper").show(),addBookshelfLinkTOLogo(),$("#bookshelf-nav-menu-mobile").modal("hide"),"0"==event)CaseConnect.currentBookId=localStorage.getItem("InsideClasInsightsCurrentBookId"),CaseConnect.currentClassId=localStorage.getItem("InsideClasInsightsCurrentClassId"),classDetailCreatedBy=localStorage.getItem("InsideClasInsightsClassDetailCreatedBy"),$(".loginLink").hide(),$(".hr-rule-div").hide(),Handler.login.checkTopBottomBarsForLogin(),$(".statusBar").show(),$(".welcome").html("Welcome "+map.firstName);else if(event)if(classDetailCreatedBy=event.currentTarget.getAttribute("createdBy"),CaseConnect.currentClassId=event.currentTarget.getAttribute("classId"),CaseConnect.currentBookId=event.currentTarget.getAttribute("bookId"),CaseConnect.currentProductId=event.target.getAttribute("relatedThemisproductId"),localStorage.setItem("currentProductId",CaseConnect.currentProductId),event.target.getAttribute("freeTrialFlag")&&(CaseConnect.freeTrialFlag=event.target.getAttribute("freeTrialFlag"),localStorage.setItem("freeTrialFlag",CaseConnect.freeTrialFlag)),event.target.getAttribute("adminStudyFlag")&&(CaseConnect.adminStudyFlag=event.target.getAttribute("adminStudyFlag"),localStorage.setItem("adminStudyFlag",CaseConnect.adminStudyFlag)),event.target.getAttribute("adminOutlineFlag")&&(CaseConnect.adminOutlineFlag=event.target.getAttribute("adminOutlineFlag"),localStorage.setItem("adminOutlineFlag",CaseConnect.adminOutlineFlag)),event.target.getAttribute("adminInsightsFlag")&&(CaseConnect.adminInsightsFlag=event.target.getAttribute("adminInsightsFlag"),localStorage.setItem("adminInsightsFlag",CaseConnect.adminInsightsFlag)),event.target.getAttribute("adminNewsFlag")&&(CaseConnect.adminNewsFlag=event.target.getAttribute("adminNewsFlag"),localStorage.setItem("adminNewsFlag",CaseConnect.adminNewsFlag)),null===CaseConnect.currentClassId&&null===classDetailCreatedBy&&null===CaseConnect.currentBookId){CaseConnect.currentClassId=event.currentTarget.options[event.currentTarget.options.selectedIndex].getAttribute("classId"),classDetailCreatedBy=event.currentTarget.options[event.currentTarget.options.selectedIndex].getAttribute("createdBy"),CaseConnect.currentBookId=event.currentTarget.options[event.currentTarget.options.selectedIndex].getAttribute("bookId");var bookTitle=event.currentTarget.getAttribute("booktitle"),thumbnailimagepath=event.currentTarget.getAttribute("thumbnailimagepath")}else var bookTitle=event.target.getAttribute("booktitle"),thumbnailimagepath=event.target.getAttribute("thumbnailimagepath");else if(CaseConnect.currentProductId=localStorage.getItem("currentProductId"),CaseConnect.bookData.bookId&&null!==CaseConnect.bookData.bookId)CaseConnect.currentBookId=CaseConnect.bookData.bookId,classDetailCreatedBy=map.userId,CaseConnect.currentClassId="-99999"===lastVisitedClassId?"":lastVisitedClassId,$(".faculty-open-book").css("display","none");else if(!CaseConnect.bookData&&CaseConnect.navigatingAwayFromNewBookshelf)for(i=0;i<CaseConnect.navigatingAwayFromNewBookshelf.length;i++)CaseConnect.navigatingAwayFromNewBookshelf[i].bookId===CaseConnect.currentBookId&&(CaseConnect.currentBookId=CaseConnect.navigatingAwayFromNewBookshelf[i].bookId,CaseConnect.currentClassId="-99999"===lastVisitedClassId?"":lastVisitedClassId,classDetailCreatedBy=map.userId,$(".faculty-open-book").css("display","none"));else CaseConnect.navigatingAwayFromNewBookshelf?(insideThemis||insideThemisAdmin)&&CaseConnect.currentBookId&&""!==CaseConnect.currentBookId&&(classDetailCreatedBy=map.userId,CaseConnect.currentClassId="-99999"===lastVisitedClassId?"":lastVisitedClassId,$(".faculty-open-book").css("display","none")):(CaseConnect.currentBookId||bookChapterSupplimentList||(getChapterAndSupplementalList(),CaseConnect.currentBookId=bookChapterSupplimentList[0].bookId),CaseConnect.currentClassId="-99999"===lastVisitedClassId?"":lastVisitedClassId,classDetailCreatedBy=map.userId,$(".faculty-open-book").css("display","none"));CaseConnect.currentUserId=map.userId,CaseConnect.currentUserRoleId=map.userRoleId,CaseConnect.currentUserRole=map.userRole;var reqData={userVO:{userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId,userActivityVO:{lastActivityCode:"CLASS_INSIGHT_GET_CLASS",pageNavigatingFrom:"ClassInsight",pageNavigatingTo:"ClassInsight",lastReadBookId:CaseConnect.currentBookId,lastViewedClassId:CaseConnect.currentClassId},sessionVO:{deviceOS:CaseConnect.deviceOS,deviceType:CaseConnect.deviceType,browserName:CaseConnect.browserName,appType:CaseConnect.appType,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},classVO:{classId:CaseConnect.currentClassId,bookId:CaseConnect.currentBookId,createdBy:classDetailCreatedBy}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageClassWebService/getClassDetails",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(reqData)}).then(function(data){if(void 0!==data.sessionAuthenticationToken){if(CaseConnect.resourceFlag=data.resourceFlag,CaseConnect.casesFlag=data.casesFlag,CaseConnect.newsFeedFlag=data.newsFeedFlag,localStorage.setItem("sessionAuthenticationToken",data.sessionAuthenticationToken),localStorage.setItem("InsideClasInsights",!0),localStorage.setItem("InsideClasInsightsClassDetailCreatedBy",classDetailCreatedBy),localStorage.setItem("resourceFlag",CaseConnect.resourceFlag),localStorage.setItem("casesFlag",CaseConnect.casesFlag),localStorage.setItem("InsideClasInsightsCurrentClassId",CaseConnect.currentClassId),localStorage.setItem("InsideClasInsightsCurrentBookId",CaseConnect.currentBookId),insideClassInsightsPage=!0,insideStudycenterPage=!1,insideNewsFeed=!1,insideCasesPage=!1,insideOutline=!1,insideEreader=!1,insideThemis=!1,insideThemisAdmin=!1,insideCQuizzing=!1,insidePracticePerfect=!1,insideGlobalSearchResult=!1,insideResourcePage=!1,!CaseConnect.bookData&&CaseConnect.navigatingAwayFromNewBookshelf){for(var bookDataArr=CaseConnect.navigatingAwayFromNewBookshelf,count=0;count<bookDataArr.length;++count)if(bookDataArr[count].bookId==CaseConnect.currentBookId){CaseConnect.bookData=bookDataArr[count];break}}else data.bookVO&&(CaseConnect.bookData=data.bookVO,CaseConnect.bookType=data.bookVO.bookType);if("true"===data.status){if(data.bookVO){var bookTitle=data.bookVO.bookTitle;thumbnailimagepath=data.bookVO.thumbnailImagePath,CaseConnect.bookType=data.bookVO.bookType}data.resourceFlag&&(CaseConnect.resourceFlag=data.resourceFlag),void 0!==data.casesFlag&&"true"==data.casesFlag&&(CaseConnect.casesFlag=data.casesFlag),void 0!==data.newsFeedFlag&&"true"==data.newsFeedFlag&&(CaseConnect.newsFeedFlag=data.newsFeedFlag),CaseConnect.currentChapterId="",data.classVO?(lastVisitedClassId=data.classVO.classId,"-99999"===data.classVO.classId?map.wk_conatiner.load("professorCreateClass.html?v19895",function(){$(window).scrollTop(0),$("#archivedStudyDashboard,#archivedSeperator,#hyperLinkForArchive").hide(),"true"==data.resourceFlag&&$(".resourceMenushow").removeClass("resourceMenuhide"),void 0!==data.casesFlag&&(CaseConnect.casesFlag=data.casesFlag,"true"===CaseConnect.casesFlag?CaseConnect.bookType?"oer"!==CaseConnect.bookType&&$(".hide-case-page-class").show():$(".hide-case-page-class").show():$(".hide-case-page-class").hide()),void 0!==data.newsFeedFlag&&"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide(),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide(),bookSpecificFeatureDisplay(),null!==CaseConnect.currentBookId&&""!==CaseConnect.currentBookId&&void 0!==CaseConnect.currentBookId&&(checkNewsFeedInApp(),expiryDate()),getMyRequestNoftificationCount(),displayTooltipContent(),$("#bookshelflink").show(),$("#bookshelf-nav-menu-mobile").modal("hide");var e=document.documentElement;e.setAttribute("data-useragent",navigator.userAgent),e.setAttribute("data-platform",navigator.platform),navigator.userAgent.match(/Trident\/[6]/i)&&$(".bookshelf-doc-dropdown").css({position:"static","background-image":"none"}),$(".thumbnail-image").attr("src",thumbnailimagepath).attr("alt",bookTitle),$(".bookshelf-book-title").html(bookTitle),$(".ereader-main-header-title").html(bookTitle),$(".read-modal-book-title").html(bookTitle),$(".faculty-open-book").css("display","none"),"true"==CaseConnect.resourceFlag&&$(".resourceMenushow").removeClass("resourceMenuhide"),"true"===CaseConnect.casesFlag?CaseConnect.bookType?"oer"!==CaseConnect.bookType&&$(".hide-case-page-class").show():$(".hide-case-page-class").show():$(".hide-case-page-class").hide(),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide(),CaseConnect.currentBookId=CaseConnect.bookData.bookId,CaseConnect.currentClassId="",enableCopyPaste(),facultyCreateClassWelcome(),adjustLeftNavHeight(),$(window).trigger("resize"),adminSuppressFunc()}):(CaseConnect.currentClassId=data.classVO.classId,map.wk_conatiner.load("professorCreateClass.html?v19894",function(){$(window).scrollTop(0),displayTooltipContent(),getArchivedClass(),$("#bookshelflink").show(),$("#bookshelf-nav-menu-mobile").modal("hide"),$(".class-insights-header").html("Class Insights"),"true"==CaseConnect.resourceFlag&&$(".resourceMenushow").removeClass("resourceMenuhide"),"true"===CaseConnect.casesFlag?CaseConnect.bookType?"oer"!==CaseConnect.bookType&&$(".hide-case-page-class").show():$(".hide-case-page-class").show():$(".hide-case-page-class").hide(),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide(),bookSpecificFeatureDisplay();var b=document.documentElement;b.setAttribute("data-useragent",navigator.userAgent),b.setAttribute("data-platform",navigator.platform);var ie10=navigator.userAgent.match(/Trident\/[6]/i);if(ie10&&$(".bookshelf-doc-dropdown").css({position:"static","background-image":"none"}),!CaseConnect.bookData&&CaseConnect.navigatingAwayFromNewBookshelf){for(var bookDataArr=CaseConnect.navigatingAwayFromNewBookshelf,count=0;count<bookDataArr.length;++count)if(bookDataArr[count].bookId==CaseConnect.currentBookId){CaseConnect.bookData=bookDataArr[count];break}}else data.bookVO&&(CaseConnect.bookData=data.bookVO);if(insideClassInsightsPage=!0,insideStudycenterPage=!1,insideNewsFeed=!1,insideCasesPage=!1,insideResourcePage=!1,insideOutline=!1,insideEreader=!1,insideThemis=!1,insideThemisAdmin=!1,insideCQuizzing=!1,insidePracticePerfect=!1,insideGlobalSearchResult=!1,$("#faculty-copy-button").attr({"class-description":data.classVO.classDescription,"class-name":"Copy of "+data.classVO.className,"thumbnail-image-path":thumbnailimagepath,"current-book-title":bookTitle,copyClassButtonClicked:!0}),$(".thumbnail-image").attr("src",thumbnailimagepath).attr("alt",bookTitle),$(".bookshelf-book-title").html(bookTitle),$(".ereader-main-header-title").html(bookTitle),$(".read-modal-book-title").html(bookTitle),$("#class-insights-heading").text("Class Insights"),$(".class-insights-right-header-wrap").css("display","inline-block"),$("#class-insights-right-header").css("display","inline-block"),$("#faculty-save-cancel-buttons").css("display","none"),$("#faculty-save-cancel-buttons-mobile").css("display","none"),facultyClassNameData=data.classVO.className,facultyFacultyNameData=data.classVO.semesterYear,facultySectionNameData=data.classVO.section,facultyMeetingNameData=data.classVO.meetingTime,facultyDescNameData=data.classVO.classDescription,document.getElementById("faculty-class-name").value=data.classVO.className,document.getElementById("faculty-semester-year").value=data.classVO.semesterYear,document.getElementById("faculty-section-name").value=data.classVO.section,document.getElementById("faculty-meeting-times").value=data.classVO.meetingTime,document.getElementById("faculty-description-detail").value=data.classVO.classDescription,currentClassCreatedDate=data.classVO.createdDate,data.bookVO.classVOList){!data.bookVO.classVOList.length>0&&(data.bookVO.classVOList=[data.bookVO.classVOList]);var compiledTemplate1=Handlebars.getTemplate("ereader-classList"),html1=compiledTemplate1(data);$("#class-insights-right-header").append(html1),"true"==data.resourceFlag&&$(".resourceMenushow").removeClass("resourceMenuhide"),void 0!==data.casesFlag&&(CaseConnect.casesFlag=data.casesFlag,"true"===CaseConnect.casesFlag?CaseConnect.bookType?"oer"!==CaseConnect.bookType&&$(".hide-case-page-class").show():$(".hide-case-page-class").show():$(".hide-case-page-class").hide()),void 0!==data.newsFeedFlag&&"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide(),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide()}null!==CaseConnect.currentBookId&&""!==CaseConnect.currentBookId&&void 0!==CaseConnect.currentBookId&&(checkNewsFeedInApp(),expiryDate()),getMyRequestNoftificationCount(),$("#after-class-id-generated").css("display","inline-block"),$("#facultyClassCode").html(data.classVO.classCode.toUpperCase()),$(".faculty-class-insights-code-info-btn").attr("title","This unique Class Code was generated for this class. Share this class code with your students for easy enrollment in your class. Students registered from your school will also be able to browse for your class if you choose not to share the Class Code."),$(".faculty-open-book").css("display","none");var handler="getStudyDashBoardForProfessor",request={},reqData={};if(request.url="/manageClassWebService/getStudyDashBoardForProfessorOrStudent",request.url=properties[properties.env]+request.url,request.method="POST",request.handler=eval("Handler."+handler),request.data=reqData,request.handler.request.apply(null,[request]),Utility.fireRequest(request),$(".class-insights-right-header-wrap").css("display","inline-block"),$("#class-insights-right-header").css("display","inline-block"),$(".classinsights-heading").html("Class Insights"),$("#right-header-bookTitle").html(bookTitle.toUpperCase()),$("#right-header-bookTitle").attr("title",bookTitle),"true"===data.classVO.classCreatorFlag?$("#faculty-delete-class-button").show():$("#faculty-delete-class-button").hide(),void 0!==data.classVO.coProfessorList)if("true"===data.classVO.classCreatorFlag)if($("#faculty-delete-class-button").show(),$(".add-books").show(),$("#coTeacherTitle").text("ADD CO-TEACHERS OR TEACHING ASSISTANTS"),void 0!==data.classVO.coProfessorList.length)for(var i=0;i<data.classVO.coProfessorList.length;i++){var profId="deleteProf"+data.classVO.coProfessorList[i].userId;$("#coTeacherSection").append("<div><a id='deleteProf"+data.classVO.coProfessorList[i].userId+"' onClick='deleteProfesssor(this.id)'><img src='img/bookshelf/x-delete-button.png' class='faculty-code-info-btn'></a><label class='faculty-co-teachers-list'>"+data.classVO.coProfessorList[i].combinedFirstNameAndLastNameForSorting+"</label></div>")}else $("#coTeacherSection").append("<div><a id='deleteProf"+data.classVO.coProfessorList.userId+"' onClick='deleteProfesssor(this.id)'><img src='img/bookshelf/x-delete-button.png' class='faculty-code-info-btn'></a><label class='faculty-co-teachers-list'>"+data.classVO.coProfessorList.combinedFirstNameAndLastNameForSorting+"</label></div>");else if($("#faculty-delete-class-button").hide(),$(".add-books").hide(),$("#coTeacherTitle").text("CO-TEACHERS OR TEACHING ASSISTANTS"),void 0!==data.classVO.coProfessorList.length)for(var i=0;i<data.classVO.coProfessorList.length;i++){var profId="deleteProf"+data.classVO.coProfessorList[i].userId;$("#coTeacherSection").append("<div><label class='faculty-co-teachers-list'>"+data.classVO.coProfessorList[i].combinedFirstNameAndLastNameForSorting+"</label></div>")}else $("#coTeacherSection").append("<div><label class='faculty-co-teachers-list'>"+data.classVO.coProfessorList.combinedFirstNameAndLastNameForSorting+"</label></div>");if(void 0!==data.classVO.fileList){var docsList=[];if(data.classVO.fileList.length>0?docsList=data.classVO.fileList:docsList.push(data.classVO.fileList),docsList.length>0)for(var i=0;i<docsList.length;i++){docsList.length>4?$("#faculty-uploaded-list").css({"max-height":"140px","overflow-y":"scroll"}):$("#faculty-uploaded-list").css({"max-height":"1005","overflow-y":"hidden"}),fileNameForFacultyDocs=docsList[i].fileName,fileIdForFacultyDocs=docsList[i].fileId;var facultyOtherDocs=document.createElement("DIV");facultyOtherDocs.className="faculty-learning-materials-list",document.getElementById("faculty-uploaded-list").appendChild(facultyOtherDocs);var facultyOtherDocsDeleteAnchor=document.createElement("a");facultyOtherDocsDeleteAnchor.setAttribute("onClick","deleteUploadedDocsModal(event)"),facultyOtherDocsDeleteAnchor.setAttribute("href","#/"),facultyOtherDocsDeleteAnchor.setAttribute("aria-label","Delete document"),facultyOtherDocsDeleteAnchor.setAttribute("fileName",docsList[i].fileName),facultyOtherDocsDeleteAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsDeleteAnchor);var facultyOtherDocsDelete=document.createElement("IMG");if(facultyOtherDocsDelete.className="faculty-code-info-btn",facultyOtherDocsDelete.setAttribute("src","img/bookshelf/x-delete-button.png"),facultyOtherDocsDelete.setAttribute("fileName",docsList[i].fileName),facultyOtherDocsDelete.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsDelete.setAttribute("alt","Delete document"),facultyOtherDocsDelete.setAttribute("onClick","deleteUploadedDocsModal(event)"),facultyOtherDocsDelete.style.cursor="pointer",facultyOtherDocsDeleteAnchor.appendChild(facultyOtherDocsDelete),".doc"===docsList[i].fileType){var facultyOtherDocsAnchor=document.createElement("a");facultyOtherDocsAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.setAttribute("href","#/"),facultyOtherDocsAnchor.setAttribute("aria-label","Microsoft Word"),facultyOtherDocsAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsAnchor);var facultyOtherDocsIcon=document.createElement("IMG");facultyOtherDocsIcon.className="faculty-materials-icon",facultyOtherDocsIcon.setAttribute("src","img/bookshelf/doc-icon.png"),facultyOtherDocsIcon.setAttribute("alt","Microsoft Word"),facultyOtherDocsIcon.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsIcon.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.appendChild(facultyOtherDocsIcon)}if(".docx"===docsList[i].fileType){var facultyOtherDocsAnchor=document.createElement("a");facultyOtherDocsAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.setAttribute("href","#/"),facultyOtherDocsAnchor.setAttribute("aria-label","Microsoft Word"),facultyOtherDocsAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsAnchor);var facultyOtherDocsIcon=document.createElement("IMG");facultyOtherDocsIcon.className="faculty-materials-icon",facultyOtherDocsIcon.setAttribute("src","img/bookshelf/doc-icon.png"),facultyOtherDocsIcon.setAttribute("alt","Microsoft Word"),facultyOtherDocsIcon.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsIcon.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.appendChild(facultyOtherDocsIcon)}if(".pdf"===docsList[i].fileType){var facultyOtherDocsAnchor=document.createElement("a");facultyOtherDocsAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.setAttribute("href","#/"),facultyOtherDocsAnchor.setAttribute("aria-label","PDF"),facultyOtherDocsAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsAnchor);var facultyOtherDocsIcon=document.createElement("IMG");facultyOtherDocsIcon.className="faculty-materials-icon",facultyOtherDocsIcon.setAttribute("src","img/bookshelf/pdf-icon.png"),facultyOtherDocsIcon.setAttribute("alt","PDF"),facultyOtherDocsIcon.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsIcon.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.appendChild(facultyOtherDocsIcon)}if(".ppt"===docsList[i].fileType||".pptx"===docsList[i].fileType){var facultyOtherDocsAnchor=document.createElement("a");facultyOtherDocsAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.setAttribute("href","#/"),facultyOtherDocsAnchor.setAttribute("aria-label","Microsoft PowerPoint"),facultyOtherDocsAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsAnchor);var facultyOtherDocsIcon=document.createElement("IMG");facultyOtherDocsIcon.className="faculty-materials-icon",facultyOtherDocsIcon.setAttribute("src","img/bookshelf/ppt-icon.png"),facultyOtherDocsIcon.setAttribute("alt","Microsoft PowerPoint"),facultyOtherDocsIcon.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsIcon.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.appendChild(facultyOtherDocsIcon)}if(".jpg"===docsList[i].fileType||".JPG"===docsList[i].fileType||".png"===docsList[i].fileType||".PNG"===docsList[i].fileType||".jpeg"===docsList[i].fileType||".JPEG"===docsList[i].fileType||".tif"===docsList[i].fileType||".TIF"===docsList[i].fileType){var facultyOtherDocsAnchor=document.createElement("a");facultyOtherDocsAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.setAttribute("href","#/"),facultyOtherDocsAnchor.setAttribute("aria-label","Image"),facultyOtherDocsAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsAnchor);var facultyOtherDocsIcon=document.createElement("IMG");facultyOtherDocsIcon.className="faculty-materials-icon",facultyOtherDocsIcon.setAttribute("src","img/bookshelf/jpg-icon.png"),facultyOtherDocsIcon.setAttribute("alt","Image"),facultyOtherDocsIcon.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsIcon.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsAnchor.appendChild(facultyOtherDocsIcon)}if(".zip"===docsList[i].fileType){var facultyOtherDocsAnchor=document.createElement("a");facultyOtherDocsAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.setAttribute("href","#/"),facultyOtherDocsAnchor.setAttribute("aria-label","ZIP"),facultyOtherDocsAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsAnchor);var facultyOtherDocsIcon=document.createElement("IMG");facultyOtherDocsIcon.className="faculty-materials-icon",facultyOtherDocsIcon.setAttribute("src","img/bookshelf/zip-icon.png"),facultyOtherDocsIcon.setAttribute("alt","ZIP"),facultyOtherDocsIcon.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsIcon.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsAnchor.appendChild(facultyOtherDocsIcon)}if(".xls"===docsList[i].fileType||".xlsx"===docsList[i].fileType){var facultyOtherDocsAnchor=document.createElement("a");facultyOtherDocsAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.setAttribute("href","#/"),facultyOtherDocsAnchor.setAttribute("aria-label","Microsoft Excel"),facultyOtherDocsAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsAnchor);var facultyOtherDocsIcon=document.createElement("IMG");facultyOtherDocsIcon.className="faculty-materials-icon",facultyOtherDocsIcon.setAttribute("src","img/bookshelf/xls-icon.png"),facultyOtherDocsIcon.setAttribute("alt","Microsoft Excel"),facultyOtherDocsIcon.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsIcon.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsAnchor.appendChild(facultyOtherDocsIcon)}if(".rtf"===docsList[i].fileType){var facultyOtherDocsAnchor=document.createElement("a");facultyOtherDocsAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.setAttribute("href","#/"),facultyOtherDocsAnchor.setAttribute("aria-label","Rich Text Format"),facultyOtherDocsAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsAnchor);var facultyOtherDocsIcon=document.createElement("IMG");facultyOtherDocsIcon.className="faculty-materials-icon",facultyOtherDocsIcon.setAttribute("src","img/bookshelf/rtf-icon.png"),facultyOtherDocsIcon.setAttribute("alt","Rich Text Format"),facultyOtherDocsIcon.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsIcon.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsAnchor.appendChild(facultyOtherDocsIcon)}var facultyOtherDocsLabelAnchor=document.createElement("a");facultyOtherDocsLabelAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsLabelAnchor.setAttribute("href","#/"),facultyOtherDocsLabelAnchor.setAttribute("fileName",docsList[i].fileName),facultyOtherDocsLabelAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsLabelAnchor);var facultyOtherDocsLabel=document.createElement("span");facultyOtherDocsLabel.className="faculty-docs-name-list reset-additional-info display-inline-block",facultyOtherDocsLabel.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsLabel.setAttribute("title",docsList[i].fileName),facultyOtherDocsLabel.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsLabel.innerHTML=docsList[i].fileName,facultyOtherDocsLabelAnchor.appendChild(facultyOtherDocsLabel)}}else data.classVO.fileList;adjustLeftNavHeight(),$(window).trigger("resize"),adminSuppressFunc()}))):(data.classVO||alertMessagesModal(exceptionMsg.systemError),$("#page-loading-spinner").hide()),$("#page-loading-spinner").hide()}else $("#page-loading-spinner").hide()}else $("#page-loading-spinner").hide();sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function facultyCancelCreateClass(){localStorage.setItem("InsideClasInsights",!1);var fClassName=$("#faculty-class-name").val(),fSemYear=$("#faculty-semester-year").val(),fSection=$("#faculty-section-name").val(),fMeeting=$("#faculty-meeting-times").val(),fDesc=$("#faculty-description-detail").val();if(""!==fClassName||""!==fSemYear||""!==fSection||""!==fMeeting||""!==fDesc)if(fClassName!==facultyClassNameData||fSemYear!==facultyFacultyNameData||fSection!==facultySectionNameData||fMeeting!==facultyMeetingNameData||fDesc!==facultyDescNameData)$("#cancel-create-class-message").modal("show");else{var handler="goToBookShelf",request={},data={};request.url="/bookShelfRetrivalService/getBookList",request.url=properties[properties.env]+request.url,request.method="POST",request.handler=eval("Handler."+handler),request.data=data,request.handler.request.apply(null,[request]),Utility.fireRequest(request)}else{var handler="goToBookShelf",request={},data={};request.url="/bookShelfRetrivalService/getBookList",request.url=properties[properties.env]+request.url,request.method="POST",request.handler=eval("Handler."+handler),request.data=data,request.handler.request.apply(null,[request]),Utility.fireRequest(request)}}function cancelCreateClassAgree(){$("#cancel-create-class-message").modal("hide")}function deleteUploadedDocsModal(e){fileNameForFacultyDocs=e.currentTarget.getAttribute("fileName"),fileIdForFacultyDocs=e.currentTarget.getAttribute("fileId"),$("#delete-file-message").modal("show")}function deleteUploadedDocs(){var e={userVO:{userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId,userActivityVO:{lastActivityCode:"CLASS_INSIGHT_DELETE_FILES",pageNavigatingFrom:"class-insight",pageNavigatingTo:""},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,ipAddress:localStorage.getItem("ipAddress"),sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},classVO:{classId:CaseConnect.currentClassId},fileVO:{fileName:fileNameForFacultyDocs,fileId:fileIdForFacultyDocs}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageClassWebService/deleteClassFile",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(e)}).then(function(e){if(void 0!==e.sessionAuthenticationToken)if(localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),"true"===e.status)if(e.fileVOList){$("#faculty-uploaded-list").html("");var t=e.fileVOList;"object"==$.type(t)&&(t=[t]);for(var a=0;a<t.length;a++){t.length>4?$("#faculty-uploaded-list").css({"max-height":"140px","overflow-y":"scroll"}):$("#faculty-uploaded-list").css({"max-height":"1005","overflow-y":"hidden"}),fileNameForFacultyDocs=t[a].fileName,fileIdForFacultyDocs=t[a].fileId;var o=document.createElement("DIV");o.className="faculty-learning-materials-list",document.getElementById("faculty-uploaded-list").appendChild(o);var s=document.createElement("a");s.setAttribute("onClick","deleteUploadedDocsModal(event)"),s.setAttribute("href","#/"),s.setAttribute("aria-label","Delete Document"),s.setAttribute("fileName",t[a].fileName),s.setAttribute("fileId",t[a].fileId),o.appendChild(s);var n,i,r=document.createElement("IMG");if(r.className="faculty-code-info-btn",r.setAttribute("src","img/bookshelf/x-delete-button.png"),r.setAttribute("fileName",t[a].fileName),r.setAttribute("fileId",t[a].fileId),r.setAttribute("alt","Delete document"),r.setAttribute("onClick","deleteUploadedDocsModal(event)"),r.style.cursor="pointer",s.appendChild(r),".doc"===t[a].fileType)(n=document.createElement("a")).setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),n.setAttribute("href","#/"),n.setAttribute("aria-label","Microsoft Word"),n.setAttribute("fileId",t[a].fileId),o.appendChild(n),(i=document.createElement("IMG")).className="faculty-materials-icon",i.setAttribute("src","img/bookshelf/doc-icon.png"),i.setAttribute("alt","Microsoft Word"),i.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),i.setAttribute("fileId",t[a].fileId),n.appendChild(i);if(".docx"===t[a].fileType)(n=document.createElement("a")).setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),n.setAttribute("href","#/"),n.setAttribute("aria-label","Microsoft Word"),n.setAttribute("fileId",t[a].fileId),o.appendChild(n),(i=document.createElement("IMG")).className="faculty-materials-icon",i.setAttribute("src","img/bookshelf/doc-icon.png"),i.setAttribute("alt","Microsoft Word"),i.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),i.setAttribute("fileId",t[a].fileId),n.appendChild(i);if(".ppt"===t[a].fileType||".pptx"===t[a].fileType)(n=document.createElement("a")).setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),n.setAttribute("href","#/"),n.setAttribute("aria-label","Microsoft PowerPoint"),n.setAttribute("fileId",t[a].fileId),o.appendChild(n),(i=document.createElement("IMG")).className="faculty-materials-icon",i.setAttribute("src","img/bookshelf/ppt-icon.png"),i.setAttribute("alt","Microsoft PowerPoint"),i.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),i.setAttribute("fileId",t[a].fileId),n.appendChild(i);if(".pdf"===t[a].fileType)(n=document.createElement("a")).setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),n.setAttribute("href","#/"),n.setAttribute("aria-label","PDF"),n.setAttribute("fileId",t[a].fileId),o.appendChild(n),(i=document.createElement("IMG")).className="faculty-materials-icon",i.setAttribute("src","img/bookshelf/pdf-icon.png"),i.setAttribute("alt","PDF"),i.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),i.setAttribute("fileId",t[a].fileId),n.appendChild(i);if(".jpg"===t[a].fileType||".JPG"===t[a].fileType||".png"===t[a].fileType||".PNG"===t[a].fileType||".jpeg"===t[a].fileType||".JPEG"===t[a].fileType||".tif"===t[a].fileType||".TIF"===t[a].fileType)(n=document.createElement("a")).setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),n.setAttribute("href","#/"),n.setAttribute("aria-label","Image"),n.setAttribute("fileId",t[a].fileId),o.appendChild(n),(i=document.createElement("IMG")).className="faculty-materials-icon",i.setAttribute("src","img/bookshelf/jpg-icon.png"),i.setAttribute("alt","Image"),i.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),i.setAttribute("fileId",t[a].fileId),n.appendChild(i);if(".zip"===t[a].fileType)(n=document.createElement("a")).setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),n.setAttribute("href","#/"),n.setAttribute("aria-label","ZIP"),n.setAttribute("fileId",t[a].fileId),o.appendChild(n),(i=document.createElement("IMG")).className="faculty-materials-icon",i.setAttribute("src","img/bookshelf/zip-icon.png"),i.setAttribute("alt","ZIP"),i.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),i.setAttribute("fileId",t[a].fileId),n.appendChild(i);if(".xls"===t[a].fileType||".xlsx"===t[a].fileType)(n=document.createElement("a")).setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),n.setAttribute("href","#/"),n.setAttribute("aria-label","Microsoft Excel"),n.setAttribute("fileId",t[a].fileId),o.appendChild(n),(i=document.createElement("IMG")).className="faculty-materials-icon",i.setAttribute("src","img/bookshelf/xls-icon.png"),i.setAttribute("alt","Microsoft Excel"),i.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),i.setAttribute("fileId",t[a].fileId),n.appendChild(i);if(".rtf"===t[a].fileType)(n=document.createElement("a")).setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),n.setAttribute("href","#/"),n.setAttribute("aria-label","Rich Text Format"),n.setAttribute("fileId",t[a].fileId),o.appendChild(n),(i=document.createElement("IMG")).className="faculty-materials-icon",i.setAttribute("src","img/bookshelf/rtf-icon.png"),i.setAttribute("alt","Rich Text Format"),i.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),i.setAttribute("fileId",t[a].fileId),n.appendChild(i);var l=document.createElement("a");l.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),l.setAttribute("href","#/"),l.setAttribute("aria-label",t[a].fileName),l.setAttribute("fileName",t[a].fileName),l.setAttribute("fileId",t[a].fileId),o.appendChild(l);var c=document.createElement("span");c.className="faculty-docs-name-list reset-additional-info display-inline-block",c.innerHTML=t[a].fileName,c.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),c.setAttribute("title",t[a].fileName),c.setAttribute("aria-label",t[a].fileName),c.setAttribute("fileId",t[a].fileId),l.appendChild(c)}$("#page-loading-spinner").hide()}else $("#faculty-uploaded-list").html(""),$("#page-loading-spinner").hide();else $("#page-loading-spinner").hide();sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function getBookShelfSetupMessage(){var e={userVO:{userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId,userActivityVO:{lastActivityCode:"BOOKSHELF_GET_USER_SETTINGS",pageNavigatingFrom:"Bookshelf",pageNavigatingTo:"Bookshelf"},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageUserService/getBookShelfSetupMessageDisplayStatus",type:"POST",contentType:"application/json",accept:"application/json",async:!1,data:JSON.stringify(e)}).then(function(e){"true"===e.status&&(void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),CaseConnect.bookShelfSetupDisplayMessageFlag=e.userSettingsVO.bookShelfSetupDisplayMessageFlag,"Professor"===map.userRole?$("#new-bookshelf-modal-faculty").modal("show"):$("#new-bookshelf-modal-student").modal("show")),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),alertMessagesModal(exceptionMsg.systemError)})}function saveBookShelfSetupMessage(){CaseConnect.bookShelfSetupDisplayMessageFlag=!1;var e={userVO:{userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId,userActivityVO:{lastActivityCode:"BOOKSHELF_SAVE_USER_SETTINGS",pageNavigatingFrom:"Bookshelf",pageNavigatingTo:"Bookshelf"},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},userSettingsVO:{userId:map.userId,bookShelfSetupDisplayMessageFlag:CaseConnect.bookShelfSetupDisplayMessageFlag,createdBy:map.userId,modifiedBy:map.userId}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageUserService/saveBookShelfSetupMessageDisplayStatus",type:"POST",contentType:"application/json",accept:"application/json",async:!1,data:JSON.stringify(e)}).then(function(e){"true"===e.status&&(void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),$("#page-loading-spinner").hide()),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),alertMessagesModal(exceptionMsg.systemError)})}function saveClassInsightClassCreation(){$("#faculty-create-class-message").on("hidden.bs.modal",function(e){$("#archivedStudyDashboard,#archivedSeperator,#hyperLinkForArchive").hide(),setTimeout(function(){$("#faculty-class-name").focus()},30)})}function getClassInsightStudentEnrollmentMessage(){var e={userVO:{userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId,userActivityVO:{lastActivityCode:"CLASS_INSIGHT_GET_USER_SETTINGS",pageNavigatingFrom:"ClassInsight",pageNavigatingTo:"ClassInsight",lastReadBookId:CaseConnect.currentBookId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageUserService/getClassInsightStudentEnrollmentMessageDisplayStatus",type:"POST",contentType:"application/json",accept:"application/json",async:!1,data:JSON.stringify(e)}).then(function(e){"true"===e.status&&(void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),"false"!==(studentEnrollMessageDisplayStatus=e.userSettingsVO.classInsightStudentEnrollmentDisplayMessageFlag)?$("#student-enroll-success-message").modal("show"):alertMessagesModal("Student Enrolled Successfully."),$("#page-loading-spinner").hide()),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),alertMessagesModal(exceptionMsg.systemError)})}function saveClassInsightStudentEnrollment(){studentEnrollMessageDisplayStatus="false";var e={userVO:{userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId,userActivityVO:{lastActivityCode:"CLASS_INSIGHT_SAVE_USER_SETTINGS",pageNavigatingFrom:"ClassInsight",pageNavigatingTo:"ClassInsight",lastReadBookId:CaseConnect.currentBookId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},userSettingsVO:{userId:map.userId,classInsightStudentEnrollmentDisplayMessageFlag:studentEnrollMessageDisplayStatus,createdBy:map.userId,modifiedBy:map.userId}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageUserService/saveClassInsightStudentEnrollmentMessageDisplayStatus",type:"POST",contentType:"application/json",accept:"application/json",async:!1,data:JSON.stringify(e)}).then(function(e){"true"===e.status&&(void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),$("#page-loading-spinner").hide()),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),alertMessagesModal(exceptionMsg.systemError)})}function getApplicationOverlayTutorialMessage(){var e={userVO:{userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId,userActivityVO:{lastActivityCode:"BOOKSHELF_SAVE_USER_SETTINGS",pageNavigatingFrom:"Bookshelf",pageNavigatingTo:"Bookshelf",lastReadBookId:CaseConnect.currentBookId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageUserService/getApplicationOverlayTutorialMessageDisplayStatus",type:"POST",contentType:"application/json",accept:"application/json",async:!1,data:JSON.stringify(e)}).then(function(e){"true"===e.status&&(void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),CaseConnect.applicationOverlayTutorialDisplayMessageFlag=e.userSettingsVO.applicationOverlayTutorialDisplayMessageFlag,"true"===CaseConnect.applicationOverlayTutorialDisplayMessageFlag&&(tutorialApplicationBookType=e.userSettingsVO.bookType),e.userSettingsVO.enforceEulaTutorialFlag&&"true"==e.userSettingsVO.enforceEulaTutorialFlag?($("#eula-validation-modal").modal("show"),$(".eula-text-container").load("endUserLisenceAggrement.html"),"true"==CaseConnect.applicationOverlayTutorialDisplayMessageFlag?$("#eula-validation-modal button").removeAttr("id","class").removeAttr("style").attr({id:"btn-eula-accept",class:"btn btn-default popover-common-btn ereader-btn-custom-gradient",onClick:"saveEulaValidationStatus(event,false)"}):$("#eula-validation-modal button").removeAttr("id","class").removeAttr("style").attr({id:"btn-eula-accept",class:"btn btn-default popover-common-btn ereader-btn-custom-gradient",onClick:"saveApplicationOverlayTutorialMessage(true)"})):"true"===CaseConnect.applicationOverlayTutorialDisplayMessageFlag&&(tutorialApplicationBookType=e.userSettingsVO.bookType,welcomeTutorial()),$("#page-loading-spinner").hide()),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),alertMessagesModal(exceptionMsg.systemError)})}function saveApplicationOverlayTutorialMessage(e){CaseConnect.applicationOverlayTutorialDisplayMessageFlag="false",CaseConnect.firstTimeLoginFlag="false",localStorage.setItem("firstTimeLoginFlag","false"),$("#new-bookshelf-modal-faculty").modal("hide");var t={userVO:{userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId,userActivityVO:{lastActivityCode:"BOOKSHELF_SAVE_USER_SETTINGS",pageNavigatingFrom:"Bookshelf",pageNavigatingTo:"Bookshelf",lastReadBookId:CaseConnect.currentBookId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},userSettingsVO:{userId:map.userId,createdBy:map.userId,modifiedBy:map.userId}};e?"onlyEula"==e?t.userSettingsVO.enforceEulaTutorialFlag="false":(t.userSettingsVO.enforceEulaTutorialFlag="false",t.userSettingsVO.applicationOverlayTutorialDisplayMessageFlag="false",t.userSettingsVO.bookType=tutorialApplicationBookType):(t.userSettingsVO.applicationOverlayTutorialDisplayMessageFlag=CaseConnect.applicationOverlayTutorialDisplayMessageFlag,t.userSettingsVO.bookType=tutorialApplicationBookType),$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageUserService/saveApplicationOverlayTutorialMessageDisplayStatus",type:"POST",contentType:"application/json",accept:"application/json",async:!1,data:JSON.stringify(t)}).then(function(e){slideIndex=1,caseBookTutorial=!1,practicePackTutorial=!1,studyAidTutorial=!1,"true"===e.status&&(void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),$("#page-loading-spinner").hide(),document.activeElement.blur(),$(".connections-logo").parent().focus(),$("[eulaFlag='true']").attr("eulaFlag","false")),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),alertMessagesModal(exceptionMsg.systemError)})}function closeTutorialModal(){$("#tutorialModal").modal("hide")}function facultyDeleteClass(){var reqData={userVO:{userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId,userActivityVO:{lastActivityCode:"CLASS_INSIGHT_DELETE_CLASS",pageNavigatingFrom:"class-insight",pageNavigatingTo:"",lastReadBookId:CaseConnect.currentBookId,lastViewedClassId:CaseConnect.currentClassId},sessionVO:{appType:CaseConnect.appType,browserName:CaseConnect.browserName,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:"false",ipAddress:localStorage.getItem("ipAddress"),sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},classVO:{classId:CaseConnect.currentClassId,bookId:CaseConnect.currentBookId}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageClassWebService/deleteClass",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(reqData)}).then(function(data){if(void 0!==data.sessionAuthenticationToken&&(localStorage.setItem("sessionAuthenticationToken",data.sessionAuthenticationToken),"true"===data.status)){CaseConnect.currentClassId="";var handler="goToBookShelf",request={},data={};request.url="/bookShelfRetrivalService/getBookList",request.url=properties[properties.env]+request.url,request.method="POST",request.handler=eval("Handler."+handler),request.data=data,request.handler.request.apply(null,[request]),Utility.fireRequest(request),localStorage.setItem("InsideClasInsights","false")}sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function facultyDeleteClassConfirmation(){$("#faculty-delete-class-confirmation-window").modal("show")}function backToClassInsights(){$("#archivedStudyDashboard,#archivedSeperator,#hyperLinkForArchive").hide(),$("#ereader-nav-menu-mobile").modal("hide"),$("#outline-nav-menu-mobile").modal("hide"),$("#themis-nav-menu-mobile").modal("hide"),$("#study-nav-menu-mobile").modal("hide"),$("#bookshelf-nav-menu-mobile").modal("hide"),$("#cases-nav-menu-mobile").modal("hide"),$("#news-feed-nav-mobile").modal("hide"),setTimeout(function(){if("Professor"===map.userRole)getClassDetails();else if("Student"===map.userRole){var handler="getClassDetails",request={},req_data={};request.url="/manageClassWebService/getClassDetails",request.url=properties[properties.env]+request.url,request.method="POST",request.handler=eval("Handler."+handler),request.data=req_data,request.handler.request.apply(null,[request]),Utility.fireRequest(request),insideEreader=!1,insideThemis=!1,insideThemisAdmin=!1,insideCQuizzing=!1,insidePracticePerfect=!1,$(window).trigger("resize")}},500)}function facultyCreateClassWelcome(){$("#faculty-create-class-welcome-modal").modal("show")}function studentEnrollClassWelcome(){$("#student-enroll-class-welcome-modal").modal("show")}function copyClassClicked(e){map.wk_conatiner.load("professorCreateClass.html?v19894",function(){$(window).scrollTop(0),$("#archivedStudyDashboard,#archivedSeperator,#hyperLinkForArchive").hide(),displayTooltipContent(),$("#bookshelflink").show(),$("#bookshelf-nav-menu-mobile").modal("hide"),insideNewsFeed=!1,insideCasesPage=!1,insideResourcePage=!1,insideStudycenterPage=!1,insideOutline=!1,insideEreader=!1,insideThemis=!1,insideThemisAdmin=!1,insideCQuizzing=!1,insidePracticePerfect=!1,insideGlobalSearchResult=!1,insideClassInsightsPage=!0,"true"==CaseConnect.resourceFlag&&$(".resourceMenushow").removeClass("resourceMenuhide"),"true"===CaseConnect.casesFlag?CaseConnect.bookType?"oer"!==CaseConnect.bookType&&$(".hide-case-page-class").show():$(".hide-case-page-class").show():$(".hide-case-page-class").hide(),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide(),bookSpecificFeatureDisplay(),null!==CaseConnect.currentBookId&&""!==CaseConnect.currentBookId&&void 0!==CaseConnect.currentBookId&&(checkNewsFeedInApp(),expiryDate()),getMyRequestNoftificationCount();var t=document.documentElement;t.setAttribute("data-useragent",navigator.userAgent),t.setAttribute("data-platform",navigator.platform),navigator.userAgent.match(/Trident\/[6]/i)&&$(".bookshelf-doc-dropdown").css({position:"static","background-image":"none"}),document.getElementById("faculty-class-name").value=e.target.getAttribute("class-name"),document.getElementById("faculty-description-detail").value=e.target.getAttribute("class-description"),$(".thumbnail-image").attr("src",e.target.getAttribute("thumbnail-image-path")).attr("alt",e.target.getAttribute("current-book-title")),$(".bookshelf-book-title").html(e.target.getAttribute("current-book-title")),$(".ereader-main-header-title").html(e.target.getAttribute("current-book-title")),$(".read-modal-book-title").html(e.target.getAttribute("current-book-title")),$("#faculty-save-class-btn").removeAttr("data-handler"),$("#faculty-save-class-btn").removeAttr("data-action"),$("#faculty-save-class-btn").attr("onClick","copyClassFromExistingClass()"),$(".faculty-open-book").css("display","none")[0],$(".faculty-button-cover").css("display","none"),$("#faculty-save-class-btn").css("display","inline-block"),adjustLeftNavHeight(),$(window).trigger("resize"),adminSuppressFunc()})}function copyClassFromExistingClass(){insideStaticPage=!1,insideBookshelf=!1,$("#archivedStudyDashboard,#archivedSeperator,#hyperLinkForArchive").hide();var reqData={userVO:{userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId,userActivityVO:{lastActivityCode:"CLASS_INSIGHT_ADD_CLASS",pageNavigatingFrom:"ClassInsight",pageNavigatingTo:"ClassInsight",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:CaseConnect.lastViewedOutlineId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,ipAddress:localStorage.getItem("ipAddress"),sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},classVO:{className:$("#faculty-class-name").val(),classDescription:$("#faculty-description-detail").val(),semesterYear:$("#faculty-semester-year").val(),section:$("#faculty-section-name").val(),meetingTime:$("#faculty-meeting-times").val(),bookId:CaseConnect.currentBookId,parentClassId:lastVisitedClassId,copiedFromOtherClassFlag:"true"}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageClassWebService/copyClass",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(reqData)}).then(function(data){if(void 0!==data.sessionAuthenticationToken)if("true"===data.status){if(data.bookVO){var bookTitle=data.bookVO.bookTitle;thumbnailimagepath=data.bookVO.thumbnailImagePath}CaseConnect.currentChapterId="",data.classVO?(lastVisitedClassId=data.classVO.classId,insideClassInsightsPage=!0,"-99999"===data.classVO.classId?(localStorage.setItem("module","insights"),map.wk_conatiner.load("professorCreateClass.html?v19894",function(){$(window).scrollTop(0),displayTooltipContent(),$("#bookshelflink").show(),$("#bookshelf-nav-menu-mobile").modal("hide"),"true"==CaseConnect.resourceFlag&&$(".resourceMenushow").removeClass("resourceMenuhide"),"true"===CaseConnect.casesFlag?CaseConnect.bookType?"oer"!==CaseConnect.bookType&&$(".hide-case-page-class").show():$(".hide-case-page-class").show():$(".hide-case-page-class").hide(),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide(),bookSpecificFeatureDisplay();var e=document.documentElement;e.setAttribute("data-useragent",navigator.userAgent),e.setAttribute("data-platform",navigator.platform),navigator.userAgent.match(/Trident\/[6]/i)&&$(".bookshelf-doc-dropdown").css({position:"static","background-image":"none"}),$(".thumbnail-image").attr("src",thumbnailimagepath).attr("alt",bookTitle),$(".bookshelf-book-title").html(bookTitle),$(".ereader-main-header-title").html(bookTitle),$(".read-modal-book-title").html(bookTitle),$(".faculty-open-book").css("display","none"),CaseConnect.currentBookId=CaseConnect.bookData.bookId,CaseConnect.currentClassId="",facultyCreateClassWelcome(),adjustLeftNavHeight(),$(window).trigger("resize"),adminSuppressFunc()})):(CaseConnect.currentClassId=data.classVO.classId,map.wk_conatiner.load("professorCreateClass.html?v19895",function(){insideCasesPage=!1,insideEreader=!1,insideThemis=!1,insideThemisAdmin=!1,insideCQuizzing=!1,insidePracticePerfect=!1,insideNewsFeed=!1,insideAssessment=!1,insideOutline=!1,insideResourcePage=!1,insideStudycenterPage=!1,insideStaticPage=!1,insideBookshelf=!1,insideGlobalSearchResult=!1,$(window).scrollTop(0),displayTooltipContent(),$("#bookshelflink").show(),$("#bookshelf-nav-menu-mobile").modal("hide"),$(".class-insights-header").html("Class Insights"),"true"==CaseConnect.resourceFlag&&$(".resourceMenushow").removeClass("resourceMenuhide"),"true"===CaseConnect.casesFlag?CaseConnect.bookType?"oer"!==CaseConnect.bookType&&$(".hide-case-page-class").show():$(".hide-case-page-class").show():$(".hide-case-page-class").hide(),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide(),bookSpecificFeatureDisplay();var b=document.documentElement;b.setAttribute("data-useragent",navigator.userAgent),b.setAttribute("data-platform",navigator.platform);var ie10=navigator.userAgent.match(/Trident\/[6]/i);if(ie10&&$(".bookshelf-doc-dropdown").css({position:"static","background-image":"none"}),!CaseConnect.bookData&&CaseConnect.navigatingAwayFromNewBookshelf){for(var bookDataArr=CaseConnect.navigatingAwayFromNewBookshelf,count=0;count<bookDataArr.length;++count)if(bookDataArr[count].bookId==CaseConnect.currentBookId){CaseConnect.bookData=bookDataArr[count];break}}else data.bookVO&&(CaseConnect.bookData=data.bookVO);if(null!==CaseConnect.currentBookId&&""!==CaseConnect.currentBookId&&void 0!==CaseConnect.currentBookId&&(checkNewsFeedInApp(),expiryDate()),getMyRequestNoftificationCount(),$("#faculty-copy-button").attr({"class-description":data.classVO.classDescription,"class-name":"Copy of "+data.classVO.className,"thumbnail-image-path":thumbnailimagepath,"current-book-title":bookTitle,copyClassButtonClicked:!0}),$(".thumbnail-image").attr("src",thumbnailimagepath).attr("alt",bookTitle),$(".bookshelf-book-title").html(bookTitle),$(".ereader-main-header-title").html(bookTitle),$(".read-modal-book-title").html(bookTitle),$("#class-insights-heading").text("Class Insights"),$(".classinsights-heading").html("Class Insights"),$(".class-insights-right-header-wrap").css("display","inline-block"),$("#class-insights-right-header").css("display","inline-block"),$("#faculty-save-cancel-buttons").css("display","none"),$("#faculty-save-cancel-buttons-mobile").css("display","none"),facultyClassNameData=data.classVO.className,facultyFacultyNameData=data.classVO.semesterYear,facultySectionNameData=data.classVO.section,facultyMeetingNameData=data.classVO.meetingTime,facultyDescNameData=data.classVO.classDescription,classDetailCreatedBy=data.classVO.createdBy,document.getElementById("faculty-class-name").value=data.classVO.className,document.getElementById("faculty-semester-year").value=data.classVO.semesterYear,document.getElementById("faculty-section-name").value=data.classVO.section,document.getElementById("faculty-meeting-times").value=data.classVO.meetingTime,document.getElementById("faculty-description-detail").value=data.classVO.classDescription,currentClassCreatedDate=data.classVO.createdDate,data.bookVO.classVOList){!data.bookVO.classVOList.length>0&&(data.bookVO.classVOList=[data.bookVO.classVOList]);var compiledTemplate1=Handlebars.getTemplate("ereader-classList"),html1=compiledTemplate1(data);$("#class-insights-right-header").append(html1)}$("#after-class-id-generated").css("display","inline-block"),$("#facultyClassCode").html(data.classVO.classCode.toUpperCase()),$(".faculty-class-insights-code-info-btn").attr("title","This unique Class Code was generated for this class. Share this class code with your students for easy enrollment in your class. Students registered from your school will also be able to browse for your class if you choose not to share the Class Code."),$(".faculty-open-book").css("display","none");var handler="getStudyDashBoardForProfessor",request={},reqData={};if(request.url="/manageClassWebService/getStudyDashBoardForProfessorOrStudent",request.url=properties[properties.env]+request.url,request.method="POST",request.handler=eval("Handler."+handler),request.data=reqData,request.handler.request.apply(null,[request]),Utility.fireRequest(request),$(".class-insights-right-header-wrap").css("display","inline-block"),$("#class-insights-right-header").css("display","inline-block"),$(".classinsights-heading").html("Class Insights"),$("#right-header-bookTitle").html(bookTitle.toUpperCase()),$("#right-header-bookTitle").attr("title",bookTitle),"true"===data.classVO.classCreatorFlag?$("#faculty-delete-class-button").show():$("#faculty-delete-class-button").hide(),void 0!==data.classVO.coProfessorList)if("true"===data.classVO.classCreatorFlag)if($("#faculty-delete-class-button").show(),$(".add-books").show(),$("#coTeacherTitle").text("ADD CO-TEACHERS OR TEACHING ASSISTANTS"),void 0!==data.classVO.coProfessorList.length)for(var i=0;i<data.classVO.coProfessorList.length;i++){var profId="deleteProf"+data.classVO.coProfessorList[i].userId;$("#coTeacherSection").append("<div><a id='deleteProf"+data.classVO.coProfessorList[i].userId+"' onClick='deleteProfesssor(this.id)'><img src='img/bookshelf/x-delete-button.png' class='faculty-code-info-btn'></a><label class='faculty-co-teachers-list'>"+data.classVO.coProfessorList[i].combinedFirstNameAndLastNameForSorting+"</label></div>")}else $("#coTeacherSection").append("<div><a id='deleteProf"+data.classVO.coProfessorList.userId+"' onClick='deleteProfesssor(this.id)'><img src='img/bookshelf/x-delete-button.png' class='faculty-code-info-btn'></a><label class='faculty-co-teachers-list'>"+data.classVO.coProfessorList.combinedFirstNameAndLastNameForSorting+"</label></div>");else if($("#faculty-delete-class-button").hide(),$(".add-books").hide(),$("#coTeacherTitle").text("CO-TEACHERS OR TEACHING ASSISTANTS"),void 0!==data.classVO.coProfessorList.length)for(var i=0;i<data.classVO.coProfessorList.length;i++){var profId="deleteProf"+data.classVO.coProfessorList[i].userId;$("#coTeacherSection").append("<div><label class='faculty-co-teachers-list'>"+data.classVO.coProfessorList[i].combinedFirstNameAndLastNameForSorting+"</label></div>")}else $("#coTeacherSection").append("<div><label class='faculty-co-teachers-list'>"+data.classVO.coProfessorList.combinedFirstNameAndLastNameForSorting+"</label></div>");if(void 0!==data.classVO.fileList){var docsList=[];if(data.classVO.fileList.length>0?docsList=data.classVO.fileList:docsList.push(data.classVO.fileList),docsList.length>0)for(var i=0;i<docsList.length;i++){docsList.length>4?$("#faculty-uploaded-list").css({"max-height":"140px","overflow-y":"scroll"}):$("#faculty-uploaded-list").css({"max-height":"1005","overflow-y":"hidden"}),fileNameForFacultyDocs=docsList[i].fileName,fileIdForFacultyDocs=docsList[i].fileId;var facultyOtherDocs=document.createElement("DIV");facultyOtherDocs.className="faculty-learning-materials-list",document.getElementById("faculty-uploaded-list").appendChild(facultyOtherDocs);var facultyOtherDocsDeleteAnchor=document.createElement("a");facultyOtherDocsDeleteAnchor.setAttribute("onClick","deleteUploadedDocsModal(event)"),facultyOtherDocsDeleteAnchor.setAttribute("href","#/"),facultyOtherDocsDeleteAnchor.setAttribute("aria-label","Delete document"),facultyOtherDocsDeleteAnchor.setAttribute("fileName",docsList[i].fileName),facultyOtherDocsDeleteAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsDeleteAnchor);var facultyOtherDocsDelete=document.createElement("IMG");if(facultyOtherDocsDelete.className="faculty-code-info-btn",facultyOtherDocsDelete.setAttribute("src","img/bookshelf/x-delete-button.png"),facultyOtherDocsDelete.setAttribute("fileName",docsList[i].fileName),facultyOtherDocsDelete.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsDelete.setAttribute("alt","Delete document"),facultyOtherDocsDelete.setAttribute("onClick","deleteUploadedDocsModal(event)"),facultyOtherDocsDelete.style.cursor="pointer",facultyOtherDocsDeleteAnchor.appendChild(facultyOtherDocsDelete),".doc"===docsList[i].fileType){var facultyOtherDocsAnchor=document.createElement("a");facultyOtherDocsAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.setAttribute("href","#/"),facultyOtherDocsAnchor.setAttribute("aria-label","Microsoft Word"),facultyOtherDocsAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsAnchor);var facultyOtherDocsIcon=document.createElement("IMG");facultyOtherDocsIcon.className="faculty-materials-icon",facultyOtherDocsIcon.setAttribute("src","img/bookshelf/doc-icon.png"),facultyOtherDocsIcon.setAttribute("alt","Microsoft Word"),facultyOtherDocsIcon.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsIcon.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.appendChild(facultyOtherDocsIcon)}if(".docx"===docsList[i].fileType){var facultyOtherDocsAnchor=document.createElement("a");facultyOtherDocsAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.setAttribute("href","#/"),facultyOtherDocsAnchor.setAttribute("aria-label","Microsoft Word"),facultyOtherDocsAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsAnchor);var facultyOtherDocsIcon=document.createElement("IMG");facultyOtherDocsIcon.className="faculty-materials-icon",facultyOtherDocsIcon.setAttribute("src","img/bookshelf/doc-icon.png"),facultyOtherDocsIcon.setAttribute("alt","Microsoft Word"),facultyOtherDocsIcon.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsIcon.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.appendChild(facultyOtherDocsIcon)}if(".pdf"===docsList[i].fileType){var facultyOtherDocsAnchor=document.createElement("a");facultyOtherDocsAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.setAttribute("href","#/"),facultyOtherDocsAnchor.setAttribute("aria-label","PDF"),facultyOtherDocsAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsAnchor);var facultyOtherDocsIcon=document.createElement("IMG");facultyOtherDocsIcon.className="faculty-materials-icon",facultyOtherDocsIcon.setAttribute("src","img/bookshelf/pdf-icon.png"),facultyOtherDocsIcon.setAttribute("alt","PDF"),facultyOtherDocsIcon.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsIcon.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.appendChild(facultyOtherDocsIcon)}if(".ppt"===docsList[i].fileType||".pptx"===docsList[i].fileType){var facultyOtherDocsAnchor=document.createElement("a");facultyOtherDocsAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.setAttribute("href","#/"),facultyOtherDocsAnchor.setAttribute("aria-label","Microsoft PowerPoint"),facultyOtherDocsAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsAnchor);var facultyOtherDocsIcon=document.createElement("IMG");facultyOtherDocsIcon.className="faculty-materials-icon",facultyOtherDocsIcon.setAttribute("src","img/bookshelf/ppt-icon.png"),facultyOtherDocsIcon.setAttribute("alt","Microsoft PowerPoint"),facultyOtherDocsIcon.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsIcon.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.appendChild(facultyOtherDocsIcon)}if(".jpg"===docsList[i].fileType||".JPG"===docsList[i].fileType||".png"===docsList[i].fileType||".PNG"===docsList[i].fileType||".jpeg"===docsList[i].fileType||".JPEG"===docsList[i].fileType||".tif"===docsList[i].fileType||".TIF"===docsList[i].fileType){var facultyOtherDocsAnchor=document.createElement("a");facultyOtherDocsAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.setAttribute("href","#/"),facultyOtherDocsAnchor.setAttribute("aria-label","Image"),facultyOtherDocsAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsAnchor);var facultyOtherDocsIcon=document.createElement("IMG");facultyOtherDocsIcon.className="faculty-materials-icon",facultyOtherDocsIcon.setAttribute("src","img/bookshelf/jpg-icon.png"),facultyOtherDocsIcon.setAttribute("alt","Image"),facultyOtherDocsIcon.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsIcon.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsAnchor.appendChild(facultyOtherDocsIcon)}if(".zip"===docsList[i].fileType){var facultyOtherDocsAnchor=document.createElement("a");facultyOtherDocsAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.setAttribute("href","#/"),facultyOtherDocsAnchor.setAttribute("aria-label","ZIP"),facultyOtherDocsAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsAnchor);var facultyOtherDocsIcon=document.createElement("IMG");facultyOtherDocsIcon.className="faculty-materials-icon",facultyOtherDocsIcon.setAttribute("src","img/bookshelf/zip-icon.png"),facultyOtherDocsIcon.setAttribute("alt","ZIP"),facultyOtherDocsIcon.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsIcon.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsAnchor.appendChild(facultyOtherDocsIcon)}if(".xls"===docsList[i].fileType||".xlsx"===docsList[i].fileType){var facultyOtherDocsAnchor=document.createElement("a");facultyOtherDocsAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.setAttribute("href","#/"),facultyOtherDocsAnchor.setAttribute("aria-label","Microsoft Excel"),facultyOtherDocsAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsAnchor);var facultyOtherDocsIcon=document.createElement("IMG");facultyOtherDocsIcon.className="faculty-materials-icon",facultyOtherDocsIcon.setAttribute("src","img/bookshelf/xls-icon.png"),facultyOtherDocsIcon.setAttribute("alt","Microsoft Excel"),facultyOtherDocsIcon.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsIcon.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsAnchor.appendChild(facultyOtherDocsIcon)}if(".rtf"===docsList[i].fileType){var facultyOtherDocsAnchor=document.createElement("a");facultyOtherDocsAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsAnchor.setAttribute("href","#/"),facultyOtherDocsAnchor.setAttribute("aria-label","Rich Text Format"),facultyOtherDocsAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsAnchor);var facultyOtherDocsIcon=document.createElement("IMG");facultyOtherDocsIcon.className="faculty-materials-icon",facultyOtherDocsIcon.setAttribute("src","img/bookshelf/rtf-icon.png"),facultyOtherDocsIcon.setAttribute("alt","Rich Text Format"),facultyOtherDocsIcon.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsIcon.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsAnchor.appendChild(facultyOtherDocsIcon)}var facultyOtherDocsLabelAnchor=document.createElement("a");facultyOtherDocsLabelAnchor.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsLabelAnchor.setAttribute("href","#/"),facultyOtherDocsLabelAnchor.setAttribute("fileName",docsList[i].fileName),facultyOtherDocsLabelAnchor.setAttribute("fileId",docsList[i].fileId),facultyOtherDocs.appendChild(facultyOtherDocsLabelAnchor);var facultyOtherDocsLabel=document.createElement("span");facultyOtherDocsLabel.className="faculty-docs-name-list reset-additional-info display-inline-block",facultyOtherDocsLabel.setAttribute("onClick","Handler.click.downloadFacultyDocumet(event);"),facultyOtherDocsLabel.setAttribute("title",docsList[i].fileName),facultyOtherDocsLabel.setAttribute("fileId",docsList[i].fileId),facultyOtherDocsLabel.innerHTML=docsList[i].fileName,facultyOtherDocsLabelAnchor.appendChild(facultyOtherDocsLabel)}}else data.classVO.fileList;adjustLeftNavHeight(),$(window).trigger("resize"),adminSuppressFunc()}))):$("#page-loading-spinner").hide(),$("#page-loading-spinner").hide()}else $("#page-loading-spinner").hide();sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function showAddNotePopoverOnly(){(removeDefaultSelectionColor(),$(".delete-btn").css("visibility","hidden")[1],$(".save-note-icon").css("visibility","hidden")[1],updatingNote||(addingNote=!0),insideEreader)&&(void 0!==$("#"+selectedNoteId).offset()&&$("#"+selectedNoteId).offset().top-topOffset<250&&$(window).height()-$("#"+selectedNoteId).height()-$("#"+selectedNoteId).offset().top<250&&(makingSpaceForpopoverToBeDisplayed=!0,document.getElementById("ereader-scroller").scrollTop=document.getElementById(selectedNoteId).offsetTop-250,yValue=document.getElementById(selectedNoteId).getBoundingClientRect().top));$("#"+selectedNoteId).popover("destroy"),$("#"+selectedNoteId).popover({html:!0,placement:"auto bottom",trigger:"manual",container:"body",template:'<div class="popover ebook-custom-popover highlight-popover" rel=popover id="highlight-popover-notes"><div class="arrow popover-arrow"></div><div class="popover-content note-popover-content popover-without-padding" id="add-note-content-box"></div></div>',content:$("#popover-add-note-content-only").html()}),$("#"+selectedNoteId).on("shown.bs.popover",function(){var e=$("#highlight-popover-notes").offset().left,t=$(window).width()-($("#highlight-popover-notes").outerWidth()+$("#highlight-popover-notes").offset().left);if(t<0){var a=Math.abs(t);$("#highlight-popover-notes").css("left",e-a+"px")}}),$("#"+selectedNoteId).popover("show"),highlightPopoverVisible=!0,setTimeout(function(){var e;(e=$("textarea#add-note-textarea")[1].value,$("textarea#add-note-textarea")[1].value="",$("textarea#add-note-textarea")[1].value=e,initialiseKeyUpForNotePopover(),document.getElementById(selectedNoteId).style.backgroundColor||(selectedHighlightColor=""),changeHighlightImage(),document.getElementById(selectedNoteId).hasAttribute("style")?document.getElementById(selectedNoteId).hasAttribute("style")&&""===$("textarea#add-note-textarea")[1].innerHTML&&void 0!==$("button#color-blank-notes")[1]&&$("button#color-blank-notes")[1].removeAttribute("disabled"):void 0!==$("button#color-blank-notes")[1]&&$("button#color-blank-notes")[1].setAttribute("disabled","disabled"),updatingNote||addingNote)&&(Clipboard.isSupported()||copyTextToClipBoard("copyNote"),copyTextWithClipCode())},30),$("textarea#add-note-textarea").focus(),navigator.userAgent.match(/(iPad|Android|iPhone)/)||($("#highlight-popover-notes textarea#add-note-textarea").keydown(function(e){""!==$("textarea#add-note-textarea")[1].value&&9==e.keyCode&&(e.preventDefault(),$("button.save-note-icon").focus())}),$("#highlight-popover-notes button.save-note-icon").keydown(function(e){""!==$("textarea#add-note-textarea")[1].value&&9==e.keyCode&&(e.preventDefault(),$("button#color-yellow").focus())})),displayCommonAnnotationPopover=!1,$("button.copy-clipboard-true.copy-clip-button").hide(),$("input.zero-clipboard-true.copy-clip-button").hide()}function removeDefaultSelectionColor(){for(var e=$('highlight[id^="note"]'),t=0;t<e.length;t++)$(e[t]).removeClass("ereader-selection-text-color")}function showHighlightPopoverOnly(){updatingNote||(highlightPalletsVisibleOnly=!0),$("#"+selectedNoteId).popover("destroy"),$("#"+selectedNoteId).popover({html:!0,placement:"auto bottom",trigger:"manual",container:"body",template:'<div class="popover ebook-custom-popover highlight-popover" rel=popover id="highlight-popover-notes"><div class="arrow popover-arrow highlight-pallet-arrow"></div><div class="popover-content note-popover-content popover-without-padding" id="add-note-content-box"></div></div>',content:$("#popover-highlight-content-only").html()}),setTimeout(function(){$("#"+selectedNoteId).popover("show"),$("#highlight-popover-notes").css("left",leftPositionOfPopover+"px"),$("#"+selectedNoteId).on("shown.bs.popover",function(){var e=$("#highlight-popover-notes").offset().left,t=$(window).width()-($("#highlight-popover-notes").outerWidth()+$("#highlight-popover-notes").offset().left);if(t<0){var a=Math.abs(t);$("#highlight-popover-notes").css("left",e-a+"px")}})},180),document.addEventListener("focus",function(e){var t=document.getElementById("highlight-popover-notes");null!=t&&(t.contains(e.target)||(e.stopPropagation(),void 0!==t.focus()&&t.focus()))},!0),window.getSelection().removeAllRanges(),highlightPalletsVisibleOnly=!0}function initialiseKeyUpForLinkPopover(){""===$("input#add-link-url")[1].value?!0===updatingLink?(addingLink=!1,updatingLink=!0):(addingLink=!0,updatingLink=!1):""!==$("input#add-link-url")[1].value&&(addingLink=!1),$(".link-url-text").keyup(function(){var e=$("input#add-link-url")[1].value;""!==e?$(".save-link-icon").css("visibility","visible")[1]:""===e&&($(".save-link-icon").css("visibility","hidden")[1],!0===updatingLink?(addingLink=!1,updatingLink=!0):addingLink=!0)}),$(".link-comments-textarea").keyup(function(){var e=$("textarea#add-link-textarea-box")[1].value,t=$("input#add-link-url")[1].value;""!==t&&""!==e?$(".save-link-icon").css("visibility","visible")[1]:""===t&&""!==e?($(".save-link-icon").css("visibility","hidden")[1],!0===updatingLink?(addingLink=!1,updatingLink=!0):addingLink=!0):""===t&&""===e?($(".save-link-icon").css("visibility","hidden")[1],!0===updatingLink?(addingLink=!1,updatingLink=!0):addingLink=!0):""!==t&&""===e&&$(".save-link-icon").css("visibility","visible")[1]}),$(".link-url-text").on("onblur",function(){"Android"===CaseConnect.deviceOS&&"Chrome"===CaseConnect.browserName&&(document.querySelector('meta[name="viewport"]').content="width=device-width, initial-scale=1")}),$(".link-url-text").on("paste",function(){setTimeout(function(){var e=$("input#add-link-url")[1].value;""===e?$(".save-link-icon").css("visibility","hidden")[1]:""!=e&&$(".save-link-icon").css("visibility","visible")[1]},30)})}function showLinkPopover(){var e=localStorage.getItem("adminInsightsFlag");($(".delete-btn").css("visibility","hidden")[1],$(".save-link-icon").css("visibility","hidden")[1],insideEreader)&&($("#"+selectedNoteId).offset().top-topOffset<250&&$(window).height()-$("#"+selectedNoteId).height()-$("#"+selectedNoteId).offset().top<250&&(makingSpaceForpopoverToBeDisplayed=!0,document.getElementById("ereader-scroller").scrollTop=document.getElementById(selectedNoteId).offsetTop-250,yValue=document.getElementById(selectedNoteId).getBoundingClientRect().top));$("#"+selectedNoteId).popover("destroy"),$("#"+selectedNoteId).popover({html:!0,placement:"auto bottom",trigger:"manual",container:"body",template:'<div class="popover ebook-custom-popover highlight-popover" rel=popover id="highlight-popover-notes"><div class="arrow popover-arrow"></div><div class="popover-content note-popover-content popover-without-padding" id="add-note-content-box"></div></div>',content:$("#popover-add-link-content").html()}),$("#"+selectedNoteId).on("shown.bs.popover",function(){var e=$("#highlight-popover-notes").offset().left,t=$(window).width()-($("#highlight-popover-notes").outerWidth()+$("#highlight-popover-notes").offset().left);if(t<0){var a=Math.abs(t);$("#highlight-popover-notes").css("left",e-a+"px")}}),$("#"+selectedNoteId).popover("show"),displayCommonAnnotationPopover=!1,pCaseWithHeadingCitation=!1,pCaseWithHeadingOnly=!1,"false"===e&&($(".share-class-text").css({visibility:"hidden"}),$(".link-share-with-class-checkbox").css({visibility:"hidden"})),"Mac Desktop"===CaseConnect.deviceType?$(".share-class-text").css({position:"relative",bottom:"0px"}):$(".share-class-text").css({position:"relative",bottom:"4px"}),setTimeout(function(){var e;e=$("input#add-link-url")[1].value,$("input#add-link-url")[1].value="",$("input#add-link-url")[1].value=e,initialiseKeyUpForLinkPopover()},30),addingNote=!1}function saveCreatedLink(){linkCreatedOnText=!0;var e=$("input#add-link-url")[1].value,t=$("textarea#add-link-textarea-box")[1].value.replace(/</g,"&lt;").replace(/>/g,"&gt;"),a=$(".link-share-with-class-checkbox")[1].checked;if(insideCasesPage&&(CaseConnect.currentSectionId=casesSectionListOnLoad.sectionId,CaseConnect.currentSectionTitle=casesSectionListOnLoad.sectionTitle,annotationSectionId=CaseConnect.currentSectionId,annotationSectionTitle=CaseConnect.currentSectionTitle),$("#ebook-toc").popover("hide"),$("#ebook-toc-mobile").popover("hide"),$(".ebook-fontsize").popover("hide"),$(".ebook-search").popover("hide"),$(".rTsIconPopover").popover("hide"),$(document).popover("hide"),$(".ereader-chapter-list").popover("hide"),a?linkSharedWithClass="true":a||(linkSharedWithClass="false"),"chapter"===CaseConnect.bookData.chapterType||insideCasesPage)if(""!=e){$("#page-loading-spinner").show();var o=$("input#add-link-url")[1].value.indexOf("://");e=-1!==o?$("input#add-link-url")[1].value.substr(0,o).toLowerCase()+$("input#add-link-url")[1].value.substr(o):"https://"+$("input#add-link-url")[1].value,linkStartOffset=parseInt($("#"+selectedNoteId).attr("startOffset")),linkEndOffset=parseInt($("#"+selectedNoteId).attr("endOffset"));var s={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},annotationVO:{bookId:CaseConnect.currentBookId,chapterId:CaseConnect.currentChapterId,chapterTitle:CaseConnect.currentChapterTitle,sectionId:annotationSectionId,sectionTitle:annotationSectionTitle,linkUrl:e,linkStartOffset:highlightStartOffsetAtSectionLevel,linkEndOffset:highlightEndOffsetAtSectionLevel,linkDescription:t,linkBackGroundColorCode:"#ffffff",linkFontColorCode:"#007ac3",linkShareFlag:linkSharedWithClass,highlightStartParaId:annotationStartParaId,highlightEndParaId:annotationEndParaId,highlightParaStartOffset:highlightStartOffset,highlightParaEndOffset:highlightEndOffset,enclosingParaList:selectedParaIds}};insideEreader?(s.userVO.userActivityVO.lastActivityCode="EREADER_ANNOTATION_ADD_LINK",s.userVO.userActivityVO.pageNavigatingFrom="EReader",s.userVO.userActivityVO.pageNavigatingTo="EReader"):(s.userVO.userActivityVO.lastActivityCode="CASE_PAGE",s.userVO.userActivityVO.pageNavigatingFrom="CASES",s.userVO.userActivityVO.pageNavigatingTo="CASES"),$.ajax({url:properties[properties.env]+"/manageAnnotationService/addChapterLink",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(s)}).then(function(a){if(void 0!==a.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",a.sessionAuthenticationToken),$("#page-loading-spinner").hide(),displayCommonAnnotationPopover=!1,pCaseWithHeadingCitation=!1,pCaseWithHeadingOnly=!1,$("#"+selectedNoteId).popover("hide"),linkEditingForproffessor="true",0===highLightSpanIdAcrossPara.length){var o=document.getElementById(selectedNoteId);linkSpanId=0,(n=document.createElement("anchorTag")).innerHTML=o.innerHTML,n.id=selectedNoteId,n.className="anchorElementText",n.setAttribute("data-references","popover"),n.setAttribute("data-toggle","popover"),n.setAttribute("tabindex","0"),n.setAttribute("data-original-title",""),n.setAttribute("linkStartOffset",highlightStartOffsetAtSectionLevel),n.setAttribute("linkEndOffset",highlightEndOffsetAtSectionLevel),n.setAttribute("linkParaStartOffset",highlightStartOffset),n.setAttribute("linkParaEndOffset",highlightEndOffset),n.setAttribute("enclosingParaIdString",enclosingParaIdString),n.setAttribute("linkStartParaId",annotationStartParaId),n.setAttribute("linkEndParaId",annotationEndParaId),n.setAttribute("createdLinkUrl",e),n.setAttribute("createdLinkComments",t),n.setAttribute("createdLinkShareStatus",linkSharedWithClass),n.setAttribute("linkEditingForproffessor","true"),n.normalize(),o.parentNode.replaceChild(n,o),$(n).css("color","#007ac3")}else if(highLightSpanIdAcrossPara.length>0)for(var s=0;s<highLightSpanIdAcrossPara.length;s++){selectedNoteId="note"+s;var n;o=document.getElementById(selectedNoteId);(n=document.createElement("anchorTag")).innerHTML=o.innerHTML,n.id=selectedNoteId,n.className="anchorElementText",n.setAttribute("data-references","popover"),n.setAttribute("data-toggle","popover"),n.setAttribute("tabindex","0"),n.setAttribute("data-original-title",""),n.setAttribute("linkStartOffset",highlightStartOffsetAtSectionLevel),n.setAttribute("linkEndOffset",highlightEndOffsetAtSectionLevel),n.setAttribute("linkParaStartOffset",highlightStartOffset),n.setAttribute("linkParaEndOffset",highlightEndOffset),n.setAttribute("enclosingParaIdString",enclosingParaIdString),n.setAttribute("linkStartParaId",annotationStartParaId),n.setAttribute("linkEndParaId",annotationEndParaId),n.setAttribute("createdLinkUrl",e),n.setAttribute("createdLinkComments",t),n.setAttribute("createdLinkShareStatus",linkSharedWithClass),n.setAttribute("linkEditingForproffessor","true"),n.normalize(),o.parentNode.replaceChild(n,o),$(n).css("color","#007ac3")}if(a.annotationVO){if(dppAnotationId=a.annotationVO.annotationId,0===highLightSpanIdAcrossPara.length)document.getElementById("note"+highLightSpanId).id=dppAnotationId,document.getElementById(dppAnotationId).addEventListener("mouseup",linkTextClick),document.getElementById(dppAnotationId).setAttribute("startOffset",linkStartOffset),document.getElementById(dppAnotationId).setAttribute("endOffset",linkEndOffset);else if(highLightSpanIdAcrossPara.length>0){for(s=0;s<highLightSpanIdAcrossPara.length;s++)0===s?(document.getElementById("note"+s).id=dppAnotationId,document.getElementById(dppAnotationId).addEventListener("mouseup",linkTextClick),document.getElementById(dppAnotationId).setAttribute("startOffset",linkStartOffset),document.getElementById(dppAnotationId).setAttribute("endOffset",linkEndOffset)):(document.getElementById("note"+s).id=dppAnotationId+"_"+[s],document.getElementById(dppAnotationId+"_"+[s]).addEventListener("mouseup",linkTextClick),document.getElementById(dppAnotationId+"_"+[s]).setAttribute("startOffset",linkStartOffset),document.getElementById(dppAnotationId+"_"+[s]).setAttribute("endOffset",linkEndOffset));var i="";if(selectedParaIds.length>0)for(var r=0;r<selectedParaIds.length;r++)r===selectedParaIds.length-1?i+=selectedParaIds[r]:i+=selectedParaIds[r]+"|";document.getElementById(dppAnotationId).setAttribute("enclosingParaIdString",i)}selectedNoteId=dppAnotationId}yValue=document.getElementById(selectedNoteId).getBoundingClientRect().top,addingLink=!1,insideCasesPage||$(".case-excerpt-block").css("padding-left","15px"),displayLinksOnLeft(selectedNoteId,yValue,e,t,linkSharedWithClass,linkEditingForproffessor),reCalculateRtSOnLeft(),$(".delete-btn").css("visibility","visible")[1],alreadyCalled=!1,sessionTimeOut()},function(e){if(sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)){addingLink=!1,addingNote=!1,$(".delete-btn").css("visibility","hidden")[1],selectedNoteId="note"+highLightSpanId,alertMessagesModal(e.responseJSON.errorMessg),$("#"+selectedNoteId).popover("hide");var t=document.getElementById(selectedNoteId),a=document.createElement("span");a.innerHTML=t.innerHTML,a.normalize(),t.parentNode.replaceChild(a,t),$("#page-loading-spinner").hide()}else window.location=properties.ui_domain;alreadyCalled=!1})}else window.getSelection().removeAllRanges(),$("#"+selectedNoteId).popover("hide"),$("#page-loading-spinner").hide();else alertMessagesModal(exceptionMsg.highlightChapters)}function linkTextClick(){if(highlightPopoverVisible&&($("#"+selectedNoteId).popover("hide"),highlightPopoverVisible=!1),addBriefPopoverShown&&($("#"+selectedNoteId).popover("hide"),addBriefPopoverShown=!1,clickedInsidePcaseForAnnot=!1),linkIconId&&$("#"+linkIconId).popover("hide"),updatingNote=!1,highlightPopoverVisible=!1,addBriefPopoverShown=!1,clickedInsidePcaseForAnnot=!1,highlightPalletsVisibleOnly=!1,$(".ebook-fontsize").popover("hide"),$(".ebook-search").popover("hide"),$(".rTsIconPopover").popover("hide"),insideEreader&&$(document).popover("hide"),$(".ereader-chapter-list").popover("hide"),$("#note-save-confirmation-wrapper").remove(),displayCommonAnnotationPopover&&($("#"+selectedNoteId).popover("hide"),displayCommonAnnotationPopover=!1,pCaseWithHeadingCitation=!1,pCaseWithHeadingOnly=!1),displayCommonAnnotationPopover=!1,addingLink||updatingLink);else{var e,t="";window.getSelection?e=window.getSelection():void 0!==document.selection&&(e=document.selection),bodyRect=document.body.getBoundingClientRect();for(var a=e.anchorNode;!$(a.parentNode).hasClass("anchorElementText");)-1!=a.parentNode.id.indexOf("_")&&(t=a.parentNode.id,a.parentNode.id=a.parentNode.id.substring(0,a.parentNode.id.indexOf("_"))),a=a.parentNode;-1!=a.parentNode.id.indexOf("_")?(t=a.parentNode.id,selectedNoteId=a.parentNode.id.substring(0,a.parentNode.id.indexOf("_"))):selectedNoteId=a.parentNode.id;for(var o=(null===document.getElementById(selectedNoteId)?document.getElementById(t):document.getElementById(selectedNoteId)).parentNode;!$(o).hasClass("cc-section")&&null!==o;)o=o.parentNode;if(null!==o&&o.getElementsByClassName("cc-section-title").length>0?annotationSectionTitle=removeTags(o.getElementsByClassName("cc-section-title")[0].innerHTML):annotationSectionTitle="",null===document.getElementById(selectedNoteId)?element=document.getElementById(t):element=document.getElementById(selectedNoteId),rect=element.getBoundingClientRect(),yValue=rect.top,insideEreader)if($("#"+selectedNoteId).offset().top-topOffset<250&&$(window).height()-$("#"+selectedNoteId).height()-$("#"+selectedNoteId).offset().top<250)makingSpaceForpopoverToBeDisplayed=!0,document.getElementById("ereader-scroller").scrollTop=document.getElementById(selectedNoteId).offsetTop-250,yValue=document.getElementById(selectedNoteId).getBoundingClientRect().top;if((i=$(".linksIcon")).length>0)for(var s=0;s<i.length;s++)i[s].id.substring(7,i[s].id.length)===selectedNoteId&&(updatingLink=!0);var n=$("img[id='linkDiv"+selectedNoteId+"']");if(n&&n.length>0){if(showLinkPopover(),$("input#add-link-url").length>1){var i=$(".linksIcon");for(s=0;s<i.length;s++)if(i[s].id.substring(7,i[s].id.length)===n[0].id.substr(7)){$("input#add-link-url")[1].innerHTML=i[s].getAttribute("urlText"),$("input#add-link-url")[1].value=i[s].getAttribute("urlText"),"undefined"!==i[s].getAttribute("urlComments")||null!==i[s].getAttribute("urlComments")?$("textarea#add-link-textarea-box")[1].value=i[s].getAttribute("urlComments").replace(/&lt;/g,"<").replace(/&gt;/g,">"):$("textarea#add-link-textarea-box")[1].value="","undefined"!==i[s].getAttribute("sharelinkchecked")&&(linkShareCheckBoxLastStatus=i[s].getAttribute("sharelinkchecked"),"true"===i[s].getAttribute("sharelinkchecked")?$(".link-share-with-class-checkbox").prop("checked",!0):"false"===i[s].getAttribute("sharelinkchecked")&&$(".link-share-with-class-checkbox").prop("checked",!1)),$(".delete-btn").css("visibility","visible")[1];break}}}else showLinkPopover()}}function displayLinksOnLeft(e,t,a,o,s,n){$("#linkAnchorElement"+e)&&$("#linkAnchorElement"+e).remove();var i=$(".ereader-content").css("line-height"),r=document.getElementById("links-container").getBoundingClientRect().top,l=document.createElement("A");l.id="linkAnchorElement"+e;var c=document.createElement("IMG");c.id="linkDiv"+e,c.className="linksIcon display-inline-block",c.style.top=t-r-2+"px",c.src="img/ereader/link-icon.png",c.style.width="30px",c.style.height="30px",c.style.position="absolute",c.setAttribute("urlComments",o.replace(/</g,"&lt;").replace(/>/g,"&gt;")),c.setAttribute("urlText",a),c.setAttribute("shareLinkChecked",s),c.setAttribute("linkEditingForproffessor",n),"Student"===linkFetchinguser||"Professor"===linkFetchinguser&&"false"===n?(c.setAttribute("data-toggle","popover"),c.setAttribute("rel","popover"),c.setAttribute("onclick","linkIconClicked(event)")):"Professor"===linkFetchinguser&&"true"===n&&(l.setAttribute("onclick","linkIconClicked(event)"),l.setAttribute("linkEditingForproffessor",n));var d,u=$(".linksIcon");u.sort(function(e,t){return e.style.top>t.style.top?1:e.style.top<t.style.top?-1:0});var p=0;for(d=0;d<u.length;d++)parseInt(u[d].style.top)<parseInt(c.style.top)+parseInt(i)&&parseInt(u[d].style.top)>parseInt(c.style.top)-parseInt(i)&&parseInt(u[d].style.top)>p&&(p=parseInt(u[d].style.top),c.style.top=parseInt(u[d].style.top)+7+parseInt(i)+"px",l.top=parseInt(u[d].style.top)+parseInt(i)+"px");l.appendChild(c),document.getElementById("links-container").appendChild(l);for(var h=$(".rTsIcon"),g=0;g<h.length;g++){parseInt(c.style.top)>=parseInt(h[g].style.top)&&parseInt(c.style.top)-parseInt(h[g].style.top)<20&&(h[g].remove(),h[g].style.top=parseInt(c.style.top)+7+parseInt(i)+"px",document.getElementById("links-container").appendChild(h[g]))}var f=document.getElementById("linkDiv"+e).getBoundingClientRect(),m=null;for(d=0;d<u.length;d++)m=document.getElementById(u[d].id).getBoundingClientRect(),f.right<m.left||f.left>m.right||f.bottom<m.top||(f.top,m.bottom);addingLink=!1,closePopover(),insideCasesPage||$(".case-excerpt-block").css("padding-left","15px")}function deleteLink(){updatingLink=!1,deleteCurrentLink()}function deleteCurrentLink(){$("#page-loading-spinner").show(),insideCasesPage&&(CaseConnect.currentSectionId=casesSectionListOnLoad.sectionId,CaseConnect.currentSectionTitle=casesSectionListOnLoad.sectionTitle);var e={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},annotationVO:{annotationId:selectedNoteId,bookId:CaseConnect.currentBookId,chapterId:CaseConnect.currentChapterId,chapterTitle:CaseConnect.currentChapterTitle}};insideEreader?(e.userVO.userActivityVO.lastActivityCode="EREADER_ANNOTATION_DELETE_LINK",e.userVO.userActivityVO.pageNavigatingFrom="EReader",e.userVO.userActivityVO.pageNavigatingTo="EReader"):(e.userVO.userActivityVO.lastActivityCode="CASE_PAGE",e.userVO.userActivityVO.pageNavigatingFrom="CASES",e.userVO.userActivityVO.pageNavigatingTo="CASES"),$.ajax({url:properties[properties.env]+"/manageAnnotationService/deleteChapterLink",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(e)}).then(function(e){void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),$("#page-loading-spinner").hide(),addingLink=!1,updatingLink=!1,displayCommonAnnotationPopover=!1,pCaseWithHeadingCitation=!1,pCaseWithHeadingOnly=!1,closePopover();for(var t=$("anchortag[id^="+selectedNoteId+"]"),a=0;a<t.length;a++){var o=document.getElementById(t[a].id),s=document.createElement("span");s.innerHTML=o.innerHTML,s.normalize(),o.parentNode.replaceChild(s,o)}var n=$(".linksIcon");for(a=0;a<n.length;a++)if(n[a].id.substring(7,n[a].id.length)===selectedNoteId){n[a].parentNode.removeChild(n[a]);break}sessionTimeOut()},function(e){Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg),closePopover()):window.location=properties.ui_domain,sessionTimeOut()})}function linkIconClicked(e){if("visible"!==$("#highlight-popover-notes").css("visibility"))if(linkEditingForproffessor=e.currentTarget.getAttribute("linkEditingForproffessor"),"Professor"===linkFetchinguser&&"true"===linkEditingForproffessor){selectedNoteId=e.currentTarget.id,selectedNoteId=selectedNoteId.substring(17,selectedNoteId.length);for(var t=(null===document.getElementById(selectedNoteId)?document.getElementById(selectedNoteIdWithIndexer):document.getElementById(selectedNoteId)).parentNode;!$(t).hasClass("cc-section")&&null!==t;)t=t.parentNode;if(null!==t&&t.getElementsByClassName("cc-section-title").length>0?annotationSectionTitle=removeTags(t.getElementsByClassName("cc-section-title")[0].innerHTML):annotationSectionTitle="",element=document.getElementById(selectedNoteId),rect=element.getBoundingClientRect(),yValue=rect.top,(s=$(".linksIcon")).length>0)for(var a=0;a<s.length;a++)s[a].id.substring(7,s[a].id.length)===selectedNoteId&&(updatingLink=!0);var o=$("img[id='linkDiv"+selectedNoteId+"']");if(o&&o.length>0&&(showLinkPopover(),$("input#add-link-url").length>1)){var s=$(".linksIcon");for(a=0;a<s.length;a++)if(s[a].id.substring(7,s[a].id.length)===o[0].id.substring(7)){$("input#add-link-url")[1].innerHTML=s[a].getAttribute("urlText"),$("input#add-link-url")[1].value=s[a].getAttribute("urlText"),"undefined"!==s[a].getAttribute("urlComments")||null!==s[a].getAttribute("urlComments")?$("textarea#add-link-textarea-box")[1].value=s[a].getAttribute("urlComments").replace(/&lt;/g,"<").replace(/&gt;/g,">"):$("textarea#add-link-textarea-box")[1].value="","undefined"!==s[a].getAttribute("sharelinkchecked")&&("true"===s[a].getAttribute("sharelinkchecked")?$(".link-share-with-class-checkbox").prop("checked",!0):"false"===s[a].getAttribute("sharelinkchecked")&&$(".link-share-with-class-checkbox").prop("checked",!1)),$(".delete-btn").css("visibility","visible")[1];break}}noteTextClick=!0}else("Student"===linkFetchinguser||"Professor"===linkFetchinguser&&"false"===linkEditingForproffessor)&&(linkIconId=e.currentTarget.id,linkUrlForStudent=e.currentTarget.getAttribute("urltext"),linkUrlCommentsForStudents=e.currentTarget.getAttribute("urlcomments"),initializeLinkPopoverForStudent(linkIconId))}function initializeLinkPopoverForStudent(e){$("#link-popover-student-url").html(linkUrlForStudent),"undefined"!==linkUrlCommentsForStudents&&$("#link-popover-student-comments").html(linkUrlCommentsForStudents),$("#link-popover-student-url").attr("href",linkUrlForStudent);var t=$("#"+e).offset().top,a=$("#"+e).height();insideEreader&&(t-topOffset<250&&$(window).height()-a-t<250&&(makingSpaceForpopoverToBeDisplayed=!0,document.getElementById("ereader-scroller").scrollTop=document.getElementById(e).offsetTop-250));$("#"+e).popover("destroy"),$("#"+e).popover({html:!0,placement:"right",trigger:"manual",container:"body",template:'<div class="popover ebook-custom-popover link-student-popover-wrapper" id="link-student-popover-wrapper"><div class="arrow"></div><div id="ereader-menu-popover-content" class="popover-content ereader-menu-popover"></div></div>',content:$("#link-popover-student").html()}),$("#"+e).popover("show"),displayCommonAnnotationPopover=!1,pCaseWithHeadingCitation=!1,pCaseWithHeadingOnly=!1}function updateLink(){if($("input#add-link-url")[1])if("visible"===$(".save-link-icon").css("visibility")){$("#ebook-toc").popover("hide"),$("#ebook-toc-mobile").popover("hide"),$(".ebook-fontsize").popover("hide"),$(".ebook-search").popover("hide"),$(".ereader-chapter-list").popover("hide");var e=$("input#add-link-url")[1].value,t=$("textarea#add-link-textarea-box")[1].value.replace(/</g,"&lt;").replace(/>/g,"&gt;"),a=$(".link-share-with-class-checkbox")[1].checked;annotationStartParaId=$("#"+selectedNoteId).attr("linkStartParaId"),annotationEndParaId=$("#"+selectedNoteId).attr("linkEndParaId"),linkStartOffset=parseInt($("#"+selectedNoteId).attr("linkStartOffset")),linkEndOffset=parseInt($("#"+selectedNoteId).attr("linkEndOffset")),linkParaStartOffset=parseInt($("#"+selectedNoteId).attr("linkParaStartOffset")),linkParaEndOffset=parseInt($("#"+selectedNoteId).attr("linkParaEndOffset")),startParaId=annotationStartParaId,endParaId=annotationEndParaId,linkEditingForproffessor="true";var o,s=$("#"+selectedNoteId).attr("enclosingparaidstring");o=convertEnclosingParaStringIdToEnclosingParaArray(s);selectedNoteId;-1!==selectedNoteId.indexOf("_")&&selectedNoteId.substring(0,selectedNoteId.indexOf("_")),a?linkSharedWithClass="true":a||(linkSharedWithClass="false"),$("#page-loading-spinner").show();var n={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},annotationVO:{annotationId:selectedNoteId,bookId:CaseConnect.currentBookId,chapterId:CaseConnect.currentChapterId,chapterTitle:CaseConnect.currentChapterTitle,sectionId:annotationSectionId,sectionTitle:annotationSectionTitle,linkUrl:e,linkStartOffset:linkStartOffset,linkEndOffset:linkEndOffset,linkDescription:t,linkColorCode:"#007ac3",linkBackGroundColorCode:"#ede48c",linkShareFlag:linkSharedWithClass,highlightParaStartOffset:linkParaStartOffset,highlightParaEndOffset:linkParaEndOffset,highlightStartParaId:annotationStartParaId,highlightEndParaId:annotationEndParaId,enclosingParaList:o}};insideEreader?(n.userVO.userActivityVO.lastActivityCode="EREADER_ANNOTATION_UPDATE_LINK",n.userVO.userActivityVO.pageNavigatingFrom="EReader",n.userVO.userActivityVO.pageNavigatingTo="EReader"):(n.userVO.userActivityVO.lastActivityCode="CASE_PAGE",n.userVO.userActivityVO.pageNavigatingFrom="CASES",n.userVO.userActivityVO.pageNavigatingTo="CASES"),$.ajax({url:properties[properties.env]+"/manageAnnotationService/updateChapterLink",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(n)}).then(function(a){void 0!==a.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",a.sessionAuthenticationToken),yValue=document.getElementById(selectedNoteId).getBoundingClientRect().top;for(var o=$(".linksIcon"),s=0;s<o.length;s++)if(o[s].id.substring(7,o[s].id.length)===selectedNoteId){o[s].parentNode.removeChild(o[s]);break}addingLink=!1,updatingLink=!1,insideCasesPage||$(".case-excerpt-block").css("padding-left","15px"),displayLinksOnLeft(selectedNoteId,yValue,e,t,linkSharedWithClass,linkEditingForproffessor),reCalculateRtSOnLeft(),$(".delete-btn").css("visibility","visible")[1],$("#"+selectedNoteId).popover("hide"),$("#page-loading-spinner").hide(),alreadyCalled=!1,sessionTimeOut()},function(e){Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),updatingLink=!1,closePopover(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain,alreadyCalled=!1,sessionTimeOut()})}else $("#"+selectedNoteId).popover("hide"),updatingLink=!1,alreadyCalled=!1}function deleteLinkButton(){$("#highlight-popover-notes").hide(),$("#delete-link-confirmation-modal").modal("show")}function cancleAddLinkButton(){$("#"+selectedNoteId).popover("hide"),updatingLink=!1,addingLink=!1,keepPopoverVisible=!1,keepBriefPopoverVisible=!1,highlightPopoverVisible=!1,addBriefPopoverShown=!1,clickedInsidePcaseForAnnot=!1,removeDummyTags()}function shareLinkCheckbox(e){var t=$(".link-share-with-class-checkbox")[1].checked;!0===t?($(".link-share-with-class-checkbox").prop("checked",!0),e.stopPropagation()):!1===t&&($(".link-share-with-class-checkbox").prop("checked",!1),e.stopPropagation()),t===linkShareCheckBoxLastStatus?$(".save-link-icon").css("visibility","hidden")[1]:t!==linkShareCheckBoxLastStatus&&$(".save-link-icon").css("visibility","visible")[1]}function hideFooter(){$("#casebook-ereader-footer-wrapper").slideDown("slow"),$(".ereader-footer-collapse").css("visibility","hidden"),$(".ereader-footer-expand").css("visibility","visible")}function showFooter(){$("#casebook-ereader-footer-wrapper").slideUp("slow"),$(".ereader-footer-expand").css("visibility","hidden"),$(".ereader-footer-collapse").css("visibility","visible")}function fetchLinkDetails(e){var t;$("#page-loading-spinner").show(),"chapter"!==CaseConnect.bookData.chapterType&&loadingAnnotationsFromTOC&&insideEreader?(loadingAnnotationsFromTOC=!1,annotationListingChapterId=bookAnnotateFileList[0].chapterId,e=bookAnnotateFileList[0].chapterId):insideCasesPage&&(loadingAnnotationsFromTOC=!1,annotationListingChapterId=casesSectionListOnLoad.chapterId,e=casesSectionListOnLoad.chapterId),"Professor"===localStorage.getItem("userRole")?(t="/manageAnnotationService/getChapterLinkProfessor",linkFetchinguser="Professor"):"Student"===localStorage.getItem("userRole")&&(t="/manageAnnotationService/getChapterLinkStudent",linkFetchinguser="Student");var a={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},annotationVO:{bookId:CaseConnect.currentBookId,chapterId:e,chapterTitle:CaseConnect.currentChapterTitle}};insideEreader?(a.userVO.userActivityVO.lastActivityCode="EREADER_ANNOTATION_GET_LINK",a.userVO.userActivityVO.pageNavigatingFrom="EReader",a.userVO.userActivityVO.pageNavigatingTo="EReader"):(a.userVO.userActivityVO.lastActivityCode="CASE_PAGE",a.userVO.userActivityVO.pageNavigatingFrom="CASES",a.userVO.userActivityVO.pageNavigatingTo="CASES"),$.ajax({url:properties[properties.env]+t,type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(a)}).then(function(e){void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken);var t="";if($(".linksIcon").remove(),e.annotationVOList){var a=[];e.annotationVOList.length>0?(a=e.annotationVOList,e.annotationVOList=e.annotationVOList.sort(function(e,t){return parseFloat(e.linkStartOffset)-parseFloat(t.linkStartOffset)})):a.push(e.annotationVOList);var o,s={},n=[],i=null,r=null;globalChapterLinkList=a;for(var l=0;l<a.length;l++)if(a[l].linkFontColorCode="#007ac3",void 0!==a[l].highlightEndParaId&&void 0!==a[l].highlightStartParaId&&null!==a[l].highlightEndParaId&&null!==a[l].highlightStartParaId&&0!==a[l].highlightEndParaId.length&&0!==a[l].highlightStartParaId.length&&null!==document.getElementById(a[l].highlightEndParaId)&&null!==document.getElementById(a[l].highlightStartParaId)){var c=!1;if(null!==a[l].enclosingParaList&&a[l].highlightStartParaId!==a[l].highlightEndParaId&&(c=!0,s[a[l].annotationId]=a[l],n.push(a[l].annotationId)),a[l].highlightStartParaId!==i){if(null!==i&&document.getElementById(i)&&(document.getElementById(i).outerHTML=o),i=a[l].highlightStartParaId,document.getElementById(a[l].highlightStartParaId)){for(var d=document.getElementById(a[l].highlightStartParaId),u=$("#"+d.id).find(".anchorElementText"),p=0;p<u.length;p++)null!=u[p].getAttribute("createdlinkcomments")&&null!=u[p].getAttribute("createdlinkcomments")&&u[p].setAttribute("createdlinkcomments",u[p].getAttribute("createdlinkcomments").replace(/</g,"&lt;").replace(/>/g,"&gt;"));o=d.outerHTML}else o="";o=(o=(o=o.replace(/(\r\n|\n|\r)/gm,"")).replace(/amp;/g,"")).replace(/&nbsp;/g," ")}var h=o;if(enclosingParaIdString="",null!==a[l].enclosingParaList&&void 0!==a[l].enclosingParaList){if("string"==$.type(a[l].enclosingParaList))enclosingParaIdString=a[l].highlightStartParaId;else for(var g=0;g<a[l].enclosingParaList.length;g++){var f=g===a[l].enclosingParaList.length-1?"":"|";enclosingParaIdString+=a[l].enclosingParaList[g]+f}}void 0===a[l].linkDescription?(a[l].linkDescription="",t=a[l].linkDescription):(t="",t=a[l].linkDescription.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/' '/g,"&nbsp;").replace(/"/g,"&ldquo;").replace(/"/g,"&rdquo;").replace(/'/g,"&lsquo;").replace(/'/g,"&rsquo;").replace(/&/g,"&amp;"));for(var m,C='<anchortag id="'+a[l].annotationId+'" class="anchorElementText" style="color: '+a[l].linkFontColorCode+' !important" data-references="popover" tabindex="0" data-toggle="popover" data-original-title="" title="" createdlinkurl="'+a[l].linkUrl+'" createdlinkcomments="'+t+'" linkeditingforproffessor ="'+a[l].linkEditFlag+'" createdlinksharestatus="'+a[l].linkShareFlag+'" linkParaStartOffset="'+a[l].highlightParaStartOffset+'" linkParaEndOffset="'+a[l].highlightParaEndOffset+'" linkStartOffset="'+a[l].linkStartOffset+'" linkEndOffset="'+a[l].linkEndOffset+'" linkStartParaId="'+a[l].highlightStartParaId+'"  linkEndParaid="'+a[l].highlightEndParaId+'" enclosingParaIdString="'+enclosingParaIdString+'">',y=0,v=/<\/*([a-z][a-z0-9]*)\b[^>]*>(.*?)/;(m=v.exec(h))&&!(m.index>a[l].highlightParaStartOffset);)h=h.replace(m[0],""),y+=m[0].length;var I=parseInt(a[l].highlightParaStartOffset)+y,b="";if(document.getElementById(a[l].highlightStartParaId)){var k=document.getElementById(a[l].highlightStartParaId),A=$("#"+k.id).find(".anchorElementText");for(p=0;p<A.length;p++)null!=A[p].getAttribute("createdlinkcomments")&&null!=A[p].getAttribute("createdlinkcomments")&&A[p].setAttribute("createdlinkcomments",A[p].getAttribute("createdlinkcomments").replace(/</g,"&lt;").replace(/>/g,"&gt;"));b=k.outerHTML}if(b=(b=(b=b.replace(/(\r\n|\n|\r)/gm,"")).replace(/amp;/g,"")).replace(/&nbsp;/g," "),c)for(;(m=v.exec(h))&&!(m.index>b.length);)h=h.replace(m[0],""),y+=m[0].length,m[0].length;else for(;(m=v.exec(h))&&!(m.index>a[l].highlightParaEndOffset);)h=h.replace(m[0],""),y+=m[0].length;var O=parseInt(a[l].highlightParaEndOffset)+y;if(globalLinkStartOffset=a[l].highlightParaStartOffset,globalLinkEndOffset=a[l].highlightParaEndOffset,c){O=o.length;o.substring(I,O);var S=document.getElementById(a[l].highlightStartParaId);if(o=o.substring(0,I)+C+o.substring(I,O)+"</anchortag>"+o.substring(O),document.getElementById(a[l].highlightEndParaId)){var T=document.getElementById(a[l].highlightEndParaId),P=$("#"+T.id).find(".anchorElementText");for(p=0;p<P.length;p++)null!=P[p].getAttribute("createdlinkcomments")&&null!=P[p].getAttribute("createdlinkcomments")&&P[p].setAttribute("createdlinkcomments",P[p].getAttribute("createdlinkcomments").replace(/</g,"&lt;").replace(/>/g,"&gt;"));r=T.outerHTML}h=r=(r=(r=r.replace(/(\r\n|\n|\r)/gm,"")).replace(/amp;/g,"")).replace(/&nbsp;/g," ");for(var D=0;D<a[l].enclosingParaList.length;D++)if(a[l].enclosingParaList[D]!==a[l].highlightStartParaId&&a[l].enclosingParaList[D]!==a[l].highlightEndParaId){void 0===a[l].linkDescription?(a[l].linkDescription="",t=a[l].linkDescription):(t="",t=a[l].linkDescription.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/' '/g,"&nbsp;").replace(/"/g,"&ldquo;").replace(/"/g,"&rdquo;").replace(/'/g,"&lsquo;").replace(/'/g,"&rsquo;").replace(/&/g,"&amp;"));var L=document.getElementById(a[l].enclosingParaList[D]);a[l].annotationId,a[l].linkFontColorCode,a[l].linkUrl,a[l].linkEditFlag,a[l].linkShareFlag,a[l].highlightParaStartOffset,a[l].highlightParaEndOffset,a[l].linkStartOffset,a[l].linkEndOffset,enclosingParaIdString;null!==L&&(L.innerHTML='<anchortag id="'+a[l].annotationId+"_"+D+"_"+D+'" class="anchorElementText" style="color: '+a[l].linkFontColorCode+' !important" data-references="popover" tabindex="0" data-toggle="popover" data-original-title="" title="" createdlinkurl="'+a[l].linkUrl+'" createdlinkcomments="'+t+'"  linkeditingforproffessor ="'+a[l].linkEditFlag+'" createdlinksharestatus="'+a[l].linkShareFlag+'" linkParaStartOffset="'+a[l].highlightParaStartOffset+'" linkParaEndOffset="'+a[l].highlightParaEndOffset+'" linkStartOffset="'+a[l].linkStartOffset+'" linkEndOffset="'+a[l].linkEndOffset+'"  enclosingParaIdString="'+enclosingParaIdString+'">'+L.innerHTML+"</anchortag>")}for(var w=0,N=0;(m=v.exec(h))&&!(m.index>0);)h=h.replace(m[0],""),w+=m[0].length,m[0].length;for(;(m=v.exec(h))&&!(m.index>a[l].highlightParaEndOffset);)h=h.replace(m[0],""),m[0].length,N+=m[0].length;var E=0;null!=(H=$(r).children()[0])&&null!=H.getAttribute("class")&&-1!==H.getAttribute("class").indexOf("cc-pagenum-begin")&&(E=H.innerHTML.length+"</span>".length),void 0===a[l].linkDescription?(a[l].linkDescription="",t=a[l].linkDescription):(t="",t=a[l].linkDescription.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/' '/g,"&nbsp;").replace(/"/g,"&ldquo;").replace(/"/g,"&rdquo;").replace(/'/g,"&lsquo;").replace(/'/g,"&rsquo;").replace(/&/g,"&amp;"));w+=E;var F=r.substring(w).indexOf(r.substring(w).trim());r=r.substring(0,w)+'<anchortag id="'+a[l].annotationId+'_1" class="anchorElementText" style="color: '+a[l].linkFontColorCode+' !important" data-references="popover" tabindex="0" data-toggle="popover" data-original-title="" title="" createdlinkurl="'+a[l].linkUrl+'" createdlinkcomments="'+t+'" linkeditingforproffessor ="'+a[l].linkEditFlag+'" createdlinksharestatus="'+a[l].linkShareFlag+'" linkParaStartOffset="'+a[l].highlightParaStartOffset+'" linkParaEndOffset="'+a[l].highlightParaEndOffset+'" linkStartOffset="'+a[l].linkStartOffset+'" linkEndOffset="'+a[l].linkEndOffset+'"  enclosingParaIdString="'+enclosingParaIdString+'">'+r.substring(w+F,w+F+parseInt(a[l].highlightParaEndOffset)+N-E)+"</anchortag>"+r.substring(w+F+parseInt(a[l].highlightParaEndOffset)+N-E),null!==a[l].highlightEndParaId&&document.getElementById(a[l].highlightEndParaId)&&(document.getElementById(a[l].highlightEndParaId).outerHTML=r)}else{var x=!1;if(void 0!==globalChapterAnnotationList)for(j=0;j<globalChapterAnnotationList.length;j++)a[l].highlightParaEndOffset===globalChapterAnnotationList[j].highlightParaStartOffset&&-1!==o.substring(0,O).indexOf(globalChapterAnnotationList[j].annotationId)&&(x=!0);if(l>0&&a[l].highlightParaEndOffset===a[l-1].highlightParaStartOffset&&!1===x)o=o.substring(0,O-1)+"</anchortag>"+o.substring(O);else if(l>0&&a[l].highlightParaStartOffset===a[l-1].highlightParaStartOffset&&!1===x)o=o.substring(0,O).replace("</anchortag>","</anchortag></anchortag>")+o.substring(O);else if(!0===x){if(void 0!==globalChapterAnnotationList)for(j=0;j<globalChapterAnnotationList.length;j++)a[l].highlightParaEndOffset===globalChapterAnnotationList[j].highlightParaStartOffset&&(-1!==o.substring(0,O).indexOf(globalChapterAnnotationList[j].annotationId)&&(o=o.substring(0,O).replace('<highlight id="'+globalChapterAnnotationList[j].annotationId+'"','</anchortag><highlight id="'+globalChapterAnnotationList[j].annotationId+'"')+o.substring(O)),x=!1)}else o=o.substring(0,O)+"</anchortag>"+o.substring(O);o=o.substring(0,I)+C+o.substring(I),setTimeout(function(){if(void 0!==globalChapterAnnotationList)for(j=0;j<globalChapterAnnotationList.length;j++)for(var e=$("highlight[id^="+globalChapterAnnotationList[j].annotationId+"]"),t=0;t<e.length;t++)document.getElementById(e[t].id).setAttribute("onClick","highLightedTextClick()")},1e3)}}document.getElementById(i)&&(document.getElementById(i).outerHTML=o);var M=document.getElementsByTagName("anchortag"),B=[];for(l=0;l<M.length;l++)void 0===s[M[l].id]&&-1===M[l].id.indexOf("_")&&B.push(M[l]);for(l=0;l<n.length;l++){S=document.getElementById(n[l]);multiParaAnnotationStartParaStartOffset=S.getAttribute("linkParaStartOffset"),multiParaAnnotationStartParaEndOffset=S.textContent.length,multiParaLinkIndexer=0,linkTagFirstPart='<anchortag id="',multiParaAnnotationID=n[l],linkTagLastPart='" class="anchorElementText" style="'+S.getAttribute("style")+'" data-references="popover" data-toggle="popover" tabindex="0" data-original-title="" title="" createdlinkurl="'+S.getAttribute("createdLinkUrl")+'" createdlinkcomments="'+S.getAttribute("createdlinkcomments")+'" linkeditingforproffessor ="'+S.getAttribute("linkeditingforproffessor")+'"  createdlinksharestatus="'+S.getAttribute("createdlinksharestatus")+'" linkParaStartOffset="'+S.getAttribute("linkParaStartOffset")+'" linkParaEndOffset="'+S.getAttribute("linkParaEndOffset")+'" linkStartOffset="'+S.getAttribute("linkStartOffset")+'" linkEndOffset="'+S.getAttribute("linkEndOffset")+'" linkStartparaid="'+S.getAttribute("linkStartparaid")+'" linkEndparaid="'+S.getAttribute("linkEndparaid")+'"  enclosingParaIdString="'+enclosingParaIdString+'">';var V=document.getElementById(S.getAttribute("linkStartParaId")),R=S.getAttribute("linkStartParaId");MARK=!1,addLinkMarkup(V,R),addLinkMarkupByOffestAndLength1(V,R,n[l]),V=document.getElementById(S.getAttribute("linkEndParaId")),R=S.getAttribute("linkEndParaId");var H;E=0;null!==(H=$(V).children()[0]).getAttribute("class")&&-1!==H.getAttribute("class").indexOf("cc-pagenum-begin")&&(E=H.innerHTML.length+"</span>".length),multiParaAnnotationStartParaStartOffset=0,multiParaAnnotationStartParaEndOffset=parseInt(S.getAttribute("linkParaEndOffset")),MARK=!1,addLinkMarkup(V,R),addLinkMarkupByOffestAndLength(V,R,n[l],!0)}setTimeout(function(){for(var e=0;e<n.length;e++)for(var t=$("anchortag[id^="+n[e]+"]"),a=0;a<t.length;a++)document.getElementById(t[a].id).addEventListener("mouseup",linkTextClick)},500);var _=B;for(l=0;l<_.length;l++){S=_[l];multiParaAnnotationStartParaStartOffset=parseInt(S.getAttribute("linkParaStartOffset")),multiParaAnnotationStartParaEndOffset=parseInt(S.getAttribute("linkParaEndOffset")),multiParaLinkIndexer=0,linkTagFirstPart='<anchortag id="',multiParaAnnotationID=S.id,linkTagLastPart='" class="anchorElementText" style="'+S.getAttribute("style")+'" data-references="popover" data-toggle="popover" tabindex="0" data-original-title="" title="" createdlinkurl="'+S.getAttribute("createdLinkUrl")+'" createdlinkcomments="'+S.getAttribute("createdlinkcomments")+'" linkeditingforproffessor ="'+S.getAttribute("linkeditingforproffessor")+'"  createdlinksharestatus="'+S.getAttribute("createdlinksharestatus")+'"  linkParaStartOffset="'+S.getAttribute("linkParaStartOffset")+'" linkParaEndOffset="'+S.getAttribute("linkParaEndOffset")+'" linkStartOffset="'+S.getAttribute("linkStartOffset")+'" linkEndOffset="'+S.getAttribute("linkEndOffset")+'" linkStartparaid="'+S.getAttribute("linkStartparaid")+'" linkEndParaId="'+S.getAttribute("linkEndParaId")+'"  enclosingParaIdString="'+enclosingParaIdString+'">';V=document.getElementById(S.getAttribute("linkStartParaId")),R=S.getAttribute("linkStartParaId");MARK=!1,addLinkMarkup(V,R),addLinkMarkupByOffestAndLengthForSinglePara(V,R,S.id)}setTimeout(function(){for(var e=0;e<_.length;e++)for(var t=$("anchortag[id^="+_[e].id+"]"),a=0;a<t.length;a++)document.getElementById(t[a].id).addEventListener("mouseup",linkTextClick)},500);for(l=0;l<a.length;l++)if(dppAnotationId=a[l].annotationId,document.getElementById(dppAnotationId)&&(document.getElementById(dppAnotationId).addEventListener("mouseup",linkTextClick),a[l].linkUrl)){selectedNoteId=dppAnotationId,bodyRect=document.body.getBoundingClientRect();var q=document.getElementById(selectedNoteId).getBoundingClientRect();yValue=q.top,a[l].linkDescription?(insideCasesPage||$(".case-excerpt-block").css("padding-left","15px"),displayLinksOnLeft(selectedNoteId,yValue,a[l].linkUrl,a[l].linkDescription,a[l].linkShareFlag,a[l].linkEditFlag),reCalculateRtSOnLeft()):(a[l].linkDescription="",displayLinksOnLeft(selectedNoteId,yValue,a[l].linkUrl,a[l].linkDescription,a[l].linkShareFlag,a[l].linkEditFlag),reCalculateRtSOnLeft()),linkIconId="linkDiv"+selectedNoteId}if(listOfLinkIcons=a,"Student"===linkFetchinguser)for(var U=$(".anchorElementText"),j=0;j<U.length;j++){G=U[j].id,W=document.getElementById(G),(Q=document.createElement("span")).innerHTML=W.innerHTML,Q.normalize(),W.parentNode.replaceChild(Q,W)}else if("Professor"===linkFetchinguser)for(l=0;l<a.length;l++){var W,G;for(U=$(".anchorElementText"),j=0;j<U.length;j++){var Q;if(G=U[j].id,"false"===$("#"+G).attr("linkeditingforproffessor"))W=document.getElementById(G),(Q=document.createElement("span")).innerHTML=W.innerHTML,Q.normalize(),W.parentNode.replaceChild(Q,W)}}if(insideEreader&&loadingNewChapterFromAnnotationListing&&document.getElementById(clickedAnnotationIdFromListing)){var J=document.getElementById(clickedAnnotationIdFromListing);document.getElementById("ereader-scroller").scrollTop=J.offsetTop,updatePageNoAndChapterName(),loadingNewChapterFromAnnotationListing=!1}removeHighlightFromPageNumbers()}if(insideEreader)ereaderReadToStudyIcons();else if(insideCasesPage){$(window).height();var z=$(window).width();"undefined"!=typeof casesSectionListOnLoad&&""!==casesSectionListOnLoad&&(""!==checkDropValue&&checkIfBriefloaded&&z>992?"My Brief"===caseExcerptRightTitle&&"Case Text"===caseExcerptLeftTitle?$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),$(window).trigger("resize")}):"Case Text"===caseExcerptRightTitle&&"My Brief"===caseExcerptLeftTitle?$("#case-excerpt-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage()}):$("#page-loading-spinner").hide():(null==checkDropValue||""===checkDropValue)&&z>992?"My Brief"===caseExcerptRightTitle&&"Case Text"===caseExcerptLeftTitle?$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),$(window).trigger("resize")}):"Case Text"===caseExcerptRightTitle&&"My Brief"===caseExcerptLeftTitle?$("#case-excerpt-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage()}):$("#page-loading-spinner").hide():null==checkDropValue&&z<992&&"undefined"==typeof caseExcerptRightTitle&&"undefined"==typeof caseExcerptLeftTitle?$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),z>992&&$(window).trigger("resize")}):""===checkDropValue&&z<992&&"undefined"!=typeof caseExcerptRightTitle&&"undefined"!=typeof caseExcerptLeftTitle&&!caseExcerptClicked?"My Brief"===caseExcerptRightTitle&&"Case Text"===caseExcerptLeftTitle?(z>991&&$(".case-excerpt-second-div-sm").show(),$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),z<991&&("inline-block"===$(".case-excerpt-first-div-sm").css("display")||"block"===$(".case-excerpt-first-div-sm").css("display"))?$(".case-excerpt-second-div-sm").hide():$(".case-excerpt-second-div-sm").show(),z>992&&$(window).trigger("resize")})):"Case Text"===caseExcerptRightTitle&&"My Brief"===caseExcerptLeftTitle?(z>991&&$(".case-excerpt-first-div-sm").show(),$("#case-excerpt-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),z>991&&$(".case-excerpt-first-div-sm").show(),z>992&&$(window).trigger("resize")})):$("#page-loading-spinner").hide():null===checkDropValue&&z<992&&"undefined"!=typeof caseExcerptRightTitle&&"undefined"!=typeof caseExcerptLeftTitle&&!caseExcerptClicked?"My Brief"===caseExcerptRightTitle&&"Case Text"===caseExcerptLeftTitle?(z>991&&$(".case-excerpt-second-div-sm").show(),$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),$(".case-excerpt-second-div-sm").show(),z<991&&$(".case-excerpt-first-div-sm").hide(),z>992&&$(window).trigger("resize")})):"Case Text"===caseExcerptRightTitle&&"My Brief"===caseExcerptLeftTitle?(z>991&&$(".case-excerpt-first-div-sm").show(),$("#case-excerpt-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),z>991&&$(".case-excerpt-first-div-sm").show(),z>992&&$(window).trigger("resize")})):$("#page-loading-spinner").hide():$("#page-loading-spinner").hide())}else $("#page-loading-spinner").hide()},function(e){Utility.handleSessionAuthentication(e.responseJSON)?(insideEreader&&ereaderReadToStudyIcons(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain,sessionTimeOut()})}function addLinkMarkup(e,t){$(e).contents().each(function(){var e=$(this);3==this.nodeType&&MARK&&(multiParaLinkIndexer++,$(this).wrap(linkTagFirstPart+multiParaAnnotationID+"_"+multiParaLinkIndexer+linkTagLastPart+"</anchorTag>")),1==this.nodeType&&("anchortag"==this.nodeName.toLowerCase()&&($(e).hasClass("anchorElementText")&&$(e).attr("id")==t?(MARK=!0,addLinkMarkup(e,t)):(MARK=!1,addLinkMarkup(e,t))),addLinkMarkup(e,t))})}function addLinkMarkupByOffestAndLength1(e,t,a){$(e).contents().each(function(){var e=$(this);if(1==this.nodeType)addLinkMarkupByOffestAndLength(e,t,a);else if(3==this.nodeType){multiParaLinkIndexer++;!MARK&&multiParaAnnotationStartParaStartOffset<this.length?(multiParaLinkIndexer++,$(this).replaceWith(this.textContent.substring(0,multiParaAnnotationStartParaStartOffset)+linkTagFirstPart+a+"_"+multiParaLinkIndexer+linkTagLastPart+this.textContent.substring(multiParaAnnotationStartParaStartOffset,this.length)+"</anchorTag>"),multiParaAnnotationStartParaEndOffset=multiParaAnnotationStartParaEndOffset-this.length+multiParaAnnotationStartParaStartOffset):MARK&&multiParaAnnotationStartParaEndOffset>this.length?(multiParaLinkIndexer++,$(this).wrap(linkTagFirstPart+a+"_"+multiParaLinkIndexer+linkTagLastPart+"</anchorTag>"),multiParaAnnotationStartParaEndOffset-=this.length):MARK&&multiParaAnnotationStartParaEndOffset<this.length?(multiParaLinkIndexer++,$(this).replaceWith(linkTagFirstPart+a+"_"+multiParaLinkIndexer+linkTagLastPart+this.textContent.substring(0,multiParaAnnotationStartParaEndOffset)+"</anchorTag>"+this.textContent.substring(multiParaAnnotationStartParaEndOffset,this.length)+"</anchorTag>"),multiParaAnnotationStartParaStartOffset=-1,multiParaAnnotationStartParaEndOffset=-1):multiParaAnnotationStartParaStartOffset-=this.length}})}function addLinkMarkupByOffestAndLength(e,t,a,o){$(e).contents().each(function(){var e=$(this);if(1==this.nodeType)addLinkMarkupByOffestAndLength(e,t,a,o);else if(3==this.nodeType){multiParaLinkIndexer++,(!o||multiParaAnnotationStartParaEndOffset>0)&&(!MARK&&multiParaAnnotationStartParaStartOffset<this.length?(multiParaLinkIndexer++,$(this).replaceWith(this.textContent.substring(0,multiParaAnnotationStartParaStartOffset)+linkTagFirstPart+a+"_"+multiParaLinkIndexer+linkTagLastPart+this.textContent.substring(multiParaAnnotationStartParaStartOffset,this.length)+"</anchortag>"),multiParaAnnotationStartParaEndOffset=multiParaAnnotationStartParaEndOffset-this.length+multiParaAnnotationStartParaStartOffset):MARK&&multiParaAnnotationStartParaEndOffset>this.length?(multiParaLinkIndexer++,$(this).wrap(linkTagFirstPart+a+"_"+multiParaLinkIndexer+linkTagLastPart+"</anchortag>"),multiParaAnnotationStartParaEndOffset-=this.length):MARK&&multiParaAnnotationStartParaEndOffset<this.length?(multiParaLinkIndexer++,$(this).replaceWith(linkTagFirstPart+a+"_"+multiParaLinkIndexer+linkTagLastPart+this.textContent.substring(0,multiParaAnnotationStartParaEndOffset)+"</anchortag>"+this.textContent.substring(multiParaAnnotationStartParaEndOffset,this.length)+"</anchortag>"),multiParaAnnotationStartParaStartOffset=-1,multiParaAnnotationStartParaEndOffset=-1):multiParaAnnotationStartParaStartOffset-=this.length)}})}function addLinkMarkupByOffestAndLengthForSinglePara(e,t){$(e).contents().each(function(){var e=$(this);1==this.nodeType?addLinkMarkupByOffestAndLengthForSinglePara(e,t):3==this.nodeType&&(multiParaLinkIndexer++,!MARK&&multiParaAnnotationStartParaStartOffset<this.length?(multiParaLinkIndexer++,$(this).replaceWith(this.textContent.substring(0,multiParaAnnotationStartParaStartOffset)+linkTagFirstPart+multiParaAnnotationID+"_"+multiParaLinkIndexer+linkTagLastPart+this.textContent.substring(multiParaAnnotationStartParaStartOffset,this.length)+"</anchorTag>"),MARK=!0,multiParaAnnotationStartParaEndOffset=multiParaAnnotationStartParaEndOffset-this.length+multiParaAnnotationStartParaStartOffset):MARK&&multiParaAnnotationStartParaEndOffset>this.length?(multiParaLinkIndexer++,$(this).wrap(linkTagFirstPart+multiParaAnnotationID+"_"+multiParaLinkIndexer+linkTagLastPart+"</anchorTag>"),multiParaAnnotationStartParaEndOffset-=this.length):MARK&&multiParaAnnotationStartParaEndOffset<this.length?(multiParaLinkIndexer++,this.textContent.substring(0,multiParaAnnotationStartParaEndOffset).length>0&&$(this).replaceWith(linkTagFirstPart+multiParaAnnotationID+"_"+multiParaLinkIndexer+linkTagLastPart+this.textContent.substring(0,multiParaAnnotationStartParaEndOffset)+"</anchorTag>"+this.textContent.substring(multiParaAnnotationStartParaEndOffset,this.length)+"</anchorTag>"),multiParaAnnotationStartParaStartOffset=-1,multiParaAnnotationStartParaEndOffset=-1):(multiParaAnnotationStartParaStartOffset-=this.length,multiParaAnnotationStartParaEndOffset-=this.length))})}function showInnocenceModal(){$("#home-innocence-project-message").modal("show")}function showInnocenceModalLearn(){$("#home-innocence-project-message2").modal("show")}function showEreaderNavInMoblie(){$("#ereader-nav-menu-mobile").modal("show"),$(".mobile-ereader-navigation-modal").show(),$(".mobile-read-menu-dropdown").show(),$("#txtPageNumMobileModal").val($("#txtPageNumMobile").val()),bookSpecificFeatureDisplay()}function hideEreaderNavInMoblie(){$("#ereader-nav-menu-mobile").modal("hide")}function showBookshelfNavInMoblie(){$("#bookshelf-nav-menu-mobile").modal("show"),bookSpecificFeatureDisplay()}function hideBookshelfNavMobile(){$("#bookshelf-nav-menu-mobile").modal("hide"),$(".bookshelf-nav-mobile-cog").focus()}function closeOtherPopovers(){$(".ebook-search").popover("hide"),$(".ebook-fontsize").popover("hide"),$("#ebook-toc").popover("hide"),$("#ebook-toc-mobile").popover("hide"),$(".ereader-chapter-list").popover("hide"),$(".rTsIconPopover").popover("hide"),insideEreader&&$(document).popover("hide"),$(window).width()>768&&($("#bookshelf-nav-menu-mobile").modal("hide"),$("#ereader-nav-menu-mobile").modal("hide"),$("#outline-nav-menu-mobile").modal("hide"),$("#themis-nav-menu-mobile").modal("hide"),$("#cases-nav-menu-mobile").modal("hide"),$("#news-feed-nav-mobile").modal("hide"),$("#study-nav-menu-mobile").modal("hide"))}function gotoChapterRead(e){$(".ereader-chapter-list").popover({html:!0,placement:"bottom",container:"body",template:'<div class="popover ebook-read-chapter-popover" role="dialog" tabindex="-1" aria-hidden="true" aria-describedby="read-chapter-popover" aria-labelledby="read-chapter-popover"><div id = "" class="popover-content read-chapter-popover"></div></div>',content:function(){return $("#ereader-chapter-list-data").html()}});var t=$(window).width();if(t>768)$(".app-left-navigation").width();else t<768&&$(".ereader-chapter-list").on("shown.bs.popover",function(){var e=$(".app-left-navigation").width();$(".ebook-read-chapter-popover").css("left",e+"px")});void 0!==e?showListOfChapters(e):$(".chapter-list-section").html("")}function showListOfChapters(e){var t;for($("#read-chapter-list-parent").empty(),t=0;t<bookChapterSupplimentList.length;t++){if(bookChapterSupplimentList[t].chapterId!==CaseConnect.currentChapterId&&"-999"!==bookChapterSupplimentList[t].navbarTitle)(a=document.createElement("LI")).className="list-style-none",document.getElementById("read-chapter-list-parent").appendChild(a),(o=document.createElement("A")).className="list-style-none",o.id="chapterList"+bookChapterSupplimentList[t].chapterId,o.setAttribute("onclick",'handleGotoPage("'+bookChapterSupplimentList[t].strStartPageNumber+'",event)'),o.setAttribute("href","#"),o.setAttribute("goToPageTop","goToPageTop"),a.appendChild(o),(s=document.createElement("DIV")).className="display-inline-block",s.id="chapterTitleBox"+bookChapterSupplimentList[t].chapterId,s.innerHTML=bookChapterSupplimentList[t].navbarTitle,o.appendChild(s);else if(bookChapterSupplimentList[t].chapterId===CaseConnect.currentChapterId&&"-999"!==bookChapterSupplimentList[t].navbarTitle){var a,o,s;(a=document.createElement("LI")).className="list-style-none",document.getElementById("read-chapter-list-parent").appendChild(a),(o=document.createElement("A")).className="list-style-none",o.style.cursor="auto",o.style.background="#cdcdcd",o.style.display="block",o.id="chapterList"+bookChapterSupplimentList[t].chapterId,o.setAttribute("href","#"),a.appendChild(o),(s=document.createElement("DIV")).className="display-inline-block",s.id="chapterTitleBox"+bookChapterSupplimentList[t].chapterId,s.innerHTML=bookChapterSupplimentList[t].navbarTitle,o.appendChild(s)}}var n=$("#ereader-scroller").height()-20;$(".chapter-list-section").css({height:n+"px","overflow-y":"hidden"}),setTimeout(function(){$(".chapter-list-section").customScrollbar({skin:"default-skin",hScroll:!1,vScroll:!0,updateOnWindowResize:!0}),"block"===$(".ebook-read-chapter-popover").css("display")?($(".mobile-ereader-navigation-modal").is(":visible")?$(".mobile-ereader-navigation-modal").hide():$(".mobile-ereader-navigation-modal").show(),$(".ereader-chapter-list").find(".toggle-up-down").addClass("glyphicon-menu-up").removeClass("glyphicon-menu-down")):($(".mobile-ereader-navigation-modal").show(),$(".ereader-chapter-list").find(".toggle-up-down").addClass("glyphicon-menu-down").removeClass("glyphicon-menu-up")),document.addEventListener("focus",function(e){var t=document.getElementsByClassName("ebook-read-chapter-popover")[0];null!=t&&(t.contains(e.target)||(e.stopPropagation(),void 0!==t.focus()&&t.focus()))},!0)},1e3)}function getChapterAndSupplementalList(){var e={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"EREADER_READING_BOOK",pageNavigatingFrom:"EReader",pageNavigatingTo:"EReader",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01"},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},bookVO:{bookId:CaseConnect.currentBookId}};$.ajax({url:properties[properties.env]+"/bookContentRetrievalService/getChapterAndSupplementalList",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(e)}).then(function(e){if(void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),bookChapterSupplimentList=e.chapterVOList,document.getElementById("next-chapter-button-bottom"))for(var t=0;t<bookChapterSupplimentList.length;t++)CaseConnect.currentChapterId===bookChapterSupplimentList[t].chapterId&&bookChapterSupplimentList[t+1]&&($("#nextChapterFromBottomPage")[0].innerHTML=bookChapterSupplimentList[t+1].navbarTitle,CaseConnect.nextChapterStartPageNumber!==bookChapterSupplimentList[t+1].strStartPageNumber&&(CaseConnect.nextChapterStartPageNumber=bookChapterSupplimentList[t+1].strStartPageNumber));$("#txtPageNum").val(CaseConnect.currentPageNumber),$("#txtPageNumMobile").val(CaseConnect.currentPageNumber);var a=null,o=null;null!=CaseConnect.currentPageNumber&&null!==CaseConnect.currentPageNumber&&(CaseConnect.currentPageNumber=CaseConnect.currentPageNumber.toString(),-1===CaseConnect.currentPageNumber.indexOf("C-")&&-1===CaseConnect.currentPageNumber.indexOf("c-")||(a=parseInt(CaseConnect.currentPageNumber.slice("2")),o=parseInt(CaseConnect.currentChapterEndPageNumber.slice("2"))));var s=document.getElementById("ereader-scroller");if((-999!==parseInt(CaseConnect.nextChapterStartPageNumber)&&(CaseConnect.currentPageNumber===CaseConnect.currentChapterEndPageNumber||parseInt(CaseConnect.currentPageNumber)-1===parseInt(CaseConnect.currentChapterEndPageNumber)||parseInt(CaseConnect.currentPageNumber)+1===parseInt(CaseConnect.currentChapterEndPageNumber))||-999!==parseInt(CaseConnect.nextChapterStartPageNumber)&&null!==a&&(a===o||a-1===o||a+1===o)||$(s).scrollTop()+$(s).innerHeight()>=$(s)[0].scrollHeight)&&CaseConnect.currentChapterId!==bookChapterSupplimentList[bookChapterSupplimentList.length-1].chapterId){$(".next-chapter-footer").show();var n=$(window).height();if($("#media-elements-column").height($(".ereader-content").height()+31),(c=$(window).width())<768){var i=$("#next-chapter-footer").height(),r=$("#ereader").height()+$(".ereader-green-block").height()+1;heightWithHeader=r+parseInt(i),$("#next-chapter-footer").css({"padding-left":"0px","padding-right":"0px"})}else heightWithHeader=$("#header-wrapper").height()+$(".ereader-green-block").height()+1+$("#next-chapter-footer").height()+$(".content-top-menu").height()+1;"block"===$("#email-notification").css("display")?heightWithHeader+=$("#email-notification").height():heightWithHeader=heightWithHeader;heightWithHeader,$(".app-left-navigation").height(),$(".content-top-menu").height();$(".ereader-scroll-container").css("max-height",n-heightWithHeader),$(".ereader-scroll-container").css("height",n-heightWithHeader),navigator.userAgent.match(/(iPad|Android|iPhone)/)&&($(".ereader-scroll-container").css("height",n-heightWithHeader),$(".ereader-scroll-container").css("max-height",n-heightWithHeader));var l=0;l=($("#ereader-scroller").height()+$(".content-top-menu").height()+1).toString()+"px",$(".app-left-navigation").css("min-height",l)}else{$(".next-chapter-footer").hide();n=$(window).height();$("#media-elements-column").height($(".ereader-content").height()+31);r=$("#ereader").height()+$(".ereader-green-block").height()+1;var c=$(window).width();heightWithHeader=c<768?r:$("#header-wrapper").height()+$(".ereader-green-block").height()+1+$(".content-top-menu").height()+1;heightWithHeader,$(".app-left-navigation").height(),$(".content-top-menu").height();$(".ereader-scroll-container").css("max-height",n-heightWithHeader),$(".ereader-scroll-container").css("height",n-heightWithHeader),navigator.userAgent.match(/(iPad|Android|iPhone)/)&&($(".ereader-scroll-container").css("height",n-heightWithHeader),$(".ereader-scroll-container").css("max-height",n-heightWithHeader));l=0;l=($("#ereader-scroller").height()+$(".content-top-menu").height()+1).toString()+"px",$(".app-left-navigation").css("min-height",l)}},function(e){sessionAuthFails(e),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function ereaderReadToStudyIcons(){if($("#page-loading-spinner").show(),"toc"!==CaseConnect.currentPageNumber){var e={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"EREADER_FORMATIVE_ASSESSMENT_GET_QUESTIONS",pageNavigatingFrom:"EReader",pageNavigatingTo:"EReader",lastReadBookId:CaseConnect.currentBookId},sessionVO:{appType:CaseConnect.appType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,deviceType:CaseConnect.deviceType,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},questionVO:{chapterId:CaseConnect.currentChapterId,bookId:CaseConnect.currentBookId}};$.ajax({url:properties[properties.env]+"/assessmentRetrievalService/getQuestionsForEreader",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(e)}).then(function(e){if(void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),"true"===e.status)if(e.assessmentVO){if(e.assessmentVO.sectionVOListForResponse){CaseConnect.rTsNotificationFlag=e.userSettingsVO.eReaderStudyTutorialDisplayMessageFlag;var t=[],a=e.assessmentVO.sectionVOListForResponse;if(a.length>0?t=a:t.push(a),sectionDataList=t,null!==t)for(var o=0;o<t.length;o++){if(t[o].learningObjectiveVOList){var s=[],n=t[o].learningObjectiveVOList;if(n.length>0?s=n:s.push(n),1==s.length)for(var i=0;i<s.length;i++)var r=s[i].sumOfQuestionsInLO;else r="some value"}var l=t[o].sectionId;if("0"!==r&&document.getElementById(l)){yValue=document.getElementById(l).getBoundingClientRect().bottom,topValue=yValue;var c=$(".ereader-content").css("line-height");if(insideEreader)var d=document.getElementById("links-container").getBoundingClientRect().top;var u=l;loDataContent=e.assessmentVO;var p=document.createElement("A");p.id="rTsPromptAnchor"+u,p.className="rTsIcon display-inline-block rTsIconPopover",p.style.position="absolute",p.setAttribute("onClick","showrTsPopover(event)"),p.setAttribute("ontouchstart","showrTsPopover(event)"),p.setAttribute("data-toggle","popover"),p.setAttribute("rel","popover"),p.setAttribute("tabindex","0"),p.setAttribute("aria-label","Study Prompt"),p.setAttribute("sectionId",l),p.style.top=topValue-d-55+"px";var h=document.createElement("UL");h.className="list-style-none no-padding";var g=document.createElement("LI");g.className="display-inline-block",h.appendChild(g);var f=document.createElement("IMG");f.id="linkDiv"+u,f.className="display-inline-block rTs-icon-image",f.src="img/ereader/read-to-study-icon.png",g.appendChild(f),p.appendChild(h),insideEreader&&document.getElementById("links-container").appendChild(p);var m,C=$(".linksIcon");$(".rTsIcon");C.sort(function(e,t){return e.style.top>t.style.top?1:e.style.top<t.style.top?-1:0});var y=0;for(m=0;m<C.length;m++)parseInt(C[m].style.top)<parseInt(p.style.top)+parseInt(c)&&parseInt(C[m].style.top)>parseInt(p.style.top)-parseInt(c)&&parseInt(C[m].style.top)>y&&(y=parseInt(C[m].style.top),p.style.top=parseInt(C[m].style.top)+7+parseInt(c)+"px",p.top=parseInt(C[m].style.top)+parseInt(c)+"px")}}}}else $("#page-loading-spinner").hide();setTimeout(function(){$("#txtPageNum").val(CaseConnect.currentPageNumber),$("#txtPageNumMobile").val(CaseConnect.currentPageNumber),"iOS"===CaseConnect.deviceOS&&"iPad"===CaseConnect.deviceType||"iOS"===CaseConnect.deviceOS&&"iPhone"===CaseConnect.deviceType||CaseConnect.deviceType},1e3),searchByPageNum?(CaseConnect.currentPageNumber=searchByPageNum,$("#txtPageNum").val(CaseConnect.currentPageNumber),$("#txtPageNumMobile").val(CaseConnect.currentPageNumber),savelabelSettingsFlag?savelabelSettingsFlag=!1:$(window).trigger("resize"),searchByPageNum=""):($("#txtPageNum").val(CaseConnect.currentPageNumber),$("#txtPageNumMobile").val(CaseConnect.currentPageNumber),savelabelSettingsFlag?savelabelSettingsFlag=!1:$(window).trigger("resize")),reCalculateLinkOnLeft(),reCalculateRtSOnLeft(),$("#page-loading-spinner").hide(),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}else $("#page-loading-spinner").hide()}function showMessageNotificationAlert(e){if(e){var t=e.currentTarget.id;$("#"+t).popover("destroy"),$("#"+t).popover({html:!0,placement:"right",trigger:"manual",container:"body",template:'<div class="popover ebook-custom-popover highlight-popover" rel=popover id="read-study-lo-popover"><div class="arrow popover-arrow"></div><div class="popover-content note-popover-content popover-without-padding" id="add-note-content-box"></div></div>',content:$("#read-study-notification").html()})}$(document).popover("destroy"),$(document).popover({html:!0,placement:"right",trigger:"manual",container:"#ereader-scroller",viewport:"#ereader-scroller",template:'<div class="popover highlight-popover" rel=popover id="read-study-notify"><div class="popover-content note-popover-content popover-without-padding" id="add-note-content-box"></div></div>',content:$("#read-to-study-notification").html()})}function showrTsPopover(e){CaseConnect.readToStudyFirstLo="";var t=e.currentTarget.id,a=$("#"+t).offset().top,o=$("#"+t).height(),s=$("#header-wrapper").height(),n=$("#ereader").height(),i=$(".ereader-green-block").height(),r=a-(s+n+i);a-topOffset<250&&$(window).height()-o-a<250&&(makingSpaceForpopoverToBeDisplayed=!0,document.getElementById("ereader-scroller").scrollTop=document.getElementById(t).offsetTop-250);var l=Handlebars.getTemplate("readToStudyPopover");l(sectionDataList);if($("#read-question-count-content").html(l),e)for(var c=0;c<sectionDataList.length;c++)if(e.currentTarget.getAttribute("sectionId")===sectionDataList[c].sectionId){if(sectionDataList[c].learningObjectiveVOList){var d=[],u=sectionDataList[c].learningObjectiveVOList;u.length>0?d=u:d.push(u);for(var p=0;p<d.length;p++){if("0"!==d[p].sumOfQuestionsInLO){var h=document.createElement("DIV");h.className="rts-lo-block-section display-inline-block",document.getElementById("rts-lo-desc-ques").appendChild(h);var g=document.createElement("DIV");g.className="",h.appendChild(g);var f=document.createElement("A");f.className="expand-lo-title",f.id="lo-title-anchor_"+p,f.setAttribute("onClick","expandCollapseLORts(this)"),f.setAttribute("loId",d[p].learningObjId),f.setAttribute("data-toggle","collapse"),g.appendChild(f);var m=document.createElement("SPAN");m.className="rts-lo-title rts-lo-title-collapse display-inline-block",m.id="rts-lo-title-text_"+p,m.innerHTML=d[p].learningObjName,m.setAttribute("onClick","expandCollapseLORts(this)"),m.setAttribute("loId",d[p].learningObjId),m.setAttribute("aria-label",d[p].learningObjName),g.appendChild(m);var C=document.createElement("DIV");if(C.className="rts-lo-question-details display-inline-block",C.style.display="none",h.appendChild(C),"0"!==d[p].totalTextExplainerQuestions){var y=document.createElement("DIV");"1"===d[p].totalTextExplainerQuestions?y.innerHTML=d[p].totalTextExplainerQuestions+" Explanation":y.innerHTML=d[p].totalTextExplainerQuestions+" Explanations",C.appendChild(y)}if("0"!==d[p].totalVideoQuestions){var v=document.createElement("DIV");"1"===d[p].totalVideoQuestions?v.innerHTML=d[p].totalVideoQuestions+" Video":v.innerHTML=d[p].totalVideoQuestions+" Videos",C.appendChild(v)}if("0"!==d[p].totalAudioQuestions){var I=document.createElement("DIV");"1"===d[p].totalAudioQuestions?I.innerHTML=d[p].totalAudioQuestions+" Audio":I.innerHTML=d[p].totalAudioQuestions+" Audios",C.appendChild(I)}if("0"!==d[p].totalEssayQuestions){var b=document.createElement("DIV");"1"===d[p].totalEssayQuestions?b.innerHTML=d[p].totalEssayQuestions+" Essay Question":b.innerHTML=d[p].totalEssayQuestions+" Essay Questions",C.appendChild(b)}if("0"!==d[p].totalFCQuestions){var k=document.createElement("DIV");"1"===d[p].totalFCQuestions?k.innerHTML=d[p].totalFCQuestions+" Flash Card":k.innerHTML=d[p].totalFCQuestions+" Flash Cards",C.appendChild(k)}if("0"!==d[p].totalMCQQuestions){var A=document.createElement("DIV");"1"===d[p].totalMCQQuestions?A.innerHTML=d[p].totalMCQQuestions+" Multiple Choice Question":A.innerHTML=d[p].totalMCQQuestions+" Multiple Choice Questions",C.appendChild(A)}if("0"!==d[p].totalhypoQuestions){var O=document.createElement("DIV");"1"===d[p].totalhypoQuestions?O.innerHTML=d[p].totalhypoQuestions+" Short Answer Question":O.innerHTML=d[p].totalhypoQuestions+" Short Answer Questions",C.appendChild(O)}if("0"!==d[p].totalissueSpotQuestions){var S=document.createElement("DIV");"1"===d[p].totalissueSpotQuestions?S.innerHTML=d[p].totalissueSpotQuestions+" Issue Spotting Activity":S.innerHTML=d[p].totalissueSpotQuestions+" Issue Spotting Activities",C.appendChild(S)}}}}showMessageNotificationAlert(e),rtsIconId=t,$("#"+t).popover("show");for(var T=0;T<d.length;T++){"0"!==d[T].sumOfQuestionsInLO&&""===CaseConnect.readToStudyFirstLo&&(CaseConnect.readToStudyFirstLo=d[T].learningObjId,loAnchorRtS=T)}setTimeout(function(){expandCollapseLORtsOnLoad(loAnchorRtS)},100);var P=$(window).width();return!insideTouchDevices&&P>767&&"true"===CaseConnect.rTsNotificationFlag&&$(document).popover("show"),void(!insideTouchDevices&&P>767&&$(document).on("shown.bs.popover",function(){var e,t=$("#tab-section-container").width(),a=$("#read-study-notify").width(),o=$(window).width(),l=$(document).height(),c=$(".read-study-content-wrapper").height(),d=l-(s+n+i);d<r+c&&(r=r-(r+c-d)-100),o<767?(e=Math.abs(t-a+100),$("#read-study-notify").css({left:e+"px",top:r+"px"})):o>767&&(CaseConnect.deviceType,e=Math.abs(t),$("#read-study-notify").css({top:r+"px",left:e+"px"}))}))}}function expandCollapseLORts(e){var t=$(e);t.parent().find(">a:first").toggleClass("expand-lo-title").toggleClass("collapse-lo-title"),t.parent().find(">span:first").toggleClass("rts-lo-title-collapse"),t.parent().find(">a:first").hasClass("collapse-lo-title")?t.parent().find(">a:first").attr("aria-label","Hide LO details"):t.parent().find(">a:first").hasClass("expand-lo-title")&&t.parent().find(">a:first").attr("aria-label","View LO details"),t.parent().next(".rts-lo-question-details").slideToggle("slow",function(){})}function expandCollapseLORtsOnLoad(e){$("a#lo-title-anchor_"+e)[1];$("a#lo-title-anchor_"+e)[1].classList.toggle("collapse-lo-title"),$("a#lo-title-anchor_"+e)[1].classList.toggle("expand-lo-title"),$("span#rts-lo-title-text_"+e)[1].classList.toggle("rts-lo-title-collapse"),$("a#lo-title-anchor_"+e)[1].parentNode.nextSibling.style.display="block"}function hideDocumentPopover(){$(".rTsIconPopover").on("hide.bs.popover",function(){$(document).popover("hide")})}function rtsGoStudy(e){$("#"+rtsIconId).popover("hide"),$(document).popover("hide"),comingFromRtsToStudy=!0,insideStudy()}function hideRtsNotificationPopover(){var e=$(".read-to-study-notification-check")[0].checked;e?(CaseConnect.rTsNotificationFlag="false",saveRtsNotificationResponse()):e||$(document).popover("hide")}function saveRtsNotificationResponse(){var e={userVO:{userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId,userActivityVO:{lastActivityCode:"EREADER_READING_BOOK",pageNavigatingFrom:"EReader",pageNavigatingTo:"EReader",lastReadBookId:CaseConnect.currentBookId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},userSettingsVO:{userId:map.userId,eReaderStudyTutorialDisplayMessageFlag:CaseConnect.rTsNotificationFlag,createdBy:map.userId,modifiedBy:map.userId},bookVO:{bookId:CaseConnect.currentBookId}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageUserService/saveEreaderStudyTutorialMessageDisplayStatus",type:"POST",contentType:"application/json",accept:"application/json",async:!1,data:JSON.stringify(e)}).then(function(e){"true"===e.status&&(void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),$("#page-loading-spinner").hide(),$(document).popover("hide")),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),alertMessagesModal(exceptionMsg.systemError)})}function displayRtsOnLeft(e){if(null!==e)for(var t=0;t<e.length;t++){var a=e[t].sectionId;$("#rTsPromptAnchor"+a)&&$("#rTsPromptAnchor"+a).remove();var o=[],s=e[t].learningObjectiveVOList;if(s.length>0?o=s:o.push(s),1==o.length)for(var n=0;n<o.length;n++)var i=o[n].sumOfQuestionsInLO;else i="some value";if("0"!==i&&document.getElementById(a)){yValue=document.getElementById(a).getBoundingClientRect().bottom,topValue=yValue;var r=$(".ereader-content").css("line-height"),l=document.getElementById("links-container").getBoundingClientRect().top,c=a,d=document.createElement("A");d.id="rTsPromptAnchor"+c,d.className="rTsIcon display-inline-block rTsIconPopover",d.style.position="absolute",d.setAttribute("onClick","showrTsPopover(event)"),d.setAttribute("ontouchstart","showrTsPopover(event)"),d.setAttribute("data-toggle","popover"),d.setAttribute("rel","popover"),d.setAttribute("tabindex","0"),d.setAttribute("aria-label","Study Prompt"),d.setAttribute("sectionId",a),d.style.top=topValue-l-55+"px";var u=document.createElement("UL");u.className="list-style-none no-padding";var p=document.createElement("LI");p.className="display-inline-block",u.appendChild(p);var h=document.createElement("IMG");h.id="linkDiv"+c,h.className="display-inline-block rTs-icon-image",h.src="img/ereader/read-to-study-icon.png",p.appendChild(h),d.appendChild(u),document.getElementById("links-container").appendChild(d);var g,f=$(".linksIcon");$(".rTsIcon");f.sort(function(e,t){return e.style.top>t.style.top?1:e.style.top<t.style.top?-1:0});var m=0;for(g=0;g<f.length;g++)parseInt(f[g].style.top)<parseInt(d.style.top)+parseInt(r)&&parseInt(f[g].style.top)>parseInt(d.style.top)-parseInt(r)&&parseInt(f[g].style.top)>m&&(m=parseInt(f[g].style.top),d.style.top=parseInt(f[g].style.top)+7+parseInt(r)+"px",d.top=parseInt(f[g].style.top)+parseInt(r)+"px")}}}function reCalculateRtSOnLeft(){$(".rTsIconPopover").each(function(){$("#rTsPromptAnchor"+this.id).remove(),sectionDataList&&displayRtsOnLeft(sectionDataList)})}function claculateStaticPopoverTop(){$(window).height();var e=$(".popover.search-popover").css("top")?$(".popover.search-popover").css("top"):$(".popover.ereader-font-change-popover").css("top");e=parseInt(e),$("#media-elements-column").height($(".ereader-content").height()+31),"block"===$("#email-notification").css("display")?e=e+$("#email-notification").height()+"px":e+="px",$(".popover.search-popover").css({position:"absolute",top:e}),$(".popover.ereader-font-change-popover").css({position:"absolute",top:e})}function welcomeTutorial(e){"true"===CaseConnect.applicationOverlayTutorialDisplayMessageFlag?"practicepack"==tutorialApplicationBookType||"oer"==tutorialApplicationBookType?($("#new-bookshelf-modal-faculty").modal("hide"),$("#practisepack-tutorial-faculty").modal("show"),$("#studyaid-tutorial-faculty").modal("hide"),e&&($("#practisepack-tutorial-faculty #cbc-close-link").attr("onclick","saveApplicationOverlayTutorialMessage(true)"),$("#practisepack-tutorial-faculty .done").attr("onclick","saveApplicationOverlayTutorialMessage(true)")),caseBookTutorial=!1,practicePackTutorial=!0,studyAidTutorial=!1,slideIndex=1,showDivs(slideIndex)):"casebook"==tutorialApplicationBookType||"coursebook"==tutorialApplicationBookType?($("#new-bookshelf-modal-faculty").modal("show"),$("#practisepack-tutorial-faculty").modal("hide"),$("#studyaid-tutorial-faculty").modal("hide"),caseBookTutorial=!0,practicePackTutorial=!1,studyAidTutorial=!1,slideIndex=1,showDivs(slideIndex),e&&($("#new-bookshelf-modal-faculty #cbc-close-link").attr("onclick","saveApplicationOverlayTutorialMessage(true)"),$("#new-bookshelf-modal-faculty .done").attr("onclick","saveApplicationOverlayTutorialMessage(true)"))):"studyaid"==tutorialApplicationBookType?($("#new-bookshelf-modal-faculty").modal("hide"),$("#practisepack-tutorial-faculty").modal("hide"),$("#studyaid-tutorial-faculty").modal("show"),caseBookTutorial=!1,practicePackTutorial=!1,studyAidTutorial=!0,slideIndex=1,showDivs(slideIndex),e&&($("#studyaid-tutorial-faculty #cbc-close-link").attr("onclick","saveApplicationOverlayTutorialMessage(true)"),$("#studyaid-tutorial-faculty .done").attr("onclick","saveApplicationOverlayTutorialMessage(true)"))):($("#new-bookshelf-modal-faculty").modal("hide"),$("#practisepack-tutorial-faculty").modal("hide"),$("#studyaid-tutorial-faculty").modal("hide"),caseBookTutorial=!1,practicePackTutorial=!1,studyAidTutorial=!1,slideIndex=1):($("#new-bookshelf-modal-faculty").modal("hide"),$("#practisepack-tutorial-faculty").modal("hide"),$("#studyaid-tutorial-faculty").modal("hide"),caseBookTutorial=!1,practicePackTutorial=!1,studyAidTutorial=!1,slideIndex=1)}