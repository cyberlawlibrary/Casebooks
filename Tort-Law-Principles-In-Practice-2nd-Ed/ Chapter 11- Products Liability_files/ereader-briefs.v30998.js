var briefStartOffsetAtSectionLevel,briefEndOffsetAtSectionLevel,briefedTextWithoutHTML,briefStartParaId,briefEndParaId,briefParaStartOffset,casesChapterListOnLoad,casesSectionListOnLoad,addingBrief=!1,updatingBrief=!1,addBriefPopoverShown=!1,insidePrincipalCase=!1,pCaseWithHeadingCitation=!1,pCaseWithHeadingOnly=!1,keepBriefPopoverVisible=!1,clickedInsidePcaseForAnnot=!1,addedBriefFromAnnotation=!1,colorCodeInput="",colorList=["#ede48c","#b5eb97","#aee6fe","#fec0ff","#ffd4a8","#cbbefc"],colorMarkerList="",briefSpanId=0,savedCaseSearchedText="",briefLabelFromCommonPopover="",briefTextClickFlag=!1,insideCasesPage=!1,currentSelectedAutoSuggestIndexCase=null,caseExcerptClicked=!1,checkModalColorArray=[],customBriefModified=!1,labelListIsClicked=!1,checkDropValue=null,checkIfCaseloaded=!1,checkIfBriefloaded=!1,checkIfShareBriefloaded=!1,shareBriefClickedMobile=!1,savelabelSettingsFlag=!1,caseExcerptLeftTitle="",caseExcerptRightTitle="",leftPaneTitle="",rightPaneTitle="",globalChapterBriefList="",updateHighlightCalledFromPallets=!1,tabData="";function mouseClicked(e){}function cancelBriefSettingModal(){for(var e,t,a=$("#brief-modal-list-content").children(),i=[],o=0;o<a.length;o++)i.push(a[o].getAttribute("label-color"));for(o=0;o<a.length;o++){if(a[o].childNodes[0].value!=a[o].getAttribute("label-title")){e=!0;break}e=!1}for(o=0;o<a.length;o++){if(checkModalColorArray[o]!=i[o]){t=!0;break}t=!1}1==e||1==t?($("#cancel-case-modal").modal("show"),$(".cases-modal").css("opacity","0")):closeBriefModalWithoutSave()}function showCancelModel(){$(".cases-modal").css("opacity","")}function closeBriefModalWithoutSave(){$(".cases-modal").css("opacity",""),$("#brief-setting-modal").modal("hide"),insideEreader&&"true"==CaseConnect.welcomeCaseBriefInEreader&&updateWelcomeCaseBriefInEreader()}function saveDataForBriefModal(){$("#page-loading-spinner").show(),savelabelSettingsFlag=!0;for(var e=$("#brief-modal-list-content").children(),t=null,a=null,i=null,o="",r=0;r<e.length;r++)e[r].childNodes[0].value,e[r].setAttribute("label-title",e[r].childNodes[0].value),e[r].setAttribute("label-orderIndex",r+1),t=e[r].getAttribute("label-title"),a=e[r].getAttribute("label-color"),i=r+1,e[r].childNodes[0].setAttribute("aria-label",t),e[r].childNodes[0].setAttribute("value",t),e[r].childNodes[0].setAttribute("label-title",t),t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"),o=r!==e.length-1?o+'{"colorCode":"'+a+'", "labelName":"'+t+'","orderIndex":"'+i+'"},':o+'{"colorCode":"'+a+'", "labelName":"'+t+'","orderIndex":"'+i+'"}';o=JSON.parse("["+o+"]");var n={userVO:{userId:CaseConnect.currentUserId,userRole:CaseConnect.currentUserRole,userRoleId:CaseConnect.currentUserRoleId,streamContentRequiredFlag:!1,userActivityVO:{lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"",lastReadParagraphId:"",lastViewedOutlineId:CaseConnect.lastViewedOutlineId},sessionVO:{deviceOS:CaseConnect.deviceOS,deviceType:CaseConnect.deviceType,browserName:CaseConnect.browserName,appType:CaseConnect.appType,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},bookVO:{bookId:CaseConnect.currentBookId},labelVOList:o};insideEreader?(n.userVO.userActivityVO.lastActivityCode="EREADER_READING_BOOK",n.userVO.userActivityVO.pageNavigatingFrom="EReader",n.userVO.userActivityVO.pageNavigatingTo="EReader"):(n.userVO.userActivityVO.lastActivityCode="CASE_PAGE",n.userVO.userActivityVO.pageNavigatingFrom="CASES",n.userVO.userActivityVO.pageNavigatingTo="CASES"),$.ajax({url:properties[properties.env]+"/manageCases/saveLabelSettings",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(n)}).then(function(e){if(void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),"true"===e.status){void 0!==e.labelVOList?(CaseConnect.preSetBriefLabelList=e.labelVOList,loadDataListInPopover(),$("#brief-setting-modal").modal("hide")):(CaseConnect.preSetBriefLabelList="",loadDataListInPopover(),$("#brief-setting-modal").modal("hide"));for(var t=$('highlight[id^="note"]'),a=0;a<t.length;a++){var i=document.getElementById(t[a].id);(n=document.createElement("span")).innerHTML=i.innerHTML,n.normalize(),i.parentNode.replaceChild(n,i)}if(insideEreader){for(t=$('briefstag[class^="briefElementText"]'),a=0;a<t.length;a++){i=document.getElementById(t[a].id);(n=document.createElement("span")).innerHTML=i.innerHTML,n.normalize(),i.parentNode.replaceChild(n,i)}var o=$("anchortag.anchorElementText");for(a=0;a<o.length;a++){var r=document.getElementById(o[a].id);(d=document.createElement("span")).innerHTML=r.innerHTML,d.normalize(),r.parentNode.replaceChild(d,r)}fetchBrief(CaseConnect.currentChapterId)}else if(insideCasesPage){CaseConnect.currentChapterId=casesSectionListOnLoad.chapterId,CaseConnect.currentSectionId=casesSectionListOnLoad.sectionId,CaseConnect.currentSectionTitle=casesSectionListOnLoad.sectionTitle;for(t=$('highlight[class^="highlightedText"]'),a=0;a<t.length;a++){var n;i=document.getElementById(t[a].id);(n=document.createElement("span")).innerHTML=i.innerHTML,n.normalize(),i.parentNode.replaceChild(n,i)}var s=$('briefstag[class^="briefElementText"]');for(a=0;a<s.length;a++){var l=document.getElementById(s[a].id),c=document.createElement("span");c.innerHTML=l.innerHTML,c.normalize(),l.parentNode.replaceChild(c,l)}for(o=$("anchortag.anchorElementText"),a=0;a<o.length;a++){var d;r=document.getElementById(o[a].id);(d=document.createElement("span")).innerHTML=r.innerHTML,d.normalize(),r.parentNode.replaceChild(d,r)}fetchAnnotations(casesSectionListOnLoad.chapterId)}insideEreader&&"true"===CaseConnect.welcomeCaseBriefInEreader&&updateWelcomeCaseBriefInEreader()}else $("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg),sessionTimeOut()},function(e){sessionTimeOut(),sessionAuthFails(e),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function fetchDataForBriefModal(){if(addingBrief=!1,updatingBrief=!1,addBriefPopoverShown=!1,displayCommonAnnotationPopover=!1,pCaseWithHeadingCitation=!1,pCaseWithHeadingOnly=!1,addedBriefFromAnnotation=!1,briefTextClickFlag=!1,$("#"+selectedNoteId).popover("hide"),removeDummyTags(),CaseConnect.preSetBriefLabelList){$("#brief-setting-modal").modal("show"),$("ul#brief-modal-list-content").html("");for(var e="",t=CaseConnect.preSetBriefLabelList,a=0;a<t.length;a++)"#ede48c"===t[a].colorCode?e="label-yellow-modal":"#b5eb97"===t[a].colorCode?e="label-green-modal":"#aee6fe"===t[a].colorCode?e="label-blue-modal":"#fec0ff"===t[a].colorCode?e="label-pink-modal":"#ffd4a8"===t[a].colorCode?e="label-orange-modal":"#cbbefc"===t[a].colorCode&&(e="label-purple-modal"),void 0!==t[a].labelName?navigator.userAgent.match(/(iPad|Android|iPhone)/)||insideTouchDevices?($("ul#brief-modal-list-content").append("<li class='' onClick='mouseClicked(event);' label-title='"+t[a].labelName+"' label-color='"+t[a].colorCode+"' label-orderIndex='"+t[a].orderIndex+"'><input class='form-control "+e+" labeltext' type='text' value='"+t[a].labelName+"' placeholder='Type your label here' id='example-text-input_"+[a+1]+"' label-title='"+t[a].labelName+"' label-color='"+t[a].colorCode+"' label-orderIndex='"+t[a].orderIndex+"'/></li>"),$(".sortabless2").removeClass("sortabless2")):$("ul#brief-modal-list-content").append("<li class='move' onClick='mouseClicked(event);' label-title='"+t[a].labelName+"' label-color='"+t[a].colorCode+"' label-orderIndex='"+t[a].orderIndex+"'><input class='form-control "+e+" labeltext' type='text' value='"+t[a].labelName+"' placeholder='Type your label here' id='example-text-input_"+[a+1]+"' label-title='"+t[a].labelName+"' label-color='"+t[a].colorCode+"' label-orderIndex='"+t[a].orderIndex+"'/></li>"):navigator.userAgent.match(/(iPad|Android|iPhone)/)||insideTouchDevices?($("ul#brief-modal-list-content").append("<li class='' onClick='mouseClicked(event);' label-title='' label-color='"+t[a].colorCode+"' label-orderIndex='"+t[a].orderIndex+"'><input class='form-control "+e+" labeltext' type='text' value='' placeholder='Type your label here' id='example-text-input_"+[a+1]+"' label-title='' label-color='"+t[a].colorCode+"' label-orderIndex='"+t[a].orderIndex+"'/></li>"),$(".sortabless2").removeClass("sortabless2")):$("ul#brief-modal-list-content").append("<li class='move' onClick='mouseClicked(event);' label-title='' label-color='"+t[a].colorCode+"' label-orderIndex='"+t[a].orderIndex+"'><input class='form-control "+e+" labeltext' type='text' value='' placeholder='Type your label here' id='example-text-input_"+[a+1]+"' label-title='' label-color='"+t[a].colorCode+"' label-orderIndex='"+t[a].orderIndex+"'/></li>")}else{$("#page-loading-spinner").show();var i={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),streamContentRequiredFlag:!1,userActivityVO:{lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:""},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},bookVO:{bookId:CaseConnect.currentBookId}};insideEreader?(i.userVO.userActivityVO.lastActivityCode="EREADER_READING_BOOK",i.userVO.userActivityVO.pageNavigatingFrom="EReader",i.userVO.userActivityVO.pageNavigatingTo="EReader"):(i.userVO.userActivityVO.lastActivityCode="CASE_PAGE",i.userVO.userActivityVO.pageNavigatingFrom="CASES",i.userVO.userActivityVO.pageNavigatingTo="CASES"),$.ajax({url:properties[properties.env]+"/manageCases/getLabelSettings ",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(i)}).then(function(e){if(void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),"true"===e.status)if(null!=e.hasPCaseAnnotation&&null!=e.hasPCaseAnnotation&&("true"==e.hasPCaseAnnotation?CaseConnect.hasPCaseAnnotation="true":CaseConnect.hasPCaseAnnotation="false"),e.labelVOList){if(void 0!==e.labelVOList){!e.labelVOList.length>0&&(e.labelVOList=[e.labelVOList]),e.labelVOList?(CaseConnect.preSetBriefLabelList=e.labelVOList,loadDataListInPopover()):(CaseConnect.preSetBriefLabelList="",loadDataListInPopover());var t=CaseConnect.preSetBriefLabelList;if(t){$("#brief-setting-modal").modal("show"),$("ul#brief-modal-list-content").html("");for(var a="",i=0;i<t.length;i++)"#ede48c"===t[i].colorCode?a="label-yellow-modal":"#b5eb97"===t[i].colorCode?a="label-green-modal":"#aee6fe"===t[i].colorCode?a="label-blue-modal":"#fec0ff"===t[i].colorCode?a="label-pink-modal":"#ffd4a8"===t[i].colorCode?a="label-orange-modal":"#cbbefc"===t[i].colorCode&&(a="label-purple-modal"),void 0!==t[i].labelName?navigator.userAgent.match(/(iPad|Android|iPhone)/)||insideTouchDevices?($("ul#brief-modal-list-content").append("<li class='' onClick='mouseClicked(event);' label-title='"+t[i].labelName+"' label-color='"+t[i].colorCode+"' label-orderIndex='"+t[i].orderIndex+"'><input class='form-control "+a+" labeltext' type='text' value='"+t[i].labelName+"' placeholder='Type your label here' id='example-text-input_"+[i+1]+"' label-title='"+t[i].labelName+"' label-color='"+t[i].colorCode+"' label-orderIndex='"+t[i].orderIndex+"'></li>"),$(".sortabless2").removeClass("sortabless2")):$("ul#brief-modal-list-content").append("<li class='move' onClick='mouseClicked(event);' label-title='"+t[i].labelName+"' label-color='"+t[i].colorCode+"' label-orderIndex='"+t[i].orderIndex+"'><input class='form-control "+a+" labeltext' type='text' value='"+t[i].labelName+"' placeholder='Type your label here' id='example-text-input_"+[i+1]+"' label-title='"+t[i].labelName+"' label-color='"+t[i].colorCode+"' label-orderIndex='"+t[i].orderIndex+"'></li>"):navigator.userAgent.match(/(iPad|Android|iPhone)/)||insideTouchDevices?($("ul#brief-modal-list-content").append("<li class='' onClick='mouseClicked(event);' label-title='' label-color='"+t[i].colorCode+"' label-orderIndex='"+t[i].orderIndex+"'><input class='form-control "+a+" labeltext' type='text' value='' placeholder='Type your label here' id='example-text-input_"+[i+1]+"' label-title='' label-color='"+t[i].colorCode+"' label-orderIndex='"+t[i].orderIndex+"'></li>"),$(".sortabless2").removeClass("sortabless2")):$("ul#brief-modal-list-content").append("<li class='move' onClick='mouseClicked(event);' label-title='' label-color='"+t[i].colorCode+"' label-orderIndex='"+t[i].orderIndex+"'><input class='form-control "+a+" labeltext' type='text' value='' placeholder='Type your label here' id='example-text-input_"+[i+1]+"' label-title='' label-color='"+t[i].colorCode+"' label-orderIndex='"+t[i].orderIndex+"'></li>");$("#page-loading-spinner").hide()}else $("#page-loading-spinner").hide(),$("#brief-setting-modal").modal("show"),navigator.userAgent.match(/(iPad|Android|iPhone)/)||insideTouchDevices?($("ul#brief-modal-list-content li").removeClass("move"),$(".sortabless2").removeClass("sortabless2")):$("ul#brief-modal-list-content li").hasClass("move")||$("ul#brief-modal-list-content li").addClass("move")}sessionTimeOut()}else $("#page-loading-spinner").hide(),$("#brief-setting-modal").modal("show"),navigator.userAgent.match(/(iPad|Android|iPhone)/)||insideTouchDevices?($("ul#brief-modal-list-content li").removeClass("move"),$(".sortabless2").removeClass("sortabless2")):$("ul#brief-modal-list-content li").hasClass("move")||$("ul#brief-modal-list-content li").addClass("move");else $("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)},function(e){sessionTimeOut(),sessionAuthFails(e),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}$("ul#brief-modal-list-content").find("li").eq(0).children().focus(),checkModalColorArray=[];var o=$("#brief-modal-list-content").children();for(a=0;a<o.length;a++)checkModalColorArray.push(o[a].getAttribute("label-color"));"true"==CaseConnect.hasPCaseAnnotation?$(".hasPCaseAnnotation-text").show():$(".hasPCaseAnnotation-text").hide()}function showAddBriefPopoverOnly(){(labelListIsClicked=!1,$("#brief-label-list ").css("display","none"),$("#brief-label-list li").css("display","none"),removeDefaultSelectionColor(),$(".delete-btn").css("visibility","hidden")[1],$(".save-brief-icon").css("visibility","hidden")[1],highlightPalletsVisibleOnly=!1,updatingBrief||briefTextClickFlag||(addingBrief=!0),insideEreader)&&($("#"+selectedNoteId).offset().top-topOffset<250&&$(window).height()-$("#"+selectedNoteId).height()-$("#"+selectedNoteId).offset().top<250&&(makingSpaceForpopoverToBeDisplayed=!0,document.getElementById("ereader-scroller").scrollTop=document.getElementById(selectedNoteId).offsetTop-250,yValue=document.getElementById(selectedNoteId).getBoundingClientRect().top));$("#"+selectedNoteId).popover("destroy"),$("#"+selectedNoteId).popover({html:!0,placement:"auto bottom",trigger:"manual",container:"body",template:'<div class="popover ebook-custom-popover highlight-popover" rel=popover id="highlight-popover-notes"><div class="arrow popover-arrow"></div><div class="popover-content note-popover-content popover-without-padding" id="add-note-content-box"></div></div>',content:$("#popover-add-brief-content-only").html()}),$("#"+selectedNoteId).on("shown.bs.popover",function(){var e=$("#highlight-popover-notes").offset().left,t=$(window).width()-($("#highlight-popover-notes").outerWidth()+$("#highlight-popover-notes").offset().left);if(t<0){var a=Math.abs(t);$("#highlight-popover-notes").css("left",e-a+"px")}}),$("#"+selectedNoteId).popover("show"),addBriefPopoverShown=!0,setTimeout(function(){var e;(e=$("textarea#add-brief-textarea")[1].value,$("textarea#add-brief-textarea")[1].value="",$("textarea#add-brief-textarea")[1].value=e,initialiseKeyUpForBriefPopover(),document.getElementById(selectedNoteId).style.backgroundColor||(selectedHighlightColor=""),updateBriefColorPallet(selectedHighlightColor),updatingBrief)&&(Clipboard.isSupported()||copyTextToClipBoard("copyBrief"),copyTextWithClipCode());document.getElementById(selectedNoteId).hasAttribute("style")?document.getElementById(selectedNoteId).hasAttribute("style")&&""===$("textarea#add-brief-textarea")[1].innerHTML&&void 0!==$("button#color-blank-briefs")[1]&&$("button#color-blank-briefs")[1].removeAttribute("disabled"):void 0!==$("button#color-blank-briefs")[1]&&$("button#color-blank-briefs")[1].setAttribute("disabled","disabled"),loadDataListInPopover()},30),$("input#add-brief-label-box").focus(),$("button#brief-setting-change").css("display","inline-block"),navigator.userAgent.match(/(iPad|Android|iPhone)/)||($("#highlight-popover-notes textarea#add-brief-textarea").keydown(function(e){""!==$("textarea#add-brief-textarea")[1].value&&9==e.keyCode&&(e.preventDefault(),$("button.save-brief-icon").focus())}),$("#highlight-popover-notes button.save-brief-icon").keydown(function(e){""!==$("textarea#add-brief-textarea")[1].value&&9==e.keyCode&&(e.preventDefault(),$("button#color-yellow").focus())})),$("button.copy-clipboard-true.copy-clip-button").hide(),$("input.zero-clipboard-true.copy-clip-button").hide(),displayCommonAnnotationPopover=!1,pCaseWithHeadingCitation=!1,pCaseWithHeadingOnly=!1,"inline-block"===$("button#brief-setting-change").css("display")?$(".color-btns").css("padding","0 15px"):$(".color-btns").css("padding","0 17px")}function initialiseKeyUpForBriefPopover(){if($(".brief-label-not-found").hide(),$("ul.searchAutoSuggestLableList").length>1&&$("ul.searchAutoSuggestLableList").css("display","none"),void 0!==CaseConnect.preSetBriefLabelList&&""!==CaseConnect.preSetBriefLabelList){if(selectedHighlightColor&&(addingBrief||updatingBrief)){colorCodeInput=selectedHighlightColor,convertRGBToHex(colorCodeInput);for(var e=0;e<CaseConnect.preSetBriefLabelList.length;e++)if(CaseConnect.preSetBriefLabelList[e].colorCode===colorCodeInput){void 0!==CaseConnect.preSetBriefLabelList[e].labelName?$("input#add-brief-label-box")[1].value=CaseConnect.preSetBriefLabelList[e].labelName.replace(/&lt;/g,"<").replace(/&gt;/g,">"):$("input#add-brief-label-box")[1].value="";break}}if(addedBriefFromAnnotation&&selectedHighlightColor){colorCodeInput=selectedHighlightColor,convertRGBToHex(colorCodeInput);for(e=0;e<CaseConnect.preSetBriefLabelList.length;e++)if(CaseConnect.preSetBriefLabelList[e].colorCode===colorCodeInput){void 0!==CaseConnect.preSetBriefLabelList[e].labelName?$("input#add-brief-label-box")[1].value=CaseConnect.preSetBriefLabelList[e].labelName.replace(/&lt;/g,"<").replace(/&gt;/g,">"):$("input#add-brief-label-box")[1].value="";break}updateBriefColorPallet(colorCodeInput),$(".delete-btn").css("visibility","hidden")[1],$("button#color-blank-briefs").attr("disabled","disabled")}}var t=$("textarea#add-brief-textarea")[1].value,a=$("input#add-brief-label-box")[1].value;""!==a||""!==t||$(".color-btns").hasClass("selectedColor")||briefTextClickFlag||(addingBrief=!0,updatingBrief=!1),(""===a&&""!==t||""!==a&&""===t)&&briefTextClickFlag&&(updatingBrief=!0,addingBrief=!1),$(".add-brief-label-box").keyup(function(){var e=$("textarea#add-brief-textarea")[1].value,t=$("input#add-brief-label-box")[1].value;""!==t?($(".save-brief-icon").css("visibility","visible")[1],briefTextClickFlag&&(updatingBrief=!0)):""===t&&(""===t&&""!==e?($(".save-brief-icon").css("visibility","visible")[1],briefTextClickFlag&&(updatingBrief=!0),!0===updatingBrief&&(addingBrief=!1,updatingBrief=!0)):($(".save-brief-icon").css("visibility","hidden")[1],!0===updatingBrief?(addingBrief=!1,updatingBrief=!0):""!==t||""!==e||briefTextClickFlag||(addingBrief=!0,updatingBrief=!1)),briefTextClickFlag&&updatingBrief&&$(".save-brief-icon").css("visibility","visible")[1]),addedBriefFromAnnotation&&selectedHighlightColor&&($(".delete-btn").css("visibility","hidden")[1],$("button#color-blank-briefs").attr("disabled","disabled"))}),$(".brief-textarea").keyup(function(){if($(".brief-label-not-found").hide(),$("ul.searchAutoSuggestLableList").length>1&&$("ul.searchAutoSuggestLableList").css("display","none"),$(".color-btns").hasClass("selectedColor")||($("input#add-brief-label-box")[1].value=""),$(".color-btns").hasClass("selectedColor"))for(var e=$(".color-btns"),t=0;t<e.length;t++)if($("#"+e[t].id).hasClass("selectedColor")){var a=$("#"+$(".color-btns")[t].id).attr("colorcode"),i=$("#"+$(".color-btns")[t].id).attr("brieflabel");$("input#add-brief-label-box")[1].setAttribute("selectedColor",a),""===i&&($("input#add-brief-label-box")[1].value="");break}var o=$("textarea#add-brief-textarea")[1].value,r=$("input#add-brief-label-box")[1].value;""!==o?($(".save-brief-icon").css("visibility","visible")[1],briefTextClickFlag&&(updatingBrief=!0)):""===o?($(".save-brief-icon").css("visibility","hidden")[1],""===o&&""!==r?($(".save-brief-icon").css("visibility","visible")[1],briefTextClickFlag&&(updatingBrief=!0),!0===updatingBrief&&(addingBrief=!1,updatingBrief=!0)):!0===updatingBrief?(addingBrief=!1,updatingBrief=!0):""!==r||""!==o||briefTextClickFlag||(addingBrief=!0,updatingBrief=!1)):""!==r&&""===o&&($(".save-brief-icon").css("visibility","visible")[1],briefTextClickFlag&&(updatingBrief=!0),!0===updatingBrief&&(addingBrief=!1,updatingBrief=!0)),briefTextClickFlag&&updatingBrief&&$(".save-brief-icon").css("visibility","visible")[1],addedBriefFromAnnotation&&selectedHighlightColor&&($(".delete-btn").css("visibility","hidden")[1],$("button#color-blank-briefs").attr("disabled","disabled"))}),$(".brief-textarea").on("onblur",function(){($(".brief-label-not-found").hide(),$("ul.searchAutoSuggestLableList").length>1&&$("ul.searchAutoSuggestLableList").css("display","none"),$(".color-btns").hasClass("selectedColor")||($("input#add-brief-label-box")[1].value=""),"Android"===CaseConnect.deviceOS&&"Chrome"===CaseConnect.browserName)&&(document.querySelector('meta[name="viewport"]').content="width=device-width, initial-scale=1")}),$(".brief-textarea").focus(function(){if($(".brief-label-not-found").hide(),$("ul.searchAutoSuggestLableList").length>1&&$("ul.searchAutoSuggestLableList").css("display","none"),$(".color-btns").hasClass("selectedColor")||($("input#add-brief-label-box")[1].value=""),$(".color-btns").hasClass("selectedColor"))for(var e=$(".color-btns"),t=0;t<e.length;t++)if($("#"+e[t].id).hasClass("selectedColor")){var a=$("#"+$(".color-btns")[t].id).attr("colorcode"),i=$("#"+$(".color-btns")[t].id).attr("brieflabel");$("input#add-brief-label-box")[1].setAttribute("selectedColor",a),""===i&&($("input#add-brief-label-box")[1].value="");break}addedBriefFromAnnotation&&selectedHighlightColor&&($(".delete-btn").css("visibility","hidden")[1],$("button#color-blank-briefs").attr("disabled","disabled"))}),$(".brief-textarea").on("paste",function(){setTimeout(function(){$(".brief-label-not-found").hide(),$("ul.searchAutoSuggestLableList").length>1&&$("ul.searchAutoSuggestLableList").css("display","none"),$(".color-btns").hasClass("selectedColor")||($("input#add-brief-label-box")[1].value="");var e=$(".brief-textarea")[1].value,t=$("input#add-brief-label-box")[1].value;""===e?$(".save-brief-icon").css("visibility","hidden")[1]:""!=e?($(".save-brief-icon").css("visibility","visible")[1],briefTextClickFlag&&(updatingBrief=!0)):""===e&&""!==t&&($(".save-brief-icon").css("visibility","visible")[1],briefTextClickFlag&&(updatingBrief=!0)),briefTextClickFlag&&updatingBrief&&$(".save-brief-icon").css("visibility","visible")[1]},0),addedBriefFromAnnotation&&selectedHighlightColor&&($(".delete-btn").css("visibility","hidden")[1],$("button#color-blank-briefs").attr("disabled","disabled"))}),$(".add-brief-label-box").on("onblur",function(){"Android"===CaseConnect.deviceOS&&"Chrome"===CaseConnect.browserName&&(document.querySelector('meta[name="viewport"]').content="width=device-width, initial-scale=1");var e=$("input#add-brief-label-box")[1].value,t=$(".brief-textarea")[1].value;""!==e?($(".save-brief-icon").css("visibility","visible")[1],briefTextClickFlag&&(updatingBrief=!0)):""===e&&(""===e&&""!==t?($(".save-brief-icon").css("visibility","visible")[1],briefTextClickFlag&&(updatingBrief=!0),!0===updatingBrief&&(addingBrief=!1,updatingBrief=!0)):($(".save-brief-icon").css("visibility","hidden")[1],!0===updatingBrief?(addingBrief=!1,updatingBrief=!0):briefTextClickFlag?updatingBrief=!0:addingBrief=!0),briefTextClickFlag&&updatingBrief&&$(".save-brief-icon").css("visibility","visible")[1]),addedBriefFromAnnotation&&selectedHighlightColor&&($(".delete-btn").css("visibility","hidden")[1],$("button#color-blank-briefs").attr("disabled","disabled"))}),$(".add-brief-label-box").on("onfocus",function(){"Android"===CaseConnect.deviceOS&&"Chrome"===CaseConnect.browserName&&(document.querySelector('meta[name="viewport"]').content="width=device-width, initial-scale=1");var e=$("input#add-brief-label-box")[1].value,t=$(".brief-textarea")[1].value;""!==e?($(".save-brief-icon").css("visibility","visible")[1],briefTextClickFlag&&(updatingBrief=!0)):""===e&&(""===e&&""!==t?($(".save-brief-icon").css("visibility","visible")[1],briefTextClickFlag&&(updatingBrief=!0),!0===updatingBrief&&(addingBrief=!1,updatingBrief=!0)):($(".save-brief-icon").css("visibility","hidden")[1],!0===updatingBrief?(addingBrief=!1,updatingBrief=!0):briefTextClickFlag?updatingBrief=!0:addingBrief=!0),briefTextClickFlag&&updatingBrief&&$(".save-brief-icon").css("visibility","visible")[1]),addedBriefFromAnnotation&&selectedHighlightColor&&($(".delete-btn").css("visibility","hidden")[1],$("button#color-blank-briefs").attr("disabled","disabled"))}),$(".add-brief-label-box").on("paste",function(){setTimeout(function(){var e=$("input#add-brief-label-box")[1].value,t=$(".brief-textarea")[1].value;""!==e?($(".save-brief-icon").css("visibility","visible")[1],briefTextClickFlag&&(updatingBrief=!0)):""===e&&(""===e&&""!==t?($(".save-brief-icon").css("visibility","hidden")[1],!0===updatingBrief&&(addingBrief=!1,updatingBrief=!0)):($(".save-brief-icon").css("visibility","visible")[1],briefTextClickFlag&&(updatingBrief=!0))),briefTextClickFlag&&updatingBrief&&$(".save-brief-icon").css("visibility","visible")[1]},30),addedBriefFromAnnotation&&selectedHighlightColor&&($(".delete-btn").css("visibility","hidden")[1],$("button#color-blank-briefs").attr("disabled","disabled"))}),addedBriefFromAnnotation&&selectedHighlightColor?($(".delete-btn").css("visibility","hidden")[1],$("button#color-blank-briefs").attr("disabled","disabled")):$("button#color-blank-briefs").removeAttr("disabled")}function updateBriefLabelAndColorOnly(){selectedNoteId.indexOf("note")}$(function(){for(var e=0;e<colorList.length;e++){var t=[];"#ede48c"===colorList[e]?t[e]="label-yellow":"#b5eb97"===colorList[e]?t[e]="label-green":"#aee6fe"===colorList[e]?t[e]="label-blue":"#fec0ff"===colorList[e]?t[e]="label-pink":"#ffd4a8"===colorList[e]?t[e]="label-orange":"#cbbefc"===colorList[e]&&(t[e]="label-purple"),t.push(t[e]),colorMarkerList=e!==colorList.length-1?colorMarkerList+'{"colorCode":"'+colorList[e]+'", "colorMarker":"'+t[e]+'"},':colorMarkerList+'{"colorCode":"'+colorList[e]+'", "colorMarker":"'+t[e]+'"}'}colorMarkerList=JSON.parse("["+colorMarkerList+"]")});var insideAddBriefFunction=0;function addBrief(){if(!0===checkSaveBrief&&(0===insideAddBriefFunction&&(insideAddBriefFunction+=1),1===insideAddBriefFunction)){$("#page-loading-spinner").show(),briefedTextWithoutHTML=highlightedTextWithoutHTML,briefStartOffsetAtSectionLevel=highlightStartOffsetAtSectionLevel,briefEndOffsetAtSectionLevel=highlightEndOffsetAtSectionLevel,briefStartParaId=annotationStartParaId,briefEndParaId=annotationEndParaId,briefParaStartOffset=highlightStartOffset,briefParaEndOffset=highlightEndOffset;var e="",t="",a="";if(displayCommonAnnotationPopover)a=briefLabelFromCommonPopover,e=colorCodeInput,t="";else{if(!displayCommonAnnotationPopover&&addingBrief&&!$(".color-btns").hasClass("selectedColor")&&!highLightColor)return $("#"+selectedNoteId).popover("hide"),removeDummyTags(),addingBrief=!1,void(addBriefPopoverShown=!1);t=$("textarea#add-brief-textarea")[1].value.replace(/</g,"&lt;").replace(/>/g,"&gt;"),""!==(a=$("input#add-brief-label-box")[1].value.replace(/</g,"&lt;").replace(/>/g,"&gt;"))&&(e=colorCodeInput)}if(""===colorCodeInput||null===colorCodeInput?(""===selectedHighlightColor||null===selectedHighlightColor?e=highLightColor:""!==selectedHighlightColor&&null!==selectedHighlightColor&&"undefined"!=typeof selectedHighlightColor&&(e=selectedHighlightColor),colorCodeInput=e):""!==colorCodeInput&&(e=colorCodeInput),""===a&&""!==e)if(updateBriefColorPallet(e),CaseConnect.preSetBriefLabelList){for(var i=0;i<CaseConnect.preSetBriefLabelList.length;i++)if(e===CaseConnect.preSetBriefLabelList[i].colorCode){void 0!==$("input#add-brief-label-box")[1]&&($("input#add-brief-label-box")[1].value=CaseConnect.preSetBriefLabelList[i].labelName),a=CaseConnect.preSetBriefLabelList[i].labelName;break}}else a="";if(""===e)return alertMessagesModal(exceptionMsg.systemError),addingBrief=!1,void(addBriefPopoverShown=!1);if($("#ebook-toc").popover("hide"),$("#ebook-toc-mobile").popover("hide"),$(".ebook-fontsize").popover("hide"),$(".ebook-search").popover("hide"),$(".rTsIconPopover").popover("hide"),insideEreader&&$(document).popover("hide"),saveBriefRequestData=briefStartOffsetAtSectionLevel+"_"+briefEndOffsetAtSectionLevel+"_"+briefStartParaId+"_"+briefEndParaId+"_"+briefParaStartOffset+"_"+briefParaEndOffset,void 0!==localStorage.getItem("briefAnnotationListForChapter")&&null!==localStorage.getItem("briefAnnotationListForChapter")){for(localStorage.getItem("briefAnnotationListForChapter").split(","),i=0;i<allExistingBriefAnnotationUniqueVal.length;i++)if(allExistingBriefAnnotationUniqueVal[i]===saveBriefRequestData)return;allExistingBriefAnnotationUniqueVal.push(saveBriefRequestData),localStorage.setItem("briefAnnotationListForChapter",allExistingBriefAnnotationUniqueVal)}if($(".ereader-chapter-list").popover("hide"),"true"===CaseConnect.bookData.isAnnotatable||insideCasesPage){displayCommonAnnotationPopover=!1,$("#page-loading-spinner").show();var o=parseInt($("#"+selectedNoteId).attr("startOffset")),r=parseInt($("#"+selectedNoteId).attr("endOffset")),n="";if(insideCasesPage)for(var s=!1,l=$("#"+selectedNoteId).parent();!s;){var c=l.find(".cc-pagenum-begin");if(c.length>0){if($("#"+selectedNoteId).offset().top>c.offset().top){n=c.attr("title"),s=!0;break}(l=l.prev().length>0?l.prev():l.parent()).hasClass("case-excerpt-block")&&(s=!0,n="")}else(l=l.prev().length>0?l.prev():l.parent()).hasClass("case-excerpt-block")&&(s=!0,n="")}else n=CaseConnect.currentPageNumber;var d={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:""},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},briefVO:{bookId:CaseConnect.currentBookId,chapterId:CaseConnect.currentChapterId,chapterTitle:CaseConnect.currentChapterTitle,sectionId:annotationSectionId,sectionTitle:annotationSectionTitle,pageNumber:n,highlightStartOffset:briefStartOffsetAtSectionLevel,highlightEndOffset:briefEndOffsetAtSectionLevel,highlightText:highlightedTextWithoutHTML,highlightStartParaId:briefStartParaId,highlightEndParaId:briefEndParaId,highlightParaStartOffset:briefParaStartOffset,highlightParaEndOffset:briefParaEndOffset,enclosingParaList:selectedParaIds,highlightColorCode:e,noteText:t,labelName:a}};insideEreader?(d.userVO.userActivityVO.lastActivityCode="EREADER_ADD_BRIEF",d.userVO.userActivityVO.pageNavigatingFrom="EReader",d.userVO.userActivityVO.pageNavigatingTo="EReader"):insideCasesPage&&(d.userVO.userActivityVO.lastActivityCode="CASE_PAGE",d.userVO.userActivityVO.pageNavigatingFrom="CASES",d.userVO.userActivityVO.pageNavigatingTo="CASES"),$.ajax({url:properties[properties.env]+"/manageCases/addChapterBriefHighlight",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(d)}).then(function(i){if(void 0!==i.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",i.sessionAuthenticationToken),addingBrief=!1,displayCommonAnnotationPopover=!1,pCaseWithHeadingCitation=!1,pCaseWithHeadingOnly=!1,briefTextClickFlag=!1,highlightPalletsVisibleOnly=!1,addBriefPopoverShown=!1,$("#"+selectedNoteId).popover("hide"),0===highLightSpanIdAcrossPara.length)null!==(l=document.getElementById(selectedNoteId))&&(briefSpanId=0,(s=document.createElement("briefsTag")).innerHTML=l.innerHTML,s.id=selectedNoteId,s.className="briefElementText",s.setAttribute("data-references","popover"),s.setAttribute("data-toggle","popover"),s.setAttribute("tabindex","0"),s.setAttribute("data-original-title",""),s.setAttribute("briefStartOffset",briefStartOffsetAtSectionLevel),s.setAttribute("briefEndOffset",briefEndOffsetAtSectionLevel),s.setAttribute("briefParaStartOffset",briefParaStartOffset),s.setAttribute("briefParaEndOffset",briefParaEndOffset),s.setAttribute("enclosingParaIdString",enclosingParaIdString),s.setAttribute("briefStartParaId",briefStartParaId),s.setAttribute("briefEndParaId",briefEndParaId),s.setAttribute("briefLabelName",a),s.setAttribute("briefNote",t),s.normalize(),l.parentNode.replaceChild(s,l),s.setAttribute("style","background-color:"+e+"!important"));else if(highLightSpanIdAcrossPara.length>0)for(var n=0;n<highLightSpanIdAcrossPara.length;n++){selectedNoteId="note"+n;var s,l=document.getElementById(selectedNoteId);(s=document.createElement("briefsTag")).innerHTML=l.innerHTML,s.id=selectedNoteId,s.className="briefElementText",s.setAttribute("data-references","popover"),s.setAttribute("data-toggle","popover"),s.setAttribute("tabindex","0"),s.setAttribute("data-original-title",""),s.setAttribute("briefStartOffset",briefStartOffsetAtSectionLevel),s.setAttribute("briefEndOffset",briefEndOffsetAtSectionLevel),s.setAttribute("briefParaStartOffset",briefParaStartOffset),s.setAttribute("briefParaEndOffset",briefParaEndOffset),s.setAttribute("enclosingParaIdString",enclosingParaIdString),s.setAttribute("briefStartParaId",briefStartParaId),s.setAttribute("briefEndParaId",briefEndParaId),s.setAttribute("briefLabelName",a),s.setAttribute("briefNote",t),s.normalize(),l.parentNode.replaceChild(s,l),s.setAttribute("style","background-color:"+e+"!important")}else $("#"+selectedNoteId).popover("hide");if(i.briefVO){if(dppAnotationId=i.briefVO.annotationId,0===highLightSpanIdAcrossPara.length)highLightSpanId=0,document.getElementById("note"+highLightSpanId).id=dppAnotationId,(c=document.getElementById(dppAnotationId)).setAttribute("onClick","briefTextClicked()"),c.addEventListener("keyup",briefTextClicked),c.setAttribute("startOffset",o),c.setAttribute("endOffset",r);else if(highLightSpanIdAcrossPara.length>0){for(n=0;n<highLightSpanIdAcrossPara.length;n++)if(0===n){var c;document.getElementById("note"+n).id=dppAnotationId,(c=document.getElementById(dppAnotationId)).setAttribute("onClick","briefTextClicked()"),c.addEventListener("keyup",briefTextClicked),c.setAttribute("startOffset",o),c.setAttribute("endOffset",r)}else{document.getElementById("note"+n).id=dppAnotationId+"_"+[n];var d=document.getElementById(dppAnotationId+"_"+[n]);d.setAttribute("onClick","briefTextClicked()"),d.addEventListener("keyup",briefTextClicked),d.setAttribute("startOffset",o),d.setAttribute("endOffset",r)}var g="";if(selectedParaIds.length>0)for(var p=0;p<selectedParaIds.length;p++)p===selectedParaIds.length-1?g+=selectedParaIds[p]:g+=selectedParaIds[p]+"|";document.getElementById(dppAnotationId).setAttribute("enclosingParaIdString",g)}$("#"+selectedNoteId).popover("hide"),selectedNoteId=dppAnotationId,insideAddBriefFunction=0}if(yValue=document.getElementById(selectedNoteId).getBoundingClientRect().top,addingBrief=!1,addBriefPopoverShown=!1,""===a&&""===t||(localStorage.setItem("addBriefStartParaId",briefStartParaId),$("#"+briefStartParaId).next(),$("#"+briefStartParaId).next().is("p")&&localStorage.setItem("addBriefNextParaId",$("#"+briefStartParaId).next().attr("id")),displayBriefOnRight(selectedNoteId,e,yValue,a,t),setTimeout(function(){checkBriefOverNoteForOverlap()},800)),$("#page-loading-spinner").show(),insideCasesPage){var h=$(window).width();""!==checkDropValue&&checkIfBriefloaded?"My Brief"===caseExcerptRightTitle&&"Case Text"===caseExcerptLeftTitle?getMyBriefContentInCasesPage():"Case Text"===caseExcerptRightTitle&&"My Brief"===caseExcerptLeftTitle?getMyBriefContentInCasesPage():$("#page-loading-spinner").hide():null==checkDropValue||""===checkDropValue?"My Brief"===caseExcerptRightTitle&&"Case Text"===caseExcerptLeftTitle?h>991?$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),$(window).trigger("resize")}):h<992&&!caseExcerptClicked?$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage()}):$("#page-loading-spinner").hide():"Case Text"===caseExcerptRightTitle&&"My Brief"===caseExcerptLeftTitle?h>991?$("#case-excerpt-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),$(window).trigger("resize")}):h<992&&!caseExcerptClicked?$("#case-excerpt-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage()}):$("#page-loading-spinner").hide():$("#page-loading-spinner").hide():$("#page-loading-spinner").hide()}else $("#page-loading-spinner").hide();alreadyCalled=!1,checkSaveBrief=!1,sessionTimeOut()},function(e){if(sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)){addingLink=!1,addingNote=!1,$(".delete-btn").css("visibility","hidden")[1],selectedNoteId="note"+highLightSpanId,alertMessagesModal(e.responseJSON.errorMessg),$("#"+selectedNoteId).popover("hide");var t=document.getElementById(selectedNoteId),a=document.createElement("span");a.innerHTML=t.innerHTML,a.normalize(),t.parentNode.replaceChild(a,t),$("#page-loading-spinner").hide()}else window.location=properties.ui_domain;alreadyCalled=!1,checkSaveBrief=!1})}else checkSaveBrief=!1,alertMessagesModal(exceptionMsg.highlightChapters)}}function addBriefMarkup(e,t){$(e).contents().each(function(){var e=$(this);3==this.nodeType&&MARK&&(multiParaBriefIndexer++,$(this).wrap(briefTagFirstPart+multiParaAnnotationID+"_"+multiParaBriefIndexer+briefTagLastPart+"</briefstag>")),1==this.nodeType&&("briefstag"==this.nodeName.toLowerCase()&&($(e).hasClass("briefElementText")&&$(e).attr("id")==t?(MARK=!0,addBriefMarkup(e,t)):(MARK=!1,addBriefMarkup(e,t))),addBriefMarkup(e,t))})}function addBriefMarkupByOffestAndLength1(e,t,a){$(e).contents().each(function(){var e=$(this);if(1==this.nodeType)addBriefMarkupByOffestAndLength(e,t,a);else if(3==this.nodeType){multiParaBriefIndexer++;!MARK&&multiParaAnnotationStartParaStartOffset<this.length?(multiParaBriefIndexer++,$(this).replaceWith(this.textContent.substring(0,multiParaAnnotationStartParaStartOffset)+briefTagFirstPart+a+"_"+multiParaBriefIndexer+briefTagLastPart+this.textContent.substring(multiParaAnnotationStartParaStartOffset,this.length)+"</briefstag>"),multiParaAnnotationStartParaEndOffset=multiParaAnnotationStartParaEndOffset-this.length+multiParaAnnotationStartParaStartOffset):MARK&&multiParaAnnotationStartParaEndOffset>this.length?(multiParaBriefIndexer++,$(this).wrap(briefTagFirstPart+a+"_"+multiParaBriefIndexer+briefTagLastPart+"</briefstag>"),multiParaAnnotationStartParaEndOffset-=this.length):MARK&&multiParaAnnotationStartParaEndOffset<this.length?(multiParaBriefIndexer++,$(this).replaceWith(briefTagFirstPart+a+"_"+multiParaBriefIndexer+briefTagLastPart+this.textContent.substring(0,multiParaAnnotationStartParaEndOffset)+"</briefstag>"+this.textContent.substring(multiParaAnnotationStartParaEndOffset,this.length)+"</briefstag>"),multiParaAnnotationStartParaStartOffset=-1,multiParaAnnotationStartParaEndOffset=-1):multiParaAnnotationStartParaStartOffset-=this.length}})}function addBriefMarkupByOffestAndLength(e,t,a,i){$(e).contents().each(function(){var e=$(this);if(1==this.nodeType)addBriefMarkupByOffestAndLength(e,t,a,i);else if(3==this.nodeType){multiParaBriefIndexer++,(!i||multiParaAnnotationStartParaEndOffset>0)&&(!MARK&&multiParaAnnotationStartParaStartOffset<this.length?(multiParaBriefIndexer++,$(this).replaceWith(this.textContent.substring(0,multiParaAnnotationStartParaStartOffset)+briefTagFirstPart+a+"_"+multiParaBriefIndexer+briefTagLastPart+this.textContent.substring(multiParaAnnotationStartParaStartOffset,this.length)+"</briefstag>"),multiParaAnnotationStartParaEndOffset=multiParaAnnotationStartParaEndOffset-this.length+multiParaAnnotationStartParaStartOffset):MARK&&multiParaAnnotationStartParaEndOffset>this.length?(multiParaBriefIndexer++,$(this).wrap(briefTagFirstPart+a+"_"+multiParaBriefIndexer+briefTagLastPart+"</briefstag>"),multiParaAnnotationStartParaEndOffset-=this.length):MARK&&multiParaAnnotationStartParaEndOffset<this.length?(multiParaBriefIndexer++,$(this).replaceWith(briefTagFirstPart+a+"_"+multiParaBriefIndexer+briefTagLastPart+this.textContent.substring(0,multiParaAnnotationStartParaEndOffset)+"</briefstag>"+this.textContent.substring(multiParaAnnotationStartParaEndOffset,this.length)+"</briefstag>"),multiParaAnnotationStartParaStartOffset=-1,multiParaAnnotationStartParaEndOffset=-1):multiParaAnnotationStartParaStartOffset-=this.length)}})}function addBriefMarkupByOffestAndLengthForSinglePara(e,t){$(e).contents().each(function(){var e=$(this);1==this.nodeType?addBriefMarkupByOffestAndLengthForSinglePara(e,t):3==this.nodeType&&(multiParaBriefIndexer++,!MARK&&multiParaAnnotationStartParaStartOffset<this.length?(multiParaBriefIndexer++,$(this).replaceWith(this.textContent.substring(0,multiParaAnnotationStartParaStartOffset)+briefTagFirstPart+multiParaAnnotationID+"_"+multiParaBriefIndexer+briefTagLastPart+this.textContent.substring(multiParaAnnotationStartParaStartOffset,this.length)+"</briefstag>"),MARK=!0,multiParaAnnotationStartParaEndOffset=multiParaAnnotationStartParaEndOffset-this.length+multiParaAnnotationStartParaStartOffset):MARK&&multiParaAnnotationStartParaEndOffset>this.length?(multiParaBriefIndexer++,$(this).wrap(briefTagFirstPart+multiParaAnnotationID+"_"+multiParaBriefIndexer+briefTagLastPart+"</briefstag>"),multiParaAnnotationStartParaEndOffset-=this.length):MARK&&multiParaAnnotationStartParaEndOffset<=this.length?(multiParaBriefIndexer++,this.textContent.substring(0,multiParaAnnotationStartParaEndOffset).length>0&&$(this).replaceWith(briefTagFirstPart+multiParaAnnotationID+"_"+multiParaBriefIndexer+briefTagLastPart+this.textContent.substring(0,multiParaAnnotationStartParaEndOffset)+"</briefstag>"+this.textContent.substring(multiParaAnnotationStartParaEndOffset,this.length)+"</briefstag>"),multiParaAnnotationStartParaStartOffset=-1,multiParaAnnotationStartParaEndOffset=-1):(multiParaAnnotationStartParaStartOffset-=this.length,multiParaAnnotationStartParaEndOffset-=this.length))})}function reCalculateBriefOnRight(){var e,t,a,i,o;$(".briefElementText").each(function(){1===$("#briefWrapDiv"+this.id).length&&(a=this.id,e=$("#briefWrapDiv"+this.id).attr("briefnote"),t=$("#briefWrapDiv"+this.id).attr("labelname"),i=document.getElementById(this.id).getBoundingClientRect().top,o=$("#"+this.id).css("background-color"),$("#briefAnchorElement"+this.id).remove(),displayBriefOnRight(a,o,i,t,e))})}function displayBriefOnRight(e,t,a,i,o){closePrintClicked&&$("#page-loading-spinner").show(),null!=i&&null!=i&&""!=i&&(i=i.replace(/</g,"&lt;").replace(/>/g,"&gt;")),$("#briefAnchorElement"+e)&&$("#briefAnchorElement"+e).remove();var r=$(".ereader-content").css("line-height");if(insideEreader)var n=document.getElementById("notes-container").getBoundingClientRect().top;if(insideCasesPage)n=document.getElementsByClassName("case-note-container")[0].getBoundingClientRect().top;var s=document.createElement("A");s.id="briefAnchorElement"+e,s.setAttribute("onclick","briefNoteTextClicked(event)"),s.setAttribute("href","#"),s.setAttribute("labelName",i),s.setAttribute("briefNote",o),s.style.color="#333333";var l=document.createElement("div");l.id="labelDiv"+e,l.className="labelText hidden-xs ellipsis",l.style.width=$("#notes-container").width()+"px",l.style.top=a-n-2+"px",l.innerHTML=i,l.setAttribute("labelName",i),l.setAttribute("briefNote",o),l.title=i;var c=document.createElement("div");c.id="notesDiv"+e,c.innerHTML=o,c.setAttribute("labelName",i),c.setAttribute("briefNote",o),c.title=o,o.length>50&&o.split(" ").length<5||o.length>40&&o.split(" ")[0].length>20||o.length>25&&o.split(" ")[0].length>20?(c.className="briefNotesText hidden-xs ellipsis",c.style.width=$("#notes-container").width()+"px"):c.className="briefNotesText hidden-xs",c.style.top=l?l.style.top+parseInt(r)+"px":a-n-2+"px";var d=document.createElement("div");d.id="briefWrapDiv"+e,d.className="labelNoteWrapper overlapCheckClass hidden-xs",insideCasesPage?d.className="labelNoteWrapper overlapCheckClass hidden-xs hidden-md hidden-lg visible-sm":insideEreader&&(d.className="labelNoteWrapper overlapCheckClass hidden-xs"),d.setAttribute("labelName",i),d.setAttribute("briefNote",o),d.style.top=a-n-2+"px",d.appendChild(l),d.appendChild(c);var g=document.createElement("span");g.id="colSpan"+e,g.className="briefSpanBlock",g.setAttribute("style","background-color:"+t+" !important; top:"+(a-n)+"px;"),g.style.top=d.style.top;var p=300;p=null!==localStorage.getItem("briefAnnotationListForChapter")?localStorage.getItem("briefAnnotationListForChapter").split(",").length:1e3,timeCount=p<50?1:p>50&&p<150?800:1e3,setTimeout(function(){if(insideEreader)var t=$(".labelNoteWrapper");else if(insideCasesPage)t=$(".briefSpanBlock");void 0!==t&&t.length>0&&t.sort(function(e,t){return parseInt(e.style.top)>parseInt(t.style.top)?1:parseInt(e.style.top)<parseInt(t.style.top)?-1:0});var a=0,r=0;if(setTimeout(function(){for(v=0;v<t.length;v++)r=t[v].offsetHeight+5,parseInt(t[v].style.top)==parseInt(d.style.top)?(a=parseInt(t[v].style.top),d.style.top=parseInt(t[v].style.top)-2+r+"px",g.style.top=parseInt(t[v].style.top)+r+"px",s.top=parseInt(t[v].style.top)+r+"px"):parseInt(t[v].style.top)<parseInt(d.style.top)+r&&parseInt(t[v].style.top)>parseInt(d.style.top)-r&&parseInt(t[v].style.top)>a&&(a=parseInt(t[v].style.top),d.style.top=parseInt(t[v].style.top)-2+r+"px",g.style.top=parseInt(t[v].style.top)+r+"px",s.top=parseInt(t[v].style.top)+r+"px");closePrintClicked&&($("#page-loading-spinner").hide(),closePrintClicked=!1)},timeCount),s.appendChild(g),s.appendChild(d),!insideEreader||""===o&&""===i||document.getElementById("notes-container").appendChild(s),!insideCasesPage||""===o&&""===i||document.getElementsByClassName("case-note-container")[0].appendChild(s),null!==document.getElementById("briefWrapDiv"+e)){var n=document.getElementById("briefWrapDiv"+e).getBoundingClientRect(),l=null;r=0;var c=null;for(v=0;v<t.length;v++)r=t[v].offsetHeight+5,c="notesDiv"+t[v].id.slice(12),l=document.getElementById(t[v].id).getBoundingClientRect(),n.right<l.left||n.left>l.right||n.bottom<l.top||n.top>l.bottom||(l.top<n.top?(n.top,l.top,parseInt(r),parseInt(r)<parseInt($("#"+t[v].id).css("line-height"))?$clamp(document.getElementById(c),{clamp:1}):(document.getElementById(c).style.width=$("#notes-container").width()+"px",document.getElementById(c).className="briefNotesText hidden-xs ellipsis")):(l.top,n.top,parseInt(r),parseInt(r)<parseInt($("#"+t[v].id).css("line-height"))?$clamp(document.getElementById(c),{clamp:1}):(document.getElementById(c).style.width=$("#notes-container").width()+"px",document.getElementById(c).className="briefNotesText hidden-xs ellipsis")));if(void 0!==localStorage.getItem("addBriefStartParaId")&&""!==localStorage.getItem("addBriefStartParaId")&&null!==localStorage.getItem("addBriefStartParaId")){var p=localStorage.getItem("addBriefStartParaId");if(localStorage.setItem("addBriefStartParaId",""),""!==p){var h=$("#"+p).find("briefstag"),u="",f=0,b=0,C=1,m=parseInt($("#notesDiv"+e).css("line-height"));if(h.length>1){for(var v=1;v<h.length;v++)if(-1===h[v].id.indexOf("_")){u=h[v].id;break}""!==u&&($("#"+u),1)&&($("#"+u).offset(),f=$("#"+u).offset().top,(b=$("#"+e).offset().top)+$("#briefWrapDiv"+e).height()>f&&(parseInt($("#"+e).attr("startOffset"))<parseInt($("#"+u).attr("startOffset"))&&(f-b>2*m?C=1:f-b>m&&(C=1),$("#notesDiv"+e).html().length>10&&$clamp(document.getElementById("notesDiv"+e),{clamp:C})),localStorage.setItem("addBriefStartParaId","")))}else if(localStorage.setItem("addBriefStartParaId",""),void 0!==localStorage.getItem("addBriefNextParaId")&&""!==localStorage.getItem("addBriefNextParaId")&&null!==localStorage.getItem("addBriefNextParaId")){p=localStorage.getItem("addBriefNextParaId");if(localStorage.setItem("addBriefNextParaId",""),""!==p){h=$("#"+p).find("briefstag"),u="",f=0,b=0,C=1,m=parseInt($("#notesDiv"+e).css("line-height"));if(h.length>0){for(v=0;v<h.length;v++)if(-1===h[v].id.indexOf("_")){u=h[v].id;break}$("#"+u),$("#"+u).offset(),f=$("#"+u).offset().top,(b=$("#"+e).offset().top)+$("#briefWrapDiv"+e).height()>f&&(f-b>2*m?C=2:f-b>m&&(C=1),$("#notesDiv"+e).html().length>10&&$clamp(document.getElementById("notesDiv"+e),{clamp:C}),localStorage.setItem("addBriefNextParaId","")),$("#notesDiv"+e).html().length>10&&$clamp(document.getElementById("notesDiv"+e),{clamp:C}),localStorage.setItem("addBriefNextParaId","")}}}}}}},timeCount),addingBrief=!1,closePopover(),setTimeout(function(){checkBriefOverNoteForOverlap()},2e3)}function briefTextClicked(){if(briefTextClickFlag=!0,insidePrincipalCase=!0,displayCommonAnnotationPopover&&($("#"+selectedNoteId).popover("hide"),displayCommonAnnotationPopover=!1,pCaseWithHeadingCitation=!1,pCaseWithHeadingOnly=!1,removeDummyTags()),updatingLink&&($("#"+selectedNoteId).popover("hide"),updatingLink=!1),linkIconId&&$("#"+linkIconId).popover("hide"),$(".ebook-fontsize").popover("hide"),$(".ebook-search").popover("hide"),$(".ereader-chapter-list").popover("hide"),$(".rTsIconPopover").popover("hide"),insideEreader&&$(document).popover("hide"),$("#note-save-confirmation-wrapper").remove(),addBriefPopoverShown=!0,displayCommonAnnotationPopover=!1,addingBrief||updatingBrief);else{var e,t="";window.getSelection?e=window.getSelection():void 0!==document.selection&&(e=document.selection),bodyRect=document.body.getBoundingClientRect();for(var a,i=e.anchorNode;!$(i.parentNode).hasClass("briefElementText");)void 0!==i.parentNode&&null!==i.parentNode&&void 0!==i.parentNode.id&&-1!=i.parentNode.id.indexOf("_")&&(t=i.parentNode.id,i.parentNode.id=i.parentNode.id.substring(0,i.parentNode.id.indexOf("_"))),i=i.parentNode;void 0!==i.parentNode.id&&-1!=i.parentNode.id.indexOf("_")?(t=i.parentNode.id,selectedNoteId=i.parentNode.id.substring(0,i.parentNode.id.indexOf("_"))):selectedNoteId=i.parentNode.id;var o=(a=null===document.getElementById(selectedNoteId)?document.getElementById(t):document.getElementById(selectedNoteId)).parentNode;for(a.parentNode;!$(o).hasClass("cc-section")&&null!==o;)o=o.parentNode;if(null!==o?(annotationSectionId=o.id,o.getElementsByClassName("cc-section-title").length>0?annotationSectionTitle=removeTags(o.getElementsByClassName("cc-section-title")[0].innerHTML):annotationSectionTitle=""):(annotationSectionId="",annotationSectionTitle=""),selectedHighlightColor=i.parentNode.style.backgroundColor,changeHighlightImage(),updateBriefColorPallet(),null===document.getElementById(selectedNoteId)?element=document.getElementById(t):element=document.getElementById(selectedNoteId),rect=element.getBoundingClientRect(),yValue=rect.top,(s=$(".labelNoteWrapper")).length>0)for(var r=0;r<s.length;r++)if(s[r].id.substring(12,s[r].id.length)===selectedNoteId){updatingBrief=!0;break}var n=$("span[id='colSpan"+selectedNoteId+"']");if(n&&n.length>0){if(showAddBriefPopoverOnly(),$("button.copy-clipboard-true.copy-clip-button").show(),$("input.zero-clipboard-true.copy-clip-button").show(),$("textarea#add-brief-textarea").length>1){var s=$(".labelNoteWrapper");for(r=0;r<s.length;r++)if(s[r].id.substring(12,s[r].id.length)===n[0].id.substring(7,n[0].id.length)){$("textarea#add-brief-textarea")[1].innerHTML=s[r].getAttribute("briefNote"),$("input#add-brief-label-box")[1].value=s[r].getAttribute("labelName").replace(/&lt;/g,"<").replace(/&gt;/g,">"),""!==$("textarea#add-brief-textarea")[1].innerHTML&&$(".delete-btn").css("visibility","visible")[1],void 0!==$("button#color-blank-briefs")[1]&&$("button#color-blank-briefs")[1].removeAttribute("disabled");break}$(".color-btns").hasClass("selectedColor")&&void 0!==$("button#color-blank-briefs")[1]&&$("button#color-blank-briefs")[1].removeAttribute("disabled")}}else showAddBriefPopoverOnly(),$("button.copy-clipboard-true.copy-clip-button").show(),$("input.zero-clipboard-true.copy-clip-button").show();if(insideCasesPage&&void 0!==$(".myBrief").css("display")){var l=document.getElementById("highlight_"+selectedNoteId).offsetTop;$(".myBrief").scrollTop(l-20),$("#highlight_"+selectedNoteId).focus()}}}function briefNoteTextClicked(e){if(insidePrincipalCase=!0,"visible"!==$("#highlight-popover-notes").css("visibility")){$(".ebook-fontsize").popover("hide"),linkIconId&&$("#"+linkIconId).popover("hide"),$(".ebook-search").popover("hide"),$(".rTsIconPopover").popover("hide"),insideEreader&&$(document).popover("hide"),displayCommonAnnotationPopover&&($("#"+selectedNoteId).popover("hide"),displayCommonAnnotationPopover=!1,pCaseWithHeadingCitation=!1,pCaseWithHeadingOnly=!1,removeDummyTags()),$(".ereader-chapter-list").popover("hide"),selectedNoteId=e.currentTarget.id,selectedNoteId=selectedNoteId.substring(18,selectedNoteId.length);for(var t=document.getElementById(selectedNoteId).parentNode;!$(t).hasClass("cc-section");)t=t.parentNode;if(annotationSectionId=t.id,t.getElementsByClassName("cc-section-title").length>0?annotationSectionTitle=removeTags(t.getElementsByClassName("cc-section-title")[0].innerHTML):annotationSectionTitle="",selectedHighlightColor=e.currentTarget.childNodes[0].style.backgroundColor,changeHighlightImage(),element=document.getElementById(selectedNoteId),rect=element.getBoundingClientRect(),yValue=rect.top,(o=$(".labelNoteWrapper")).length>0)for(var a=0;a<o.length;a++)if(o[a].id.substring(12,o[a].id.length)===selectedNoteId){updatingBrief=!0;break}var i=$("span[id='colSpan"+selectedNoteId+"']");if(i&&i.length>0){if(showAddBriefPopoverOnly(),$("button.copy-clipboard-true.copy-clip-button").show(),$("input.zero-clipboard-true.copy-clip-button").show(),$("textarea#add-brief-textarea").length>1){var o=$(".labelNoteWrapper");for(a=0;a<o.length;a++)if(o[a].id.substring(12,o[a].id.length)===i[0].id.substring(7,i[0].id.length)){$("textarea#add-brief-textarea")[1].innerHTML=o[a].getAttribute("briefNote"),$("input#add-brief-label-box")[1].value=o[a].getAttribute("labelName").replace(/&lt;/g,"<").replace(/&gt;/g,">"),""!==$("textarea#add-brief-textarea")[1].innerHTML&&$(".delete-btn").css("visibility","visible")[1],void 0!==$("button#color-blank-briefs")[1]&&$("button#color-blank-briefs")[1].removeAttribute("disabled");break}$(".color-btns").hasClass("selectedColor")&&void 0!==$("button#color-blank-briefs")[1]&&$("button#color-blank-briefs")[1].removeAttribute("disabled")}}else $("#"+selectedNoteId).popover("hide"),showAddBriefPopoverOnly(),$("button.copy-clipboard-true.copy-clip-button").show(),$("input.zero-clipboard-true.copy-clip-button").show();noteTextClick=!0}}function fetchBrief(e,t){$("#page-loading-spinner").show();var a="";"chapter"===CaseConnect.bookData.chapterType||!loadingAnnotationsFromTOC||"true"===CaseConnect.bookData.isAnnotatable||comingFromAnnotationPrevNextBtn||insideCasesPage?insideCasesPage&&(e=casesSectionListOnLoad.chapterId,a=casesSectionListOnLoad.sectionId):($("#previousChapterAnnotationArrow").css("visibility","hidden"),loadingAnnotationsFromTOC=!1,annotationListingChapterId=bookAnnotateFileList[0].chapterId,$("#annotationListChapterName")[0].innerHTML=bookAnnotateFileList[0].navbarTitle,$(".annotationListChapterName").html(bookAnnotateFileList[0].navbarTitle),$(".annotationListChapterName").attr("aria-label",bookAnnotateFileList[0].navbarTitle),$("#annotationListChapterName")[0].setAttribute("aria-label",bookAnnotateFileList[0].navbarTitle),e=bookAnnotateFileList[0].chapterId);var i={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01"},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},briefVO:{pageNum:"0",bookId:CaseConnect.currentBookId,chapterId:e,ereaderNotesAndHighlightsPopoverFlowFlag:fetchingAnnotationsForListing}};null!=t&&""!=t&&(i.briefVO.pageNum=t),insideEreader?(i.userVO.userActivityVO.lastActivityCode="EREADER_ADD_BRIEF",i.userVO.userActivityVO.pageNavigatingFrom="EReader",i.userVO.userActivityVO.pageNavigatingTo="EReader"):(i.userVO.userActivityVO.lastActivityCode="CASE_PAGE",i.userVO.userActivityVO.pageNavigatingFrom="CASES",i.userVO.userActivityVO.pageNavigatingTo="CASES",""!==a&&(i.briefVO.sectionIdList=[a])),$.ajax({url:properties[properties.env]+"/manageCases/getChapterBrief",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(i)}).then(function(e){$("#page-loading-spinner").show(),void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),null!=t&&null!=t||($(".labelNoteWrapper").remove(),$(".briefSpanBlock").remove());var a="",i="";if(e.briefVOList){var o=[];e.briefVOList.length>0?o=e.briefVOList:o.push(e.briefVOList);var r,n={},s=[],l=null,c="";globalChapterBriefList=null==t||null==t?o:globalChapterBriefList.concat(o);for(var d=0;d<globalChapterBriefList.length;d++){var g=globalChapterBriefList[d].highlightStartOffset+"_"+globalChapterBriefList[d].highlightEndOffset+"_"+globalChapterBriefList[d].highlightStartParaId+"_"+globalChapterBriefList[d].highlightEndParaId+"_"+globalChapterBriefList[d].highlightParaStartOffset+"_"+globalChapterBriefList[d].highlightParaEndOffset;allExistingBriefAnnotationUniqueVal.push(g)}if(localStorage.setItem("briefAnnotationListForChapter",allExistingBriefAnnotationUniqueVal),insideEreader)var p=$(".ereader-content");if(insideCasesPage)p=$("#case-excerpt-block-cases");for(var h=0;h<o.length;h++)if(void 0!==o[h].highlightEndParaId&&void 0!==o[h].highlightStartParaId&&null!==o[h].highlightEndParaId&&null!==o[h].highlightStartParaId&&0!==o[h].highlightEndParaId.length&&0!==o[h].highlightStartParaId.length&&null!==p.find("#"+o[h].highlightEndParaId)[0]&&null!==p.find("#"+o[h].highlightEndParaId)[0]){var u=!1;if(null!=o[h].enclosingParaList&&null!=o[h].enclosingParaList&&o[h].highlightStartParaId!==o[h].highlightEndParaId&&(u=!0,n[o[h].annotationId]=o[h],s.push(o[h].annotationId)),o[h].highlightStartParaId!==l){if(null!==l&&p.find("#"+l)[0]&&(p.find("#"+l)[0].outerHTML=r),l=o[h].highlightStartParaId,p.find("#"+o[h].highlightStartParaId)[0]){for(var f=p.find("#"+o[h].highlightStartParaId)[0],b=$("#"+f.id).find(".briefElementText"),C=0;C<b.length;C++)null!=b[C].getAttribute("brieflabelname")&&null!=b[C].getAttribute("brieflabelname")&&b[C].setAttribute("brieflabelname",b[C].getAttribute("brieflabelname").replace(/</g,"&lt;").replace(/>/g,"&gt;")),null!=b[C].getAttribute("briefnote")&&null!=b[C].getAttribute("briefnote")&&b[C].setAttribute("briefnote",b[C].getAttribute("briefnote").replace(/</g,"&lt;").replace(/>/g,"&gt;"));r=f.outerHTML}else r="";r=(r=(r=r.replace(/(\r\n|\n|\r)/gm,"")).replace(/amp;/g,"")).replace(/&nbsp;/g," ")}var m=r;if(enclosingParaIdString="",null!=o[h].enclosingParaList&&null!=o[h].enclosingParaList){if("string"==$.type(o[h].enclosingParaList))enclosingParaIdString=o[h].highlightStartParaId;else for(var v=0;v<o[h].enclosingParaList.length;v++){var I=v===o[h].enclosingParaList.length-1?"":"|";enclosingParaIdString+=o[h].enclosingParaList[v]+I}}void 0===o[h].labelName?(o[h].labelName="",i=o[h].labelName):(i="",i=o[h].labelName.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/' '/g,"&nbsp;").replace(/"/g,"&ldquo;").replace(/"/g,"&rdquo;").replace(/'/g,"&lsquo;").replace(/'/g,"&rsquo;").replace(/&/g,"&amp;")),void 0===o[h].noteText?(o[h].noteText="",a=o[h].noteText):(a="",a=o[h].noteText.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/' '/g,"&nbsp;").replace(/"/g,"&ldquo;").replace(/"/g,"&rdquo;").replace(/'/g,"&lsquo;").replace(/'/g,"&rsquo;").replace(/&/g,"&amp;"));for(var S,y='<briefstag id="'+o[h].annotationId+'" class="briefElementText" style="background-color: '+o[h].highlightColorCode+' !important;" tabindex="0" data-references="popover" data-toggle="popover" data-original-title="" title="" brieflabelname="'+i+'" briefnote="'+a+'" briefParaStartOffset="'+o[h].highlightParaStartOffset+'" briefParaEndOffset="'+o[h].highlightParaEndOffset+'" briefstartoffset="'+o[h].highlightStartOffset+'" briefendoffset="'+o[h].highlightEndOffset+'" briefstartparaid="'+o[h].highlightStartParaId+'"  briefendparaid="'+o[h].highlightEndParaId+'" enclosingparaidstring="'+enclosingParaIdString+'">',x=0,T=/<\/*([a-z][a-z0-9]*)\b[^>]*>(.*?)/;(S=T.exec(m))&&!(S.index>o[h].highlightParaStartOffset);)m=m.replace(S[0],""),x+=S[0].length;var A=parseInt(o[h].highlightParaStartOffset)+x,k="";if(null!=p.find("#"+o[h].highlightStartParaId)[0]&&null!=p.find("#"+o[h].highlightStartParaId)[0]){var O=p.find("#"+o[h].highlightStartParaId)[0],B=$("#"+O.id).find(".briefElementText");for(C=0;C<B.length;C++)null!=B[C].getAttribute("brieflabelname")&&null!=B[C].getAttribute("brieflabelname")&&B[C].setAttribute("brieflabelname",B[C].getAttribute("brieflabelname").replace(/</g,"&lt;").replace(/>/g,"&gt;")),null!=B[C].getAttribute("briefnote")&&null!=B[C].getAttribute("briefnote")&&B[C].setAttribute("briefnote",B[C].getAttribute("briefnote").replace(/</g,"&lt;").replace(/>/g,"&gt;"));k=O.outerHTML}if(k=(k=(k=k.replace(/(\r\n|\n|\r)/gm,"")).replace(/amp;/g,"")).replace(/&nbsp;/g," "),u)for(;(S=T.exec(m))&&!(S.index>k.length);)m=m.replace(S[0],""),x+=S[0].length,S[0].length;else for(;(S=T.exec(m))&&!(S.index>o[h].highlightParaEndOffset);)m=m.replace(S[0],""),x+=S[0].length;var L=parseInt(o[h].highlightParaEndOffset)+x;if(u){L=r.length;r.substring(A,L),p.find("#"+o[h].highlightStartParaId)[0];if(r=r.substring(0,A)+y+r.substring(A,L)+"</briefstag>"+r.substring(L),null!=p.find("#"+o[h].highlightEndParaId)[0]&&null!=p.find("#"+o[h].highlightEndParaId)[0]){var P=p.find("#"+o[h].highlightEndParaId)[0],w=$("#"+P.id).find(".briefElementText");for(C=0;C<w.length;C++)null!=w[C].getAttribute("brieflabelname")&&null!=w[C].getAttribute("brieflabelname")&&w[C].setAttribute("brieflabelname",w[C].getAttribute("brieflabelname").replace(/</g,"&lt;").replace(/>/g,"&gt;")),null!=w[C].getAttribute("briefnote")&&null!=w[C].getAttribute("briefnote")&&w[C].setAttribute("briefnote",w[C].getAttribute("briefnote").replace(/</g,"&lt;").replace(/>/g,"&gt;"));c=P.outerHTML}m=c=(c=(c=c.replace(/(\r\n|\n|\r)/gm,"")).replace(/amp;/g,"")).replace(/&nbsp;/g," ");for(var N=0;N<o[h].enclosingParaList.length;N++)if(o[h].enclosingParaList[N]!==o[h].highlightStartParaId&&o[h].enclosingParaList[N]!==o[h].highlightEndParaId){var E=p.find("#"+o[h].enclosingParaList[N])[0];void 0===o[h].labelName?(o[h].labelName="",i=o[h].labelName):(i="",i=o[h].labelName.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/' '/g,"&nbsp;").replace(/"/g,"&ldquo;").replace(/"/g,"&rdquo;").replace(/'/g,"&lsquo;").replace(/'/g,"&rsquo;").replace(/&/g,"&amp;")),void 0===o[h].noteText?(o[h].noteText="",a=o[h].noteText):(a="",a=o[h].noteText.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/' '/g,"&nbsp;").replace(/"/g,"&ldquo;").replace(/"/g,"&rdquo;").replace(/'/g,"&lsquo;").replace(/'/g,"&rsquo;").replace(/&/g,"&amp;"));o[h].annotationId,o[h].highlightColorCode,o[h].highlightParaStartOffset,o[h].highlightParaEndOffset,o[h].highlightStartOffset,o[h].highlightEndOffset,o[h].highlightStartParaId,o[h].highlightEndParaId,enclosingParaIdString;null!=E&&null!=E&&(E.innerHTML='<briefstag id="'+o[h].annotationId+"_"+N+"_"+N+'" class="briefElementText" style="background-color: '+o[h].highlightColorCode+' !important;" data-references="popover" data-toggle="popover" tabindex="0" data-original-title="" title="" brieflabelname="'+i+'" briefnote="'+a+'" briefParaStartOffset="'+o[h].highlightParaStartOffset+'" briefParaEndOffset="'+o[h].highlightParaEndOffset+'" briefstartoffset="'+o[h].highlightStartOffset+'" briefendoffset="'+o[h].highlightEndOffset+'" briefstartparaid="'+o[h].highlightStartParaId+'"  briefendparaid="'+o[h].highlightEndParaId+'" enclosingParaIdString="'+enclosingParaIdString+'">'+E.innerHTML+"</briefstag>")}for(var M=0,R=0;(S=T.exec(m))&&!(S.index>0);)m=m.replace(S[0],""),M+=S[0].length,S[0].length;for(;(S=T.exec(m))&&!(S.index>o[h].highlightParaEndOffset);)m=m.replace(S[0],""),S[0].length,R+=S[0].length;var V=$(c).children()[0],F=0;null!=V&&null!=V.getAttribute("class")&&-1!==V.getAttribute("class").indexOf("cc-pagenum-begin")&&(F=V.innerHTML.length+"</span>".length),void 0===o[h].labelName?(o[h].labelName="",i=o[h].labelName):(i="",i=o[h].labelName.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/' '/g,"&nbsp;").replace(/"/g,"&ldquo;").replace(/"/g,"&rdquo;").replace(/'/g,"&lsquo;").replace(/'/g,"&rsquo;").replace(/&/g,"&amp;")),void 0===o[h].noteText?(o[h].noteText="",a=o[h].noteText):(a="",a=o[h].noteText.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/' '/g,"&nbsp;").replace(/"/g,"&ldquo;").replace(/"/g,"&rdquo;").replace(/'/g,"&lsquo;").replace(/'/g,"&rsquo;").replace(/&/g,"&amp;"));M+=F;var H=c.substring(M).indexOf(c.substring(M).trim());c=c.substring(0,M)+'<briefstag id="'+o[h].annotationId+'_1" class="briefElementText" style="background-color: '+o[h].highlightColorCode+' !important;" data-references="popover" data-toggle="popover" data-original-title="" title="" tabindex="0"  brieflabelname="'+i+'" briefnote="'+a+'" briefParaStartOffset="'+o[h].highlightParaStartOffset+'" briefParaEndOffset="'+o[h].highlightParaEndOffset+'" briefstartoffset="'+o[h].highlightStartOffset+'" briefendoffset="'+o[h].highlightEndOffset+'" briefstartparaid="'+o[h].highlightStartParaId+'"  briefendparaid="'+o[h].highlightEndParaId+'"  enclosingParaIdString="'+enclosingParaIdString+'">'+c.substring(M+H,M+H+parseInt(o[h].highlightParaEndOffset)+R-F)+"</briefstag>"+c.substring(M+H+parseInt(o[h].highlightParaEndOffset)+R-F),null!=o[h].highlightEndParaId&&null!=o[h].highlightEndParaId&&p.find("#"+o[h].highlightEndParaId)[0]&&(p.find("#"+o[h].highlightEndParaId)[0].outerHTML=c)}else{r=(r=h>0&&o[h].highlightParaEndOffset===o[h-1].highlightParaStartOffset?r.substring(0,L-1)+"</briefstag>"+r.substring(L):r.substring(0,L)+"</briefstag>"+r.substring(L)).substring(0,A)+y+r.substring(A)}}p.find("#"+l)[0]&&(p.find("#"+l)[0].outerHTML=r);var D=document.getElementsByTagName("briefstag"),_=[];for(h=0;h<D.length;h++)void 0===n[D[h].id]&&-1===D[h].id.indexOf("_")&&_.push(D[h]);setTimeout(function(){for(var e=0;e<s.length;e++)if(null!=p.find("#"+s[e])[0]&&null!=p.find("#"+s[e])[0]){var t=p.find("#"+s[e])[0];multiParaAnnotationStartParaStartOffset=t.getAttribute("briefParaStartOffset"),multiParaAnnotationStartParaEndOffset=t.textContent.length,multiParaBriefIndexer=0,briefTagFirstPart='<briefstag id="',multiParaAnnotationID=s[e],briefTagLastPart='" class="briefElementText" style="'+t.getAttribute("style")+'" data-references="popover" data-toggle="popover" data-original-title="" tabindex="0" title="" brieflabelname="'+t.getAttribute("brieflabelname")+'" briefnote="'+t.getAttribute("briefnote")+'" briefParaStartOffset="'+t.getAttribute("briefParaStartOffset")+'" briefParaEndOffset="'+t.getAttribute("briefParaEndOffset")+'" briefstartoffset="'+t.getAttribute("briefstartoffset")+'" briefendoffset="'+t.getAttribute("briefendoffset")+'" briefstartparaid="'+t.getAttribute("briefstartparaid")+'" briefendparaid="'+t.getAttribute("briefendparaid")+'"  enclosingParaIdString="'+enclosingParaIdString+'">';var a=t.getAttribute("briefStartParaId"),i=p.find("#"+a)[0];MARK=!1,addBriefMarkup(i,a),addBriefMarkupByOffestAndLength1(i,a,s[e]),a=t.getAttribute("briefEndParaId"),i=p.find("#"+a)[0];var r=$(i).children()[0];void 0!==r&&null!==r.getAttribute("class")&&-1!==r.getAttribute("class").indexOf("cc-pagenum-begin")&&r.innerHTML.length+"</span>".length,multiParaAnnotationStartParaStartOffset=0,multiParaAnnotationStartParaEndOffset=parseInt(t.getAttribute("briefParaEndOffset")),MARK=!1,addBriefMarkup(i,a),addBriefMarkupByOffestAndLength(i,a,s[e],!0)}setTimeout(function(){for(var e=0;e<s.length;e++)for(var t=$("briefstag[id^="+s[e]+"]"),a=0;a<t.length;a++)p.find("#"+t[a].id)[0].setAttribute("onClick","briefTextClicked()")},200);var n=_;for(e=0;e<n.length;e++){t=n[e];multiParaAnnotationStartParaStartOffset=parseInt(t.getAttribute("briefParaStartOffset")),multiParaAnnotationStartParaEndOffset=parseInt(t.getAttribute("briefParaEndOffset")),multiParaBriefIndexer=0,briefTagFirstPart='<briefstag id="',multiParaAnnotationID=t.id,briefTagLastPart='" class="briefElementText" style="'+t.getAttribute("style")+'" data-references="popover" data-toggle="popover" data-original-title="" tabindex="0" title="" brieflabelname="'+t.getAttribute("brieflabelname")+'" briefnote="'+t.getAttribute("briefnote")+'" briefParaStartOffset="'+t.getAttribute("briefParaStartOffset")+'" briefParaEndOffset="'+t.getAttribute("briefParaEndOffset")+'" briefstartoffset="'+t.getAttribute("briefstartoffset")+'" briefendoffset="'+t.getAttribute("briefendoffset")+'" briefstartparaid="'+t.getAttribute("briefstartparaid")+'" briefendparaid="'+t.getAttribute("briefendparaid")+'"  enclosingParaIdString="'+enclosingParaIdString+'">';a=t.getAttribute("briefStartParaId"),i=p.find("#"+a)[0];MARK=!1,addBriefMarkup(i,a),addBriefMarkupByOffestAndLengthForSinglePara(i,a,t.id)}setTimeout(function(){for(var e=0;e<n.length;e++)for(var t=$("briefstag[id^="+n[e].id+"]"),a=0;a<t.length;a++)p.find("#"+t[a].id)[0].setAttribute("onClick","briefTextClicked()"),p.find("#"+t[a].id)[0].addEventListener("keyup",briefTextClicked)},500);for(e=0;e<n.length;e++)for(var l=$("briefstag[id^="+n[e].id+"]"),c=0;c<l.length;c++)void 0!==l[c].children[0]&&"briefstag"===l[c].children[0].tagName.toLowerCase()&&1===l[c].children.length&&(l[c].innerHTML=l[c].children[0].innerHTML);for(e=0;e<o.length;e++)if(dppAnotationId=o[e].annotationId,p.find("#"+dppAnotationId)[0]&&(p.find("#"+dppAnotationId)[0].setAttribute("onClick","briefTextClicked()"),p.find("#"+dppAnotationId)[0].addEventListener("keyup",briefTextClicked),void 0!==o[e].labelName||void 0!==o[e].noteText)){void 0===o[e].labelName&&(o[e].labelName=""),void 0===o[e].noteText&&(o[e].noteText=""),selectedNoteId=dppAnotationId,bodyRect=document.body.getBoundingClientRect(),selectedHighlightColor=o[e].highlightColorCode;var d=p.find("#"+selectedNoteId)[0].getBoundingClientRect();if(yValue=d.top,""===o[e].labelName&&""===o[e].noteText);else{displayBriefOnRight(selectedNoteId,selectedHighlightColor,yValue,o[e].labelName,o[e].noteText);var g=300;(g=null!==localStorage.getItem("briefAnnotationListForChapter")?localStorage.getItem("briefAnnotationListForChapter").split(",").length:1e3)<50?setTimeout(function(){reCalculateBriefOnRight()},400):g>50&&g<150?setTimeout(function(){reCalculateBriefOnRight()},400):g>150&&g<400?setTimeout(function(){reCalculateBriefOnRight()},600):g>400&&g<800?setTimeout(function(){reCalculateBriefOnRight()},800):g>800&&g<1500?setTimeout(function(){reCalculateBriefOnRight()},1e3):setTimeout(function(){reCalculateBriefOnRight()},3e3)}}removeHighlightFromPageNumbers()},1e3)}if(setTimeout(function(){$("#txtPageNum").val(CaseConnect.currentPageNumber),$("#txtPageNumMobile").val(CaseConnect.currentPageNumber),"iOS"===CaseConnect.deviceOS&&"iPad"===CaseConnect.deviceType||"iOS"===CaseConnect.deviceOS&&CaseConnect.deviceType,null!=t&&null!=t||fetchLinkDetails(CaseConnect.currentChapterId)},1e3),setTimeout(function(){if(null!=e.totalPages&&""!=e.totalPages){var a=0;a=null==t||null==t?0:t;var i=e.totalPages;if(a<i-1){if(fetchBrief(CaseConnect.currentChapterId,a+1),0!=$(".loadMsg").length&&($(".loadMsg").remove(),$("#page-loading-spinner").hide()),insideEreader){$(".content-top-menu").append('<div class="col-md-5 loadMsg hidden-xs" style="position: relative;top: -15px;left: 25%;font-size: 10pt;font-family: arial;font-weight: bold;color:#c22e3f">Were loading your notes and highlights . . .</div>'),$("#wk_content .ereader-green-block").after('<div class="col-xs-12 loadMsg visible-xs" style="font-size: 10pt;font-family: arial;font-weight: bold;text-align:center;color:#c22e3f">Were loading your notes and highlights . . .</div>')}if(insideCasesPage){$(".case-page-content-block #cbc-cases-menu").after('<div class="col-md-5 loadMsg" style="position: absolute;top: 11px;left: 32%;font-size: 10pt;font-family: arial;font-weight: bold;color:#c22e3f">Were loading your notes and highlights . . .</div>'),$(".case-page-content-block #cases-heading-details").before('<div class="col-xs-12 loadMsg visible-xs" style="font-size: 10pt;font-family: arial;font-weight: bold;text-align:center;margin-top: 10px;color:#c22e3f">Were loading your notes and highlights . . .</div>')}}a==i-1&&($(".loadMsg").remove(),$("#page-loading-spinner").hide())}else 0!==$(".loadMsg").length&&($(".loadMsg").remove(),$("#page-loading-spinner").hide()),$("#page-loading-spinner").hide()},2e3),comingFromDiffChapterAnnotation&&(comingFromDiffChapterAnnotation=!1,insideEreader&&$(".ereader-content").find("#"+clickedAnnotationIdFromListing)[0])){var j=$(".ereader-content").find("#"+clickedAnnotationIdFromListing)[0],U=document.getElementById("ereader-scroller");$("ol.epub-parenlistlcletter li").addClass("goToPageBug"),$("ol.epub-parenlistucletter li").addClass("goToPageBug"),$("ol.epub-parenlistdecimal li").addClass("goToPageBug"),$("ol.epub-bracketlistdecimal li").addClass("goToPageBug"),$("ol.epub-ucletter li").addClass("goToPageBug"),$("ol.epub-lcletter li").addClass("goToPageBug"),$("ol.epub-ucroman li").addClass("goToPageBug"),$("ol.epub-lcroman li").addClass("goToPageBug"),$("ol.epub-decimal li").addClass("goToPageBug"),$(".epub-law-heading-container").addClass("goToPageBug"),$(".epub-law-case-marker").addClass("goToPageBug"),U.scrollTop=j.offsetTop,$("ol.epub-parenlistlcletter li").removeClass("goToPageBug"),$("ol.epub-parenlistucletter li").removeClass("goToPageBug"),$("ol.epub-parenlistdecimal li").removeClass("goToPageBug"),$("ol.epub-bracketlistdecimal li").removeClass("goToPageBug"),$("ol.epub-ucletter li").removeClass("goToPageBug"),$("ol.epub-lcletter li").removeClass("goToPageBug"),$("ol.epub-ucroman li").removeClass("goToPageBug"),$("ol.epub-lcroman li").removeClass("goToPageBug"),$("ol.epub-decimal li").removeClass("goToPageBug"),$(".epub-law-case-marker").removeClass("goToPageBug"),$(".epub-law-heading-container").removeClass("goToPageBug")}},function(e){sessionAuthFails(e),0!=$(".loadMsg").length&&$(".loadMsg").remove(),Utility.handleSessionAuthentication(e.responseJSON)?($("#notesSpinner").hide(),$("#previousChapterAnnotationArrow").attr("disabled",!1),$("#nextChapterAnnotationArrow").attr("disabled",!1),$("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function updateBrief(){briefTextClickFlag=!1;var e=$("#"+selectedNoteId).attr("briefnote"),t=$("#"+selectedNoteId).attr("brieflabelname"),a=$("#"+selectedNoteId).css("background-color");if(void 0!==$("textarea#add-brief-textarea")[1])var i=$("textarea#add-brief-textarea")[1].value.replace(/</g,"&lt;").replace(/>/g,"&gt;");var o="";if($(".color-btns").hasClass("selectedColor")){for(var r=$(".color-btns"),n=0;n<r.length;n++)if($("#"+r[n].id).hasClass("selectedColor")){o=$("#"+$(".color-btns")[n].id).attr("colorcode"),$("input#add-brief-label-box")[1].setAttribute("selectedColor",o);break}}else if(""==o&&(""!==colorCodeInput?o=colorCodeInput:""!==selectedHighlightColor&&(o=selectedHighlightColor),""!==o)){convertRGBToHex(o);for(var s=0;s<CaseConnect.preSetBriefLabelList.length;s++)CaseConnect.preSetBriefLabelList[s].colorCode===o&&(void 0!==CaseConnect.preSetBriefLabelList[s].labelName?$("input#add-brief-label-box")[1].value=CaseConnect.preSetBriefLabelList[s].labelName.replace(/&lt;/g,"<").replace(/&gt;/g,">"):$("input#add-brief-label-box")[1].value="")}if(void 0!==$("input#add-brief-label-box")[1])var l=$("input#add-brief-label-box")[1].value.replace(/</g,"&lt;").replace(/>/g,"&gt;");if(t===l&&e==i&&convertRGBToHex(a)===o)return $("#"+selectedNoteId).popover("hide"),$("#page-loading-spinner").hide(),updatingBrief=!1,addingBrief=!1,void(alreadyCalled=!1);briefedTextWithoutHTML=highlightedTextWithoutHTML,briefParaStartOffset=parseInt($("#"+selectedNoteId).attr("briefparastartoffset")),briefParaEndOffset=parseInt($("#"+selectedNoteId).attr("briefparaendoffset")),briefStartOffsetAtSectionLevel=$("#"+selectedNoteId).attr("briefstartoffset"),briefEndOffsetAtSectionLevel=$("#"+selectedNoteId).attr("briefendoffset"),briefStartParaId=$("#"+selectedNoteId).attr("briefstartparaid"),briefEndParaId=$("#"+selectedNoteId).attr("briefendparaid");var c,d=$("#"+selectedNoteId).attr("enclosingparaidstring");if(c=convertEnclosingParaStringIdToEnclosingParaArray(d),globalChapterBriefList){for(var g="",p=0;p<globalChapterBriefList.length;p++)if(selectedNoteId===globalChapterBriefList[p].annotationId){g=globalChapterBriefList[p].highlightText,highlightedTextWithoutHTML=g;break}""===g&&getHighlightTextInCopy()}else getHighlightTextInCopy();briefedTextWithoutHTML=highlightedTextWithoutHTML;var h=selectedNoteId;if(-1!==selectedNoteId.indexOf("_")&&(h=selectedNoteId.substring(0,selectedNoteId.indexOf("_"))),$("textarea#add-brief-textarea")[1]&&$("input#add-brief-label-box")[1])if("visible"===$(".save-brief-icon").css("visibility")){$(".save-brief-icon").css("visibility","hidden"),$("#page-loading-spinner").show(),insideCasesPage&&(CaseConnect.currentChapterId=casesSectionListOnLoad.chapterId,CaseConnect.currentSectionId=casesSectionListOnLoad.sectionId,CaseConnect.currentSectionTitle=casesSectionListOnLoad.sectionTitle);var u={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:CaseConnect.lastViewedOutlineId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},briefVO:{annotationId:h,bookId:CaseConnect.currentBookId,chapterTitle:CaseConnect.currentChapterTitle,pageNumber:CaseConnect.currentPageNumber,highlightParaStartOffset:briefParaStartOffset,highlightParaEndOffset:briefParaEndOffset,noteText:i,labelName:l,highlightColorCode:o,highlightStartParaId:briefStartParaId,highlightEndParaId:briefEndParaId,enclosingParaList:c}};insideEreader?(u.userVO.userActivityVO.lastActivityCode="EREADER_ADD_BRIEF",u.userVO.userActivityVO.pageNavigatingFrom="EReader",u.userVO.userActivityVO.pageNavigatingTo="EReader",u.briefVO.chapterId=CaseConnect.currentChapterId,u.briefVO.sectionId=annotationSectionId,u.briefVO.sectionTitle=annotationSectionTitle):insideCasesPage&&(u.userVO.userActivityVO.lastActivityCode="CASE_PAGE",u.userVO.userActivityVO.pageNavigatingFrom="CASES",u.userVO.userActivityVO.pageNavigatingTo="CASES",u.briefVO.chapterId=casesSectionListOnLoad.chapterId,u.briefVO.sectionId=casesSectionListOnLoad.sectionId,u.briefVO.sectionTitle=casesSectionListOnLoad.sectionTitle),$.ajax({url:properties[properties.env]+"/manageCases/updateChapterBrief",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(u)}).then(function(e){void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken);var t=$("briefstag[id^="+selectedNoteId+"]");highLightColor=o;for(var a=0;a<t.length;a++)$("briefstag#"+t[a].id).attr("style","background-color:"+highLightColor+" !important;"),$("briefstag#"+t[a].id).attr("brieflabelname",l),$("briefstag#"+t[a].id).attr("briefnote",i);selectedHighlightColor=highLightColor,yValue=document.getElementById(selectedNoteId).getBoundingClientRect().top,selectedHighlightColor||(selectedHighlightColor=document.getElementById(selectedNoteId).style.backgroundColor);var r=$("span[id='colSpan"+selectedNoteId+"']"),n=$(".labelNoteWrapper");if(n.length>0&&r.length>0)for(var s=0;s<n.length;s++)if(n[s].id.substring(12,n[s].id.length)===r[0].id.substring(7,r[0].id.length)){updatingBrief=!0,n[s].parentNode.removeChild(n[s]);break}if(void 0!==r&&void 0!==r[0]){var c=$(".briefSpanBlock");for(s=0;s<c.length;s++)if(c[s].id.substring(7,c[0].id.length)===r[0].id.substring(7,r[0].id.length)){c[s].parentNode.removeChild(c[s]);break}}if($(".color-btns").hasClass("selectedColor")&&void 0!==$("button#color-blank-briefs")[1]&&$("button#color-blank-briefs")[1].removeAttribute("disabled"),updatingBrief=!1,""===l&&""===i||(localStorage.setItem("addBriefStartParaId",briefStartParaId),$("#"+briefStartParaId).next(),$("#"+briefStartParaId).next().is("p")&&localStorage.setItem("addBriefNextParaId",$("#"+briefStartParaId).next().attr("id")),displayBriefOnRight(selectedNoteId,selectedHighlightColor,yValue,l,i),setTimeout(function(){checkBriefOverNoteForOverlap()},800)),$("#page-loading-spinner").show(),insideCasesPage){var d=$(window).width();""!==checkDropValue&&checkIfBriefloaded?"My Brief"===caseExcerptRightTitle&&"Case Text"===caseExcerptLeftTitle?getMyBriefContentInCasesPage():"Case Text"===caseExcerptRightTitle&&"My Brief"===caseExcerptLeftTitle?getMyBriefContentInCasesPage():$("#page-loading-spinner").hide():null==checkDropValue||""===checkDropValue?"My Brief"===caseExcerptRightTitle&&"Case Text"===caseExcerptLeftTitle?d>991?$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),$(window).trigger("resize")}):d<992&&!caseExcerptClicked?$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage()}):$("#page-loading-spinner").hide():"Case Text"===caseExcerptRightTitle&&"My Brief"===caseExcerptLeftTitle?d>991?$("#case-excerpt-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),$(window).trigger("resize")}):d<992&&!caseExcerptClicked?$("#case-excerpt-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage()}):$("#page-loading-spinner").hide():$("#page-loading-spinner").hide():$("#page-loading-spinner").hide()}else $("#page-loading-spinner").hide();$("#"+selectedNoteId).popover("hide"),$("#"+selectedNoteId).focus(),alreadyCalled=!1,sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),updatingBrief=!1,closePopover(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain,alreadyCalled=!1})}else $("#"+selectedNoteId).popover("hide"),updatingBrief=!1,alreadyCalled=!1}function deleteBriefNote(){briefTextClickFlag=!1;$("#"+selectedNoteId).attr("briefnote").replace(/</g,"&lt;").replace(/>/g,"&gt;");var e=$("#"+selectedNoteId).attr("brieflabelname").replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=$("#"+selectedNoteId).css("background-color"),a=convertRGBToHex(t);briefedTextWithoutHTML=highlightedTextWithoutHTML,briefParaStartOffset=parseInt($("#"+selectedNoteId).attr("briefparastartoffset")),briefParaEndOffset=parseInt($("#"+selectedNoteId).attr("briefparaendoffset")),briefStartOffsetAtSectionLevel=$("#"+selectedNoteId).attr("briefstartoffset"),briefEndOffsetAtSectionLevel=$("#"+selectedNoteId).attr("briefendoffset"),briefStartParaId=$("#"+selectedNoteId).attr("briefstartparaid"),briefEndParaId=$("#"+selectedNoteId).attr("briefendparaid");var i,o=$("#"+selectedNoteId).attr("enclosingparaidstring");i=convertEnclosingParaStringIdToEnclosingParaArray(o);for(var r=$("briefstag[id^="+selectedNoteId+"]"),n=0,s="",l=0;l<r.length;l++){for(var c,d,g=document.getElementById(r[l].id),p=g.innerHTML,h=g.getElementsByTagName("span").length,u=0;u<h;u++){var f=document.getElementById(r[l].id).getElementsByTagName("span")[u];void 0!==f&&f.hasAttribute("id")&&(d=(c=f.innerHTML).length)}if(p=(p=(p=p.replace(/(\r\n|\n|\r)/gm,"")).replace(/amp;/g,"")).replace(/&nbsp;/g," "),c)p=p.replace(c,""),n=n+(s+=removeTags(p)).length+d;else(s+=removeTags(p)).length}highlightedTextWithoutHTML=s,briefedTextWithoutHTML=highlightedTextWithoutHTML;var b=selectedNoteId;-1!==selectedNoteId.indexOf("_")&&(b=selectedNoteId.substring(0,selectedNoteId.indexOf("_"))),$("#page-loading-spinner").show(),insideCasesPage&&(CaseConnect.currentChapterId=casesSectionListOnLoad.chapterId,CaseConnect.currentSectionId=casesSectionListOnLoad.sectionId,CaseConnect.currentSectionTitle=casesSectionListOnLoad.sectionTitle);var C={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:CaseConnect.lastViewedOutlineId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},briefVO:{annotationId:b,bookId:CaseConnect.currentBookId,chapterTitle:CaseConnect.currentChapterTitle,pageNumber:CaseConnect.currentPageNumber,highlightParaStartOffset:briefParaStartOffset,highlightParaEndOffset:briefParaEndOffset,noteText:"",labelName:e,highlightColorCode:a,highlightStartParaId:briefStartParaId,highlightEndParaId:briefEndParaId,enclosingParaList:i}};insideEreader?(C.userVO.userActivityVO.lastActivityCode="EREADER_ADD_BRIEF",C.userVO.userActivityVO.pageNavigatingFrom="EReader",C.userVO.userActivityVO.pageNavigatingTo="EReader",C.briefVO.chapterId=CaseConnect.currentChapterId,C.briefVO.sectionId=annotationSectionId,C.briefVO.sectionTitle=annotationSectionTitle):insideCasesPage&&(C.userVO.userActivityVO.lastActivityCode="CASE_PAGE",C.userVO.userActivityVO.pageNavigatingFrom="CASES",C.userVO.userActivityVO.pageNavigatingTo="CASES",C.briefVO.chapterId=casesSectionListOnLoad.chapterId,C.briefVO.sectionId=casesSectionListOnLoad.sectionId,C.briefVO.sectionTitle=casesSectionListOnLoad.sectionTitle),$.ajax({url:properties[properties.env]+"/manageCases/updateChapterBrief",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(C)}).then(function(t){void 0!==t.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",t.sessionAuthenticationToken);var i=$("briefstag[id^="+selectedNoteId+"]");highLightColor=a;for(var o=0;o<i.length;o++)$("briefstag#"+i[o].id).attr("brieflabelname",e),$("briefstag#"+i[o].id).attr("briefnote","");selectedHighlightColor=highLightColor,yValue=document.getElementById(selectedNoteId).getBoundingClientRect().top,selectedHighlightColor||(selectedHighlightColor=document.getElementById(selectedNoteId).style.backgroundColor);var r=$("span[id='colSpan"+selectedNoteId+"']"),n=$(".labelNoteWrapper");if(n.length>0&&r.length>0)for(var s=0;s<n.length;s++)if(n[s].id.substring(12,n[s].id.length)===r[0].id.substring(7,r[0].id.length)){updatingBrief=!0,n[s].parentNode.removeChild(n[s]);break}if(void 0!==r&&void 0!==r[0]){var l=$(".briefSpanBlock");for(s=0;s<l.length;s++)if(l[s].id.substring(7,l[0].id.length)===r[0].id.substring(7,r[0].id.length)){l[s].parentNode.removeChild(l[s]);break}}if($(".color-btns").hasClass("selectedColor")&&void 0!==$("button#color-blank-briefs")[1]&&$("button#color-blank-briefs")[1].removeAttribute("disabled"),updatingBrief=!1,""===e){if(void 0!==r&&void 0!==r[0])for(l=$(".briefSpanBlock"),s=0;s<l.length;s++)if(l[s].id.substring(7,l[0].id.length)===r[0].id.substring(7,r[0].id.length)){l[s].parentNode.removeChild(l[s]);break}reCalculateBriefOnRight()}else displayBriefOnRight(selectedNoteId,selectedHighlightColor,yValue,e,""),setTimeout(function(){checkBriefOverNoteForOverlap()},800);if($("#page-loading-spinner").show(),insideCasesPage){var c=$(window).width();""!==checkDropValue&&checkIfBriefloaded?"My Brief"===caseExcerptRightTitle&&"Case Text"===caseExcerptLeftTitle?getMyBriefContentInCasesPage():"Case Text"===caseExcerptRightTitle&&"My Brief"===caseExcerptLeftTitle?getMyBriefContentInCasesPage():$("#page-loading-spinner").hide():null==checkDropValue||""===checkDropValue?"My Brief"===caseExcerptRightTitle&&"Case Text"===caseExcerptLeftTitle?c>991?$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),$(window).trigger("resize")}):c<992&&!caseExcerptClicked?$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage()}):$("#page-loading-spinner").hide():"Case Text"===caseExcerptRightTitle&&"My Brief"===caseExcerptLeftTitle?c>991?$("#case-excerpt-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),$(window).trigger("resize")}):c<992&&!caseExcerptClicked?$("#case-excerpt-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage()}):$("#page-loading-spinner").hide():$("#page-loading-spinner").hide():$("#page-loading-spinner").hide()}else $("#page-loading-spinner").hide();$("#"+selectedNoteId).popover("hide"),$("#"+selectedNoteId).focus(),alreadyCalled=!1,sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),updatingBrief=!1,closePopover(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain,alreadyCalled=!1})}function confirmDeleteBriefNote(){"Android"==CaseConnect.deviceOS&&(CaseConnect.androidIssueKeypad=!0),updatingBrief=!1,addingBrief=!1;var e=!1,t=$("span[id='colSpan"+selectedNoteId+"']"),a=$(".labelNoteWrapper");if(a.length>0&&t.length>0)for(var i=0;i<a.length;i++)if(a[i].id.substring(12,a[i].id.length)===t[0].id.substring(7,t[0].id.length)){e=!0;break}if(e){keepBriefPopoverVisible=!0;var o=$("#popover-delete-brief-note-content").clone(!0);$("#add-note-content-box").html(""),$("#add-note-content-box").append(o.html())}else addingBrief=!1,$("#"+selectedNoteId).popover("hide")}function showBriefPopoverAgain(){updateBriefColorPallet(selectedHighlightColor),element=document.getElementById(selectedNoteId),rect=element.getBoundingClientRect(),yValue=rect.top;var e=$("span[id='colSpan"+selectedNoteId+"']");if((a=$(".labelNoteWrapper")).length>0&&e.length>0)for(var t=0;t<a.length;t++)if(a[t].id.substring(12,a[t].id.length)===e[0].id.substring(7,e[0].id.length)){updatingBrief=!0;break}if(e&&e.length>0&&(showAddBriefPopoverOnly(),$("textarea#add-brief-textarea").length>1)){var a=$(".labelNoteWrapper");for(t=0;t<a.length;t++)if(a[t].id.substring(12,a[t].id.length)===e[0].id.substring(7,e[0].id.length)){$("textarea#add-brief-textarea")[1].innerHTML=a[t].getAttribute("briefNote"),$("input#add-brief-label-box")[1].value=a[t].getAttribute("labelName").replace(/&lt;/g,"<").replace(/&gt;/g,">"),""!==$("textarea#add-brief-textarea")[1].innerHTML&&$(".delete-btn").css("visibility","visible")[1],void 0!==$("button#color-blank-briefs")[1]&&$("button#color-blank-briefs")[1].removeAttribute("disabled");break}$(".color-btns").hasClass("selectedColor")&&void 0!==$("button#color-blank-briefs")[1]&&$("button#color-blank-briefs")[1].removeAttribute("disabled")}$("button.copy-clipboard-true").removeProp("style")}function confirmDeleteBriefNoteHighlight(){if(keepBriefPopoverVisible=!0,""!=$("textarea#add-brief-textarea")[1].innerHTML||""!==$("input#add-brief-label-box")[1].value){if(addingBrief&&!clickedInsidePcaseForAnnot)deleteCurrentBriefHighlight();else{var e=$("#popover-confirm-delete-brief-content").clone(!0);$("#add-note-content-box").html(""),$("#add-note-content-box").append(e.html())}updatingBrief=!1,addingBrief=!1,highlightPalletsVisibleOnly=!1}else""===$("textarea#add-brief-textarea")[1].innerHTML&&""!==$("input#add-brief-label-box")[1].value?deleteCurrentBriefHighlight():""===$("textarea#add-brief-textarea")[1].innerHTML&&""==$("input#add-brief-label-box")[1].value&&deleteCurrentBriefHighlight()}function deleteCurrentBriefHighlight(){$("#page-loading-spinner").show(),insideCasesPage&&(CaseConnect.currentChapterId=casesSectionListOnLoad.chapterId,CaseConnect.currentSectionId=casesSectionListOnLoad.sectionId,CaseConnect.currentSectionTitle=casesSectionListOnLoad.sectionTitle);var e={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:CaseConnect.lastViewedOutlineId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},annotationVO:{annotationId:selectedNoteId,bookId:CaseConnect.currentBookId,chapterId:CaseConnect.currentChapterId,chapterTitle:CaseConnect.currentChapterTitle,annotationType:"brief"}};insideEreader?(e.userVO.userActivityVO.lastActivityCode="EREADER_ANNOTATION_DELETE_HIGHLIGHT",e.userVO.userActivityVO.pageNavigatingFrom="EReader",e.userVO.userActivityVO.pageNavigatingTo="EReader"):insideCasesPage&&(e.userVO.userActivityVO.lastActivityCode="CASE_PAGE",e.userVO.userActivityVO.pageNavigatingFrom="CASES",e.userVO.userActivityVO.pageNavigatingTo="CASES"),$.ajax({url:properties[properties.env]+"/manageAnnotationService/deleteChapterHighlights",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(e)}).then(function(e){void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),addingBrief=!1,updatingBrief=!1,briefTextClickFlag=!1,closePopover();var t=$("briefstag[id^="+selectedNoteId+"]");briefParaStartOffset=parseInt(t[0].getAttribute("briefparastartoffset")),briefParaEndOffset=parseInt(t[0].getAttribute("briefparaendoffset")),briefStartOffsetAtSectionLevel=t[0].getAttribute("briefstartoffset"),briefEndOffsetAtSectionLevel=t[0].getAttribute("briefendoffset"),briefStartParaId=t[0].getAttribute("briefstartparaid"),briefEndParaId=t[0].getAttribute("briefendparaid"),saveBriefRequestData=briefStartOffsetAtSectionLevel+"_"+briefEndOffsetAtSectionLevel+"_"+briefStartParaId+"_"+briefEndParaId+"_"+briefParaStartOffset+"_"+briefParaEndOffset;for(var a=0;a<allExistingBriefAnnotationUniqueVal.length;a++)allExistingBriefAnnotationUniqueVal[a]===saveBriefRequestData&&allExistingBriefAnnotationUniqueVal.splice(a,1);localStorage.setItem("briefAnnotationListForChapter",allExistingBriefAnnotationUniqueVal);for(var i=0;i<t.length;i++){var o=document.getElementById(t[i].id),r=document.createElement("span");r.innerHTML=o.innerHTML,r.normalize(),o.parentNode.replaceChild(r,o)}var n=$("span[id='colSpan"+selectedNoteId+"']"),s=$(".labelNoteWrapper");if(s.length>0&&n.length>0)for(i=0;i<s.length;i++)if(s[i].id.substring(12,s[i].id.length)===n[0].id.substring(7,n[0].id.length)){s[i].parentNode.removeChild(s[i]);break}if(void 0!==n&&void 0!==n[0]){var l=$(".briefSpanBlock");for(i=0;i<l.length;i++)if(l[i].id.substring(7,l[0].id.length)===n[0].id.substring(7,n[0].id.length)){l[i].parentNode.removeChild(l[i]);break}}if($("#page-loading-spinner").show(),insideCasesPage){var c=$(window).width();""!==checkDropValue&&checkIfBriefloaded?"My Brief"===caseExcerptRightTitle&&"Case Text"===caseExcerptLeftTitle?getMyBriefContentInCasesPage():"Case Text"===caseExcerptRightTitle&&"My Brief"===caseExcerptLeftTitle?getMyBriefContentInCasesPage():$("#page-loading-spinner").hide():null==checkDropValue||""===checkDropValue?"My Brief"===caseExcerptRightTitle&&"Case Text"===caseExcerptLeftTitle?c>991?$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),$(window).trigger("resize")}):c<992&&!caseExcerptClicked?$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage()}):$("#page-loading-spinner").hide():"Case Text"===caseExcerptRightTitle&&"My Brief"===caseExcerptLeftTitle?c>991?$("#case-excerpt-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),$(window).trigger("resize")}):c<992&&!caseExcerptClicked?$("#case-excerpt-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage()}):$("#page-loading-spinner").hide():$("#page-loading-spinner").hide():$("#page-loading-spinner").hide()}else $("#page-loading-spinner").hide();sessionTimeOut()},function(e){sessionTimeOut(),sessionAuthFails(e),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg),closePopover()):window.location=properties.ui_domain})}function loadDataListInPopover(){if(void 0!==CaseConnect.preSetBriefLabelList&&""!==CaseConnect.preSetBriefLabelList){var e=CaseConnect.preSetBriefLabelList,t=$(".brief-label-list");t.html("");var a="";$(".brief-label-list").html("");for(var i=0;i<e.length;i++)void 0!==e[i].labelName&&""!==e[i].labelName&&(e[i].labelName=e[i].labelName.replace(/</g,"&lt;").replace(/>/g,"&gt;"),a="<li class='list-style-none' tabindex='0' value='"+e[i].labelName+"' ontouchstart='searchListOptionSelectedLabel(event);' onkeyup='toSelectLabel(event);' onclick='searchListOptionSelectedLabel(event);' colorCode='"+e[i].colorCode+"'>"+e[i].labelName+"</li>",t.append(a));if(""!==colorMarkerList)for(var o=0;o<e.length;o++)for(var r=0;r<colorMarkerList.length;r++)colorMarkerList[r].colorCode===e[o].colorCode&&("label-yellow"==colorMarkerList[r].colorMarker?(void 0!==e[o].labelName&&($(".highlight-color-yellow").attr("briefLabel",e[o].labelName),insidePrincipalCase?$(".highlight-color-yellow").attr("title",e[o].labelName):$(".highlight-color-yellow").attr("title","Yellow")),$(".highlight-color-yellow").attr("colorCode",e[o].colorCode)):"label-green"==colorMarkerList[r].colorMarker?(void 0!==e[o].labelName&&($(".highlight-color-green").attr("briefLabel",e[o].labelName),insidePrincipalCase?$(".highlight-color-green").attr("title",e[o].labelName):$(".highlight-color-green").attr("title","Green")),$(".highlight-color-green").attr("colorCode",e[o].colorCode)):"label-blue"==colorMarkerList[r].colorMarker?(void 0!==e[o].labelName&&($(".highlight-color-blue").attr("briefLabel",e[o].labelName),insidePrincipalCase?$(".highlight-color-blue").attr("title",e[o].labelName):$(".highlight-color-blue").attr("title","Blue")),$(".highlight-color-blue").attr("colorCode",e[o].colorCode)):"label-pink"==colorMarkerList[r].colorMarker?(void 0!==e[o].labelName&&($(".highlight-color-pink").attr("briefLabel",e[o].labelName),insidePrincipalCase?$(".highlight-color-pink").attr("title",e[o].labelName):$(".highlight-color-pink").attr("title","Pink")),$(".highlight-color-pink").attr("colorCode",e[o].colorCode)):"label-orange"==colorMarkerList[r].colorMarker?(void 0!==e[o].labelName&&($(".highlight-color-orange").attr("briefLabel",e[o].labelName),insidePrincipalCase?$(".highlight-color-orange").attr("title",e[o].labelName):$(".highlight-color-orange").attr("title","Orange")),$(".highlight-color-orange").attr("colorCode",e[o].colorCode)):"label-purple"==colorMarkerList[r].colorMarker&&(void 0!==e[o].labelName&&($(".highlight-color-purple").attr("briefLabel",e[o].labelName),insidePrincipalCase?$(".highlight-color-purple").attr("title",e[o].labelName):$(".highlight-color-purple").attr("title","Purple")),$(".highlight-color-purple").attr("colorCode",e[o].colorCode)))}else if(""!==colorMarkerList)for(r=0;r<colorMarkerList.length;r++)"label-yellow"==colorMarkerList[r].colorMarker?($(".highlight-color-yellow").attr("colorCode",colorMarkerList[r].colorCode),$(".highlight-color-yellow").removeAttr("briefLabel"),$(".highlight-color-yellow").attr("title","Yellow")):"label-green"==colorMarkerList[r].colorMarker?($(".highlight-color-green").attr("colorCode",colorMarkerList[r].colorCode),$(".highlight-color-green").removeAttr("briefLabel"),$(".highlight-color-green").attr("title","green")):"label-blue"==colorMarkerList[r].colorMarker?($(".highlight-color-blue").attr("colorCode",colorMarkerList[r].colorCode),$(".highlight-color-blue").removeAttr("briefLabel"),$(".highlight-color-blue").attr("title","blue")):"label-pink"==colorMarkerList[r].colorMarker?($(".highlight-color-pink").attr("colorCode",colorMarkerList[r].colorCode),$(".highlight-color-pink").removeAttr("briefLabel"),$(".highlight-color-pink").attr("title","pink")):"label-orange"==colorMarkerList[r].colorMarker?($(".highlight-color-orange").attr("colorCode",colorMarkerList[r].colorCode),$(".highlight-color-orange").removeAttr("briefLabel"),$(".highlight-color-orange").attr("title","orange")):"label-purple"==colorMarkerList[r].colorMarker&&($(".highlight-color-purple").attr("colorCode",colorMarkerList[r].colorCode),$(".highlight-color-purple").removeAttr("briefLabel"),$(".highlight-color-purple").attr("title","purple"))}function toSelectLabel(e){13==e.keyCode&&(labelListIsClicked=!1,searchListOptionSelectedLabel(e))}function toShowLabelUsingKeyPress(e){38!=e.keyCode&&40!=e.keyCode||(labelListIsClicked=!1,onclicklabelOptions(e))}function detectOnclick(){labelListIsClicked=!1,$("ul.searchAutoSuggestLableList").css("display","none")}function onclicklabelOptions(e){if(labelListIsClicked)return $("ul.searchAutoSuggestLableList").length>1&&($("ul.searchAutoSuggestLableList").css("display","none"),labelListIsClicked=!1,$("input#add-brief-label-box")[1].focus(),$("input#add-brief-label-box")[0].focus()),void(navigator.userAgent.match(/(Android)/)&&e.preventDefault());$("#brief-label-list ").css("display","block"),$("#brief-label-list li").css("display","block"),labelListIsClicked=!0,$("input#add-brief-label-box")[1].focus(),$("input#add-brief-label-box")[0].focus(),navigator.userAgent.match(/(Android)/)&&e.preventDefault(),insideTouchDevices||document.addEventListener("focus",function(e){var t=document.getElementById("add-brief-label-box");if(null!=t){if(t.contains(e.target))return;if(void 0===t.focus())return;t.focus()}},!0)}function searchListOptionSelectedLabel(e){labelListIsClicked=!1,$("input#add-brief-label-box")[1].value=e.target.textContent,$("ul.searchAutoSuggestLableList").css("display","none"),datalisOptionSelectOrType(),$("input#add-brief-label-box")[1].focus(),$("input#add-brief-label-box")[0].focus(),navigator.userAgent.match(/(iPad|Android|iPhone)/)&&document.activeElement.blur()}function datalisOptionSelectOrType(){$("#brief-label-list ").css("display","none");var e=$("input#add-brief-label-box")[1].value;e=e.toLowerCase(),$("input#add-brief-label-box")[1].setAttribute("selectedColor","");var t=$(".brief-label-list")[0].children,a=$(".brief-label-list")[1].children;$(".brief-label-not-found").hide();var i="",o=!1;if(null!=t&&null!=t){for(var r=0;r<t.length;r++){var n=t[r].getAttribute("value");-1!=(n=n.toLowerCase()).indexOf(e)&&""!=e?($(".brief-label-list").css("display","block"),t[r].style.display="block",a[r].style.display="block",o=!0):(t[r].style.display="none",a[r].style.display="none")}0==o&&$(".brief-label-list").css("display","none");for(r=0;r<t.length;r++){var s=t[r].getAttribute("value");if((s=s.toLowerCase())==e){o=!1;var l;l=$("#brief-label-list")[0].children[r].getAttribute("colorcode"),$("input#add-brief-label-box")[1].setAttribute("selectedColor",l),i=""!==l?l:"",$("#brief-label-list ").css("display","none"),$("#brief-label-list li").css("display","none");break}}}if(1!=o)if(""===e)if($(".save-brief-icon").css("visibility","hidden")[1],$("input#add-brief-label-box")[1].setAttribute("selectedColor",""),!0===updatingBrief?(addingBrief=!1,updatingBrief=!0):addingBrief=!0,$(".color-btns").hasClass("selectedColor")){var c="";updateBriefColorPallet(i=""),""!==c?($("input#add-brief-label-box")[1].value=c.replace(/&lt;/g,"<").replace(/&gt;/g,">"),e=c,!0===updatingBrief?(addingBrief=!1,updatingBrief=!0):addingBrief=!0):($("input#add-brief-label-box")[1].value="",e=""),$("input#add-brief-label-box")[1].value.length>0?($(".brief-label-not-found").show(),console.log("show the message")):$(".brief-label-not-found").hide()}else $(".color-btns").hasClass("selectedColor")||(e="",""===i&&(i=""!==selectedHighlightColor?selectedHighlightColor:highLightColor),$("input#add-brief-label-box")[1].value.length>0?($(".brief-label-not-found").show(),console.log("show the message")):$(".brief-label-not-found").hide());else if(""!==e){if($(".save-brief-icon").css("visibility","visible")[1],briefTextClickFlag&&(updatingBrief=!0),!0===updatingBrief?(addingBrief=!1,updatingBrief=!0):addingBrief=!0,""!==i?(selectedHighlightColor=i,colorCodeInput=i,updateBriefColorPallet(i)):""===i&&(i="",$(".brief-label-not-found").show(),console.log("show the message"),updateBriefColorPallet(i)),$(".color-btns").hasClass("selectedColor")){if($(".color-btns").hasClass("selectedColor")){c="";i="";for(var d=$(".color-btns"),g=0;g<d.length;g++)if($("#"+d[g].id).hasClass("selectedColor")){i=$("#"+$(".color-btns")[g].id).attr("colorcode"),c=$("#"+$(".color-btns")[g].id).attr("brieflabel").replace(/&lt;/g,"<").replace(/&gt;/g,">"),$("input#add-brief-label-box")[1].setAttribute("selectedColor",i);break}}}else $(".save-brief-icon").css("visibility","visible")[1],briefTextClickFlag&&(updatingBrief=!0),$("input#add-brief-label-box")[1].value.length>0?($(".brief-label-not-found").show(),console.log("show the message")):$(".brief-label-not-found").hide(),$("input#add-brief-label-box")[1].setAttribute("selectedColor",""),""!==(i="")||$(".color-btns").hasClass("selectedColor")?i=""!==selectedHighlightColor?selectedHighlightColor:highLightColor:updateBriefColorPallet(i);""!==i?(selectedHighlightColor=i,colorCodeInput=i,updateBriefColorPallet(i)):""===i&&(i=""!==selectedHighlightColor?selectedHighlightColor:highLightColor)}}function updateBriefColorPallet(e){"#ede48c"===e||"rgb(237, 228, 140)"===e?($(".highlight-color-yellow").addClass("change-yellow-color selectedColor"),$(".highlight-color-green").removeClass("change-green-color selectedColor"),$(".highlight-color-blue").removeClass("change-blue-color selectedColor"),$(".highlight-color-pink").removeClass("change-pink-color selectedColor"),$(".highlight-color-orange").removeClass("change-orange-color selectedColor"),$(".highlight-color-purple").removeClass("change-purple-color selectedColor")):"#b5eb97"===e||"rgb(181, 235, 151)"===e?($(".highlight-color-green").addClass("change-green-color selectedColor"),$(".highlight-color-blue").removeClass("change-blue-color selectedColor"),$(".highlight-color-pink").removeClass("change-pink-color selectedColor"),$(".highlight-color-orange").removeClass("change-orange-color selectedColor"),$(".highlight-color-purple").removeClass("change-purple-color selectedColor"),$(".highlight-color-yellow").removeClass("change-yellow-color selectedColor")):"#aee6fe"===e||"rgb(174, 230, 254)"===e?($(".highlight-color-blue").addClass("change-blue-color selectedColor"),$(".highlight-color-pink").removeClass("change-pink-color selectedColor"),$(".highlight-color-orange").removeClass("change-orange-color selectedColor"),$(".highlight-color-purple").removeClass("change-purple-color selectedColor"),$(".highlight-color-yellow").removeClass("change-yellow-color selectedColor"),$(".highlight-color-green").removeClass("change-green-color selectedColor")):"#fec0ff"===e||"rgb(254, 192, 255)"===e?($(".highlight-color-pink").addClass("change-pink-color selectedColor"),$(".highlight-color-orange").removeClass("change-orange-color selectedColor"),$(".highlight-color-purple").removeClass("change-purple-color selectedColor"),$(".highlight-color-yellow").removeClass("change-yellow-color selectedColor"),$(".highlight-color-green").removeClass("change-green-color selectedColor"),$(".highlight-color-blue").removeClass("change-blue-color selectedColor")):"#ffd4a8"===e||"rgb(255, 212, 168)"===e?($(".highlight-color-orange").addClass("change-orange-color selectedColor"),$(".highlight-color-purple").removeClass("change-purple-color selectedColor"),$(".highlight-color-yellow").removeClass("change-yellow-color selectedColor"),$(".highlight-color-green").removeClass("change-green-color selectedColor"),$(".highlight-color-blue").removeClass("change-blue-color selectedColor"),$(".highlight-color-pink").removeClass("change-pink-color selectedColor")):"#cbbefc"===e||"rgb(203, 190, 252)"===e?($(".highlight-color-purple").addClass("change-purple-color selectedColor"),$(".highlight-color-yellow").removeClass("change-yellow-color selectedColor"),$(".highlight-color-green").removeClass("change-green-color selectedColor"),$(".highlight-color-blue").removeClass("change-blue-color selectedColor"),$(".highlight-color-pink").removeClass("change-pink-color selectedColor"),$(".highlight-color-orange").removeClass("change-orange-color selectedColor")):($(".highlight-color-yellow").removeClass("change-yellow-color selectedColor"),$(".highlight-color-green").removeClass("change-green-color selectedColor"),$(".highlight-color-blue").removeClass("change-blue-color selectedColor"),$(".highlight-color-pink").removeClass("change-pink-color selectedColor"),$(".highlight-color-orange").removeClass("change-orange-color selectedColor"),$(".highlight-color-purple").removeClass("change-purple-color selectedColor")),($(".color-btns").hasClass("selectedColor")||updatingBrief||$(".color-btns").hasClass("selectedColor")&&addingBrief)&&($(".save-brief-icon").css("visibility","visible")[1],briefTextClickFlag)&&(updatingBrief=!0)}function showCasesModal(){$("#case-welcome-modal").modal("show")}function loadChapterListInCases(e){$("#select-case-page").show(),enableCopyPaste();for(var t=e.length,a=0;a<t;a++){var i=a+1;if($(".chapters-list").append('<div class="chapters-for-case expandCheck collapsed-chapter" id="chapter'+i+'"><span class="glyphicon glyphicon-plus cases-expand-icon expand'+i+'"" onclick="expandCases('+i+');"></span><span onclick="expandCases('+i+');">  '+e[a].navbarTitle+'</span></div><div class="cases-inside-chapters" id="cases-inside-chaptersfor'+i+'"style="display:none;"></div>'),e[a],e[a].sectionVOList,null!=e[a].sectionVOList){var o=e[a].sectionVOList;"object"==$.type(o)&&(o=[o]);for(var r=o.length,n=0;n<r;n++){var s=n+1,l=[];l=o[n].sectionTitle.split(" v.");for(var c=0;c<l.length;c++)l[c]=l[c].toUpperCase();for(var d="",g=0;g<l.length;g++)d+=l[g],g!=l.length-1&&(d+="  v. ");$("#cases-inside-chaptersfor"+i).append('<div class="chapters-for-case cases-inside-chapters-cases" id="subchapter'+s+'"onclick="showCasesPage(event);" bookId='+o[n].bookId+" chapterId="+o[n].chapterId+" sectionId="+o[n].sectionId+">"+d+"</div>"),$(window).trigger("resize")}}}$("#page-loading-spinner").hide()}function loadSectionListInCases(e){var t=e.pCasePath;null!=checkDropValue&&""!==checkDropValue||($(".case-excerpt-block").html(""),$(".case-note-container").html(""),$("#page-loading-spinner").show()),$.ajax({url:t,type:"GET",async:!1}).then(function(t){var a=(new XMLSerializer).serializeToString(t.documentElement);$(".case-name-heading").html(e.sectionTitle),void 0!==e.sectionCitation&&"-999"!==e.sectionCitation&&$(".caseCitation").html(e.sectionCitation),$(".case-excerpt-block").html(a),$(".case-excerpt-block-sm").html(a),null!==document.getElementById("case-excerpt-block-cases")&&addEventListenerForIpadandAndroid(),fetchAnnotations(e.chapterId),$(window).trigger("resize")},function(e){$("#page-loading-spinner").hide()})}function expandCases(e){$("#cases-inside-chaptersfor"+e).toggle(),$(".expand"+e).toggleClass("glyphicon-plus glyphicon-minus"),$("#chapter"+e).toggleClass("collapsed-chapter expanded-chapter");var t=$(".chapters-list .expandCheck"),a=!1,i=!1;$(".expandAllCase").removeClass("disabled-case"),$(".collapseAllCase").removeClass("disabled-case");for(var o=0;o<t.length;o++){if("collapsed-chapter"!=t[o].classList[2]){i=!1;break}i=!0}for(o=0;o<t.length;o++){if("expanded-chapter"!=t[o].classList[2]){a=!1;break}a=!0}1==a&&0==i?($(".collapseAllCase").removeClass("disabled-case"),$(".expandAllCase").addClass("disabled-case")):1==i&&0==a?($(".expandAllCase").removeClass("disabled-case"),$(".collapseAllCase").addClass("disabled-case")):($(".expandAllCase").removeClass("disabled-case"),$(".collapseAllCase").removeClass("disabled-case")),$(window).trigger("resize")}function expandall(){for(var e=0;e<casesChapterListOnLoad.length;e++)$("#cases-inside-chaptersfor"+(e+1)).show(),$(".expand"+(e+1)).removeClass("glyphicon-plus"),$(".expand"+(e+1)).addClass("glyphicon-minus"),$("#chapter"+(e+1)).removeClass("collapsed-chapter"),$("#chapter"+(e+1)).addClass("expanded-chapter");$(".collapseAllCase").removeClass("disabled-case"),$(".expandAllCase").addClass("disabled-case"),$(window).trigger("resize")}function collapseall(){for(var e=0;e<casesChapterListOnLoad.length;e++)$("#cases-inside-chaptersfor"+(e+1)).hide(),$(".expand"+(e+1)).removeClass("glyphicon-minus"),$(".expand"+(e+1)).addClass("glyphicon-plus"),$("#chapter"+(e+1)).removeClass("expanded-chapter"),$("#chapter"+(e+1)).addClass("collapsed-chapter");$(".expandAllCase").removeClass("disabled-case"),$(".collapseAllCase").addClass("disabled-case"),$(window).trigger("resize")}Handler.loadCasesBriefs={request:function(e){insideCasesPage=!0,insideNewsFeed=!1,insideStudycenterPage=!1,insideOutline=!1,insideEreader=!1,insideClassInsightsPage=!1,insideResourcePage=!1,insideGlobalSearchResult=!1,insideThemis=!1,insideThemisAdmin=!1,insideCQuizzing=!1,insidePracticePerfect=!1,changePageFont(),searchBookText(),showGotoMenu(),searchBookTextMobile(),changePageFontMobile(),outlineSearchText(),casesSearchText(),CaseConnect.outlineTimer&&clearTimeout(CaseConnect.outlineTimer),CaseConnect.currentUserId=localStorage.getItem("userId"),CaseConnect.currentUserRole=localStorage.getItem("userRole"),CaseConnect.currentUserRoleId=localStorage.getItem("userRoleId"),$("#bookshelf-nav-menu-mobile").modal("hide"),$("#ereader-nav-menu-mobile").modal("hide"),$("#outline-nav-menu-mobile").modal("hide"),$("#themis-nav-menu-mobile").modal("hide"),$("#study-nav-menu-mobile").modal("hide"),$("#cases-nav-menu-mobile").modal("hide"),$("#news-feed-nav-mobile").modal("hide"),$(".ereader-main-header-title").html(""),$(".read-modal-book-title").html(""),e.data={userVO:{userId:localStorage.getItem("userId"),userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),streamContentRequiredFlag:map.isIE9,userActivityVO:{lastActivityCode:"CASE_PAGE",pageNavigatingFrom:"CASES",pageNavigatingTo:"CASES",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:"",lastReadChapterId:"",lastReadSectionId:"",lastReadSubSectionId:"",lastReadParagraphId:"",lastViewedOutlineId:""},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},bookVO:{bookId:CaseConnect.currentBookId}},$("#page-loading-spinner").show()},response:function(e,t){(localStorage.getItem("userId")||CaseConnect.currentUserId)&&sessionTimeOut(),"true"==e.resourceFlag&&(CaseConnect.resourceFlag,e.resourceFlag,$(".resourceMenushow").removeClass("resourceMenuhide")),void 0!==e.newsFeedFlag&&(CaseConnect.newsFeedFlag,e.newsFeedFlag),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide(),$(".hide-case-page-class").show(),insideStaticPage=!1,insideBookshelf=!1,insideEreader=!1,insideNewsFeed=!1,insideAssessment=!1,insideOutline=!1,insideResourcePage=!1,insideStudycenterPage=!1,insideGlobalSearchResult=!1,insideThemis=!1,insideThemisAdmin=!1,insideCQuizzing=!1,insidePracticePerfect=!1,searchedTextSaved=null,$(".cases-mobile-menu-manage-connect").hide(),$(".cases-mobile-menu-head-menu").show(),Handler.login.removeUnderlineStyle(),void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),CaseConnect.outlineTimer&&clearTimeout(CaseConnect.outlineTimer),"false"===e.status?(sessionAuthFails(e),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain):e.bookVO&&(CaseConnect.currentUserId=localStorage.getItem("userId"),CaseConnect.currentUserRole=localStorage.getItem("userRole"),CaseConnect.currentUserRoleId=localStorage.getItem("userRoleId"),CaseConnect.sessionAuthenticationToken=localStorage.getItem("sessionAuthenticationToken"),CaseConnect.bookData=e.bookVO,CaseConnect.bookData.explodedEpubPath=e.bookVO.exploadedEpubPath,CaseConnect.currentPageNumber=e.bookVO.lastReadPageNum,CaseConnect.currentChapterId=e.bookVO.lastReadChapterId,CaseConnect.chapterTitle=e.bookVO.chapterTitle,CaseConnect.currentBookId=e.bookVO.bookId,CaseConnect.tocPath=e.bookVO.tocPath,CaseConnect.nextChapterStartPageNumber=e.bookVO.nextChapterStartPageNumber,CaseConnect.nextChapterNumber=e.bookVO.nextChapterNumber,CaseConnect.nextChapterTitle=e.bookVO.nextChapterTitle,CaseConnect.currentChapterEndPageNumber=e.bookVO.chapterEndPageNumber,CaseConnect.previousChapterEndPageNumber=e.bookVO.previousChapterEndPageNumber,CaseConnect.bookType=e.bookVO.bookType,CaseConnect.resourceFlag=e.resourceFlag,CaseConnect.newsFeedFlag=e.newsFeedFlag,$(".ereader-main-header-title").html(CaseConnect.bookData.bookTitle),null===CaseConnect.currentBookId&&""===CaseConnect.currentBookId||(checkNewsFeedInApp(),expiryDate()),getMyRequestNoftificationCount(),(CaseConnect.bookType&&"practicepack"===CaseConnect.bookType||CaseConnect.bookType&&"oer"===CaseConnect.bookType)&&($(".hide-study-page-class").hide(),$(".hide-outline-page-class").hide(),$(".hide-class-insights-class").hide(),$(".hide-pipe-line-class").hide(),$(".ereader-heading-pipes").hide(),$(".class-insights-mobile-visibility").css("visibility","hidden"),"true"==CaseConnect.resourceFlag?($(".resourceMenushow").removeClass("resourceMenuhide"),$(".hide-ereader-class").show()):$(".hide-ereader-class").hide(),void 0!==e.newsFeedFlag?CaseConnect.newsFeedFlag=e.newsFeedFlag:$(".hide-news-feed-class").hide()),(CaseConnect.bookType&&"casebook"===CaseConnect.bookType||CaseConnect.bookType&&"coursebook"===CaseConnect.bookType)&&($(".hide-study-page-class").show(),$(".hide-ereader-class").show(),$(".hide-outline-page-class").show(),$(".hide-class-insights-class").show(),$(".hide-pipe-line-class").show(),$(".class-insights-mobile-visibility").css("visibility","visible")),CaseConnect.bookType&&"studyaid"===CaseConnect.bookType&&($(".hide-study-page-class").show(),$(".hide-ereader-class").show(),$(".hide-outline-page-class").show(),$(".hide-class-insights-class").hide(),$(".hide-pipe-line-class").show(),$(".class-insights-mobile-visibility").css("visibility","hidden")),"true"==CaseConnect.resourceFlag&&$(".resourceMenushow").removeClass("resourceMenuhide"),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide()),$(".hide-case-page-class").show(),$("#casebook-footer-wrapper").show(),map.wk_conatiner.load("case-brief-content.html?v20169",function(){if(insideCasesPage=!0,insideEreader=!1,insideThemis=!1,insideThemisAdmin=!1,insideCQuizzing=!1,insidePracticePerfect=!1,$(window).trigger("resize"),$(".cases-mobile-menu-manage-connect").hide(),$(".cases-mobile-menu-head-menu").show(),$(".case-page-content-block").show(),$(".manage-connection-content-block").hide(),$(".read-modal-book-title").html(CaseConnect.bookData.bookTitle),$(".manage-connection-content-block").css("display","none"),!insideStaticPage){var t=$(window).width(),a=$(".main-container").width();t<768&&t>=a?$("#header-wrapper").hide():$("#header-wrapper").show()}if(enableCopyPaste(),"true"==CaseConnect.resourceFlag&&$(".resourceMenushow").removeClass("resourceMenuhide"),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide(),$(".hide-case-page-class").show(),insideNewsFeed=!1,$(".content-wrapper").css("padding-bottom","0px"),null!=e.chapterVOList&&void 0!==e.chapterVOList){var i=e.chapterVOList;"object"==$.type(i)&&(i=[i]),casesChapterListOnLoad=i,loadChapterListInCases(i),updateHeadingDropdown(),getAnnotatableChapterAndSupplementalList()}else null!=e.sectionVO&&void 0!==e.sectionVO&&(getAnnotatableChapterAndSupplementalList(),$("#case-excerpt-content-wrap").load("case-excerpt.html?v20169",function(){casesSectionListOnLoad=e.sectionVO,CaseConnect.currentBookId=e.sectionVO.bookId,CaseConnect.currentChapterId=e.sectionVO.chapterId,CaseConnect.currentSectionId=casesSectionListOnLoad.sectionId,CaseConnect.currentSectionTitle=casesSectionListOnLoad.sectionTitle,$("#select-case-page").hide(),$(".case-menu-header").show(),$("#cases-heading-details").show(),$(".case-content-wrapper").show(),$(".case-excerpt-block").html(""),$(".case-excerpt-sm-block").html(""),$(".case-excerpt-md-note-container").html(""),$(".case-excerpt-sm-note-container").html(""),$(".case-name-heading").html(casesSectionListOnLoad.sectionTitle),void 0!==casesSectionListOnLoad.sectionCitation&&"-999"!==casesSectionListOnLoad.sectionCitation&&$(".caseCitation").html(casesSectionListOnLoad.sectionCitation),$(".ereader-booktitle-mobile").html(CaseConnect.bookTitle),loadSectionListInCases(e.sectionVO),updateHeadingDropdown(),caseExcerptLeftTitle=$("h2.case-left-header").html(),caseExcerptRightTitle=$("h2.case-right-header").html(),"My Brief"===caseExcerptLeftTitle||"My Brief"===caseExcerptRightTitle?$("a.glyphicon-cloud-download").css("display","inline-block"):($("a.glyphicon-cloud-download").css("display","none"),checkIfBriefloaded=!1),$(".case-excerpt-second-div-sm").hide(),$(".case-excerpt-third-div-sm").hide(),$(".case-excerpt-first-div-sm").show(),caseExcerptClicked=!0,$(window).trigger("resize"),loadImagesFromCDN()}));casesSearchText(),caseSearchTextMobile(),null!=e.userSettingsVO.briefTutorialFlag&&null!=e.userSettingsVO.briefTutorialFlag&&"true"==e.userSettingsVO.briefTutorialFlag&&$("#case-welcome-modal").modal("show"),adminSuppressFunc()}),insideManageConnection=!1,$("#page-loading-spinner").hide()}};var casemenuOrigin="";function showCasesPage(e){var t=e.currentTarget.getAttribute("bookId"),a=e.currentTarget.getAttribute("sectionId");$(window).width()>991&&(casemenuOrigin="true"),$("#page-loading-spinner").show();var i={userVO:{userId:localStorage.getItem("userId"),userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),streamContentRequiredFlag:map.isIE9,userActivityVO:{lastActivityCode:"CASE_PAGE",pageNavigatingFrom:"Bookshelf",pageNavigatingTo:"BOOKSHELF",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:"",lastReadChapterId:"",lastReadSectionId:"",lastReadSubSectionId:"",lastReadParagraphId:"",lastViewedOutlineId:""},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},bookVO:{bookId:t,sectionId:a}};$.ajax({url:properties[properties.env]+"/manageCases/getCaseExcerptContentBySectionId",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(i)}).then(function(e){"true"==e.status&&($(".case-page-content-block").show(),$(".manage-connection-content-block").hide(),$(".manage-connection-content-block").css("display","none"),null!=e.sectionVO&&null!=e.sectionVO?($("#case-excerpt-content-wrap").load("case-excerpt.html?v20169",function(){var t=e.sectionVO;$("#cases-heading-details").show(),$(".case-content-wrapper").show(),$("#select-case-page").hide(),$(".case-excerpt-block").html(""),$(".case-excerpt-md-note-container").html(""),$(".case-excerpt-sm-note-container").html(""),casesSectionListOnLoad=t,CaseConnect.currentChapterId=casesSectionListOnLoad.chapterId,CaseConnect.currentSectionId=casesSectionListOnLoad.sectionId,$(".case-name-heading").html(casesSectionListOnLoad.sectionTitle),void 0!==casesSectionListOnLoad.sectionCitation&&"-999"!==casesSectionListOnLoad.sectionCitation&&$(".caseCitation").html(casesSectionListOnLoad.sectionCitation),$(".myBrief").html(""),loadSectionListInCases(casesSectionListOnLoad),updateHeadingDropdown(),caseExcerptLeftTitle=$("h2.case-left-header").html(),caseExcerptRightTitle=$("h2.case-right-header").html(),"My Brief"===caseExcerptLeftTitle||"My Brief"===caseExcerptRightTitle?$("a.glyphicon-cloud-download").css("display","inline-block"):($("a.glyphicon-cloud-download").css("display","none"),checkIfBriefloaded=!1),$(window).trigger("resize"),loadImagesFromCDN()}),$(window).width()<992&&(localStorage.setItem("caseExcerptClicked","true"),caseExcerptClicked=!0,$(".case-excerpt-first-div-sm").show(),$(".case-excerpt-second-div-sm").hide(),$(".case-excerpt-third-div-sm").hide(),$(".case-excerpt-first-div").show(),$(".case-excerpt-second-div").hide(),$(".case-excerpt-third-div").hide(),$("h2.case-right-header").html("My Brief"),$("#myBrief-content-wrap").html(""),$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),caseExcerptRightTitle=$("h2.case-right-header").html(),$("h2.case-right-header").parent().attr("title",caseExcerptRightTitle),$("h2.case-right-header").parent().attr("aria-label",caseExcerptRightTitle),updateHeadingDropdown()})),$(".case-menu-header").show()):$("#page-loading-spinner").hide());"false"==e.status&&(sessionTimeOut(),sessionAuthFails(e),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain)},function(e){sessionTimeOut(),sessionAuthFails(e),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function loadCasesBriefsFromLogin(e){if(searchedTextSaved=null,$(".ereader-main-header-title").html(""),$(".read-modal-book-title").html(""),Handler.login.removeUnderlineStyle(),void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),e.userActivityVO&&(enableCopyPaste(),insideCasesPage=!0,insideEreader=!1,insideNewsFeed=!1,insideAssessment=!1,insideOutline=!1,insideResourcePage=!1,insideStudycenterPage=!1,insideStaticPage=!1,insideBookshelf=!1,insideGlobalSearchResult=!1,insideThemis=!1,insideThemisAdmin=!1,insideCQuizzing=!1,insidePracticePerfect=!1,checkDropValue="",$(".content-wrapper").css("padding-bottom","0px"),CaseConnect.currentUserId=localStorage.getItem("userId"),CaseConnect.currentUserRole=localStorage.getItem("userRole"),CaseConnect.currentUserRoleId=localStorage.getItem("userRoleId"),CaseConnect.sessionAuthenticationToken=localStorage.getItem("sessionAuthenticationToken"),e.userActivityVO.bookVO&&(CaseConnect.bookData=e.userActivityVO.bookVO,CaseConnect.bookTitle=e.userActivityVO.bookVO.bookTitle,CaseConnect.currentBookId=e.userActivityVO.bookVO.bookId,CaseConnect.bookType=e.userActivityVO.bookVO.bookType),$(".ereader-main-header-title").html(CaseConnect.bookData.bookTitle),void 0!==e.userActivityVO.resourceFlag&&(CaseConnect.resourceFlag=e.userActivityVO.resourceFlag),void 0!==e.userActivityVO.newsFeedFlag&&(CaseConnect.newsFeedFlag=e.userActivityVO.newsFeedFlag),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide(),$("#page-loading-spinner").show(),map.wk_conatiner.load("case-brief-content.html?v20169",function(){if(insideCasesPage=!0,insideEreader=!1,insideThemis=!1,insideThemisAdmin=!1,insideCQuizzing=!1,insidePracticePerfect=!1,$(".cases-mobile-menu-manage-connect").hide(),$(".cases-mobile-menu-head-menu").show(),$(".read-modal-book-title").html(CaseConnect.bookData.bookTitle),$(window).trigger("resize"),(CaseConnect.bookType&&"practicepack"===CaseConnect.bookType||CaseConnect.bookType&&"oer"===CaseConnect.bookType)&&($(".hide-study-page-class").hide(),$(".hide-outline-page-class").hide(),$(".hide-class-insights-class").hide(),$(".hide-pipe-line-class").hide(),$(".class-insights-mobile-visibility").css("visibility","hidden"),"true"==CaseConnect.resourceFlag?($(".resourceMenushow").removeClass("resourceMenuhide"),$(".hide-ereader-class").show()):$(".hide-ereader-class").hide(),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide()),(CaseConnect.bookType&&"casebook"===CaseConnect.bookType||CaseConnect.bookType&&"coursebook"===CaseConnect.bookType)&&($(".hide-study-page-class").show(),$(".hide-ereader-class").show(),$(".hide-outline-page-class").show(),$(".hide-class-insights-class").show(),$(".hide-pipe-line-class").show(),$(".class-insights-mobile-visibility").css("visibility","visible")),CaseConnect.bookType&&"studyaid"===CaseConnect.bookType&&($(".hide-study-page-class").show(),$(".hide-ereader-class").show(),$(".hide-outline-page-class").show(),$(".hide-class-insights-class").hide(),$(".hide-pipe-line-class").show(),$(".class-insights-mobile-visibility").css("visibility","hidden")),"true"==CaseConnect.resourceFlag&&$(".resourceMenushow").removeClass("resourceMenuhide"),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide(),$(".hide-case-page-class").show(),void 0!==e.userActivityVO.chapterVOList&&null!=e.userActivityVO.chapterVOList){$("#select-case-page").show(),$(".case-page-content-block").hide(),$(".manage-connection-content-block").hide(),$(".manage-connection-content-block").css("display","none");var t=e.userActivityVO.chapterVOList;"object"==$.type(t)&&(t=[t]),casesChapterListOnLoad=t,loadChapterListInCases(t),$("#page-loading-spinner").hide()}else null!=e.userActivityVO.sectionVO&&void 0!==e.userActivityVO.sectionVO&&$("#case-excerpt-content-wrap").load("case-excerpt.html?v20169",function(){$(".case-page-content-block").show(),$(".manage-connection-content-block").hide(),$(".manage-connection-content-block").css("display","none"),casesSectionListOnLoad=e.userActivityVO.sectionVO,CaseConnect.currentBookId=e.userActivityVO.sectionVO.bookId,CaseConnect.currentChapterId=e.userActivityVO.sectionVO.chapterId,CaseConnect.currentSectionId=casesSectionListOnLoad.sectionId,CaseConnect.currentSectionTitle=casesSectionListOnLoad.sectionTitle,getAnnotatableChapterAndSupplementalList(),$("#select-case-page").hide(),$("#cases-heading-details").show(),$(".case-content-wrapper").show(),$(".case-excerpt-block").html(""),$(".case-excerpt-md-note-container").html(""),$(".case-excerpt-sm-note-container").html(""),$(".case-name-heading").html(casesSectionListOnLoad.sectionTitle),void 0!==casesSectionListOnLoad.sectionCitation&&"-999"!==casesSectionListOnLoad.sectionCitation&&$(".caseCitation").html(casesSectionListOnLoad.sectionCitation),caseExcerptLeftTitle=$("h2.case-left-header").html(),caseExcerptRightTitle=$("h2.case-right-header").html(),"My Brief"===caseExcerptLeftTitle||"My Brief"===caseExcerptRightTitle?$("a.glyphicon-cloud-download").css("display","inline-block"):($("a.glyphicon-cloud-download").css("display","none"),checkIfBriefloaded=!1),loadSectionListInCases(e.userActivityVO.sectionVO),updateHeadingDropdown(),caseExcerptLeftTitle=$("h2.case-left-header").html(),caseExcerptRightTitle=$("h2.case-right-header").html(),"My Brief"===caseExcerptLeftTitle||"My Brief"===caseExcerptRightTitle?$("a.glyphicon-cloud-download").css("display","inline-block"):($("a.glyphicon-cloud-download").css("display","none"),checkIfBriefloaded=!1),$(window).trigger("resize"),loadImagesFromCDN()});$(".ereader-booktitle-mobile").html(CaseConnect.bookTitle),null===CaseConnect.currentBookId&&""===CaseConnect.currentBookId||(checkNewsFeedInApp(),expiryDate()),getMyRequestNoftificationCount(),casesSearchText(),caseSearchTextMobile(),null!=e.userActivityVO.userSettingsVO&&void 0!==e.userActivityVO.userSettingsVO&&"true"==e.userActivityVO.userSettingsVO.briefTutorialFlag&&$("#case-welcome-modal").modal("show"),adminSuppressFunc()})),!insideStaticPage){var t=$(window).width(),a=$(".main-container").width();t<768&&t>=a?$("#header-wrapper").hide():$("#header-wrapper").show()}$("#casebook-footer-wrapper").show(),setTimeout(function(){$(".ereader-main-header-title").html(CaseConnect.bookData.bookTitle),$(".read-modal-book-title").html(CaseConnect.bookData.bookTitle),$(".ereader-sub-header-total-pages").html(CaseConnect.bookData.totalChapterPageCount)},2e3)}function selectCase(){$("#page-loading-spinner").show();var e={userVO:{userId:localStorage.getItem("userId"),userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),streamContentRequiredFlag:map.isIE9,userActivityVO:{lastActivityCode:"CASE_MENU_PAGE",pageNavigatingFrom:"Bookshelf",pageNavigatingTo:"BOOKSHELF",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:"",lastReadChapterId:"",lastReadSectionId:"",lastReadSubSectionId:"",lastReadParagraphId:"",lastViewedOutlineId:""},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},bookVO:{bookId:CaseConnect.currentBookId}};$.ajax({url:properties[properties.env]+"/manageCases/getAllPrincipleCaseByBookId ",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(e)}).then(function(e){if("true"==e.status){if($("#cases-heading-details").hide(),$(".case-content-wrapper").hide(),$(".manage-connection-content-block").hide(),$("#select-case-page").show(),enableCopyPaste(),$(".chapters-list").html(""),null!=e.chapterVOList&&null!=e.chapterVOList){$(".case-menu-header").hide();var t=e.chapterVOList;"object"==$.type(t)&&(t=[t]),CaseConnect.currentSectionId=null,CaseConnect.currentSectionTitle=null,casesChapterListOnLoad=t,loadChapterListInCases(t)}$("#page-loading-spinner").hide()}"false"==e.status&&(sessionTimeOut(),sessionAuthFails(e),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain)},function(e){sessionTimeOut(),sessionAuthFails(e),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function searchtoggle(){$("#case-search-icon").hide(),$("#caseSearchTextbox").show(),$("input#caseSearchTextbox").focus()}function closeSearchtoggle(){$(window).width();$("#case-search-icon").show(),$(".popover-case-search-field").val(""),$(".case-cancel-search").hide(),$(".case-search-detail-list").html(""),$(".caseSearchResultFound").html(""),$(".case-search-count").hide(),savedCaseSearchedText=null,setTimeout(function(){$("input.popover-case-search-field").focus()},500)}function searchtoggleSM(){$("#case-search-icon-sm").hide(),$("#caseSearchTextboxSM").show(),$("#close-case-search-sm").show()}function closeSearchtoggleSM(){}var dragging=!1;function resize(e){e.preventDefault(),dragging=!0;var t=$(".case-excerpt-first-div"),a=$("<div>",{id:"ghostbar",css:{height:t.outerHeight(),top:t.offset().top,left:t.offset().left}}).appendTo("body");$(document).mousemove(function(e){a.css("left",e.pageX)}),$(document).mouseup(function(e){if(dragging){var t=e.pageX/window.innerWidth*100,a=100-t;$(".case-excerpt-first-div").css("width",t+"%"),$(".case-excerpt-second-div").css("width",a+"%"),$("#ghostbar").remove(),$(document).unbind("mousemove"),insideCasesPage&&$(window).trigger("resize"),dragging=!1}})}var globalSectionInfo="";function showCaseExcerpt(e){caseExcerptClicked=!0,localStorage.setItem("caseExcerptClicked","true"),localStorage.setItem("shareBriefClickedMobile","false"),shareBriefClickedMobile=!1;var t,a="";e&&(a=e.currentTarget.getAttribute("sectionName")),"firstDivSm"===a?t=$(".case-excerpt-md-wrapper").parents(".case-page-mobile-datablock"):"thirdDivSm"===a?t=$(".shared-brief-wrapper").parents(".case-page-mobile-datablock"):"secondDivSm"===a&&(t=$(".myBrief").parents(".case-page-mobile-datablock")),globalSectionInfo=a,$(".case-excerpt-first-div-sm").show(),$(".case-excerpt-second-div-sm").hide(),$(".case-excerpt-third-div-sm").hide(),t.hasClass("case-excerpt-first-div")?$("#case-excerpt-content-wrap").load("case-excerpt.html?v20169",function(){$("#select-case-page").hide(),$("#cases-heading-details").show(),$(".case-content-wrapper").show(),caseExcerptLeftTitle=$("h2.case-left-header").html(),$("#case-excerpt-content-wrap .case-excerpt-block").html(""),$("#case-excerpt-content-wrap .case-excerpt-sm-block").html(""),$("#case-excerpt-content-wrap .case-excerpt-md-note-container").html(""),$("#case-excerpt-content-wrap .case-excerpt-sm-note-container").html(""),$(".case-excerpt-first-div").hide(),$(".case-excerpt-second-div").hide(),$(".case-excerpt-third-div").hide(),$(".case-excerpt-md-wrapper").parents(".case-page-mobile-datablock").show(),$(".case-name-heading").html(casesSectionListOnLoad.sectionTitle),void 0!==casesSectionListOnLoad.sectionCitation&&"-999"!==casesSectionListOnLoad.sectionCitation&&$(".caseCitation").html(casesSectionListOnLoad.sectionCitation),$(".ereader-booktitle-mobile").html(CaseConnect.bookTitle),loadSectionListInCases(casesSectionListOnLoad),$(".case-excerpt-first-div-sm").show(),$(".case-excerpt-second-div-sm").hide(),$(".case-excerpt-third-div-sm").hide(),$(".case-excerpt-second-div").hide(),$(".case-excerpt-first-div").show(),updateHeadingDropdown(),$(window).trigger("resize"),loadImagesFromCDN()}):t.hasClass("case-excerpt-second-div")?$("#myBrief-content-wrap").load("case-excerpt.html?v20169",function(){$("#select-case-page").hide(),$("#cases-heading-details").show(),$(".case-content-wrapper").show(),caseExcerptRightTitle=$("h2.case-right-header").html(),$("#myBrief-content-wrap .case-excerpt-block").html(""),$("#myBrief-content-wrap .case-excerpt-sm-block").html(""),$("#myBrief-content-wrap .case-excerpt-md-note-container").html(""),$("#myBrief-content-wrap .case-excerpt-sm-note-container").html(""),$(".case-excerpt-first-div").hide(),$(".case-excerpt-second-div").hide(),$(".case-excerpt-third-div").hide();var e=$(".case-excerpt-md-wrapper").parents(".case-page-mobile-datablock").length;null!=e&&null!=e&&(1==e?($(".case-excerpt-first-div").hide(),$(".case-excerpt-second-div").hide(),$(".case-excerpt-third-div").hide(),$(".case-excerpt-md-wrapper").parents(".case-page-mobile-datablock").show()):e>1&&($(".case-excerpt-first-div").show(),$(".case-excerpt-second-div").hide())),$(".case-excerpt-md-wrapper").parents(".case-page-mobile-datablock").show(),$(".case-name-heading").html(casesSectionListOnLoad.sectionTitle),void 0!==casesSectionListOnLoad.sectionCitation&&"-999"!==casesSectionListOnLoad.sectionCitation&&$(".caseCitation").html(casesSectionListOnLoad.sectionCitation),$(".ereader-booktitle-mobile").html(CaseConnect.bookTitle),loadSectionListInCases(casesSectionListOnLoad),$(".case-excerpt-first-div-sm").show(),$(".case-excerpt-second-div-sm").hide(),$(".case-excerpt-third-div-sm").hide(),updateHeadingDropdown(),$(window).trigger("resize"),loadImagesFromCDN()}):t.hasClass("case-excerpt-third-div")&&$("#case-excerpt-third-div").load("case-excerpt.html?v20169",function(){$("#select-case-page").hide(),$("#cases-heading-details").show(),$(".case-content-wrapper").show(),caseExcerptRightTitle=$("h2.case-right-header").html(),$("#case-excerpt-third-div .case-excerpt-block").html(""),$("#case-excerpt-third-div .case-excerpt-sm-block").html(""),$("#case-excerpt-third-div .case-excerpt-md-note-container").html(""),$("#case-excerpt-third-div .case-excerpt-sm-note-container").html(""),$(".case-excerpt-first-div").hide(),$(".case-excerpt-second-div").hide(),$(".case-excerpt-third-div").hide(),$(".case-excerpt-md-wrapper").parents(".case-page-mobile-datablock").show(),$(".case-name-heading").html(casesSectionListOnLoad.sectionTitle),void 0!==casesSectionListOnLoad.sectionCitation&&"-999"!==casesSectionListOnLoad.sectionCitation&&$(".caseCitation").html(casesSectionListOnLoad.sectionCitation),$(".ereader-booktitle-mobile").html(CaseConnect.bookTitle),loadSectionListInCases(casesSectionListOnLoad),$(".case-excerpt-first-div-sm").show(),$(".case-excerpt-second-div-sm").hide(),$(".case-excerpt-third-div-sm").hide(),updateHeadingDropdown(),$(window).trigger("resize"),loadImagesFromCDN()})}function showCaseExcerptInDesktop(e){if(e){$("#page-loading-spinner").show(),checkIfCaseloaded=!0,checkDropValue=e.currentTarget.getAttribute("desktopDropCase");var t=e.currentTarget.innerHTML;"desktopDropCaseFromLeft"===checkDropValue&&$("#case-excerpt-content-wrap").load("case-excerpt.html?v20169",function(){$("#select-case-page").hide(),$("#cases-heading-details").show(),$(".case-content-wrapper").show(),$("h2.case-left-header").html(t),caseExcerptLeftTitle=$("h2.case-left-header").html(),$("h2.case-left-header").parent().attr("title",t),$("h2.case-left-header").parent().attr("aria-label",t),$("#case-excerpt-content-wrap .case-excerpt-block").html(""),$("#case-excerpt-content-wrap .case-excerpt-sm-block").html(""),$("#case-excerpt-content-wrap .case-excerpt-md-note-container").html(""),$("#case-excerpt-content-wrap .case-excerpt-sm-note-container").html(""),$(".case-name-heading").html(casesSectionListOnLoad.sectionTitle),updateHeadingDropdown(),void 0!==casesSectionListOnLoad.sectionCitation&&"-999"!==casesSectionListOnLoad.sectionCitation&&$(".caseCitation").html(casesSectionListOnLoad.sectionCitation),$(".ereader-booktitle-mobile").html(CaseConnect.bookTitle),loadSectionListInCases(casesSectionListOnLoad),$(window).trigger("resize"),loadImagesFromCDN()}),"desktopDropCaseFromRight"===checkDropValue&&$("#myBrief-content-wrap").load("case-excerpt.html?v20169",function(){$("#select-case-page").hide(),$("#cases-heading-details").show(),$(".case-content-wrapper").show(),$("h2.case-right-header").html(t),caseExcerptRightTitle=$("h2.case-right-header").html(),$("h2.case-right-header").parent().attr("title",t),$("h2.case-right-header").parent().attr("aria-label",t),$("#myBrief-content-wrap .case-excerpt-block").html(""),$("#myBrief-content-wrap .case-excerpt-sm-block").html(""),$("#myBrief-content-wrap .case-excerpt-md-note-container").html(""),$("#myBrief-content-wrap .case-excerpt-sm-note-container").html(""),$(".case-name-heading").html(casesSectionListOnLoad.sectionTitle),updateHeadingDropdown(),void 0!==casesSectionListOnLoad.sectionCitation&&"-999"!==casesSectionListOnLoad.sectionCitation&&$(".caseCitation").html(casesSectionListOnLoad.sectionCitation),$(".ereader-booktitle-mobile").html(CaseConnect.bookTitle),loadSectionListInCases(casesSectionListOnLoad),$(window).trigger("resize"),loadImagesFromCDN()}),caseExcerptLeftTitle=$("h2.case-left-header").html(),caseExcerptRightTitle=$("h2.case-right-header").html()}}function showBriefInDesktop(e){if(e){$("#page-loading-spinner").show(),checkIfBriefloaded=!0,checkDropValue=e.currentTarget.getAttribute("desktopDropBrief");var t=e.currentTarget.innerHTML;"desktopDropBriefFromLeft"===checkDropValue&&$("#case-excerpt-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),$("h2.case-left-header").html(t),caseExcerptLeftTitle=$("h2.case-left-header").html(),$("h2.case-left-header").parent().attr("title",t),$("h2.case-left-header").parent().attr("aria-label",t),updateHeadingDropdown(),$(window).trigger("resize")}),"desktopDropBriefFromRight"===checkDropValue&&$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),$("h2.case-right-header").html(t),caseExcerptRightTitle=$("h2.case-right-header").html(),$("h2.case-right-header").parent().attr("title",t),$("h2.case-right-header").parent().attr("aria-label",t),updateHeadingDropdown(),$(window).trigger("resize")}),caseExcerptLeftTitle=$("h2.case-left-header").html(),caseExcerptRightTitle=$("h2.case-right-header").html()}}function showSharedBriefInDesktop(e){$("#page-loading-spinner").show();var t=$(window).width();if(e){$("#page-loading-spinner").show(),checkIfShareBriefloaded=!0,checkDropValue=e.currentTarget.getAttribute("desktopDropShareBrief");var a=e.currentTarget.innerHTML;"desktopDropShareBriefFromLeft"===checkDropValue&&$("#case-excerpt-content-wrap").load("share-brief.html",function(){getShareBriefContentPage(),$("h2.case-left-header").html(a),caseExcerptLeftTitle=$("h2.case-left-header").html(),$("h2.case-left-header").parent().attr("title",a),$("h2.case-left-header").parent().attr("aria-label",a),t>992&&$(window).trigger("resize"),updateHeadingDropdown()}),"desktopDropShareBriefFromRight"===checkDropValue&&$("#myBrief-content-wrap").load("share-brief.html",function(){getShareBriefContentPage(),$("h2.case-right-header").html(a),caseExcerptRightTitle=$("h2.case-right-header").html(),$("h2.case-right-header").parent().attr("title",a),$("h2.case-right-header").parent().attr("aria-label",a),t>992&&$(window).trigger("resize"),updateHeadingDropdown()}),caseExcerptLeftTitle=$("h2.case-left-header").html(),caseExcerptRightTitle=$("h2.case-right-header").html()}}function updateHeadingDropdown(){var e,t=$(".case-content-desktop .case-excerpt-heading"),a=$(".case-content-desktop ul.dropdown-menu li a");$(".case-content-desktop ul.dropdown-menu li a").show(),$(t).each(function(){e=$(this).html();for(var t=0;t<a.length;t++)e===a[t].innerHTML&&(a[t].style.display="none")}),"My Brief"===caseExcerptLeftTitle||"My Brief"===caseExcerptRightTitle?$("a.glyphicon-cloud-download").css("display","inline-block"):($("a.glyphicon-cloud-download").css("display","none"),checkIfBriefloaded=!1),caseExcerptLeftTitle=$("h2.case-left-header").html(),caseExcerptRightTitle=$("h2.case-right-header").html()}function showCaseExcerptOnResize(){caseExcerptClicked=!0,localStorage.setItem("caseExcerptClicked","true"),localStorage.setItem("shareBriefClickedMobile","false"),shareBriefClickedMobile=!1;$(window).height();var e=$(window).width();if(currentHeading="",e<992&&"undefined"==typeof event){$(".case-excerpt-first-div-sm").show(),$(".case-excerpt-second-div-sm").hide(),$(".case-excerpt-third-div-sm").hide();var t=$(".case-excerpt-md-wrapper").parents(".case-page-mobile-datablock").length;null!=t&&null!=t&&(1==t?($(".case-excerpt-first-div").hide(),$(".case-excerpt-second-div").hide(),$(".case-excerpt-third-div").hide(),$(".case-excerpt-md-wrapper").parents(".case-page-mobile-datablock").show()):t>1&&($(".case-excerpt-first-div").show(),$(".case-excerpt-second-div").hide()))}if(e>992&&("Case Text"===caseExcerptLeftTitle||"Case Text"===caseExcerptRightTitle)&&("My Brief"!==caseExcerptLeftTitle&&"My Brief"!==caseExcerptRightTitle||("My Brief"===caseExcerptRightTitle?($(".case-excerpt-first-div-sm").hide(),$(".case-excerpt-first-div").hide(),$(".case-excerpt-second-div-sm").show(),$(".case-excerpt-third-div-sm").hide(),$(".case-excerpt-second-div").show()):"My Brief"===caseExcerptLeftTitle&&($(".case-excerpt-second-div").hide(),$(".case-excerpt-second-div-sm").hide(),$(".case-excerpt-third-div-sm").hide(),$(".case-excerpt-first-div").show(),$(".case-excerpt-first-div-sm").show())),caseExcerptLeftTitle=$("h2.case-left-header").html(),caseExcerptRightTitle=$("h2.case-right-header").html()),e<992&&("Case Text"===caseExcerptLeftTitle||"Case Text"===caseExcerptRightTitle)){$(".case-excerpt-second-div-sm").hide(),$(".case-excerpt-third-div-sm").hide(),$(".case-excerpt-first-div-sm").show();var a=$(".case-excerpt-md-wrapper").parents(".case-page-mobile-datablock").length;null!=a&&null!=a&&(1==a?($(".case-excerpt-first-div").hide(),$(".case-excerpt-second-div").hide(),$(".case-excerpt-third-div").hide(),$(".case-excerpt-md-wrapper").parents(".case-page-mobile-datablock").show()):a>1&&($(".case-excerpt-first-div").show(),$(".case-excerpt-second-div").hide()))}}function showBrief(e){var t="";e&&(t=e.currentTarget.getAttribute("sectionName")),localStorage.setItem("caseExcerptClicked","false"),caseExcerptClicked=!1,localStorage.setItem("shareBriefClickedMobile","false"),shareBriefClickedMobile=!1;$(window).height();var a,i=$(window).width();i<992&&void 0===e?($(".case-excerpt-second-div-sm").show(),$(".case-excerpt-first-div-sm").hide(),$(".case-excerpt-first-div").hide(),$(".case-excerpt-third-div-sm").hide(),$(".case-excerpt-second-div").hide(),$(".case-excerpt-third-div").hide(),""!==checkDropValue&&null!==checkDropValue||"Shared Brief"===caseExcerptRightTitle&&"My Brief"===caseExcerptLeftTitle||("My Brief"===caseExcerptLeftTitle?$(".case-excerpt-second-div").hide():$(".case-excerpt-second-div").show()),$(".myBrief").parents(".case-page-mobile-datablock").show(),$(".case-excerpt-md-wrapper").parents(".case-page-mobile-datablock").hide()):i>992&&("My Brief"!==caseExcerptLeftTitle&&"My Brief"!==caseExcerptRightTitle||$(".myBrief").parents(".case-page-mobile-datablock").show(),caseExcerptLeftTitle=$("h2.case-left-header").html(),caseExcerptRightTitle=$("h2.case-right-header").html()),""!==t&&e&&($("#page-loading-spinner").show(),"firstDivSm"===t?a=$(".case-excerpt-md-wrapper").parents(".case-page-mobile-datablock"):"thirdDivSm"===t?a=$(".shared-brief-wrapper").parents(".case-page-mobile-datablock"):"secondDivSm"===t&&(a=$(".myBrief").parents(".case-page-mobile-datablock")),a.hasClass("case-excerpt-first-div")?$("#case-excerpt-content-wrap").load("my-brief.html",function(){$(".myBrief").parents(".case-page-mobile-datablock").show(),$(".case-excerpt-second-div").hide(),getMyBriefContentInCasesPage(),updateHeadingDropdown(),i>992&&$(window).trigger("resize")}):a.hasClass("case-excerpt-second-div")?$("#myBrief-content-wrap").load("my-brief.html",function(){$(".myBrief").parents(".case-page-mobile-datablock").show(),getMyBriefContentInCasesPage(),updateHeadingDropdown(),i>992&&$(window).trigger("resize")}):a.hasClass("case-excerpt-third-div")&&$("#case-excerpt-third-div").load("my-brief.html",function(){$(".myBrief").parents(".case-page-mobile-datablock").show(),getMyBriefContentInCasesPage(),updateHeadingDropdown(),i>992&&$(window).trigger("resize")}),$(".case-excerpt-second-div-sm").show(),$(".case-excerpt-first-div-sm").hide(),$(".case-excerpt-third-div-sm").hide())}function showCasesInDesktop(){caseExcerptClicked=!1,localStorage.setItem("caseExcerptClicked","false"),localStorage.setItem("shareBriefClickedMobile","false"),shareBriefClickedMobile=!1,$(".case-excerpt-first-div").show(),$(".case-excerpt-second-div").show(),$(".case-excerpt-first-div").find("div.shared-brief-wrapper").length;var e=$(".case-excerpt-first-div"),t=$(".case-excerpt-second-div");0!==e.find("div.myBrief").length?($("h2.case-left-header").html("My Brief"),updateHeadingDropdown()):0!==e.find("div.shared-brief-wrapper").length?($("h2.case-left-header").html("Shared Brief"),updateHeadingDropdown()):0!==e.find("div.case-excerpt-md-wrapper").length&&($("h2.case-left-header").html("Case Text"),updateHeadingDropdown()),0!==t.find("div.myBrief").length?($("h2.case-right-header").html("My Brief"),updateHeadingDropdown()):0!==t.find("div.shared-brief-wrapper").length?($("h2.case-right-header").html("Shared Brief"),"true"==casemenuOrigin&&($("h2.case-right-header").html("My Brief"),$("#myBrief-content-wrap").html(""),$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),caseExcerptRightTitle=$("h2.case-right-header").html(),$("h2.case-right-header").parent().attr("title",caseExcerptRightTitle),$("h2.case-right-header").parent().attr("aria-label",caseExcerptRightTitle),updateHeadingDropdown(),casemenuOrigin="false",windowWidth>992&&$(window).trigger("resize")})),updateHeadingDropdown()):0!==t.find("div.case-excerpt-md-wrapper").length&&($("h2.case-right-header").html("Case Text"),updateHeadingDropdown()),""!==caseExcerptRightTitle&&caseExcerptRightTitle===caseExcerptLeftTitle&&($("#case-excerpt-content-wrap").html(""),$("#myBrief-content-wrap").html(""),$("#case-excerpt-content-wrap").load("case-excerpt.html?v20169",function(){$("#select-case-page").hide(),$("#cases-heading-details").show(),$(".case-content-wrapper").show(),$(".case-excerpt-block").html(""),$(".case-excerpt-sm-block").html(""),$(".case-excerpt-md-note-container").html(""),$(".case-excerpt-sm-note-container").html(""),$(".ereader-booktitle-mobile").html(CaseConnect.bookTitle),loadSectionListInCases(casesSectionListOnLoad),updateHeadingDropdown(),windowWidth>992&&$(window).trigger("resize"),loadImagesFromCDN()}),$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),caseExcerptRightTitle=$("h2.case-right-header").html(),$("h2.case-right-header").parent().attr("title",caseExcerptRightTitle),$("h2.case-right-header").parent().attr("aria-label",caseExcerptRightTitle),updateHeadingDropdown(),windowWidth>992&&$(window).trigger("resize")}))}function showShareBriefMobile(e){var t="";e&&(t=e.currentTarget.getAttribute("sectionName")),localStorage.setItem("caseExcerptClicked","false"),caseExcerptClicked=!1,localStorage.setItem("shareBriefClickedMobile","true"),shareBriefClickedMobile=!0;$(window).height();var a,i=$(window).width();i<992&&void 0===e&&($(".case-excerpt-first-div-sm").hide(),$(".case-excerpt-first-div").hide(),$(".case-excerpt-second-div-sm").hide(),$(".case-excerpt-second-div").hide(),$(".case-excerpt-third-div-sm").show(),$("#case-excerpt-third-div").show(),$("#case-excerpt-third-div").parents(".case-page-mobile-datablock").show()),$(".case-excerpt-first-div-sm").hide(),$(".case-excerpt-second-div-sm").hide(),$(".case-excerpt-third-div-sm").show(),""!==t&&e&&($("#page-loading-spinner").show(),"firstDivSm"===t?a=$(".case-excerpt-md-wrapper").parents(".case-page-mobile-datablock"):"thirdDivSm"===t?a=$(".shared-brief-wrapper").parents(".case-page-mobile-datablock"):"secondDivSm"===t&&(a=$(".myBrief").parents(".case-page-mobile-datablock")),a.hasClass("case-excerpt-first-div")?$("#case-excerpt-content-wrap").load("share-brief.html",function(){$(".shared-brief-wrapper").parents(".case-page-mobile-datablock").show(),getShareBriefContentPage(),updateHeadingDropdown(),i>992&&$(window).trigger("resize")}):a.hasClass("case-excerpt-second-div")?$("#myBrief-content-wrap").load("share-brief.html",function(){$("#case-excerpt-third-div").parents(".case-page-mobile-datablock").show(),getShareBriefContentPage(),i>992&&$(window).trigger("resize"),updateHeadingDropdown()}):a.hasClass("case-excerpt-third-div")&&$("#case-excerpt-third-div").load("share-brief.html",function(){$("#case-excerpt-third-div").parents(".case-page-mobile-datablock").show(),getShareBriefContentPage(),i>992&&$(window).trigger("resize"),updateHeadingDropdown()}),adjustLeftNavHeight())}function migrateChapterHighlightsSingle(){if(insidePrincipalCase&&addedBriefFromAnnotation){if(void 0!==$("textarea#add-brief-textarea")[1])var e=$("textarea#add-brief-textarea")[1].value;var t="";if($(".color-btns").hasClass("selectedColor")){for(var a=$(".color-btns"),i=0;i<a.length;i++)if($("#"+a[i].id).hasClass("selectedColor")){t=$("#"+$(".color-btns")[i].id).attr("colorcode"),$("input#add-brief-label-box")[1].setAttribute("selectedColor",t);break}}else if(""==t&&(""!==colorCodeInput?t=colorCodeInput:""!==selectedHighlightColor&&(t=selectedHighlightColor),""!==t)){convertRGBToHex(t);for(var o=0;o<CaseConnect.preSetBriefLabelList.length;o++)CaseConnect.preSetBriefLabelList[o].colorCode===t&&(void 0!==CaseConnect.preSetBriefLabelList[o].labelName?$("input#add-brief-label-box")[1].value=CaseConnect.preSetBriefLabelList[o].labelName.replace(/&lt;/g,"<").replace(/&gt;/g,">"):$("input#add-brief-label-box")[1].value="")}if(void 0!==$("input#add-brief-label-box")[1])var r=$("input#add-brief-label-box")[1].value;updatingBrief=!1,addingBrief=!1,alreadyCalled=!1,addedBriefFromAnnotation=!1;for(var n="",s=0;s<globalChapterAnnotationList.length;s++)if(globalChapterAnnotationList[s].annotationId===selectedNoteId){n=globalChapterAnnotationList[s].highlightText;break}briefParaStartOffset=parseInt($("#"+selectedNoteId).attr("highlightparastartoffset")),briefParaEndOffset=parseInt($("#"+selectedNoteId).attr("highlightparaendoffset")),briefStartOffsetAtSectionLevel=$("#"+selectedNoteId).attr("startoffset"),briefEndOffsetAtSectionLevel=$("#"+selectedNoteId).attr("endoffset"),briefStartParaId=$("#"+selectedNoteId).attr("highlightstartparaid"),briefEndParaId=$("#"+selectedNoteId).attr("highlightendparaid");var l,c=$("#"+selectedNoteId).attr("enclosingparaidstring");l=convertEnclosingParaStringIdToEnclosingParaArray(c);var d=selectedNoteId;if(-1!==selectedNoteId.indexOf("_")&&(d=selectedNoteId.substring(0,selectedNoteId.indexOf("_"))),$("textarea#add-brief-textarea")[1]&&$("input#add-brief-label-box")[1])if("visible"===$(".save-brief-icon").css("visibility")){$("#page-loading-spinner").show();var g={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:CaseConnect.lastViewedOutlineId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},annotationVO:{annotationId:d,dppContentId:d,enclosingParaList:l,highlightColorCode:t,highlightEndOffset:briefEndOffsetAtSectionLevel,highlightEndParaId:briefEndParaId,highlightParaEndOffset:briefParaEndOffset,highlightParaStartOffset:briefParaStartOffset,highlightStartOffset:briefStartOffsetAtSectionLevel,highlightStartParaId:briefStartParaId,noteText:e,highlightText:n,sectionId:annotationSectionId,labelName:r,bookId:CaseConnect.currentBookId,chapterId:CaseConnect.currentChapterId,chapterTitle:CaseConnect.chapterTitle}};insideEreader?(g.userVO.userActivityVO.lastActivityCode="EREADER_ANNOTATION_DELETE_HIGHLIGHT",g.userVO.userActivityVO.pageNavigatingFrom="EReader",g.userVO.userActivityVO.pageNavigatingTo="EReader"):(g.userVO.userActivityVO.lastActivityCode="CASE_PAGE",g.userVO.userActivityVO.pageNavigatingFrom="CASES",g.userVO.userActivityVO.pageNavigatingTo="CASES"),$.ajax({url:properties[properties.env]+"/manageCases/migrateChapterHighlights",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(g)}).then(function(a){var i;if(void 0!==a.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",a.sessionAuthenticationToken),1===l.length?i=0:l.length>1&&(i=l.length),a.briefVO&&(dppAnotationId=a.briefVO.annotationId,selectedNoteId=a.briefVO.annotationId,$("#"+selectedNoteId).popover("hide")),0===i){var o=document.getElementById(selectedNoteId);briefSpanId=0,(s=document.createElement("briefsTag")).innerHTML=o.innerHTML,s.id=selectedNoteId,s.className="briefElementText",s.setAttribute("data-references","popover"),s.setAttribute("data-toggle","popover"),s.setAttribute("tabindex","0"),s.setAttribute("data-original-title",""),s.setAttribute("briefStartOffset",briefStartOffsetAtSectionLevel),s.setAttribute("briefEndOffset",briefEndOffsetAtSectionLevel),s.setAttribute("briefParaStartOffset",briefParaStartOffset),s.setAttribute("briefParaEndOffset",briefParaEndOffset),s.setAttribute("enclosingParaIdString",c),s.setAttribute("briefStartParaId",briefStartParaId),s.setAttribute("briefEndParaId",briefEndParaId),s.setAttribute("briefLabelName",r),s.setAttribute("briefNote",e),s.normalize(),o.parentNode.replaceChild(s,o),s.setAttribute("style","background-color:"+t+"!important")}else if(i>0)for(var n=0;n<i;n++){selectedNoteId="note"+n;var s;o=document.getElementById(selectedNoteId);(s=document.createElement("briefsTag")).innerHTML=o.innerHTML,s.id=selectedNoteId,s.className="briefElementText",s.setAttribute("data-references","popover"),s.setAttribute("data-toggle","popover"),s.setAttribute("tabindex","0"),s.setAttribute("data-original-title",""),s.setAttribute("briefStartOffset",briefStartOffsetAtSectionLevel),s.setAttribute("briefEndOffset",briefEndOffsetAtSectionLevel),s.setAttribute("briefParaStartOffset",briefParaStartOffset),s.setAttribute("briefParaEndOffset",briefParaEndOffset),s.setAttribute("enclosingParaIdString",c),s.setAttribute("briefStartParaId",briefStartParaId),s.setAttribute("briefEndParaId",briefEndParaId),s.setAttribute("briefLabelName",r),s.setAttribute("briefNote",e),s.normalize(),o.parentNode.replaceChild(s,o),s.setAttribute("style","background-color:"+t+"!important")}if(a.briefVO){if(dppAnotationId=a.briefVO.annotationId,selectedNoteId=a.briefVO.annotationId,highLightSpanId=0,0===i)document.getElementById(dppAnotationId).setAttribute("onClick","briefTextClicked()"),document.getElementById(dppAnotationId).addEventListener("keyup",briefTextClicked),document.getElementById(dppAnotationId).setAttribute("startOffset",briefStartOffsetAtSectionLevel),document.getElementById(dppAnotationId).setAttribute("endOffset",briefEndOffsetAtSectionLevel);else if(i>0)for(n=0;n<i;n++)0===n?(document.getElementById("note"+n).id=dppAnotationId,document.getElementById(dppAnotationId).setAttribute("onClick","briefTextClicked()"),document.getElementById(dppAnotationId).addEventListener("keyup",briefTextClicked),document.getElementById(dppAnotationId).setAttribute("startOffset",briefStartOffsetAtSectionLevel),document.getElementById(dppAnotationId).setAttribute("endOffset",briefEndOffsetVal)):(document.getElementById("note"+n).id=dppAnotationId+"_"+[n],document.getElementById(dppAnotationId+"_"+[n]).setAttribute("onClick","briefTextClicked()"),document.getElementById(dppAnotationId).addEventListener("keyup",briefTextClicked),document.getElementById(dppAnotationId+"_"+[n]).setAttribute("startOffset",briefStartOffsetVal),document.getElementById(dppAnotationId+"_"+[n]).setAttribute("endOffset",briefEndOffsetAtSectionLevel));selectedNoteId=dppAnotationId}selectedHighlightColor=t,yValue=document.getElementById(selectedNoteId).getBoundingClientRect().top,selectedHighlightColor||(selectedHighlightColor=document.getElementById(selectedNoteId).style.backgroundColor);for(var d=$(".notesText"),g=0;g<d.length;g++)if(d[g].id.substring(8,d[g].id.length)===selectedNoteId){d[g].parentNode.removeChild(d[g]);break}var p=$(".notesSpanBlock");for(g=0;g<p.length;g++)if(p[g].id===selectedNoteId){p[g].parentNode.removeChild(p[g]);break}if($(".color-btns").hasClass("selectedColor")&&void 0!==$("button#color-blank-notes")[1]&&$("button#color-blank-notes")[1].attr("disabled","true"),updatingBrief=!1,""===r&&""===e||(displayBriefOnRight(selectedNoteId,selectedHighlightColor,yValue,r,e),setTimeout(function(){checkBriefOverNoteForOverlap()},800)),$("#"+selectedNoteId).popover("hide"),$("#"+selectedNoteId).focus(),$("#page-loading-spinner").show(),insideCasesPage){var h=$(window).width();""!==checkDropValue&&checkIfBriefloaded?"My Brief"===caseExcerptRightTitle&&"Case Text"===caseExcerptLeftTitle?getMyBriefContentInCasesPage():"Case Text"===caseExcerptRightTitle&&"My Brief"===caseExcerptLeftTitle?getMyBriefContentInCasesPage():$("#page-loading-spinner").hide():null==checkDropValue||""===checkDropValue?"My Brief"===caseExcerptRightTitle&&"Case Text"===caseExcerptLeftTitle?h>991?$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),$(window).trigger("resize")}):h<992&&!caseExcerptClicked?$("#myBrief-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage()}):$("#page-loading-spinner").hide():"Case Text"===caseExcerptRightTitle&&"My Brief"===caseExcerptLeftTitle?h>991?$("#case-excerpt-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage(),$(window).trigger("resize")}):h<992&&!caseExcerptClicked?$("#case-excerpt-content-wrap").load("my-brief.html",function(){getMyBriefContentInCasesPage()}):$("#page-loading-spinner").hide():$("#page-loading-spinner").hide():$("#page-loading-spinner").hide()}else $("#page-loading-spinner").hide();alreadyCalled=!1,sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),updatingBrief=!1,closePopover(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain,alreadyCalled=!1})}else $("#"+selectedNoteId).popover("hide"),updatingBrief=!1,alreadyCalled=!1}}function getMyBriefContentInCasesPage(){$("#page-loading-spinner").show(),$(".myBrief").html("");var e={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"CASE_PAGE",pageNavigatingFrom:"CASES",pageNavigatingTo:"CASES",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:casesSectionListOnLoad.chapterId,lastReadSectionId:casesSectionListOnLoad.sectionId,lastReadSubSectionId:"",lastReadParagraphId:"",lastViewedOutlineId:""},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},briefVO:{bookId:CaseConnect.currentBookId,chapterId:casesSectionListOnLoad.chapterId,sectionId:casesSectionListOnLoad.sectionId}};$.ajax({url:properties[properties.env]+"/manageCases/getMyBriefContent",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(e)}).then(function(e){if(void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),"true"===e.status){if(null!=e.hasPCaseAnnotation&&null!=e.hasPCaseAnnotation&&("true"==e.hasPCaseAnnotation?CaseConnect.hasPCaseAnnotation="true":CaseConnect.hasPCaseAnnotation="false"),$(".myBrief").html(""),checkDropValue=null,void 0!==e.labelVOList){$(".brief-default-msg-block").hide(),$(".brief-default-content").hide();var t=e.labelVOList;e.labelVOList?(CaseConnect.preSetBriefLabelList=e.labelVOList,loadDataListInPopover()):(CaseConnect.preSetBriefLabelList="",loadDataListInPopover());for(var a=!0,i=0;i<t.length;i++)if(a){if(!(void 0===t[i].labelName&&void 0===t[i].briefVOList&&void 0===t[i].customBriefVOList&&""===t[i].labelName||""===t[i].labelName&&void 0===t[i].briefVOList&&void 0===t[i].customBriefVOList&&""===t[i].labelName)){a=!1;break}a=!0}if(a)return $(".myBrief").html('<div class="brief-default-msg-block"><span class="brief-default-content" placeholder="" >Get started with your case briefs by creating your</span><a href="#" class="my-brief-settings-link" onclick="fetchDataForBriefModal();" aria-label="brief-settings" > brief settings.</a></div>'),void $("#page-loading-spinner").hide();for(var o="",r=0;r<t.length;r++){var n="",s="",l="";if(void 0!==t[r].customBriefVOList&&void 0!==t[r].customBriefVOList.customNoteText){t[r].customBriefVOList;n=t[r].customBriefVOList.annotationId,s=t[r].customBriefVOList.sectionId,l=t[r].customBriefVOList.customNoteText.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/' '/g,"&nbsp;").replace(/"/g,"&ldquo;").replace(/"/g,"&rdquo;").replace(/'/g,"&lsquo;").replace(/'/g,"&rsquo;").replace(/&/g,"&amp;")}if(void 0!==t[r].labelName&&void 0===t[r].briefVOList&&""!==t[r].labelName)o='<div class="my-brief-block" colorCode="'+t[r].colorCode+'"><h2 class="brief-label-title" tabindex="0">'+t[r].labelName+'</h2><textarea id="brief-textarea_'+[r]+'" tabindex="0" colorCode="'+t[r].colorCode+'" customAnnotationId="'+n+'" customBriefSectionId="'+s+'" class="brief-edit-textarea" value="'+l+'" onblur="saveCustomBrief(this,event);" onfocus="editableBriefTextarea(this);" oninput="autoExpandHeight(event);">'+l+"</textarea></div>",$(".myBrief").append(o);else if(void 0!==t[r].labelName&&void 0!==t[r].briefVOList&&""!==t[r].labelName){o='<div class="my-brief-block" colorCode="'+t[r].colorCode+'"><h2 class="brief-label-title" tabindex="0">'+t[r].labelName+'</h2><div class="brief-content-detail" id="brief-content-detail_'+[r]+'"></div><textarea id="brief-textarea_'+[r]+'" colorCode="'+t[r].colorCode+'" customAnnotationId="'+n+'" customBriefSectionId="'+s+'" tabindex="0" value="'+l+'" class="brief-edit-textarea" onblur="saveCustomBrief(this,event);" onfocus="editableBriefTextarea(this);" oninput="autoExpandHeight(event);">'+l+" </textarea></div>",$(".myBrief").append(o);var c=t[r].briefVOList;"object"==$.type(c)&&(c=[c]);for(var d=0;d<c.length;d++){var g="";void 0!==c[d].annotationId&&(void 0!==c[d].highlightText&&(g='<div onmouseover="focusBriefText(this);" tabindex="0" onfocus="focusBriefText(this);" onmouseout="blurBriefText(this);" class="my-brief-text-wrapper col-md-12 no-padding" id="highlight_'+c[d].annotationId+'" onclick="scrollInCaseExcerpt(this);"><p class="my-brief-highlighted-text display-inline-block col-md-11 no-padding" tabindex="0" onfocus="focusBriefText(this);"><i>'+c[d].highlightText+'</i></p><span aria-label="Remove from brief" tabindex="0" onblur="blurBriefTextSpan(this);" class="pull-right glyphicon glyphicon-minus-sign col-md-1 brief-delete-elem" style="display:none;" title="Remove from brief" annotationId="'+c[d].annotationId+'" onclick="removeMyBriefHighlight(this,event);" onkeyup="removeMyBriefHighlight(this,event);"></span></div>',$("#brief-content-detail_"+r).append(g)),void 0!==c[d].noteText&&(g='<div onmouseover="focusBriefText(this);" tabindex="0" onfocus="focusBriefText(this);" onmouseout="blurBriefText(this);" class="my-brief-text-wrapper col-md-12 no-padding"  id="note_'+c[d].annotationId+'" onclick="scrollInCaseExcerpt(this);"><p class="my-brief-note-text display-inline-block col-md-11 no-padding" tabindex="0" onfocus="focusBriefText(this);">'+c[d].noteText.replace(/</g," &lt; ").replace(/>/g," &gt; ")+'</p><span aria-label="Remove from brief" title="Remove from brief" onblur="blurBriefTextSpan(this);" tabindex="0" class="pull-right glyphicon glyphicon-minus-sign col-md-1 brief-delete-elem" style="display:none;" annotationId="'+c[d].annotationId+'" onclick="removeMyBriefNote(this,event);" onkeyup="removeMyBriefNote(this,event);"></span></div>',$("#brief-content-detail_"+r).append(g)))}}else if(void 0===t[r].labelName&&void 0!==t[r].briefVOList){o='<div class="my-brief-block" colorCode="'+t[r].colorCode+'"><div class="brief-content-detail" id="brief-content-detail_'+[r]+'"></div><textarea id="brief-textarea_'+[r]+'" tabindex="0" colorCode="'+t[r].colorCode+'" customAnnotationId="'+n+'" customBriefSectionId="'+s+'" value="'+l+'" class="brief-edit-textarea" onblur="saveCustomBrief(this,event);" onfocus="editableBriefTextarea(this);" oninput="autoExpandHeight(event);">'+l+" </textarea></div>",$(".myBrief").append(o);c=t[r].briefVOList;"object"==$.type(c)&&(c=[c]);for(d=0;d<c.length;d++){g="";void 0!==c[d].annotationId&&(void 0!==c[d].highlightText&&(g='<div onmouseover="focusBriefText(this);" tabindex="0" onmouseout="blurBriefText(this);" onfocus="focusBriefText(this);" onclick="scrollInCaseExcerpt(this);" class="my-brief-text-wrapper col-md-12 no-padding"  id="highlight_'+c[d].annotationId+'"><p class="my-brief-highlighted-text display-inline-block col-md-11 no-padding" tabindex="0" onfocus="focusBriefText(this);"><i>'+c[d].highlightText+'</i></p><span aria-label="remove from brief" class="pull-right glyphicon glyphicon-minus-sign col-md-1 brief-delete-elem" style="display:none;" onblur="blurBriefTextSpan(this);" tabindex="0" title="Remove from brief" annotationId="'+c[d].annotationId+'" onclick="removeMyBriefHighlight(this,event);" onkeyup="removeMyBriefHighlight(this,event);"></span></div>',$("#brief-content-detail_"+r).append(g)),void 0!==c[d].noteText&&(g='<div onmouseover="focusBriefText(this);" tabindex="0" onmouseout="blurBriefText(this);" onfocus="focusBriefText(this);" class="my-brief-text-wrapper col-md-12 no-padding" id="note_'+c[d].annotationId+'" onclick="scrollInCaseExcerpt(this);"><p class="my-brief-note-text display-inline-block col-md-11 no-padding" tabindex="0" onfocus="focusBriefText(this);">'+c[d].noteText.replace(/</g," &lt; ").replace(/>/g," &gt; ")+'</p><span aria-label="remove from brief" title="Remove from brief"  onblur="blurBriefTextSpan(this);" tabindex="0" class="pull-right glyphicon glyphicon-minus-sign col-md-1 brief-delete-elem" style="display:none;" annotationId="'+c[d].annotationId+'" onclick="removeMyBriefNote(this,event);" onkeyup="removeMyBriefNote(this,event);"></span></div>',$("#brief-content-detail_"+r).append(g)))}}else if(void 0!==t[r].labelName&&void 0!==t[r].briefVOList&&""==t[r].labelName){o='<div class="my-brief-block" colorCode="'+t[r].colorCode+'"><div class="brief-content-detail " id="brief-content-detail_'+[r]+'"></div><textarea id="brief-textarea_'+[r]+'" tabindex="0" colorCode="'+t[r].colorCode+'" customAnnotationId="'+n+'" customBriefSectionId="'+s+'" value="'+l+'" class="brief-edit-textarea" onblur="saveCustomBrief(this,event);" onfocus="editableBriefTextarea(this);" oninput="autoExpandHeight(event);">'+l+" </textarea></div>",$(".myBrief").append(o);c=t[r].briefVOList;"object"==$.type(c)&&(c=[c]);for(d=0;d<c.length;d++){g="";void 0!==c[d].annotationId&&(void 0!==c[d].highlightText&&(g='<div onmouseover="focusBriefText(this);" tabindex="0" onmouseout="blurBriefText(this);" onfocus="focusBriefText(this);" class="my-brief-text-wrapper col-md-12 no-padding" id="highlight_'+c[d].annotationId+'" onclick="scrollInCaseExcerpt(this);"><p class="my-brief-highlighted-text display-inline-block col-md-11 no-padding" tabindex="0" onfocus="focusBriefText(this);"><i>'+c[d].highlightText+'</i></p><span aria-label="remove from brief" onblur="blurBriefTextSpan(this);" tabindex="0" class="pull-right glyphicon glyphicon-minus-sign col-md-1 brief-delete-elem" style="display:none;" annotationId="'+c[d].annotationId+'" title="Remove from brief" onclick="removeMyBriefHighlight(this,event);" onkeyup="removeMyBriefHighlight(this,event);"></span></div>',$("#brief-content-detail_"+r).append(g)),void 0!==c[d].noteText&&(g='<div onmouseover="focusBriefText(this);" tabindex="0" onmouseout="blurBriefText(this);" onfocus="focusBriefText(this);" class="my-brief-text-wrapper col-md-12 no-padding" id="note_'+c[d].annotationId+'" onclick="scrollInCaseExcerpt(this);"><p class="my-brief-note-text display-inline-block col-md-11 no-padding" tabindex="0" onfocus="focusBriefText(this);">'+c[d].noteText.replace(/</g," &lt; ").replace(/>/g," &gt; ")+'</p><span aria-label="remove from brief" title="Remove from brief"  onblur="blurBriefTextSpan(this);"tabindex="0" class="pull-right glyphicon glyphicon-minus-sign col-md-1 brief-delete-elem" style="display:none;" annotationId="'+c[d].annotationId+'" onclick="removeMyBriefNote(this,event);" onkeyup="removeMyBriefNote(this,event);"></span></div>',$("#brief-content-detail_"+r).append(g)))}}else void 0!==t[r].labelName&&void 0===t[r].briefVOList&&""==t[r].labelName&void 0!==t[r].customBriefVOList?(o='<div class="my-brief-block" colorCode="'+t[r].colorCode+'"><div class="brief-content-detail " id="brief-content-detail_'+[r]+'"></div><textarea id="brief-textarea_'+[r]+'" tabindex="0" colorCode="'+t[r].colorCode+'" customAnnotationId="'+n+'" customBriefSectionId="'+s+'" value="'+l+'" class="brief-edit-textarea" onblur="saveCustomBrief(this,event);" onfocus="editableBriefTextarea(this);" oninput="autoExpandHeight(event);">'+l+" </textarea></div>",$(".myBrief").append(o)):void 0!==t[r].labelName&&void 0===t[r].briefVOList&&""!==t[r].labelName&&(o="")}var p=$(".my-brief-block .brief-edit-textarea");for(r=0;r<p.length;r++)p[r].textContent=p[r].textContent.replace(/&nbsp;/g," ").replace(/&ldquo;/g,'"').replace(/&rdquo;/g,'"').replace(/&lsquo;/g,"'").replace(/&rsquo;/g,"'").replace(/&sect;/g,"??").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">"),p[r].setAttribute("value",p[r].getAttribute("value").replace(/&nbsp;/g," ").replace(/&ldquo;/g,'"').replace(/&rdquo;/g,'"').replace(/&lsquo;/g,"'").replace(/&rsquo;/g,"'").replace(/&sect;/g,"??").replace(/&amp;/g,"&"));var h=$(".my-brief-block");if(""!==colorMarkerList)for(var u=0;u<colorMarkerList.length;u++)$(h).each(function(){$(this).attr("colorCode").trim()===colorMarkerList[u].colorCode&&("label-yellow"==colorMarkerList[u].colorMarker?$(this).addClass("trydiv-yellow"):"label-green"==colorMarkerList[u].colorMarker?$(this).addClass("trydiv-green"):"label-blue"==colorMarkerList[u].colorMarker?$(this).addClass("trydiv-blue"):"label-pink"==colorMarkerList[u].colorMarker?$(this).addClass("trydiv-pink"):"label-orange"==colorMarkerList[u].colorMarker?$(this).addClass("trydiv-orange"):"label-purple"==colorMarkerList[u].colorMarker&&$(this).addClass("trydiv-purple"))});$("#page-loading-spinner").hide()}else $(".myBrief").html('<div class="brief-default-msg-block"><span class="brief-default-content" placeholder="" >Get started with your case briefs by creating your</span><a href="#" class="my-brief-settings-link" onclick="fetchDataForBriefModal();" aria-label="brief-settings" > brief settings.</a></div>'),$("#page-loading-spinner").hide();$(window).trigger("resize")}else $("#page-loading-spinner").hide();sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function editableBriefTextarea(e){customBriefModified=!0,$(".brief-edit-textarea").removeClass("autoAdjustHeight"),$(e).addClass("autoAdjustHeight"),$(e).removeAttr("disabled")}function exportMyBriefCalled(){$("#page-loading-spinner").show(),callExportMyBrief=!0,"undefined"!=typeof elem?saveCustomBrief(elem,event):callExportMyBrief&&($("#brief-export-delay-window").modal("show"),getMyBriefContentExport(),callExportMyBrief=!1)}function saveCustomBrief(e,t){var a=$(e).attr("customAnnotationId"),i=$(e).attr("colorCode"),o=$(e).val(),r=$(e).attr("id");""===a&&customBriefModified?(customBriefModified=!1,addCustomNoteForMyBrief(i,o,r)):""!==a&&customBriefModified?(customBriefModified=!1,updateCustomNoteForMyBrief(a,i,o,r)):callExportMyBrief&&($("#page-loading-spinner").show(),getMyBriefContentExport(),callExportMyBrief=!1)}function focusBriefText(e){$(e).find(".brief-delete-elem").show(),0===$(e).find(".brief-delete-elem").length&&$(e).parent.find(".brief-delete-elem").show()}function blurBriefText(e){$(e).find(".brief-delete-elem").hide(),0===$(e).find(".brief-delete-elem").length&&$(e).parent.find(".brief-delete-elem").hide()}function blurBriefTextSpan(e){$(e).hide()}function addCustomNoteForMyBrief(e,t,a){$("#page-loading-spinner").show();var i={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"CASE_PAGE",pageNavigatingFrom:"CASES",pageNavigatingTo:"CASES",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:casesSectionListOnLoad.chapterId,lastReadSectionId:casesSectionListOnLoad.sectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:""},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},briefVO:{bookId:CaseConnect.currentBookId,chapterId:casesSectionListOnLoad.chapterId,chapterTitle:"-999",sectionId:casesSectionListOnLoad.sectionId,sectionTitle:casesSectionListOnLoad.sectionTitle,pageNumber:"-999",highlightStartOffset:-999,highlightEndOffset:-999,highlightText:"-999",highlightStartParaId:"-999",highlightEndParaId:"-999",highlightParaStartOffset:-999,highlightParaEndOffset:-999,enclosingParaList:["-999"],highlightColorCode:e,customNoteText:t}};$.ajax({url:properties[properties.env]+"/manageCases/addCustomNoteForMyBrief",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(i)}).then(function(e){void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),"true"===e.status?($("textarea#"+a).val(t),$("textarea#"+a).attr("value",t),$("textarea#"+a).text(t),e.briefVO.annotationId&&($("textarea#"+a).attr("customAnnotationId",e.briefVO.annotationId),callExportMyBrief&&($("#page-loading-spinner").show(),getMyBriefContentExport(),callExportMyBrief=!1)),$("#page-loading-spinner").hide()):$("#page-loading-spinner").hide(),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function updateCustomNoteForMyBrief(e,t,a,i){$("#page-loading-spinner").show();var o={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"CASE_PAGE",pageNavigatingFrom:"CASES",pageNavigatingTo:"CASES",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:casesSectionListOnLoad.chapterId,lastReadSectionId:casesSectionListOnLoad.sectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:""},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},briefVO:{bookId:CaseConnect.currentBookId,annotationId:e,chapterId:casesSectionListOnLoad.chapterId,chapterTitle:"-999",sectionId:casesSectionListOnLoad.sectionId,sectionTitle:casesSectionListOnLoad.sectionTitle,pageNumber:"-999",highlightStartOffset:-999,highlightEndOffset:-999,highlightText:"-999",highlightStartParaId:"-999",highlightEndParaId:"-999",highlightParaStartOffset:-999,highlightParaEndOffset:-999,enclosingParaList:["-999"],highlightColorCode:t,customNoteText:a}};$.ajax({url:properties[properties.env]+"/manageCases/updateCustomNoteForMyBrief",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(o)}).then(function(e){void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),"true"===e.status?($("textarea#"+i).val(a),$("textarea#"+i).attr("value",a),$("textarea#"+i).text(a),$("#page-loading-spinner").hide(),callExportMyBrief&&($("#page-loading-spinner").show(),getMyBriefContentExport(),callExportMyBrief=!1)):$("#page-loading-spinner").hide(),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function removeMyBriefHighlight(e,t){var a="";if(void 0!==t.keyCode){if(13!==t.keyCode)return;a=$(e).attr("annotationId")}else a=$(e).attr("annotationId");$("#page-loading-spinner").show();var i={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"CASE_PAGE",pageNavigatingFrom:"CASES",pageNavigatingTo:"CASES",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:casesSectionListOnLoad.sectionId,lastReadParagraphId:"para01"},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},briefVO:{bookId:CaseConnect.currentBookId,chapterId:CaseConnect.currentChapterId,sectionId:casesSectionListOnLoad.sectionId,annotationId:a,displayBriefHighlightTextFlag:"false"}};$.ajax({url:properties[properties.env]+"/manageCases/removeMyBriefContent",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(i)}).then(function(e){void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),"true"===e.status?getMyBriefContentInCasesPage():$("#page-loading-spinner").hide(),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function removeMyBriefNote(e,t){var a="";if(void 0!==t.keyCode){if(13!==t.keyCode)return;a=$(e).attr("annotationId")}else a=$(e).attr("annotationId");$("#page-loading-spinner").show();var i={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"CASE_PAGE",pageNavigatingFrom:"CASES",pageNavigatingTo:"CASES",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:casesSectionListOnLoad.sectionId,lastReadParagraphId:"para01"},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},briefVO:{bookId:CaseConnect.currentBookId,chapterId:CaseConnect.currentChapterId,sectionId:casesSectionListOnLoad.sectionId,annotationId:a,displayBriefNoteFlag:"false"}};$.ajax({url:properties[properties.env]+"/manageCases/removeMyBriefContent",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(i)}).then(function(e){void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),"true"===e.status?getMyBriefContentInCasesPage():$("#page-loading-spinner").hide(),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function showCasesNavInMoblie(){$("#cases-nav-menu-mobile").modal("show")}function hideCasesNavInMoblie(){$("#cases-nav-menu-mobile").modal("hide")}function caseSearchTextMobile(){insideCasesPage&&closeOverlayInMobile("cases-nav-menu-mobile"),$(".case-search-mobile").popover({html:!0,placement:"bottom",container:"body",template:'<div class="popover ebook-custom-popover case-search-popover" aria-hidden="true" tabindex="0" role="dialog"><div class="popover-content popover-without-padding popover-case-search-textbox-wrapper display-inline-block"></div></div>',content:function(){return $("#case-search-content-wrapper-mobile").html()}}),$(".case-search-mobile").on("shown.bs.popover",function(){setTimeout(function(){var e;e=$("input#case-search-text-mobile")[1].value,$("input#case-search-text-mobile")[1].value="",$("input#case-search-text-mobile")[1].focus(),$("input#case-search-text-mobile")[1].value=e},150),$("input#case-search-text-mobile")[1].value=savedCaseSearchedText,$(".popover-case-search-field").val(savedCaseSearchedText)})}function casesSearchText(){$(".case-search-area").popover({html:!0,placement:"bottom",container:"body",template:'<div class="popover case-search-popover" aria-hidden="true" tabindex="0" role="dialog"><div class="popover-content popover-case-search-textbox-wrapper display-inline-block"></div></div>',content:function(){return $("#case-search-content-wrapper").html()}}),$(".case-search-area").on("shown.bs.popover",function(){setTimeout(function(){var e;e=$("input#caseSearchTextbox")[0].value,$("input#caseSearchTextbox")[0].value="",$("input#caseSearchTextbox")[0].focus(),void 0!==$("input#caseSearchTextbox")[1]&&$("input#caseSearchTextbox")[1].focus(),$("input#caseSearchTextbox")[0].value=e},150),$(".popover-case-search-field").val(savedCaseSearchedText)})}function closeCaseSearchPopover(e){$(".case-search-area").popover("hide"),$("input.case-search-area").focus(),setTimeout(function(){$("input.case-search-area").focus()},500)}function closeCaseSearchPopoverMobile(e){$(".case-search-mobile").popover("hide")}function searchTextInCases(e){$(window).height();for(var t=$(window).width(),a=$(".popover-case-search-field").length,i=null,o=0;o<a&&""===(i=$(".popover-case-search-field")[o].value);o++);if(""==i&&navigator.userAgent.match(/(iPad|Android|iPhone)/)){var r=$("input#case-search-text-mobile")[1].value;i=r}savedCaseSearchedText=i,""==i&&t<768&&cancelBtnCaseSearchMobile(),navigator.userAgent.match(/(iPad|Android|iPhone)/)||$(".popover-case-search-field").keyup(function(){(""!==i||""!==$(".popover-case-search-field").val()||void 0!==$("input#case-search-text-mobile")[1]&&""!==$("input#case-search-text-mobile")[1].value)&&(savedCaseSearchedText=i,$(".case-cancel-search").show(),$("#close-case-search-desktop").show())});(void 0!==e.keyCode&&13===e.keyCode||selectedFromAutoSuggestMobile||selectedFromAutoSuggestTablet)&&(selectedFromAutoSuggestMobile=!1,selectedFromAutoSuggestTablet=!1,$(".case-search-count").hide(),""!==i||""!==$(".popover-case-search-field").val()||""!==$("input#case-search-text-mobile")[1].value?(-1===stopWords.indexOf(i)||-1===$(".popover-case-search-field").val()||-1==$("input#case-search-text-mobile")[1].value?(caseSearchResult(),e.preventDefault?e.preventDefault():e.returnValue=!1):(alertMessagesModal(exceptionMsg.enterValidSearch),$(".case-cancel-search").hide(),e.preventDefault?e.preventDefault():e.returnValue=!1),$(".caseSearchResultFound").html(""),$(".case-search-detail-list").html("")):""!==i&&""!==$(".popover-case-search-field").val()||(alertMessagesModal(exceptionMsg.enterSearchTerm),e.preventDefault?e.preventDefault():e.returnValue=!1))}function caseSearchResult(){$(".popover-case-search-field").length;var e=null,t=$(window).width();t<768?e=$("input#case-search-text-mobile")[1].value:e=$("input#caseSearchTextbox")[1].value;if(""!==e||$("input#case-search-text-mobile")&&""!==$("input#case-search-text-mobile")[1].value){var a="";""!==e?a=e:t<768&&$("input#case-search-text-mobile")&&""!==$("input#case-search-text-mobile")[1].value?a=$("input#case-search-text-mobile")[1].value:t>768&&$("input#caseSearchTextbox")[1].value&&(a=$("input#caseSearchTextbox")[1].value);var i="";void 0!==casesSectionListOnLoad?(casesSectionListOnLoad.chapterId,i=casesSectionListOnLoad.sectionId):void 0!==CaseConnect.currentchapterId?(CaseConnect.currentchapterId,i=""):("",i="");var o={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"CASE_SEARCH_BOOK_CONTENT",pageNavigatingFrom:"CASES",pageNavigatingTo:"CASES",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentchapterId,lastReadSectionId:i,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01"},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,ipAddress:localStorage.getItem("ipAddress"),sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},contentSearchVO:{bookId:CaseConnect.currentBookId,searchKeyWord:a,paginationResultsPerPage:"100"}};$(".search-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageSearchService/searchTextCaseInBook",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(o)}).then(function(e){void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken);var t=$(window).width();if(navigator.userAgent.match(/(iPad|Android|iPhone)/)||(t<768?$("#case-search-mobile").popover("show"):$(".case-search-area").popover("show")),$(".caseSearchResultFound").html(""),$(".case-search-detail-list").html(""),void 0!==e.contentSearchResultVOList&&""!==e.contentSearchResultVOList){var i=e.contentSearchResultVOList;"object"==$.type(i)&&(i=[i]),$(".case-search-count").show();var o;o=i,i.length>1?$(".caseSearchResultFound").html(i.length+" results found"):1===i.length&&$(".caseSearchResultFound").html(i.length+" result found");for(var r=0;r<o.length;r++)o[r].sectionId&&$(".case-search-detail-list").append("<li id='' class='case-result-list-element list-style-none'><a href='#' id='' class=' display-inline-block case-search-sentence' bookId="+CaseConnect.currentBookId+" chapterId="+o[r].chapterId+" sectionId="+o[r].sectionId+"  sectionTitle="+o[r].sectionTitle+" onclick = 'caseGotoSearchResult(event);'>"+o[r].sectionTitle+"</a></li>");savedCaseSearchedText=a}(null!==e.contentSearchResultVOList&&void 0!==e.contentSearchResultVOList||"true"!==e.status)&&(e.contentSearchResultVOList||"true"!==e.status)||($(".case-search-count").show(),$(".caseSearchResultFound").html("No results found")),$(".searchAutoSuggestListCase").html(""),$(".searchAutoSuggestListCase").hide(),$(".search-loading-spinner").hide(),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#search-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg),$(".case-search-mobile").popover("hide")):window.location=properties.ui_domain,$(".search-loading-spinner").hide()})}else $(".case-search-detail-list").html("")}function cancelBtnCaseSearch(){$(".popover-case-search-field").val(""),$(".case-cancel-search").hide(),$(".case-search-detail-list").html(""),$(".caseSearchResultFound").html(""),$(".case-search-count").hide(),$(".case-search-area").popover("hide"),savedCaseSearchedText=null,setTimeout(function(){$("input.case-search-area").focus()},500)}function cancelBtnCaseSearchMobile(){$(".popover-case-search-field").val(""),$(".case-cancel-search-mobile").hide(),$(".case-search-detail-list").html(""),$(".caseSearchResultFound").html(""),$(".case-search-count").hide(),savedCaseSearchedText=null,setTimeout(function(){$("input#case-search-text-mobile").focus()},500)}function caseGotoSearchResult(e){$(".case-search-area").popover("hide"),$(".case-search-mobile").popover("hide"),setTimeout(function(){$("input.case-search-area").focus()},500),e.currentTarget.getAttribute("sectionId")!==CaseConnect.currentSectionId&&(CaseConnect.currentChapterId=e.currentTarget.getAttribute("chapterId"),CaseConnect.currentSectionId=e.currentTarget.getAttribute("sectionId"),showCasesPage(e))}function searchSuggestionCases(e){if(13!==e.keyCode&&37!==e.keyCode&&39!==e.keyCode&&38!==e.keyCode&&40!==e.keyCode){for(var t=$(".popover-case-search-field").length,a=null,i=0;i<t&&""===(a=$(".popover-case-search-field")[i].value.replace(/\//g,"&#47;").replace(/\\/g,"&#92;").replace(/{/g,"&#123;").replace(/;/g,"&#59;"));i++);if($(".searchAutoSuggestListCase").html(""),$("ul.searchAutoSuggestListCase").css("display","none"),a.length>2&&a.length<30){var o={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"CASE_AUTOSUGGEST_SEARCH_BOOK_CONTENT ",pageNavigatingFrom:"CASES",pageNavigatingTo:"CASES",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:CaseConnect.lastViewedOutlineId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,ipAddress:localStorage.getItem("ipAddress"),sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},contentSearchVO:{bookId:CaseConnect.currentBookId,searchKeyWord:a}};$.ajax({url:properties[properties.env]+"/manageSearchService/autoSuggestTextInBook ",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(o),success:function(e){if(void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),e.autoSuggestSearchResultVOList&&e.autoSuggestSearchResultVOList.listEntries){var t=[];$.isArray(e.autoSuggestSearchResultVOList.listEntries)?t=e.autoSuggestSearchResultVOList.listEntries:t.push(e.autoSuggestSearchResultVOList.listEntries),t,$(".searchAutoSuggestListCase").html(""),currentSelectedAutoSuggestIndexCase=null,$.each(t,function(e,a){var i=document.createElement("li");i.className="search-suggest-options",i.id=e+"search-suggest-options",i.innerHTML=t[e],$(".searchAutoSuggestListCase").append(i),navigator.userAgent.match(/(iPad|Android|iPhone)/)?$(".search-suggest-options").attr("ontouchstart","searchListOptionSelectedCase(event);"):($(".search-suggest-options").attr("onclick","searchListOptionSelectedCase(event);"),$(".search-suggest-options").attr("onmouseover","elementHoveringCase(event);"))}),$("ul.searchAutoSuggestListCase").css("display","block")}sessionTimeOut()},error:function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?(alertMessagesModal(e.responseJSON.errorMessg),$(".case-search-mobile").popover("hide")):window.location=properties.ui_domain}})}}else if((38===e.keyCode||40===e.keyCode)&&"block"===$(".searchAutoSuggestListCase").css("display")){var r=$("ul.searchAutoSuggestListCase").children();40===e.keyCode?null===currentSelectedAutoSuggestIndexCase?r.length>0&&$("#0search-suggest-options")&&($("#0search-suggest-options").addClass("sel"),$(".popover-case-search-field")[0].value=$("#0search-suggest-options").html(),currentSelectedAutoSuggestIndexCase=0):($(r).each(function(){$(this).removeClass("sel")}),currentSelectedAutoSuggestIndexCase!==r.length-1?($("#"+(currentSelectedAutoSuggestIndexCase+1)+"search-suggest-options").addClass("sel"),$(".popover-case-search-field")[0].value=$("#"+(currentSelectedAutoSuggestIndexCase+1)+"search-suggest-options").html(),currentSelectedAutoSuggestIndexCase++):($("#0search-suggest-options").addClass("sel"),$(".popover-case-search-field")[0].value=$("#0search-suggest-options").html(),currentSelectedAutoSuggestIndexCase=0)):null===currentSelectedAutoSuggestIndexCase?r.length>0&&$("#0search-suggest-options")&&($("#"+(currentSelectedAutoSuggestIndexCase-1)+"search-suggest-options").addClass("sel"),$(".popover-case-search-field")[0].value=$("#"+(currentSelectedAutoSuggestIndexCase-1)+"search-suggest-options").html(),currentSelectedAutoSuggestIndexCase=r.length-1):($(r).each(function(){$(this).removeClass("sel")}),0!==currentSelectedAutoSuggestIndexCase?($("#"+(currentSelectedAutoSuggestIndexCase-1)+"search-suggest-options").addClass("sel"),$(".popover-case-search-field")[0].value=$("#"+(currentSelectedAutoSuggestIndexCase-1)+"search-suggest-options").html(),currentSelectedAutoSuggestIndexCase--):($("#"+(r.length-1)+"search-suggest-options").addClass("sel"),$(".popover-case-search-field")[0].value=$("#"+(r.length-1)+"search-suggest-options").html(),currentSelectedAutoSuggestIndexCase=r.length-1)),$(".popover-case-search-field")[0].focus()}}function searchSuggestionCasesMobile(e){if(13!==e.keyCode&&37!==e.keyCode&&39!==e.keyCode&&38!==e.keyCode&&40!==e.keyCode){var t;$(".popover-case-search-field").length;if(t=$("input#case-search-text-mobile")[1].value.replace(/\//g,"&#47;").replace(/\\/g,"&#92;").replace(/{/g,"&#123;").replace(/;/g,"&#59;"),$(".searchAutoSuggestListCaseMobile").html(""),$("ul.searchAutoSuggestListCaseMobile").css("display","none"),t.length>2&&t.length<30){var a={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"CASE_AUTOSUGGEST_SEARCH_BOOK_CONTENT ",pageNavigatingFrom:"CASES",pageNavigatingTo:"CASES",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:CaseConnect.lastViewedOutlineId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,ipAddress:localStorage.getItem("ipAddress"),sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},contentSearchVO:{bookId:CaseConnect.currentBookId,searchKeyWord:t}};$.ajax({url:properties[properties.env]+"/manageSearchService/autoSuggestTextInBook ",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(a),success:function(e){if(void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),e.autoSuggestSearchResultVOList&&e.autoSuggestSearchResultVOList.listEntries){var t=[];$.isArray(e.autoSuggestSearchResultVOList.listEntries)?t=e.autoSuggestSearchResultVOList.listEntries:t.push(e.autoSuggestSearchResultVOList.listEntries),t,$(".searchAutoSuggestListCaseMobile").html(""),currentSelectedAutoSuggestIndexCase=null,$.each(t,function(e,a){var i=document.createElement("li");i.className="search-suggest-options",i.id=e+"search-suggest-options",i.innerHTML=t[e],$(".searchAutoSuggestListCaseMobile").append(i),navigator.userAgent.match(/(iPad|Android|iPhone)/)?($("#"+e+"search-suggest-options").attr("ontouchstart","searchListOptionSelectedCaseMobile(event);"),$(".search-suggest-options").attr("ontouchstart","searchListOptionSelectedCaseMobile(event);")):($("#"+e+"search-suggest-options").attr("onclick","searchListOptionSelectedCaseMobile(event);"),$(".search-suggest-options").attr("onclick","searchListOptionSelectedCaseMobile(event);")),$("#"+e+"search-suggest-options").attr("onmouseover","elementHoveringCaseMobile(event);")}),$(".searchAutoSuggestListCaseMobile").css("display","block")}sessionTimeOut()},error:function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?alertMessagesModal(e.responseJSON.errorMessg):window.location=properties.ui_domain}})}}else if((38===e.keyCode||40===e.keyCode)&&"block"===$("ul.searchAutoSuggestListCaseMobile").css("display")){var i=$("ul.searchAutoSuggestListCaseMobile").children();40===e.keyCode?null===currentSelectedAutoSuggestIndexCase?i.length>0&&$("#0search-suggest-options")&&($("#0search-suggest-options").addClass("sel"),$(".popover-case-search-field")[0].value=$("#0search-suggest-options").html(),currentSelectedAutoSuggestIndexCase=0):($(i).each(function(){$(this).removeClass("sel")}),currentSelectedAutoSuggestIndexCase!==i.length-1?($("#"+(currentSelectedAutoSuggestIndexCase+1)+"search-suggest-options").addClass("sel"),$(".popover-case-search-field")[0].value=$("#"+(currentSelectedAutoSuggestIndexCase+1)+"search-suggest-options").html(),currentSelectedAutoSuggestIndexCase++):($("#0search-suggest-options").addClass("sel"),$(".popover-case-search-field")[0].value=$("#0search-suggest-options").html(),currentSelectedAutoSuggestIndexCase=0)):null===currentSelectedAutoSuggestIndexCase?i.length>0&&$("#0search-suggest-options")&&($("#"+(currentSelectedAutoSuggestIndexCase-1)+"search-suggest-options").addClass("sel"),$(".popover-case-search-field")[0].value=$("#"+(currentSelectedAutoSuggestIndexCase-1)+"search-suggest-options").html(),currentSelectedAutoSuggestIndexCase=i.length-1):($(i).each(function(){$(this).removeClass("sel")}),0!==currentSelectedAutoSuggestIndexCase?($("#"+(currentSelectedAutoSuggestIndexCase-1)+"search-suggest-options").addClass("sel"),$(".popover-case-search-field")[0].value=$("#"+(currentSelectedAutoSuggestIndexCase-1)+"search-suggest-options").html(),currentSelectedAutoSuggestIndexCase--):($("#"+(i.length-1)+"search-suggest-options").addClass("sel"),$(".popover-case-search-field")[0].value=$("#"+(i.length-1)+"search-suggest-options").html(),currentSelectedAutoSuggestIndexCase=i.length-1)),$(".popover-case-search-field")[0].focus()}}var selectedFromAutoSuggestTablet=!1;function searchListOptionSelectedCase(e){$(".popover-case-search-field")[0].value=e.target.innerHTML,$(".popover-case-search-field")[0].focus(),$("ul.searchAutoSuggestListCaseMobile").css("display","none"),selectedFromAutoSuggestTablet=!0,searchTextInCases(e),navigator.userAgent.match(/(iPad|Android|iPhone)/)}var selectedFromAutoSuggestMobile=!1;function searchListOptionSelectedCaseMobile(e){$("input#case-search-text-mobile")[1].value=e.target.innerHTML,$("ul.searchAutoSuggestListCaseMobile").css("display","none"),selectedFromAutoSuggestMobile=!0,searchTextInCases(e),navigator.userAgent.match(/(iPad|Android|iPhone)/)}function elementHoveringCase(e){var t=$("ul.searchAutoSuggestListCase").children();$(t).each(function(){$(this).removeClass("sel")}),currentSelectedAutoSuggestIndexCase=parseInt(e.target.id.substring(0,1))}function elementHoveringCaseMobile(e){var t=$("ul.searchAutoSuggestListCaseMobile").children();$(t).each(function(){$(this).removeClass("sel")}),currentSelectedAutoSuggestIndexCase=parseInt(e.target.id.substring(0,1))}function searchValueCase(e){13!=e.keyCode&&"touchstart"!==e.type&&"click"!==e.type||($(".case-search-count").hide(),$("ul#searchAutoSuggestListCase").length>1&&$(".searchAutoSuggestListCase").css("display","none"),$("ul#searchAutoSuggestListCaseMobile").length>1&&$(".searchAutoSuggestListCaseMobile").css("display","none"),""!=$(".popover-case-search-field")[1].value?(validateStopWords(),e.preventDefault()):""===$(".popover-case-search-field")[1].value&&(alertMessagesModal(exceptionMsg.enterSearchTerm),e.preventDefault()))}function cancelCasePageWelcomeMsg(){var e={userVO:{userId:localStorage.getItem("userId"),userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),streamContentRequiredFlag:map.isIE9,userActivityVO:{lastActivityCode:"CASE_PAGE",pageNavigatingFrom:"Bookshelf",pageNavigatingTo:"BOOKSHELF",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:"",lastReadChapterId:"",lastReadSectionId:"",lastReadSubSectionId:"",lastReadParagraphId:"",lastViewedOutlineId:""},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},briefTutorialFlag:"false"};$.ajax({url:properties[properties.env]+"/manageUserService/updateBriefTutorialStatus",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(e)}).then(function(e){"true"==e.status&&$("#case-welcome-modal").modal("hide"),"false"==e.status&&alertMessagesModal(e.responseJSON.errorMessg)},function(e){alertMessagesModal(e.responseJSON.errorMessg)})}function updateWelcomeCaseBriefInEreader(){CaseConnect.welcomeCaseBriefInEreader="false";var e={userVO:{userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId,streamContentRequiredFlag:!1,userActivityVO:{lastActivityCode:"EREADER_READING_BOOK",pageNavigatingFrom:"EReader",pageNavigatingTo:"EReader",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.lastReadPageNum,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:""},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},bookVO:{bookId:CaseConnect.currentBookId,briefModalFlag:CaseConnect.welcomeCaseBriefInEreader}};$.ajax({url:properties[properties.env]+"/manageUserService/updateBriefModalFlag",type:"POST",contentType:"application/json",accept:"application/json",async:!1,data:JSON.stringify(e)}).then(function(e){"true"===e.status&&void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),alertMessagesModal(exceptionMsg.systemError)})}function saveRtsNotificationResponse(){var e={userVO:{userId:map.userId,userRole:map.userRole,userRoleId:map.userRoleId,userActivityVO:{lastActivityCode:"EREADER_READING_BOOK",pageNavigatingFrom:"EReader",pageNavigatingTo:"EReader",lastReadBookId:CaseConnect.currentBookId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},userSettingsVO:{userId:map.userId,eReaderStudyTutorialDisplayMessageFlag:CaseConnect.rTsNotificationFlag,createdBy:map.userId,modifiedBy:map.userId},bookVO:{bookId:CaseConnect.currentBookId}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageUserService/saveEreaderStudyTutorialMessageDisplayStatus",type:"POST",contentType:"application/json",accept:"application/json",async:!1,data:JSON.stringify(e)}).then(function(e){"true"===e.status&&(void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),$("#page-loading-spinner").hide(),$(document).popover("hide")),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),alertMessagesModal(exceptionMsg.systemError)})}var addConnectionOrginCheck,callExportMyBrief=!1;function getMyBriefContentExport(){$("#page-loading-spinner").hide(),setTimeout(function(){$("#page-loading-spinner").hide(),document.getElementById("myBriefExportForm").action=properties[properties.env]+"/manageCases/exportCaseForFormInput",$("h2.brief-label-title").addClass("export-label-style"),$("p.my-brief-text-wrapper").addClass("export-brief-para-style");var e=$(".case-name-heading").html().trim(),t=$(".caseCitation").html(),a=$(".myBrief").html();$("#export-case-name").html(e),$("#export-case-citation-name").html(t),$("#export-my-brief-content").html(a);for(var i=$("#export-my-brief-content .my-brief-block .brief-edit-textarea"),o=0;o<i.length;o++)i[o].setAttribute("value",i[o].getAttribute("value").replace(/</g,"&lt;").replace(/>/g,"&gt;"));var r=$("#export-my-brief-block").html();r=r.replace(/<br>/g,"<br/>").replace(/&nbsp;/g," ").replace(/&ldquo;/g,'"').replace(/&rdquo;/g,'"').replace(/&lsquo;/g,"'").replace(/&rsquo;/g,"'").replace(/&sect;/g,"??").replace(/&amp;/g,"&").replace("<div class='brief-label-title'>","<h1 class='brief-label-title'>").replace('<div style="width: 49%;height:40px;" class="display-inline-block dropdown  case-right">','<div style="width: 49%;height:40px; display:none" class="display-inline-block dropdown  case-right">'),$("#myBriefPageNoteName").val(e),$("#caseUserId").val(CaseConnect.currentUserId),$("#docFormat").val("docx"),$("#myBriefHtmlInput").val("<html><body>"+r+"</body></html>"),$("#myBriefExportForm").submit(),$("h2.brief-label-title").removeClass("export-label-style"),$("p.my-brief-text-wrapper").removeClass("export-brief-para-style"),setTimeout(function(){$("#brief-export-delay-window").modal("hide")},3e3)},3e3)}function loadMessage(){$("#brief-export-loading-spinner").show()}function autoExpandHeight(e){"autoAdjustHeight"==e.target.classList[1]&&e.target.scrollHeight>80&&(e.target.style.minHeight=e.target.scrollHeight+"px"),""==e.target.textContent&&(e.target.style.minHeight="80px")}var shareSettingValues=[],changesDone="";function loadAddShareSetting(e,t){$("#page-loading-spinner").show();var a=e.currentTarget,i="",o="";"acceptRequest"==t?(i=e.currentTarget.parentNode.getAttribute("value"),o=e.currentTarget.parentNode.getAttribute("sharingID"),addConnectionOrginCheck=null!=e.currentTarget.classList[2]&&null!=e.currentTarget.classList[2]&&"fromAddConnection"==e.currentTarget.classList[2]):i=e.currentTarget.getAttribute("value");var r={userVO:{userId:localStorage.getItem("userId"),toUserId:i,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{pageNavigatingFrom:"CASE_PAGE",pageNavigatingTo:"CASE_MANAGE_CONNECTION_PAGE",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"",lastReadParagraphId:""},sessionVO:{deviceOS:CaseConnect.deviceOS,deviceType:CaseConnect.deviceType,browserName:CaseConnect.browserName,appType:CaseConnect.appType,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}}};"true"==manageConnectionOrigin?r.userVO.userActivityVO.lastActivityCode="MANAGE_CONNECTION_PAGE":r.userVO.userActivityVO.lastActivityCode="CASE_MANAGE_CONNECTION_PAGE",$.ajax({url:properties[properties.env]+"/manageCases/getBookListForSharingSettings",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(r)}).then(function(e){if("true"==e.status){if($("#brief-Sharing-modal").modal("show"),$("#share-userName").text(""),$("#share-userName").text(a.getAttribute("username")),$("#brief-modal-Sharing-list-content").html(""),null!=e.bookVOList&&null!=e.bookVOList){"object"==$.type(e.bookVOList)&&(e.bookVOList=[e.bookVOList]);for(var r=e.bookVOList,n=0;n<r.length;n++)$("#brief-modal-Sharing-list-content").append('<li class="list-style-none"><div style="position:relative"><label style="display:block;"><input type="checkbox" class="share-books" bookId='+r[n].bookId+' id="share-checkbox" onClick="" value="true"> </input><p class="cases-checkbox-msg share-bookName ">'+r[n].bookTitle+'</p> <p class="cases-checkbox-msg share-authorName">By '+r[n].bookAuthor+".</p></label></div></li>")}$(".share-books").prop("checked",!0),$(".share-All-books").prop("checked",!0),$(".share-books").attr("value","true"),$(".share-All-books").attr("value","true"),$(".share-save").attr("toUserId",i),$(".share-save").attr("selectOrigin",t),"acceptRequest"==t&&$(".share-save").attr("briefSharingID",o),$("#page-loading-spinner").hide(),sessionTimeOut();var s=$("#brief-modal-Sharing-list-content li div input");shareSettingValues=[];for(n=0;n<s.length;n++)shareSettingValues.push(s[n].value);shareSettingValues.push($(".share-All-books").val().toString())}"false"==e.status&&(alertMessagesModal(e.responseJSON.errorMessg),$("#page-loading-spinner").hide())},function(e){alertMessagesModal(e.responseJSON.errorMessg),$("#page-loading-spinner").hide()})}function sharingSetting(e,t){$("#page-loading-spinner").show();var a=e.currentTarget,i=e.currentTarget.parentNode.getAttribute("value"),o=e.currentTarget.parentNode.getAttribute("sharingID"),r={userVO:{userId:localStorage.getItem("userId"),toUserId:i,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),briefSharingRequestId:o,userActivityVO:{pageNavigatingFrom:"CASE_PAGE",pageNavigatingTo:"CASE_MANAGE_CONNECTION_PAGE",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"",lastReadParagraphId:""},sessionVO:{deviceOS:CaseConnect.deviceOS,deviceType:CaseConnect.deviceType,browserName:CaseConnect.browserName,appType:CaseConnect.appType,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}}};"true"==manageConnectionOrigin?r.userVO.userActivityVO.lastActivityCode="MANAGE_CONNECTION_PAGE":r.userVO.userActivityVO.lastActivityCode="CASE_MANAGE_CONNECTION_PAGE",$.ajax({url:properties[properties.env]+"/manageCases/getSharingSettings",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(r)}).then(function(e){if("true"==e.status){if($("#brief-Sharing-modal").modal("show"),$("#share-userName").text(""),$("#share-userName").text(a.getAttribute("username")),$("#brief-modal-Sharing-list-content").html(""),null!=e.bookVOList&&null!=e.bookVOList){"object"==$.type(e.bookVOList)&&(e.bookVOList=[e.bookVOList]);for(var r=e.bookVOList,n=0;n<r.length;n++)$("#brief-modal-Sharing-list-content").append('<li class="list-style-none"><div style="position:relative"><label style="display:block;"><input type="checkbox" class="share-books" bookId='+r[n].bookId+' id="share-checkbox" onClick="" value="true"> </input><p class="cases-checkbox-msg share-bookName ">'+r[n].bookTitle+'</p> <p class="cases-checkbox-msg share-authorName">By '+r[n].bookAuthor+".</p></label></div></li>")}if($(".share-save").attr("toUserId",i),$(".share-save").attr("selectOrigin",t),$(".share-save").attr("briefSharingID",o),null!=e.sharedBookVOList&&null!=e.sharedBookVOList){"object"==$.type(e.sharedBookVOList)&&(e.sharedBookVOList=[e.sharedBookVOList]);var s=$("#brief-modal-Sharing-list-content input");for(n=0;n<e.sharedBookVOList.length;n++)for(var l=0;l<s.length;l++)e.sharedBookVOList[n].bookId==s[l].getAttribute("bookid")?(s[l].checked=!0,s[l].setAttribute("value","true")):s[l].checked||(s[l].checked=!1,s[l].setAttribute("value","false"))}else for(s=$("#brief-modal-Sharing-list-content input"),l=0;l<s.length;l++)s[l].checked=!1,s[l].setAttribute("value","false");null!=e.shareFutureBooks&&null!=e.shareFutureBooks&&"true"==e.shareFutureBooks?($(".share-All-books").prop("checked",!0),$(".share-books").prop("checked",!0),$(".share-books").attr("value","true"),$(".share-All-books").attr("value","true")):($(".share-All-books").prop("checked",!1),$(".share-All-books").attr("value","false")),$("#page-loading-spinner").hide(),sessionTimeOut();var c=$("#brief-modal-Sharing-list-content li div input");shareSettingValues=[];for(n=0;n<c.length;n++)shareSettingValues.push(c[n].value);shareSettingValues.push($(".share-All-books").val().toString())}"false"==e.status&&(alertMessagesModal(e.responseJSON.errorMessg),$("#page-loading-spinner").hide())},function(e){alertMessagesModal(e.responseJSON.errorMessg),$("#page-loading-spinner").hide()})}function cancelBriefSharingModal(){for(var e=$("#brief-modal-Sharing-list-content li div input"),t=[],a=0;a<e.length;a++){var i=e[a].checked;t.push(i.toString())}t.push($(".share-All-books").prop("checked").toString());for(a=0;a<t.length;a++){if(t[a]!=shareSettingValues[a]){changesDone="true";break}changesDone="false"}"true"==changesDone?($("#cancel-share-modal").modal("show"),$(".cases-modal").css("opacity","0")):closeBriefSharingModal()}function saveDataForsharingModal(e,t,a,i){for(var o="",r=0;r<a.length;r++)o=r===a.length-1?o+'{"bookId": '+a[r]+"}":o+'{"bookId": '+a[r]+"},";o=JSON.parse("["+o+"]");var n={userVO:{userId:localStorage.getItem("userId"),toUserId:e,shareFutureBooks:i,briefSharingRequestId:t,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{pageNavigatingFrom:"CASE_PAGE",pageNavigatingTo:"CASE_MANAGE_CONNECTION_PAGE",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"",lastReadParagraphId:""},sessionVO:{deviceOS:CaseConnect.deviceOS,deviceType:CaseConnect.deviceType,browserName:CaseConnect.browserName,appType:CaseConnect.appType,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}}};"true"==manageConnectionOrigin?n.userVO.userActivityVO.lastActivityCode="MANAGE_CONNECTION_PAGE":n.userVO.userActivityVO.lastActivityCode="CASE_MANAGE_CONNECTION_PAGE",""!=o&&(n.bookVOList=o),$.ajax({url:properties[properties.env]+"/manageCases/setSharingSettings",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(n)}).then(function(e){"true"==e.status&&($("#brief-Sharing-modal").modal("hide"),sessionTimeOut()),"false"==e.status&&(alertMessagesModal(e.responseJSON.errorMessg),Utility.hideSpinner())},function(e){alertMessagesModal(e.responseJSON.errorMessg),Utility.hideSpinner()})}function closeBriefSharingModal(){$("#brief-Sharing-modal").modal("hide"),$(".cases-modal").css("opacity","")}function scrollInCaseExcerpt(e){if(void 0!==$("#case-excerpt-block-cases").css("display")){var t,a="";-1!==e.id.indexOf("highlight")?(a=e.id.substring(10),t=document.getElementById(a).offsetTop,$(".case-excerpt-md-wrapper").scrollTop(t),$("#"+a).focus()):-1!==e.id.indexOf("note")&&(a=e.id.substring(5),t=document.getElementById(a).offsetTop,$(".case-excerpt-md-wrapper").scrollTop(t),$("#"+a).focus())}}