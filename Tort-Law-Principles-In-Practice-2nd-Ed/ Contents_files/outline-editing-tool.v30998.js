var nonEditableChapterOutline=!1,insideCustomOutline=!1,newCustomOutlineBeingCreated=!1,navigatingFromClassInsightsToOutline=!1,lastViewedNotesTab="chapterOutlineInBook",customOutlineData=null,tinymceForCustomVisible=!1,lastVisitedEditableChapterId=null,lastVisitedNonEditableChapterId=null,currentCustomOutlineTitle=null,currentCustomOutlineId=null,currentCustomAnnotationId=null,loadingNewOutline=!1,comingFromCustomOutline=!1,comingFromAnotherMyNote=!1,manualSaveOfCustomOutline=!1,customOutlineTobeSaved=!1,undoOutlineMessageDisplay=!0,lastVisitedCustomOutlineId="",comingFromOutlineSearch=!1,chapterOutlineList=[],myNotesClicked=!1,customOutlineIdToDisplay=null,customOutlineTitleToDisplay=null,lastVisitedNotesLabel=null,customOutlineTitleonBlur=!1,saveNewOutlineFromCommonSaveFunction=!1,updateOutlineFromCommonSaveFunction=!1,saveTitleFromCommonSaveFunction=!1,updateTitleFromCommonSaveFunction=!1,loadBookNotesFromCommonFunction=!1,outlineViewChapterList=null;function initializeOutlineOnLoad(){$("#page-loading-spinner").show(),$(".mce-widget").remove(),$(".mce-container").remove(),customOutlineTobeSaved=!1,loadingNewOutline=!0,comingFromAnotherMyNote=!1,insideCustomOutline=!1,lastViewedNotesTab="chapterOutlineInBook",savedOutlineSearchedText=null,(CaseConnect.bookType&&"practicepack"===CaseConnect.bookType||CaseConnect.bookType&&"oer"===CaseConnect.bookType)&&($(".hide-study-page-class").hide(),$(".hide-ereader-class").hide(),$(".hide-outline-page-class").hide(),$(".hide-class-insights-class").hide(),$(".hide-pipe-line-class").hide(),$(".class-insights-mobile-visibility").css("visibility","hidden")),(CaseConnect.bookType&&"casebook"===CaseConnect.bookType||CaseConnect.bookType&&"coursebook"===CaseConnect.bookType)&&($(".hide-study-page-class").show(),$(".hide-ereader-class").show(),$(".hide-outline-page-class").show(),$(".hide-class-insights-class").show(),$(".hide-pipe-line-class").show(),$(".class-insights-mobile-visibility").css("visibility","visible")),CaseConnect.bookType&&"studyaid"===CaseConnect.bookType&&($(".hide-study-page-class").show(),$(".hide-ereader-class").show(),$(".hide-outline-page-class").show(),$(".hide-class-insights-class").hide(),$(".hide-pipe-line-class").show(),$(".class-insights-mobile-visibility").css("visibility","hidden")),"true"==CaseConnect.resourceFlag&&$(".resourceMenushow").removeClass("resourceMenuhide"),adminSuppressFunc(),setTimeout(function(){},1e3),setTimeout(function(){CaseConnect.bookData?(void 0!==CaseConnect.bookTitle?($(".ereader-main-header-title").html(CaseConnect.bookTitle),$(".read-modal-book-title").html(CaseConnect.bookTitle),$(".outline-booktitle-mobile").html(CaseConnect.bookTitle)):($(".ereader-main-header-title").html(CaseConnect.bookData.bookTitle),$(".read-modal-book-title").html(CaseConnect.bookData.bookTitle),$(".outline-booktitle-mobile").html(CaseConnect.bookData.bookTitle)),CaseConnect.bookData.viewableInOutline):!CaseConnect.bookData&&CaseConnect.navigatingAwayFromNewBookshelf?(CaseConnect.currentChapterId=outlineViewChapterList[0].chapterId,CaseConnect.currentChapterTitle=outlineViewChapterList[0].chapterTitle,$(".ereader-main-header-title").html(CaseConnect.navigatingAwayFromNewBookshelf[0].bookTitle),$(".outline-booktitle-mobile").html(CaseConnect.navigatingAwayFromNewBookshelf[0].bookTitle)):CaseConnect.bookName&&$(".outline-main-header-title").html(CaseConnect.bookName),CaseConnect.currentChapterId,newCustomOutlineBeingCreated=!1,loadChapterNotesFromTab(),outlineSearchText(),outlineSearchTextMobile(),checkNewsFeedInApp(),expiryDate()},2e3)}function loadOutlineFromLogin(e){$("#page-loading-spinner").show(),$(".mce-widget").remove(),$(".mce-container").remove(),loadingNewOutline=!0,insideStaticPage=!1,insideBookshelf=!1,comingFromAnotherMyNote=!1,savedOutlineSearchedText=null,CaseConnect.bookData=e.userActivityVO,CaseConnect.bookData.bookTitle=e.userActivityVO.lastReadBookTitle,CaseConnect.currentChapterNumber=e.userActivityVO.lastReadChapterNumber,CaseConnect.currentBookId=e.userActivityVO.lastReadBookId,CaseConnect.bookType=e.userActivityVO.lastReadBookType,CaseConnect.resourceFlag=e.userActivityVO.resourceFlag,CaseConnect.casesFlag=e.userActivityVO.casesFlag,CaseConnect.newsFeedFlag=e.userActivityVO.newsFeedFlag,bookChapterList,setTimeout(function(){CaseConnect.bookName=e.userActivityVO.lastReadBookTitle,(e.userActivityVO.lastReadBookType&&"casebook"===e.userActivityVO.lastReadBookType||e.userActivityVO.lastReadBookType&&"coursebook"===e.userActivityVO.lastReadBookType)&&(CaseConnect.bookType=e.userActivityVO.lastReadBookType),e.userActivityVO.lastReadBookType&&"studyaid"===e.userActivityVO.lastReadBookType&&(CaseConnect.bookType=e.userActivityVO.lastReadBookType),(e.userActivityVO.lastReadBookType&&"practicepack"===e.userActivityVO.lastReadBookType||e.userActivityVO.lastReadBookType&&"oer"===e.userActivityVO.lastReadBookType)&&(CaseConnect.bookType=e.userActivityVO.lastReadBookType),(e.userActivityVO.lastReadBookType&&"practicepack"===e.userActivityVO.lastReadBookType||e.userActivityVO.lastReadBookType&&"oer"===e.userActivityVO.lastReadBookType)&&($(".hide-study-page-class").hide(),$(".hide-ereader-class").hide(),$(".hide-outline-page-class").hide(),$(".hide-class-insights-class").hide(),$(".hide-pipe-line-class").hide(),$(".class-insights-mobile-visibility").css("visibility","hidden")),(e.userActivityVO.lastReadBookType&&"casebook"===e.userActivityVO.lastReadBookType||e.userActivityVO.lastReadBookType&&"coursebook"===e.userActivityVO.lastReadBookType)&&($(".hide-study-page-class").show(),$(".hide-ereader-class").show(),$(".hide-outline-page-class").show(),$(".hide-class-insights-class").show(),$(".hide-pipe-line-class").show(),$(".class-insights-mobile-visibility").css("visibility","visible")),e.userActivityVO.lastReadBookType&&"studyaid"===e.userActivityVO.lastReadBookType&&($(".hide-study-page-class").show(),$(".hide-ereader-class").show(),$(".hide-outline-page-class").show(),$(".hide-class-insights-class").hide(),$(".hide-pipe-line-class").show(),$(".class-insights-mobile-visibility").css("visibility","hidden")),"true"==CaseConnect.resourceFlag&&$(".resourceMenushow").removeClass("resourceMenuhide"),"true"===CaseConnect.casesFlag?CaseConnect.bookType?"oer"!==CaseConnect.bookType&&$(".hide-case-page-class").show():$(".hide-case-page-class").show():$(".hide-case-page-class").hide(),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide(),adminSuppressFunc(),CaseConnect.bookData?void 0!==CaseConnect.bookTitle?($(".ereader-main-header-title").html(CaseConnect.bookTitle),$(".read-modal-book-title").html(CaseConnect.bookTitle),$(".outline-booktitle-mobile").html(CaseConnect.bookTitle)):($(".ereader-main-header-title").html(CaseConnect.bookData.bookTitle),$(".read-modal-book-title").html(CaseConnect.bookData.bookTitle),$(".outline-booktitle-mobile").html(CaseConnect.bookData.bookTitle)):CaseConnect.bookName?($(".ereader-main-header-title").html(CaseConnect.bookName),$(".read-modal-book-title").html(CaseConnect.bookName),$(".outline-booktitle-mobile").html(CaseConnect.bookName)):!CaseConnect.bookData&&CaseConnect.navigatingAwayFromNewBookshelf&&(CaseConnect.currentChapterId=outlineViewChapterList[0].chapterId,CaseConnect.currentChapterTitle=outlineViewChapterList[0].chapterTitle,$(".ereader-main-header-title").html(CaseConnect.navigatingAwayFromNewBookshelf[0].bookTitle),$(".read-modal-book-title").html(CaseConnect.navigatingAwayFromNewBookshelf[0].bookTitle),$(".outline-booktitle-mobile").html(CaseConnect.navigatingAwayFromNewBookshelf[0].bookTitle)),getLastVisitedCustomOutline(),"customOutline"!==e.userActivityVO.lastViewedOutlineType?(lastViewedNotesTab="chapterOutlineInBook",e.userActivityVO.outlineVO?(CaseConnect.currentChapterId=e.userActivityVO.outlineVO.chapterId,CaseConnect.currentChapterTitle=e.userActivityVO.outlineVO.chapterTitle):(CaseConnect.currentChapterId=outlineViewChapterList[0].chapterId,CaseConnect.currentChapterTitle=outlineViewChapterList[0].chapterTitle)):(lastViewedNotesTab="customOutlineInBook",insideCustomOutline=!0,currentCustomOutlineTitle=e.userActivityVO.outlineVO.chapterTitle,currentCustomOutlineId=e.userActivityVO.outlineVO.chapterId),CaseConnect.currentChapterId&&$(outlineViewChapterList).each(function(){this.chapterId===CaseConnect.currentChapterId&&(CaseConnect.currentChapterTitle="Chapter "+this.chapterNumber+": "+this.chapterTitle,CaseConnect.currentNavbarTitle=this.navbarTitle)}),outlineSearchText(),outlineSearchTextMobile(),checkNewsFeedInApp(),expiryDate(),getMyRequestNoftificationCount()},3e3)}function setSaveOutlineOnTimer(){CaseConnect.outlineTimer&&clearTimeout(CaseConnect.outlineTimer),CaseConnect.outlineTimer=setInterval(function(){saveMyOutline()},18e4),$("#save-btn-annotation-outline").attr("disabled","disabled"),$("#save-btn-annotation-outline").css("cursor","auto"),$("#save-btn-annotation-outline-button").attr("disabled","disabled"),$("#save-btn-annotation-outline-button").css("cursor","auto")}function outlineSearchTextMobile(){insideOutline&&closeOverlayInMobile("outline-nav-menu-mobile"),$("#outline-search-mobile").popover({html:!0,placement:"bottom",container:"body",template:'<div class="popover ebook-custom-popover outline-search-popover" aria-hidden="true" tabindex="0" role="dialog"><div class="popover-content popover-without-padding popover-outline-search-textbox-wrapper display-inline-block"></div></div>',content:function(){return $("#outline-search-content-wrapper-mobile").html()}}),$("#outline-search-mobile").on("shown.bs.popover",function(){setTimeout(function(){var e;e=$("input#outline-search-text-mobile")[1].value,$("input#outline-search-text-mobile")[1].value="",$("input#outline-search-text-mobile")[1].focus(),$("input#outline-search-text-mobile")[1].click(),$("input#outline-search-text-mobile")[1].value=e},150),$(".outline-search-popover").css("left","0"),$("input#outline-search-text-mobile")[1].value=savedOutlineSearchedText,$("input#outline-search-text")[1],$("input#outline-search-text")[1].value=savedOutlineSearchedText,$(".popover-outline-search-field").val(savedOutlineSearchedText)})}function outlineSearchText(){$("#outline-search-text-desktop").popover({html:!0,placement:"bottom",container:"body",template:'<div class="popover outline-search-popover" aria-hidden="true" tabindex="0" role="dialog"><div class="popover-content popover-outline-search-textbox-wrapper display-inline-block"></div></div>',content:function(){return $("#outline-search-content-wrapper").html()}}),$("#outline-search-text-desktop").on("shown.bs.popover",function(){setTimeout(function(){var e;e=$("input#outline-search-text")[0].value,$("input#outline-search-text")[1].value="",$("input#outline-search-text")[1].focus(),$("input#outline-search-text")[1].value=e},150),$(".popover-outline-search-field").val(savedOutlineSearchedText),$("input#outline-search-text")[1].value=savedOutlineSearchedText})}function searchTextInOutline(e){$(".popover-outline-search-field").keyup(function(){$(".popover-outline-search-field")[0].value;""===$(".popover-outline-search-field")[0].value&&""===$(".popover-outline-search-field").val()&&""===$("input#outline-search-text")[1].value||(""!==$(".popover-outline-search-field")[0].value?savedOutlineSearchedText=$(".popover-outline-search-field")[0].value:""!==$("input#outline-search-text")[1].value&&(savedOutlineSearchedText=$("input#outline-search-text")[1].value),$(".outline-cancel-search").show())});13===e.keyCode&&($(".outline-search-count").hide(),""!==$(".popover-outline-search-field")[0].value||""!==$(".popover-outline-search-field").val()||""!==$("input#outline-search-text")[1].value?(stopWords.indexOf(-1===$(".popover-outline-search-field")[0].value||-1===$(".popover-outline-search-field").val()||-1===$("input#outline-search-text")[1].value)?(outlineSearchResult(),e.preventDefault?e.preventDefault():e.returnValue=!1):(alertMessagesModal(exceptionMsg.enterValidSearch),$(".outline-cancel-search").hide(),e.preventDefault?e.preventDefault():e.returnValue=!1),$(".outlineResultFound").html(""),$(".outline-search-detail-list").html("")):""!==$(".popover-outline-search-field")[0].value&&""!==$(".popover-outline-search-field").val()&&""!==$("input#outline-search-text")[1].value||(alertMessagesModal(exceptionMsg.enterSearchTerm),e.preventDefault?e.preventDefault():e.returnValue=!1))}function searchTextInOutlineMobile(e){$(".popover-outline-search-field").keyup(function(){if(void 0!==$("input#outline-search-text-mobile")[1]){$("input#outline-search-text-mobile")[1].value;(""!==$("#outline-search-text-mobile").val()||$("input#outline-search-text-mobile")[1].value)&&(savedOutlineSearchedText=$("input#outline-search-text-mobile")[1].value,$(".outline-cancel-search-mobile").show())}}),13===e.keyCode&&($(".outline-search-count").hide(),$("input#outline-search-text-mobile")[1].value||""!==$("#outline-search-text-mobile").val()?(stopWords.indexOf(-1===$("input#outline-search-text-mobile")[1].value||-1===$("#outline-search-text-mobile").val())?(outlineSearchResult(),e.preventDefault?e.preventDefault():e.returnValue=!1):(alertMessagesModal(exceptionMsg.enterValidSearch),$(".outline-cancel-search-mobile").hide(),e.preventDefault?e.preventDefault():e.returnValue=!1),$(".outlineResultFound").html(""),$(".outline-search-detail-list").html("")):(""===$("input#outline-search-text-mobile")[1].value||""===$(".popover-outline-search-field").val()||$("input#outline-search-text")[1].value)&&(alertMessagesModal(exceptionMsg.enterSearchTerm),e.preventDefault?e.preventDefault():e.returnValue=!1))}function outlineSearchResult(){var e=$(window).width(),t="";if(""!==$(".popover-outline-search-field")[0].value||void 0!==$("input#outline-search-text-mobile")[1]&&""!==$("input#outline-search-text-mobile")[1].value||void 0!==$("input#outline-search-text")[1]&&""!==$("input#outline-search-text")[1].value){e<768&&$("input#outline-search-text-mobile")&&""!==$("input#outline-search-text-mobile")[1].value?t=$("input#outline-search-text-mobile")[1].value:e>768&&$("input#outline-search-text")[1].value&&(t=$("input#outline-search-text")[1].value);var n={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"OUTLINE_SEARCH_ANNOTATIONS_CONTENT",pageNavigatingFrom:"Outline",pageNavigatingTo:"Outline",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastViewedOutlineType:"chapterOutline",lastViewedCustomOutlineId:currentCustomOutlineId,lastViewedCustomOutlineTitle:currentCustomOutlineTitle,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:CaseConnect.lastViewedOutlineId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,ipAddress:localStorage.getItem("ipAddress"),sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},contentSearchVO:{bookId:CaseConnect.currentBookId,searchKeyWord:t,paginationResultsPerPage:null}};$(".search-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageSearchService/searchTextInOutline",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(n)}).then(function(e){if(void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),$(".outlineResultFound").html(""),$(".outline-search-detail-list").html(""),e.outlineSearchVO&&e.outlineSearchVO.contentSearchResultVOList&&e.outlineSearchVO.contentSearchResultVOList){$(".outline-search-count").show();var n=[];e.outlineSearchVO.contentSearchResultVOList.length>0?(n=e.outlineSearchVO.contentSearchResultVOList,$(".outlineResultFound").html(e.outlineSearchVO.totalResultCount+" results found")):(n.push(e.outlineSearchVO.contentSearchResultVOList),$(".outlineResultFound").html(e.outlineSearchVO.totalResultCount+" result found"));for(var i=0;i<n.length;i++)if(n[i].chapterId)if(chapterTitleVal=n[i].chapterTitle?n[i].chapterTitle:n[i].chapterTitleInherit,0===chapterTitleVal.indexOf("Chapter"))$(".outline-search-detail-list").append("<li id='outline-result-list-element' class='outline-result-list-element list-style-none'><a href='#' id='outline-search-sentence' class=' display-inline-block outline-search-sentence' annotationId="+n[i].annotationId+" chapterId="+n[i].chapterId+" chapterTitle="+chapterTitleVal+" onclick = 'outlineGotoSearchAnnotation(event);'>"+chapterTitleVal+"</a></li>");else{var o="";n[i].chapterId&&$(outlineViewChapterList).each(function(){this.chapterId===n[i].chapterId&&(o=this.chapterNumber)}),$(".outline-search-detail-list").append("<li id='outline-result-list-element' class='outline-result-list-element list-style-none'><a href='#' id='outline-search-sentence' class=' display-inline-block outline-search-sentence' annotationId="+n[i].annotationId+" chapterId="+n[i].chapterId+" chapterTitle="+chapterTitleVal+" onclick = 'outlineGotoSearchAnnotation(event);'>Chapter "+o+": "+chapterTitleVal+"</a></li>")}else $(".outline-search-detail-list").append("<li id='outline-result-list-element' class='outline-result-list-element list-style-none'><a href='#' id='outline-search-sentence' class=' display-inline-block outline-search-sentence' annotationId="+n[i].annotationId+" chapterId="+n[i].customOutlinId+" chapterTitle="+n[i].customOutlineTitle+" onclick = 'outlineGotoSearchAnnotation(event);' customOutline = 'true'>"+n[i].customOutlineTitle+"</a></li>");savedOutlineSearchedText=t}(null!==e.outlineSearchVO&&void 0!==e.outlineSearchVO||"true"!==e.status)&&(e.outlineSearchVO.contentSearchResultVOList||"true"!==e.status)||($(".outline-search-count").show(),$(".outlineResultFound").html("No results found")),$(".search-loading-spinner").hide(),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#search-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain,$(".search-loading-spinner").hide()})}else $(".outline-search-detail-list").html("")}function cancelBtnOutlineSearch(){$(".popover-outline-search-field").val(""),$("input#outline-search-text")[1].value="",$(".outline-cancel-search").hide(),$(".outline-search-detail-list").html(""),$(".outlineResultFound").html(""),$(".outline-search-count").hide(),savedOutlineSearchedText=null,setTimeout(function(){$("input.outline-search-area").focus()},500)}function cancelBtnOutlineSearchMobile(){$(".popover-outline-search-field").val(""),$("input#outline-search-text")[1].value="",$(".outline-cancel-search-mobile").hide(),$(".outline-search-detail-list").html(""),$(".outlineResultFound").html(""),$(".outline-search-count").hide(),savedOutlineSearchedText=null,setTimeout(function(){$("input#outline-search-text-mobile").focus()},500)}function closeOutlineSearchPopover(e){$("#outline-search-text-desktop").popover("hide"),$("input.outline-search-area").focus(),setTimeout(function(){$("input.outline-search-area").focus()},500)}function closeOutlineSearchPopoverMobile(e){$("#outline-search-mobile").popover("hide"),setTimeout(function(){$("#outline-nav-menu-mobile-cog").focus()},500)}function outlineGotoSearchAnnotation(e){$("#outline-search-text-desktop").popover("hide"),$("#outline-search-mobile").popover("hide"),setTimeout(function(){$("input.outline-search-area").focus()},500);e.currentTarget.getAttribute("annotationId"),e.currentTarget.getAttribute("annotationId");"true"!==e.currentTarget.getAttribute("customOutline")?(CaseConnect.currentChapterId=e.currentTarget.getAttribute("chapterId"),comingFromOutlineSearch=!0,nonEditableChapterOutline=!0,tinymceForCustomVisible=!1,lastViewedNotesTab="chapterOutlineInBook",goToMenuNotesFlag="bookNotes",$(".outline-my-notes-tab").removeClass("active"),$(".outline-book-notes-tab").addClass("active"),insideCustomOutline=!1,$(".editor-submit-wrapper").html(""),$("#chapter-title-input-outline").attr("disabled","disabled"),getAnnotationsForChapterOutline()):(CaseConnect.currentChapterId=e.currentTarget.getAttribute("chapterId"),$("#page-loading-spinner").show(),$(".outline-book-notes-tab").removeClass("active"),$(".outline-my-notes-tab").addClass("active"),goToMenuNotesFlag="myNotes",insideCustomOutline=!0,tinymceForCustomVisible=!1,newCustomOutlineBeingCreated=!1,currentCustomOutlineId=CaseConnect.currentChapterId,loadOutlineFromTabs()),$(window).scrollTop(0)}function loadChapterNotesFromTab(e){if(nonEditableChapterOutline=!0,customOutlineTobeSaved&&nonEditableChapterOutline)return lastVisitedNotesLabel=e.currentTarget.getAttribute("value"),void saveCustomOutlineFromAnywhere();if(lastVisitedNotesLabel=null,e){if(!("myNotes"===e.currentTarget.getAttribute("value")&&!insideCustomOutline||"bookNotes"===e.currentTarget.getAttribute("value")&&insideCustomOutline||"myNotes"===e.currentTarget.getAttribute("value")&&insideCustomOutline&&newCustomOutlineBeingCreated))return;loadChapterListColumn(e)}else loadChapterListColumn(e)}function loadChapterListColumn(e){$("#page-loading-spinner").show(),tinymceForCustomVisible=!1,e?(comingFromAnotherMyNote=!1,"myNotes"===e.currentTarget.getAttribute("value")?(lastViewedNotesTab="customOutlineInBook",insideCustomOutline=!0,goToMenuNotesFlag="myNotes",$(".outline-book-notes-tab").removeClass("active"),$(".outline-my-notes-tab").addClass("active")):"bookNotes"===e.currentTarget.getAttribute("value")&&(lastViewedNotesTab="chapterOutlineInBook",$(".outline-my-notes-tab").removeClass("active"),$(".outline-book-notes-tab").addClass("active"),goToMenuNotesFlag="bookNotes",insideCustomOutline=!1,newCustomOutlineBeingCreated=!1,$(".editor-submit-wrapper").html(""),$("#chapter-title-input-outline").attr("disabled","disabled")),comingFromCustomOutline&&!insideCustomOutline?(lastVisitedNonEditableChapterId?CaseConnect.currentChapterId=lastVisitedNonEditableChapterId:lastVisitedNonEditableChapterId||(CaseConnect.currentChapterId=""),getAnnotationsForChapterOutline(),$("#chapter-title-input-outline").attr("disabled","disabled")):(!comingFromCustomOutline&&insideCustomOutline||comingFromCustomOutline&&newCustomOutlineBeingCreated&&insideCustomOutline)&&(!comingFromAnotherMyNote&&lastVisitedEditableChapterId?(CaseConnect.currentChapterId=lastVisitedEditableChapterId,currentCustomOutlineId=CaseConnect.currentChapterId):!lastVisitedEditableChapterId&&lastVisitedCustomOutlineId&&(CaseConnect.currentChapterId=lastVisitedCustomOutlineId,currentCustomOutlineId=CaseConnect.currentChapterId),loadOutlineFromTabs(),newCustomOutlineBeingCreated=!1)):insideCustomOutline||"customOutlineInBook"===lastViewedNotesTab?($(".outline-book-notes-tab").removeClass("active"),$(".outline-my-notes-tab").addClass("active"),goToMenuNotesFlag="myNotes",insideCustomOutline=!0,null!==currentCustomOutlineId&&null!==currentCustomOutlineTitle||(lastVisitedCustomOutlineId?currentCustomOutlineId=lastVisitedCustomOutlineId:(currentCustomOutlineId="",currentCustomOutlineTitle="")),loadOutlineFromTabs()):insideCustomOutline&&"chapterOutlineInBook"!==lastViewedNotesTab||(goToMenuNotesFlag="bookNotes",$(".outline-my-notes-tab").removeClass("active"),$(".outline-book-notes-tab").addClass("active"),insideCustomOutline=!1,$(".editor-submit-wrapper").html(""),$("#chapter-title-input-outline").attr("disabled","disabled"),getAnnotationsForChapterOutline())}function loadOutlineFromTabs(){$("#page-loading-spinner").show();var e=null;e=insideCustomOutline?{userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"OUTLINE_GET_RECENT_NOTES",pageNavigatingFrom:"Outline",pageNavigatingTo:"Outline",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastViewedCustomOutlineId:currentCustomOutlineId,lastViewedCustomOutlineTitle:currentCustomOutlineTitle,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:2,lastViewedOutlineType:"customOutline"},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},outlineVO:{bookId:CaseConnect.currentBookId,recentNotesFlag:"allNotes"}}:{userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"OUTLINE_GET_RECENT_NOTES",pageNavigatingFrom:navigatingFromClassInsightsToOutline?"ClassInsight":"Outline",pageNavigatingTo:"Outline",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:navigatingFromClassInsightsToOutline?"":CaseConnect.currentChapterId,lastReadChapterTitle:navigatingFromClassInsightsToOutline?"":CaseConnect.currentChapterTitle,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:2,lastViewedOutlineType:"chapterOutline"},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},outlineVO:{bookId:CaseConnect.currentBookId,recentNotesFlag:"allNotes"}},$("#outline-notes-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageOutlineService/getOutlineNotes",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(e)}).then(function(e){void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),void 0!==e.casesFlag?(CaseConnect.casesFlag=e.casesFlag,"true"===CaseConnect.casesFlag?CaseConnect.bookType?"oer"!==CaseConnect.bookType&&$(".hide-case-page-class").show():$(".hide-case-page-class").show():$(".hide-case-page-class").hide()):$(".hide-case-page-class").hide(),"true"===CaseConnect.casesFlag?CaseConnect.bookType?"oer"!==CaseConnect.bookType&&$(".hide-case-page-class").show():$(".hide-case-page-class").show():$(".hide-case-page-class").hide(),void 0!==e.newsFeedFlag?(CaseConnect.newsFeedFlag=e.newsFeedFlag,"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide()):$(".hide-news-feed-class").hide(),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide();if(e.outlineVO){if("bookNotes"===goToMenuNotesFlag){comingFromCustomOutline=!1,comingFromAnotherMyNote=!1,$(".outline-notes-list-block").html("");var t=[];e.outlineVO.chapterOutlineVO&&(e.outlineVO.chapterOutlineVO.length>0?t=e.outlineVO.chapterOutlineVO:t.push(e.outlineVO.chapterOutlineVO)),outlineViewChapterList=t,chapterOutlineList=t,$(outlineViewChapterList).each(function(){this.chapterId===CaseConnect.currentChapterId&&(CaseConnect.currentChapterTitle="Chapter "+this.chapterNumber+": "+this.chapterTitle,CaseConnect.currentNavbarTitle=this.navbarTitle)}),$("#chapter-outline-date").html("");for(var n=0;n<t.length;n++)if("none"!==t[n].chapterNumber&&""!==t[n].chapterNumber)if(insideCustomOutline||t[n].chapterId!==CaseConnect.currentChapterId)if(t[n].lastModifiedTimestamp){i=retriveLocalTimeFromUTC(t[n].lastModifiedTimestamp);i=moment(i.toString()).format(" MMMM DD, YYYY"),$(".outline-notes-list-block").append('<li class="outline-notes-list-li list-style-none"><a class="list-group-item outline-notes-list-item ellipsis" href="#" id="list-group-item" onclick="bookNotesClick(event)" chapterId="'+t[n].chapterId+'" chapterTitle="'+t[n].navbarTitle+'" chapterNumber="'+t[n].chapterNumber+'"><span class="outline-notes-chapter-name ellipsis">'+t[n].navbarTitle+'</span><span class="outline-notes-edited-date">Updated'+i+"</span></a></li>")}else $(".outline-notes-list-block").append('<li class="outline-notes-list-li list-style-none"><a class="list-group-item outline-notes-list-item ellipsis" href="#" id="list-group-item" onclick="bookNotesClick(event)" chapterId="'+t[n].chapterId+'" chapterTitle="'+t[n].navbarTitle+'" chapterNumber="'+t[n].chapterNumber+'"><span class="outline-notes-chapter-name ellipsis">'+t[n].navbarTitle+"</span> </a></li>");else if(t[n].lastModifiedTimestamp){var i=retriveLocalTimeFromUTC(t[n].lastModifiedTimestamp);i=moment(i.toString()).format(" MMMM DD, YYYY"),$(".outline-notes-list-block").append('<li class="outline-notes-list-li list-style-none"><a class="list-group-item outline-notes-list-item recent-selected-note  ellipsis" href="#" id="list-group-item" onclick="bookNotesClick(event)" chapterId="'+t[n].chapterId+'" chapterTitle="'+t[n].navbarTitle+'" chapterNumber="'+t[n].chapterNumber+'"><span class="outline-notes-chapter-name ellipsis">'+t[n].navbarTitle+'</span><span class="outline-notes-edited-date">Updated'+i+"</span></a></li>"),updateLastSavedTime(t[n].lastModifiedTimestamp)}else $(".outline-notes-list-block").append('<li class="outline-notes-list-li list-style-none"><a class="list-group-item outline-notes-list-item recent-selected-note  ellipsis" href="#" id="list-group-item" onclick="bookNotesClick(event)" chapterId="'+t[n].chapterId+'" chapterTitle="'+t[n].navbarTitle+'" chapterNumber="'+t[n].chapterNumber+'"><span class="outline-notes-chapter-name ellipsis">'+t[n].navbarTitle+"</span></a></li>");$(window).trigger("resize"),t.length,$("#page-loading-spinner").hide()}else if("myNotes"===goToMenuNotesFlag)if($(".outline-notes-list-block").html(""),lastVisitedEditableChapterId="",comingFromCustomOutline=!0,e.outlineVO.customOutlineVO){var o=[];customOutlineData=e.outlineVO.customOutlineVO,e.outlineVO.customOutlineVO.length>0?o=e.outlineVO.customOutlineVO:o.push(e.outlineVO.customOutlineVO);for(n=0;n<o.length;n++)if(CaseConnect.currentChapterId===o[n].chapterId||comingFromAnotherMyNote){if(CaseConnect.currentChapterId===o[n].chapterId){CaseConnect.currentChapterId=o[n].chapterId;break}}else CaseConnect.currentChapterId=o[0].chapterId;for(n=0;n<o.length;n++){if("none"!==o[n].chapterId&&""!==o[n].chapterId&&"customOutline"===o[n].outlineType){i=retriveLocalTimeFromUTC(o[n].lastModifiedTimestamp);i=moment(i.toString()).format(" MMMM DD, YYYY"),insideCustomOutline&&o[n].chapterId===currentCustomOutlineId?($(".outline-notes-list-block").append('<li class="outline-notes-list-li list-style-none"><a class="list-group-item outline-notes-list-item recent-selected-note  ellipsis" href="#" id="list-group-item" onclick="myNotesClick(event);" chapterId="'+o[n].chapterId+'" chapterTitle="'+o[n].chapterTitle+'" lastModifiedTimestamp="'+o[n].lastModifiedTimestamp+'"><span class="outline-notes-chapter-name ellipsis">'+o[n].chapterTitle+'</span><span class="outline-notes-edited-date">Updated'+i+"</span></a></li>"),newCustomOutlineBeingCreated||(CaseConnect.currentChapterId=currentCustomOutlineId,lastVisitedEditableChapterId=currentCustomOutlineId,document.getElementById("chapter-title-input-outline").value=o[n].chapterTitle,document.getElementById("chapter-title-input-outline").title=o[n].chapterTitle,document.getElementById("chapter-title-input-outline").setAttribute("aria-label",o[n].chapterTitle))):null===currentCustomOutlineId&&o[n].chapterId===o[0].chapterId?$(".outline-notes-list-block").append('<li class="outline-notes-list-li list-style-none"><a class="list-group-item outline-notes-list-item recent-selected-note  ellipsis" href="#" id="list-group-item" onclick="myNotesClick(event);" chapterId="'+o[n].chapterId+'" chapterTitle="'+o[n].chapterTitle+'" lastModifiedTimestamp="'+o[n].lastModifiedTimestamp+'"><span class="outline-notes-chapter-name ellipsis">'+o[n].chapterTitle+'</span><span class="outline-notes-edited-date">Updated'+i+"</span></a></li>"):$(".outline-notes-list-block").append('<li class="outline-notes-list-li list-style-none"><a class="list-group-item outline-notes-list-item ellipsis" href="#" id="list-group-item" onclick="myNotesClick(event);" chapterId="'+o[n].chapterId+'" chapterTitle="'+o[n].chapterTitle+'" lastModifiedTimestamp="'+o[n].lastModifiedTimestamp+'"><span class="outline-notes-chapter-name ellipsis">'+o[n].chapterTitle+'</span><span class="outline-notes-edited-date">Updated'+i+"</span></a></li>")}comingFromAnotherMyNote||lastVisitedEditableChapterId||newCustomOutlineBeingCreated?!comingFromAnotherMyNote||lastVisitedEditableChapterId||newCustomOutlineBeingCreated||(lastVisitedEditableChapterId=CaseConnect.currentChapterId):(lastVisitedEditableChapterId=o[0].chapterId,document.getElementById("chapter-title-input-outline").value=o[0].chapterTitle,document.getElementById("chapter-title-input-outline").title=o[0].chapterTitle,document.getElementById("chapter-title-input-outline").setAttribute("aria-label",o[0].chapterTitle))}newCustomOutlineBeingCreated||outlineCustomNotes(),$(window).trigger("resize"),o.length>10?$(".outline-notes-list-block-desktop").customScrollbar({skin:"default-skin",hScroll:!1,vScroll:!0,updateOnWindowResize:!0}):$(".outline-notes-list-block-desktop").removeClass("default-skin"),newCustomOutlineBeingCreated&&$("#page-loading-spinner").hide()}else{if($(".outline-notes-list-block").html(" "),!newCustomOutlineBeingCreated){comingFromAnotherMyNote=!1,document.getElementById("chapter-title-input-outline").value="",$("#chapter-title-input-outline").removeAttr("disabled"),$("#chapter-title-input-outline").removeAttr("title"),$("#chapter-title-input-outline").attr("onblur","saveCustomAnnotationTitleOnBlur();"),$("#outline-empty-notes-placeholder").show(),outlineEmptyEditorWithBorder(),$(".outline-note-date").empty(),insideCustomOutline=!0,newCustomOutlineBeingCreated=!0,comingFromCustomOutline=!0,currentCustomOutlineId=null,currentCustomAnnotationId=null,currentCustomOutlineTitle=null;var a=Handlebars.getTemplate("outline-new-template");$(".outline-editor-container").html(a),$("#chapter-title-input-outline").removeAttr("disabled"),$("#chapter-title-input-outline").removeAttr("title"),tinyMCE.get("tinymce-outline-content"),document.getElementById("chapter-title-input-outline").value="",$("#save-btn-annotation-outline").attr("disabled","disabled"),$("#save-btn-annotation-outline").css("cursor","auto"),$("#save-btn-annotation-outline-mobile").attr("disabled","disabled"),$("#save-btn-annotation-outline-mobile").css("cursor","auto"),$("#export-chapter-outline").hide(),$(window).trigger("resize");var s=$(window).width();return $(".new-note-save-mobile").removeClass("save-chapter-outline").addClass("save-custom-outline"),s<768?$(".new-note-save-mobile").show():$(".new-note-save-mobile").hide(),$(".outline-editor-header-editable").show(),$(".outline-editor-header-noneditable").hide(),$("#page-loading-spinner").hide(),!1}$("#page-loading-spinner").hide()}$("#page-loading-spinner").hide()}else $("#page-loading-spinner").hide();newCustomOutlineBeingCreated||(CaseConnect.currentNavbarTitle?(document.getElementById("chapter-title-div-outline-mobile").innerHTML=CaseConnect.currentNavbarTitle,document.getElementById("chapter-title-input-outline").value=CaseConnect.currentNavbarTitle,document.getElementById("chapter-title-input-outline").setAttribute("aria-label",CaseConnect.currentNavbarTitle),document.getElementById("chapter-title-div-outline-mobile").setAttribute("aria-label",CaseConnect.currentNavbarTitle)):(document.getElementById("chapter-title-div-outline-mobile").innerHTML=CaseConnect.currentChapterTitle,document.getElementById("chapter-title-input-outline").value=CaseConnect.currentChapterTitle,document.getElementById("chapter-title-input-outline").setAttribute("aria-label",CaseConnect.currentChapterTitle),document.getElementById("chapter-title-div-outline-mobile").setAttribute("aria-label",CaseConnect.currentChapterTitle)))},function(e){navigatingFromClassInsightsToOutline=!1,sessionAuthFails(e),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain,$("#page-loading-spinner").hide(),sessionTimeOut()})}function loadCustomNotesAfterSave(){reqData={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"OUTLINE_GET_RECENT_NOTES",pageNavigatingFrom:"Outline",pageNavigatingTo:"Outline",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastViewedCustomOutlineId:currentCustomOutlineId,lastViewedCustomOutlineTitle:currentCustomOutlineTitle,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:2,lastViewedOutlineType:"customOutline"},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},outlineVO:{bookId:CaseConnect.currentBookId,recentNotesFlag:"allNotes"}},$("#outline-notes-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageOutlineService/getOutlineNotes",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(reqData)}).then(function(e){void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),void 0!==e.casesFlag?(CaseConnect.casesFlag=e.casesFlag,"true"===CaseConnect.casesFlag?CaseConnect.bookType?"oer"!==CaseConnect.bookType&&$(".hide-case-page-class").show():$(".hide-case-page-class").show():$(".hide-case-page-class").hide()):$(".hide-case-page-class").hide(),void 0!==e.newsFeedFlag?(CaseConnect.newsFeedFlag=e.newsFeedFlag,"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide()):$(".hide-news-feed-class").hide(),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide();if(e.outlineVO&&(goToMenuNotesFlag="myNotes",$(".outline-notes-list-block").html(""),lastVisitedEditableChapterId="",comingFromCustomOutline=!0,e.outlineVO.customOutlineVO)){var t=[];customOutlineData=e.outlineVO.customOutlineVO,e.outlineVO.customOutlineVO.length>0?t=e.outlineVO.customOutlineVO:t.push(e.outlineVO.customOutlineVO);for(var n=0;n<t.length;n++)if(CaseConnect.currentChapterId===t[n].chapterId||comingFromAnotherMyNote){if(CaseConnect.currentChapterId===t[n].chapterId){CaseConnect.currentChapterId=t[n].chapterId;break}}else CaseConnect.currentChapterId=t[0].chapterId;for(n=0;n<t.length;n++){if("none"!==t[n].chapterId&&""!==t[n].chapterId&&"customOutline"===t[n].outlineType){var i=retriveLocalTimeFromUTC(t[n].lastModifiedTimestamp);i=moment(i.toString()).format(" MMMM DD, YYYY"),insideCustomOutline&&t[n].chapterId===currentCustomOutlineId?($(".outline-notes-list-block").append('<li class="outline-notes-list-li list-style-none"><a class="list-group-item outline-notes-list-item recent-selected-note  ellipsis" href="#" id="list-group-item" onclick="myNotesClick(event);" chapterId="'+t[n].chapterId+'" chapterTitle="'+t[n].chapterTitle+'" lastModifiedTimestamp="'+t[n].lastModifiedTimestamp+'"><span class="outline-notes-chapter-name ellipsis">'+t[n].chapterTitle+'</span><span class="outline-notes-edited-date">Updated'+i+"</span></a></li>"),newCustomOutlineBeingCreated||(CaseConnect.currentChapterId=currentCustomOutlineId,lastVisitedEditableChapterId=currentCustomOutlineId,document.getElementById("chapter-title-input-outline").value=t[n].chapterTitle,document.getElementById("chapter-title-input-outline").title=t[n].chapterTitle,document.getElementById("chapter-title-input-outline").setAttribute("aria-label",t[n].chapterTitle))):$(".outline-notes-list-block").append('<li class="outline-notes-list-li list-style-none"><a class="list-group-item outline-notes-list-item ellipsis" href="#" id="list-group-item" onclick="myNotesClick(event);" chapterId="'+t[n].chapterId+'" chapterTitle="'+t[n].chapterTitle+'" lastModifiedTimestamp="'+t[n].lastModifiedTimestamp+'"><span class="outline-notes-chapter-name ellipsis">'+t[n].chapterTitle+'</span><span class="outline-notes-edited-date">Updated'+i+"</span></a></li>")}comingFromAnotherMyNote||lastVisitedEditableChapterId||newCustomOutlineBeingCreated?!comingFromAnotherMyNote||lastVisitedEditableChapterId||newCustomOutlineBeingCreated||(lastVisitedEditableChapterId=CaseConnect.currentChapterId):(lastVisitedEditableChapterId=t[0].chapterId,document.getElementById("chapter-title-input-outline").value=t[0].chapterTitle,document.getElementById("chapter-title-input-outline").title=t[0].chapterTitle,document.getElementById("chapter-title-input-outline").setAttribute("aria-label",t[0].chapterTitle))}newCustomOutlineBeingCreated||outlineCustomNotes(),$(window).trigger("resize"),t.length>10?$(".outline-notes-list-block-desktop").customScrollbar({skin:"default-skin",hScroll:!1,vScroll:!0,updateOnWindowResize:!0}):$(".outline-notes-list-block-desktop").removeClass("default-skin"),newCustomOutlineBeingCreated&&$("#page-loading-spinner").hide()}sessionTimeOut()},function(e){navigatingFromClassInsightsToOutline=!1,sessionAuthFails(e),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain,sessionTimeOut()})}function getAnnotationsForChapterOutline(){$("#page-loading-spinner").show(),$("#export-chapter-outline").css("display","block"),$(".new-note-save-mobile").removeClass("save-custom-outline").addClass("save-chapter-outline"),$(".save-chapter-outline .new-note-save-mobile").css("display","none"),$(".outline-new-note-disable").css("display","none"),$(".outline-editor-header-editable").hide(),$(".outline-editor-header-noneditable").show(),$(window).trigger("resize"),$(".outline-editor-header-textbox").css({"background-color":"none",margin:"0px 15px","padding-left":"0","padding-right":"0"}),$("#page-loading-spinner").show();var e={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"OUTLINE_GET_CHAPTER_ANNOTATIONS",pageNavigatingFrom:navigatingFromClassInsightsToOutline?"ClassInsight":"Outline",pageNavigatingTo:"Outline",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:navigatingFromClassInsightsToOutline?"":CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:CaseConnect.lastViewedOutlineId,lastViewedOutlineType:"chapterOutline"},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},annotationVO:{bookId:CaseConnect.currentBookId,chapterId:navigatingFromClassInsightsToOutline?"":CaseConnect.currentChapterId,ereaderNotesAndHighlightsPopoverFlowFlag:"true"}};$.ajax({url:properties[properties.env]+"/manageOutlineService/getChapterOutline",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(e)}).then(function(e){sessionTimeOut(),void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken);var t=e;navigatingFromClassInsightsToOutline=!1,e.chapterId&&(CaseConnect.currentChapterId=e.chapterId,CaseConnect.currentChapterId&&(lastVisitedNonEditableChapterId=CaseConnect.currentChapterId,outlineViewChapterList&&$(outlineViewChapterList).each(function(){this.chapterId===CaseConnect.currentChapterId&&(CaseConnect.currentChapterTitle="Chapter "+this.chapterNumber+": "+this.chapterTitle,CaseConnect.currentNavbarTitle=this.navbarTitle)}),CaseConnect.currentNavbarTitle?(document.getElementById("chapter-title-div-outline-mobile").innerHTML=CaseConnect.currentNavbarTitle,document.getElementById("chapter-title-input-outline").value=CaseConnect.currentNavbarTitle,document.getElementById("chapter-title-input-outline").setAttribute("aria-label",CaseConnect.currentNavbarTitle),document.getElementById("chapter-title-div-outline-mobile").setAttribute("aria-label",CaseConnect.currentNavbarTitle)):(document.getElementById("chapter-title-div-outline-mobile").innerHTML=CaseConnect.currentChapterTitle,document.getElementById("chapter-title-input-outline").value=CaseConnect.currentChapterTitle,document.getElementById("chapter-title-input-outline").setAttribute("aria-label",CaseConnect.currentChapterTitle),document.getElementById("chapter-title-div-outline-mobile").setAttribute("aria-label",CaseConnect.currentChapterTitle)),$(".outline-editor-header-editable").hide(),$(".outline-editor-header-noneditable").show(),$(window).trigger("resize"),document.getElementById("chapter-title-input-outline").title=CaseConnect.currentChapterTitle));var n=Handlebars.getTemplate("outline-chapter-annotations")(t);if(($(".outline-editor-container").html(n),t.sectionVOList)&&(nonEditableChapterOutline&&(CaseConnect.bookData?void 0!==CaseConnect.bookTitle?($(".ereader-main-header-title").html(CaseConnect.bookTitle),$(".read-modal-book-title").html(CaseConnect.bookTitle),$(".outline-booktitle-mobile").html(CaseConnect.bookTitle)):($(".ereader-main-header-title").html(CaseConnect.bookData.bookTitle),$(".read-modal-book-title").html(CaseConnect.bookData.bookTitle),$(".outline-booktitle-mobile").html(CaseConnect.bookData.bookTitle)):CaseConnect.bookName?($(".ereader-main-header-title").html(CaseConnect.bookName),$(".read-modal-book-title").html(CaseConnect.bookName),$(".outline-booktitle-mobile").html(CaseConnect.bookName)):($(".ereader-main-header-title").html(CaseConnect.navigatingAwayFromNewBookshelf[0].bookTitle),$(".read-modal-book-title").html(CaseConnect.navigatingAwayFromNewBookshelf[0].bookTitle),$(".outline-booktitle-mobile").html(CaseConnect.navigatingAwayFromNewBookshelf[0].bookTitle)),Array.isArray(t.sectionVOList)||(t.sectionVOList=[t.sectionVOList]),$("#outline-chapter-annotation")&&t.sectionVOList.length>0))){for(var i=0;i<t.sectionVOList.length;i++)if(void 0!==t.sectionVOList[i].sectionId&&""!==t.sectionVOList[i].sectionId&&"-9999"!==t.sectionVOList[i].sectionId){if("A"===t.sectionVOList[i].sectionType||""===t.sectionVOList[i].sectionType&&-1!==t.sectionVOList[i].sectionId.indexOf("footnotes")){if((p=document.createElement("DIV")).id="sectionTitleA_"+t.sectionVOList[i].sectionId,document.getElementById("outline-chapter-annotation").appendChild(p),void 0!==t.sectionVOList[i].sectionTitle&&""!==t.sectionVOList[i].sectionTitle&&-1===t.sectionVOList[i].sectionTitle.indexOf("-999")){var o=document.createElement("DIV");o.setAttribute("class","outline-section-titleA"),o.setAttribute("tabindex","0"),o.setAttribute("aria-label",t.sectionVOList[i].sectionTitle),p.appendChild(o),o.innerHTML=t.sectionVOList[i].sectionTitle}else t.sectionVOList[i].sectionTitle;if(t.sectionVOList[i].annotationVOList){var a=[];t.sectionVOList[i].annotationVOList.length>0?a=t.sectionVOList[i].annotationVOList:a.push(t.sectionVOList[i].annotationVOList);for(var s=0;s<a.length;s++)if(a[s].highlightText){(m=document.createElement("DIV")).id="highlightedTextWrapperA_"+t.sectionVOList[i].sectionId,m.setAttribute("class","outline-annotation-A"),m.setAttribute("aria-labelledby",m.id),p.appendChild(m);var l=document.createElement("DIV");if(m.appendChild(l),(h=document.createElement("SPAN")).setAttribute("class","outline-annotation-highlight-A"),h.style.backgroundColor=a[s].highlightColorCode,h.innerHTML=a[s].highlightText,l.appendChild(h),void 0!==a[s].noteText&&""!==a[s].noteText)(g=document.createElement("DIV")).setAttribute("class","outline-annotation-highlight-A"),g.innerHTML=a[s].noteText.replace(/</g,"&lt;").replace(/>/g,"&gt;"),m.appendChild(g)}}else{if(void 0!==t.sectionVOList[i].sectionTitle&&""!==t.sectionVOList[i].sectionTitle&&-1===t.sectionVOList[i].sectionTitle.indexOf("-999"))(d=document.createElement("div")).id="outline-empty-section-block_"+t.sectionVOList[i].sectionId,d.className="outline-empty-block",document.getElementById("sectionTitleA_"+t.sectionVOList[i].sectionId)&&document.getElementById("sectionTitleA_"+t.sectionVOList[i].sectionId).appendChild(d)}}else if("B"===t.sectionVOList[i].sectionType||""===t.sectionVOList[i].sectionType&&-1===t.sectionVOList[i].sectionId.indexOf("footnotes")){var r=document.createElement("DIV");if(r.id="sectionTitleB_"+t.sectionVOList[i].sectionId,document.getElementById("outline-chapter-annotation").appendChild(r),void 0!==t.sectionVOList[i].sectionTitle&&""!==t.sectionVOList[i].sectionTitle){var u=document.createElement("DIV");u.setAttribute("class","outline-section-titleB"),u.setAttribute("tabindex","0"),u.setAttribute("aria-label",t.sectionVOList[i].sectionTitle),r.appendChild(u),u.innerHTML=t.sectionVOList[i].sectionTitle}if(t.sectionVOList[i].annotationVOList){a=[];t.sectionVOList[i].annotationVOList.length>0?a=t.sectionVOList[i].annotationVOList:a.push(t.sectionVOList[i].annotationVOList);for(var c=0;c<a.length;c++)if(a[c].highlightText){(m=document.createElement("DIV")).id="highlightedTextWrapperB_"+t.sectionVOList[i].sectionId,m.setAttribute("class","outline-annotation-B"),m.setAttribute("aria-labelledby",m.id),r.appendChild(m);l=document.createElement("DIV");if(m.appendChild(l),null!=a[c].labelName&&null!=a[c].labelName)(C=document.createElement("DIV")).setAttribute("class","outline-annotation-highlight-B brief-label-highlight-popover"),C.innerHTML=a[c].labelName.replace(/</g,"&lt;").replace(/>/g,"&gt;"),l.appendChild(C);if((h=document.createElement("SPAN")).setAttribute("class","outline-annotation-highlight-B"),h.style.backgroundColor=a[c].highlightColorCode,h.innerHTML=a[c].highlightText,l.appendChild(h),void 0!==a[c].noteText&&""!==a[c].noteText)(g=document.createElement("DIV")).setAttribute("class","outline-annotation-highlight-B"),g.innerHTML=a[c].noteText.replace(/</g,"&lt;").replace(/>/g,"&gt;"),m.appendChild(g)}}else{var d;if(void 0!==t.sectionVOList[i].sectionTitle&&""!==t.sectionVOList[i].sectionTitle&&-1===t.sectionVOList[i].sectionTitle.indexOf("-999"))(d=document.createElement("div")).id="outline-empty-section-block_"+t.sectionVOList[i].sectionId,d.className="outline-empty-block",document.getElementById("sectionTitleB_"+t.sectionVOList[i].sectionId)&&document.getElementById("sectionTitleB_"+t.sectionVOList[i].sectionId).appendChild(d)}}}else if("-9999"===t.sectionVOList[i].sectionId&&null!==t.sectionVOList[i].annotationVOList&&void 0!==t.sectionVOList[i].annotationVOList){Array.isArray(t.sectionVOList[i].annotationVOList)||(t.sectionVOList[i].annotationVOList=[t.sectionVOList[i].annotationVOList]);var p;a=[];a=t.sectionVOList[i].annotationVOList,(p=document.createElement("DIV")).id="sectionTitleZero_"+i,document.getElementById("outline-chapter-annotation").appendChild(p);for(s=0;s<a.length;s++)if(a[s].highlightText){var m;(m=document.createElement("DIV")).id="highlightedTextWrapperZero_"+t.sectionVOList[i].sectionId,m.setAttribute("class","outline-annotation-Zero"),p.appendChild(m);var C,h,g;l=document.createElement("DIV");if(m.appendChild(l),null!=a[s].labelName&&null!=a[s].labelName)(C=document.createElement("DIV")).setAttribute("class","outline-annotation-highlight-A brief-label-highlight-popover"),C.innerHTML=a[s].labelName.replace(/</g,"&lt;").replace(/>/g,"&gt;"),l.appendChild(C);if((h=document.createElement("SPAN")).setAttribute("class","outline-annotation-highlight-A"),h.style.backgroundColor=a[s].highlightColorCode,h.innerHTML=a[s].highlightText,l.appendChild(h),void 0!==a[s].noteText&&""!==a[s].noteText)(g=document.createElement("DIV")).setAttribute("class","outline-annotation-highlight-A"),g.innerHTML=a[s].noteText,m.appendChild(g)}}nonEditableChapterOutline=!1,loadOutlineFromTabs()}},function(e){navigatingFromClassInsightsToOutline=!1,sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function bookNotesClick(e){closeOverlayInMobile("outline-nav-menu-mobile");var t=e.currentTarget.getAttribute("chapterId");if($("#outline-notes-menu-mobile").modal("hide"),$("li outline-search-result-item").hasClass("active")||$(e.currentTarget).hasClass("recent-selected-note"))return $("#page-loading-spinner").hide(),!0;CaseConnect.currentChapterId!==t&&($("#page-loading-spinner").show(),insideCustomOutline=!1,CaseConnect.currentChapterId=t,CaseConnect.currentChapterId&&$(chapterOutlineList).each(function(){this.chapterId===CaseConnect.currentChapterId&&(CaseConnect.currentChapterTitle="Chapter "+this.chapterNumber+": "+this.chapterTitle,CaseConnect.currentNavbarTitle=this.navbarTitle)}),setTimeout(function(){loadChapterNotesFromTab(),$("#outline-menu").popover("hide"),navigatingAwayFromCurrentOutline=!1},100)),$("#page-loading-spinner").hide()}function createNewCustomOutline(){$("#outline-notes-menu-mobile").modal("hide"),$(window).trigger("resize");var e=$(window).width();if($(".new-note-save-mobile").removeClass("save-chapter-outline").addClass("save-custom-outline"),e<768?$(".new-note-save-mobile").show():$(".new-note-save-mobile").hide(),$("button#professor-book-shelf-cog").hide(),$("#page-loading-spinner").show(),newCustomOutlineBeingCreated=!0,!(customOutlineTobeSaved&&comingFromCustomOutline&&newCustomOutlineBeingCreated))return setTimeout(function(){if(document.getElementById("chapter-title-input-outline").value="",$("#chapter-title-input-outline").removeAttr("disabled"),$("#chapter-title-input-outline").removeAttr("title"),$("#chapter-title-input-outline").attr("onblur","saveCustomAnnotationTitleOnBlur();"),outlineEmptyEditorWithBorder(),$(".outline-note-date").empty(),insideCustomOutline=!0,$("#export-chapter-outline").css("display","none"),$("#list-group-item").removeClass("recent-selected-note"),$(window).trigger("resize"),$(".new-note-save-mobile").removeClass("save-chapter-outline").addClass("save-custom-outline"),$(window).width()<768?$(".new-note-save-mobile").css("display","block"):$(".new-note-save-mobile").css("display","none"),$(".outline-new-note-disable").css("display","block"),$(".outline-editor-header-editable").show(),$(".outline-editor-header-noneditable").hide(),$(".outline-editor-header-textbox").css({"background-color":"#eeeeee",margin:"0px","padding-left":"15px","padding-right":"15px"}),newCustomOutlineBeingCreated=!0,comingFromCustomOutline=!0,currentCustomOutlineId=null,currentCustomAnnotationId=null,currentCustomOutlineTitle=null,CaseConnect.currentChapterId=null,comingFromAnotherMyNote){if(comingFromAnotherMyNote){$("#page-loading-spinner").show(),tinyMCE.get("tinymce-outline-content");tinyMCE.get("tinymce-outline-content").getContent();tinyMCE.get("tinymce-outline-content").setContent(""),comingFromAnotherMyNote=!0;for(t=$(".list-group-item"),n=0;n<t.length;n++)-1!==t[n].className.indexOf("recent-selected-note")&&t[n].classList.remove("recent-selected-note");setTimeout(function(){$(window).scrollTop(0)},1200)}}else{$("#page-loading-spinner").show();var e=Handlebars.getTemplate("outline-new-template");$(".outline-editor-container").html(e),$("#chapter-title-input-outline").removeAttr("disabled"),$("#chapter-title-input-outline").removeAttr("title");for(var t=$(".list-group-item"),n=0;n<t.length;n++)-1!==t[n].className.indexOf("recent-selected-note")&&t[n].classList.remove("recent-selected-note");setTimeout(function(){$(window).scrollTop(0)},1200)}},1200),document.getElementById("chapter-title-input-outline").value="",$("#save-btn-annotation-outline").attr("disabled","disabled"),$("#save-btn-annotation-outline").css("cursor","auto"),$("#save-btn-annotation-outline-mobile").attr("disabled","disabled"),$("#save-btn-annotation-outline-mobile").css("cursor","auto"),setTimeout(function(){$(window).scrollTop(0),$("#page-loading-spinner").hide()},2e3),!1;saveCustomOutlineFromAnywhere()}function outlineEmptyEditorWithBorder(){$("#tinymce-outline-content_ifr").css({"min-height":"300px","margin-bottom":"0px"})}function outlineEmptyEditorWithoutBorder(){$("#outline-empty-notes-placeholder").show(),$("#tinymce-outline-content_ifr").css({"min-height":"300px","margin-bottom":"0px",border:"none","border-radius":"0px"})}function hideThisDivTag(){$("#outline-empty-notes-placeholder").hide(),$("label.outline-editor-label").hide(),tinyMCE.get("tinymce-outline-content")&&tinyMCE.get("tinymce-outline-content").focus()}function GetCaretPositionInIframe(e){var t=document.getElementById(e).contentWindow.getSelection();try{if(t.baseNode)return t.baseNode.parentElement;if(t.focusNode){if(t.focusNode.parentElement)return t.focusNode.parentElement;if(t.focusNode.parentNode)return t.focusNode.parentNode}}catch(e){}}function outlineCustomNotes(){if($("#page-loading-spinner").show(),$("#chapter-title-input-outline").removeAttr("disabled"),$("#chapter-title-input-outline").attr("onblur","saveCustomAnnotationTitleOnBlur();"),$("#outline-empty-notes-placeholder").show(),tinymceForCustomVisible)$("#page-loading-spinner").hide();else{if(comingFromAnotherMyNote||newCustomOutlineBeingCreated){if(comingFromAnotherMyNote&&!newCustomOutlineBeingCreated){if(tinyMCE.get("tinymce-outline-content"),tinyMCE.get("tinymce-outline-content")){tinyMCE.get("tinymce-outline-content").getContent();tinyMCE.get("tinymce-outline-content").setContent("")}fetchCustomOutlineFromRecentAndListing(lastVisitedEditableChapterId)}else if(tinyMCE.get("tinymce-outline-content"),tinyMCE.get("tinymce-outline-content")){tinyMCE.get("tinymce-outline-content").getContent();tinyMCE.get("tinymce-outline-content").setContent("")}}else{outlineEmptyEditorWithBorder();var e=Handlebars.getTemplate("outline-new-template");$(".outline-editor-container").html(e),tinyMCE.get("tinymce-outline-content"),fetchCustomOutlineFromRecentAndListing(lastVisitedEditableChapterId)}tinymceForCustomVisible=!0}return $("#save-btn-annotation-outline").attr("disabled","disabled"),$("#save-btn-annotation-outline").css("cursor","auto"),$("#save-btn-annotation-outline-mobile").attr("disabled","disabled"),$("#save-btn-annotation-outline-mobile").css("cursor","auto"),!1}function fetchCustomOutlineFromRecentAndListing(e,t){fetchCustomOutlineTitleWithId(e),newCustomOutlineBeingCreated=!1}function fetchCustomOutlineTitleWithId(e){$("#page-loading-spinner").show();var t={userVO:{userId:localStorage.getItem("userId"),userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"OUTLINE_GET_CUSTOM_TITLE",pageNavigatingFrom:"Outline",pageNavigatingTo:"Outline",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastViewedOutlineType:"customOutline",lastViewedCustomOutlineId:e,lastViewedCustomOutlineTitle:currentCustomOutlineTitle,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01"},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},outlineVO:{bookId:CaseConnect.currentBookId,customOutlineId:e,outlineType:"customOutline"}};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageOutlineService/getCustomOutlineTitle",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(t)}).then(function(t){void 0!==t.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",t.sessionAuthenticationToken),setTimeout(function(){tinyMCE.get("tinymce-outline-content")},3e3),CaseConnect.bookData?void 0!==CaseConnect.bookTitle?($(".ereader-main-header-title").html(CaseConnect.bookTitle),$(".read-modal-book-title").html(CaseConnect.bookTitle),$(".outline-booktitle-mobile").html(CaseConnect.bookTitle)):($(".ereader-main-header-title").html(CaseConnect.bookData.bookTitle),$(".read-modal-book-title").html(CaseConnect.bookData.bookTitle),$(".outline-booktitle-mobile").html(CaseConnect.bookData.bookTitle)):CaseConnect.bookName?($(".ereader-main-header-title").html(CaseConnect.bookName),$(".read-modal-book-title").html(CaseConnect.bookName),$(".outline-booktitle-mobile").html(CaseConnect.bookName)):($(".ereader-main-header-title").html(CaseConnect.navigatingAwayFromNewBookshelf[0].bookTitle),$(".read-modal-book-title").html(CaseConnect.navigatingAwayFromNewBookshelf[0].bookTitle),$(".outline-booktitle-mobile").html(CaseConnect.navigatingAwayFromNewBookshelf[0].bookTitle)),insideCustomOutline=!0,newCustomOutlineBeingCreated=!1,currentCustomOutlineId=e,$("#export-chapter-outline").css("display","none"),$(window).trigger("resize"),$(".new-note-save-mobile").removeClass("save-chapter-outline").addClass("save-custom-outline"),$(window).width()<768?$(".new-note-save-mobile").css("display","block"):$(".new-note-save-mobile").css("display","none"),$(".outline-new-note-disable").css("display","none"),$(".outline-editor-header-editable").show(),$(".outline-editor-header-noneditable").hide(),$(".outline-editor-header-textbox").css({"background-color":"none",margin:"0px 15px","padding-left":"0","padding-right":"0"}),$("#chapter-title-input-outline").removeAttr("disabled"),$("#chapter-title-input-outline").attr("onblur","saveCustomAnnotationTitleOnBlur();"),currentCustomOutlineTitle=t.outlineVO.chapterTitle,$(".outline-note-date").html(""),t.outlineVO.lastModifiedTimestamp&&updateLastSavedTime(t.outlineVO.lastModifiedTimestamp),$("#chapter-title-input-outline").val(t.outlineVO.chapterTitle),$("#chapter-title-input-outline").attr("title",t.outlineVO.chapterTitle),$("#chapter-title-input-outline").attr("aria-label",t.outlineVO.chapterTitle),fetchCustomOutlineWithId(t.outlineVO.chapterId)},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain,$("#page-loading-spinner").hide()})}function updateLastSavedTime(e){var t=retriveLocalTimeFromUTC(e);t=moment(t.toString()).format("MMMM DD, YYYY | hh:mm A"),$(".outline-note-date").html("Updated "+t),$(".outline-note-date").attr("aria-label","'Updated '"+t),$("#chapter-outline-date").html("Updated "+t),$("#chapter-outline-date").attr("aria-label","'Updated '"+t)}function fetchCustomOutlineWithId(e){$("#page-loading-spinner").show();var t={userVO:{userId:localStorage.getItem("userId"),userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"OUTLINE_GET_CUSTOM_ANNOTATIONS",pageNavigatingFrom:"Outline",pageNavigatingTo:"Outline",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastViewedOutlineType:"customOutline",lastViewedCustomOutlineId:e,lastViewedCustomOutlineTitle:currentCustomOutlineTitle,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:CaseConnect.lastViewedOutlineId},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},annotationVO:{bookId:CaseConnect.currentBookId,customOutlineId:e}};$.ajax({url:properties[properties.env]+"/manageOutlineService/getAnnotationsForCustomOutline",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(t)}).then(function(t){(currentCustomEditorContent="",void 0!==t.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",t.sessionAuthenticationToken),$("#outline-menu").popover("hide"),null!=t.annotationVOList)?(lastVisitedEditableChapterId=e,insideCustomOutline=!0,$("#export-chapter-outline").css("display","none"),$(window).trigger("resize"),$(".new-note-save-mobile").removeClass("save-chapter-outline").addClass("save-custom-outline"),$(window).width()<768?$(".new-note-save-mobile").css("display","block"):$(".new-note-save-mobile").css("display","none"),$(".outline-new-note-disable").css("display","none"),$(".outline-editor-header-editable").show(),$(".outline-editor-header-noneditable").hide(),$(".outline-editor-header-textbox").css({"background-color":"none",margin:"0px 15px","padding-left":"0","padding-right":"0"}),tinyMCE.get("tinymce-outline-content")&&(tinyMCE.get("tinymce-outline-content").setContent(""),void 0!==t.annotationVOList.customAnnotationText?(loadingNewOutline=!0,tinyMCE.get("tinymce-outline-content").setContent(t.annotationVOList.customAnnotationText),t.annotationVOList.customAnnotationText.trim().length>0&&$("label.outline-editor-label").hide(),currentCustomAnnotationId=t.annotationVOList.annotationId):t.annotationVOList.length>0?(loadingNewOutline=!0,tinyMCE.get("tinymce-outline-content").setContent(t.annotationVOList[0].customAnnotationText),t.annotationVOList[0].customAnnotationText.trim().length>0&&$("label.outline-editor-label").hide(),currentCustomAnnotationId=t.annotationVOList[0].annotationId):($("label.outline-editor-label").show(),currentCustomAnnotationId=null)),$("#page-loading-spinner").hide(),$(window).scrollTop(0)):($("label.outline-editor-label").show(),$("#page-loading-spinner").hide(),currentCustomAnnotationId=null);setSaveOutlineOnTimer(),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain,$("#page-loading-spinner").hide()})}function myNotesClick(e){if($("#page-loading-spinner").show(),$("#outline-notes-menu-mobile").modal("hide"),closeOverlayInMobile("outline-nav-menu-mobile"),myNotesClicked=!0,comingFromCustomOutline&&customOutlineTobeSaved&&myNotesClicked)return customOutlineIdToDisplay=e.currentTarget.getAttribute("chapterId"),customOutlineTitleToDisplay=e.currentTarget.childNodes[e.currentTarget.childNodes.length-2].innerHTML,saveCustomOutlineFromAnywhere(),void $("#page-loading-spinner").hide();if(customOutlineTitleonBlur&&myNotesClicked||customOutlineTitleonBlur&&customOutlineTobeSaved&&myNotesClicked)return customOutlineIdToDisplay=e.currentTarget.getAttribute("chapterId"),customOutlineTitleToDisplay=e.currentTarget.childNodes[e.currentTarget.childNodes.length-2].innerHTML,saveCustomOutlineFromAnywhere(),void $("#page-loading-spinner").hide();myNotesClicked=!1,customOutlineTitleonBlur=!1,customOutlineIdToDisplay=null,customOutlineTitleToDisplay=null;var t=e.currentTarget.getAttribute("chapterId");if(lastViewedNotesTab="customOutlineInBook",comingFromAnotherMyNote=!0,newCustomOutlineBeingCreated){if(newCustomOutlineBeingCreated=!1,CaseConnect.currentChapterId!==t){if($("#page-loading-spinner").show(),insideCustomOutline=!0,$("#export-chapter-outline").css("display","none"),$(window).trigger("resize"),$(".new-note-save-mobile").removeClass("save-chapter-outline").addClass("save-custom-outline"),$(window).width()<768?$(".new-note-save-mobile").css("display","block"):$(".new-note-save-mobile").css("display","none"),$(".outline-new-note-disable").css("display","none"),$(".outline-editor-header-editable").show(),$(".outline-editor-header-noneditable").hide(),$(".outline-editor-header-textbox").css({"background-color":"none",margin:"0 15px","padding-left":"0","padding-right":"0"}),CaseConnect.currentChapterId=t,e&&($("#page-loading-spinner").show(),!insideCustomOutline||currentCustomOutlineId!==t)){var n=e.currentTarget.childNodes;currentCustomOutlineId=t,currentCustomOutlineTitle=n[n.length-2].innerHTML}CaseConnect.currentChapterId&&$(outlineViewChapterList).each(function(){this.chapterId===CaseConnect.currentChapterId&&(CaseConnect.currentChapterTitle="Chapter "+this.chapterNumber+": "+this.chapterTitle,CaseConnect.currentNavbarTitle=this.navbarTitle)}),setTimeout(function(){loadChapterNotesFromTab(),$("#outline-search-text-desktop").popover("hide"),$("#outline-search-mobile").popover("hide"),navigatingAwayFromCurrentOutline=!1},500)}}else{if($("li outline-search-result-item").hasClass("active")||$(e.currentTarget).hasClass("recent-selected-note"))return $("#page-loading-spinner").hide(),!0;if(CaseConnect.currentChapterId!==t){if($("#page-loading-spinner").show(),insideCustomOutline=!0,$("#export-chapter-outline").css("display","none"),$(window).trigger("resize"),$(".new-note-save-mobile").removeClass("save-chapter-outline").addClass("save-custom-outline"),$(window).width()<768?$(".new-note-save-mobile").css("display","block"):$(".new-note-save-mobile").css("display","none"),$(".outline-new-note-disable").css("display","none"),$(".outline-editor-header-editable").show(),$(".outline-editor-header-noneditable").hide(),$(".outline-editor-header-textbox").css({"background-color":"none",margin:"0px 15px","padding-left":"0","padding-right":"0"}),CaseConnect.currentChapterId=t,e&&($("#page-loading-spinner").show(),!insideCustomOutline||currentCustomOutlineId!==t)){n=e.currentTarget.childNodes;currentCustomOutlineId=t,currentCustomOutlineTitle=n[n.length-2].innerHTML}CaseConnect.currentChapterId&&$(outlineViewChapterList).each(function(){this.chapterId===CaseConnect.currentChapterId&&(CaseConnect.currentChapterTitle="Chapter "+this.chapterNumber+": "+this.chapterTitle,CaseConnect.currentNavbarTitle=this.navbarTitle)}),setTimeout(function(){loadChapterNotesFromTab(),$("#outline-search-text-desktop").popover("hide"),$("#outline-search-mobile").popover("hide"),navigatingAwayFromCurrentOutline=!1},500)}}}function getLastVisitedCustomOutline(){var e;e={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"OUTLINE_GET_RECENT_NOTES",pageNavigatingFrom:"Outline",pageNavigatingTo:"Outline",lastReadBookId:CaseConnect.currentBookId,lastViewedCustomOutlineId:currentCustomOutlineId,lastViewedCustomOutlineTitle:currentCustomOutlineTitle,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:CaseConnect.lastViewedOutlineId,lastViewedOutlineType:"customOutline"},sessionVO:{appType:"web",deviceType:"Desktop",deviceOS:"Windows 7",deviceMacId:"",keepMeLoggedInFlag:"false",browserName:"Firefox",sessionAuthenticationToken:"1001"}},outlineVO:{bookId:CaseConnect.currentBookId}},$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageOutlineService/getLastVisitedCustomOutline",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(e)}).then(function(e){e.outlineVO&&(lastVisitedCustomOutlineId=e.outlineVO.customOutlineId),newCustomOutlineBeingCreated=!1,loadChapterNotesFromTab()},function(e){sessionTimeOut(),$("#page-loading-spinner").hide()})}function saveOutlineButtonClicked(){saveMyOutline(),setSaveOutlineOnTimer()}function saveMyOutline(){setTimeout(function(){insideCustomOutline&&customOutlineTobeSaved&&($("#save-btn-annotation-outline").attr("disabled","disabled"),$("#save-btn-annotation-outline").css("cursor","auto"),$("#save-btn-annotation-outline-mobile").attr("disabled","disabled"),$("#save-btn-annotation-outline-mobile").css("cursor","auto"),customOutlineTobeSaved=!1,currentCustomOutlineId?currentCustomAnnotationId?modifyCustomOutline():saveCustomOutline():(manualSaveOfCustomOutline=!0,saveCustomOutlineTitle()))},500)}function saveCustomOutline(){$("#page-loading-spinner").show();var e=!1;""===currentCustomOutlineTitle&&(e=!0,currentCustomOutlineTitle="Sample Outline Title"),tinyMCE.get("tinymce-outline-content")&&""===currentCustomEditorContent&&(currentCustomEditorContent=tinyMCE.activeEditor.getContent()),$("#page-loading-spinner").show();var t={userVO:{userId:localStorage.getItem("userId"),userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"OUTLINE_SAVE_CUSTOM_ANNOTATIONS",pageNavigatingFrom:"Outline",pageNavigatingTo:"Outline",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastViewedOutlineType:"customOutline",lastViewedCustomOutlineId:currentCustomOutlineId,lastViewedCustomOutlineTitle:currentCustomOutlineTitle,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:CaseConnect.lastViewedOutlineId,lastViewedOutlineType:"customOutline"},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},annotationVOList:[{bookId:CaseConnect.currentBookId,customOutlineId:currentCustomOutlineId,userCustomOutlineTitle:currentCustomOutlineTitle,customAnnotationText:currentCustomEditorContent,highlightStartOffset:-999,highlightEndOffset:-999,customAnnotationFlag:"true",annotationUpdateStatus:"createCustomAnnotationFromCustomOutline"}]};$("#page-loading-spinner").show(),$.ajax({url:properties[properties.env]+"/manageOutlineService/saveCustomOutLine",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(t)}).then(function(t){currentCustomEditorContent="",void 0!==t.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",t.sessionAuthenticationToken),CaseConnect.outlineTimer&&insideCustomOutline&&!e?(currentCustomAnnotationId=t.annotationVOList.annotationId,newCustomOutlineBeingCreated=!1):currentCustomOutlineTitle="",$("#outline-message-box").modal("hide"),(saveNewOutlineFromCommonSaveFunction||updateOutlineFromCommonSaveFunction)&&(setTimeout(function(){createNewCustomOutline()},500),saveNewOutlineFromCommonSaveFunction=!1,updateOutlineFromCommonSaveFunction=!1),saveTitleFromCommonSaveFunction&&(currentCustomOutlineId=customOutlineIdToDisplay,currentCustomOutlineTitle=customOutlineTitleToDisplay,myNotesClicked=!1,saveTitleFromCommonSaveFunction=!1,customOutlineTitleonBlur=!1,loadChapterNotesFromTab(),customOutlineIdToDisplay=null,customOutlineTitleToDisplay=null),insideCustomOutline&&loadCustomNotesAfterSave(),sessionTimeOut()},function(e){$("#outline-message-box").modal("hide"),sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?("bus.exception.bookId.or.outlineType.or.customoutlineid.or.customoutlinetitle.is.missing"===e.responseJSON.wkErrorCode?alertMessagesModal(exceptionMsg.enterTitleToSave):alertMessagesModal(e.responseJSON.errorMessg),$("#page-loading-spinner").hide()):window.location=properties.ui_domain})}function saveCustomOutlineTitle(){var e=$(".chapter-title-input-outline").val().trim();if(currentCustomOutlineTitle!==$(".chapter-title-input-outline").val().trim()||""===e){if(""===(currentCustomOutlineTitle=$(".chapter-title-input-outline").val().trim())&&tinyMCE.get("tinymce-outline-content")){editorContent=tinyMCE.get("tinymce-outline-content").getContent().trim();var t=removeTags(editorContent);t&&(currentCustomOutlineTitle=t.substring(0,25).trim())}if(""===currentCustomOutlineTitle)$("#page-loading-spinner").hide();else{currentCustomEditorContent=tinyMCE.get("tinymce-outline-content").getContent();var n={userVO:{userId:localStorage.getItem("userId"),userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"OUTLINE_SAVE_CUSTOM_TITLE",pageNavigatingFrom:"Outline",pageNavigatingTo:"Outline",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:CaseConnect.lastViewedOutlineId,lastViewedOutlineType:"customOutline",lastViewedCustomOutlineTitle:currentCustomOutlineTitle},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},outlineVO:{bookId:CaseConnect.currentBookId,userCustomOutlineTitle:currentCustomOutlineTitle,customOutlineId:"-999"}};$.ajax({url:properties[properties.env]+"/manageOutlineService/saveCustomOutlineTitle",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(n)}).then(function(e){void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),CaseConnect.outlineTimer&&insideCustomOutline&&null!=currentCustomOutlineTitle&&($(".chapter-title-input-outline").val(currentCustomOutlineTitle),$(".chapter-title-input-outline").attr("aria-label",currentCustomOutlineTitle),$(".outline-note-date").html(""),updateLastSavedTime(e.outlineVO.lastModifiedTimestamp)),currentCustomOutlineId=e.outlineVO.customOutlineId,lastVisitedEditableChapterId=currentCustomOutlineId,myNotesClicked||(customOutlineTitleonBlur=!1),manualSaveOfCustomOutline&&(saveCustomOutline(),manualSaveOfCustomOutline=!1),loadChapterListColumn(),saveTitleFromCommonSaveFunction&&!manualSaveOfCustomOutline&&(lastVisitedEditableChapterId=currentCustomOutlineId=customOutlineIdToDisplay,currentCustomOutlineTitle=customOutlineTitleToDisplay,myNotesClicked=!1,saveTitleFromCommonSaveFunction=!1,loadChapterNotesFromTab(),customOutlineIdToDisplay=null,customOutlineTitleToDisplay=null),loadBookNotesFromCommonFunction&&(loadBookNotesFromCommonFunction=!1,lastVisitedNonEditableChapterId?CaseConnect.currentChapterId=lastVisitedNonEditableChapterId:lastVisitedNonEditableChapterId||(CaseConnect.currentChapterId=""),getAnnotationsForChapterOutline(),$("#chapter-title-input-outline").attr("disabled","disabled")),sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($(".chapter-title-input-outline").val(""),currentCustomOutlineTitle="",$("#page-loading-spinner").hide(),"bus.exception.duplicate.custom.outline.title"===e.responseJSON.wkErrorCode?(alertMessagesModal(e.responseJSON.errorMessg),$(".chapter-title-input-outline").click()):alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}}}function modifyCustomOutlineTitle(){var e=$(".chapter-title-input-outline").val().trim(),t="";if((currentCustomOutlineTitle!==$(".chapter-title-input-outline").val().trim()||""===e)&&""===(t=$(".chapter-title-input-outline").val().trim())){editorContent=tinyMCE.activeEditor.getContent().trim();var n=removeTags(editorContent);n&&(t=n.substring(0,25).trim())}if(""===t)$("#page-loading-spinner").hide();else{var i={userVO:{userId:localStorage.getItem("userId"),userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"OUTLINE_SAVE_CUSTOM_TITLE",pageNavigatingFrom:"Outline",pageNavigatingTo:"Outline",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:CaseConnect.lastViewedOutlineId,lastViewedOutlineType:"customOutline",lastViewedCustomOutlineId:currentCustomOutlineId,lastViewedCustomOutlineTitle:t},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},outlineVO:{bookId:CaseConnect.currentBookId,userCustomOutlineTitle:t,customOutlineId:currentCustomOutlineId}};$.ajax({url:properties[properties.env]+"/manageOutlineService/saveCustomOutlineTitle",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(i)}).then(function(e){void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),currentCustomOutlineTitle=t,CaseConnect.outlineTimer&&insideCustomOutline&&null!=currentCustomOutlineTitle&&($(".outline-note-date").html(""),updateLastSavedTime(e.outlineVO.lastModifiedTimestamp),$(".chapter-title-input-outline").val(currentCustomOutlineTitle),$(".chapter-title-input-outline").attr("aria-label",currentCustomOutlineTitle)),$("#page-loading-spinner").hide(),currentCustomOutlineId=e.outlineVO.customOutlineId,lastVisitedEditableChapterId=currentCustomOutlineId,modifyCustomOutline(),myNotesClicked||(customOutlineTitleonBlur=!1),sessionTimeOut()},function(e){sessionAuthFails(e),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),"bus.exception.duplicate.custom.outline.title"===e.responseJSON.wkErrorCode?(alertMessagesModal(e.responseJSON.errorMessg),$(".chapter-title-input-outline").val(currentCustomOutlineTitle),$(".chapter-title-input-outline").attr("aria-label",currentCustomOutlineTitle),modifyCustomOutline()):alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain,sessionTimeOut()})}}function modifyCustomOutline(){$("#page-loading-spinner").show();$(".chapter-title-input-outline").val().trim();if(currentCustomOutlineTitle!==$(".chapter-title-input-outline").val().trim())modifyCustomOutlineTitle();else{""===currentCustomEditorContent&&(currentCustomEditorContent=tinyMCE.get("tinymce-outline-content").getContent().trim());var e={userVO:{userId:localStorage.getItem("userId"),userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"OUTLINE_SAVE_CUSTOM_ANNOTATIONS",pageNavigatingFrom:"Outline",pageNavigatingTo:"Outline",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastViewedOutlineType:"customOutline",lastReadChapterId:CaseConnect.currentChapterId,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:CaseConnect.lastViewedOutlineId,lastViewedOutlineType:"customOutline",lastViewedCustomOutlineId:currentCustomOutlineId,lastViewedCustomOutlineTitle:currentCustomOutlineTitle},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},annotationVOList:[{bookId:CaseConnect.currentBookId,customOutlineId:currentCustomOutlineId,userCustomOutlineTitle:currentCustomOutlineTitle,highlightStartOffset:-999,highlightEndOffset:-999,customAnnotationText:currentCustomEditorContent,customAnnotationFlag:"true",annotationId:currentCustomAnnotationId,annotationUpdateStatus:"modifyCustomAnnotationFromCustomOutline"}]};$.ajax({url:properties[properties.env]+"/manageOutlineService/saveCustomOutLine",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(e)}).then(function(e){currentCustomEditorContent="",void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),$("#page-loading-spinner").hide(),$(".outline-note-date").html(""),updateLastSavedTime(e.annotationVOList.lastModifiedTimestamp),currentCustomAnnotationId=e.annotationVOList.annotationId,$("#outline-message-box").modal("hide"),loadOutlineFromTabs(),updateOutlineFromCommonSaveFunction&&(setTimeout(function(){createNewCustomOutline()},500),updateOutlineFromCommonSaveFunction=!1),updateTitleFromCommonSaveFunction&&setTimeout(function(){currentCustomOutlineId=customOutlineIdToDisplay,currentCustomOutlineTitle=customOutlineTitleToDisplay,myNotesClicked=!1,updateTitleFromCommonSaveFunction=!1,customOutlineTitleonBlur=!1,loadChapterNotesFromTab(),customOutlineIdToDisplay=null,customOutlineTitleToDisplay=null},1e3),sessionTimeOut()},function(e){sessionAuthFails(e),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),$("#outline-message-box").modal("hide"),"bus.exception.bookId.or.outlineType.or.customoutlineid.or.customoutlinetitle.is.missing"==e.responseJSON.wkErrorCode?alertMessagesModal(exceptionMsg.enterTitleToSave):alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain,sessionTimeOut()})}}function saveCustomAnnotationTitleOnBlur(){customOutlineTitleonBlur=!0,currentCustomOutlineId?modifyCustomOutlineTitle():saveCustomOutlineTitle()}function get_editor_content(){if(document.getElementById("outLineExportForm").action=properties[properties.env]+"/manageOutlineService/exportOutline",insideCustomOutline){if(tinyMCE.get("tinymce-outline-content"))var e=tinyMCE.get("tinymce-outline-content").getContent()}else e=$(".outline-editor-textarea").html();e=e.replace(/<br>/g,"<br/>").replace(/&nbsp;/g," ").replace(/&ldquo;/g,'"').replace(/&rdquo;/g,'"').replace(/&lsquo;/g,"'").replace(/&rsquo;/g,"'").replace(/&sect;/g,"ยง").replace(/&amp;/g,"&"),$("#outlinePageNoteName").val("Note"),$("#docFormat").val("docx"),$("#outlineHtmlInput").val("<html><body>"+e+"</body></html>"),$("#outLineExportForm").submit()}function getOutlineTutorialDisplayStatus(){var e={userVO:{userId:localStorage.getItem("userId"),userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"BOOKSHELF_SAVE_USER_SETTINGS",pageNavigatingFrom:"Bookshelf",pageNavigatingTo:"Bookshelf"},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}}};$.ajax({url:properties[properties.env]+"/manageUserService/getOutlineTutorialMessageDisplayStatus",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(e)}).then(function(e){if(CaseConnect.showOutlineTutorial=e.userSettingsVO.outlineTutorialDisplayMessageFlag,""!==CaseConnect.applicationOverlayTutorialDisplayMessageFlag){if("true"===CaseConnect.applicationOverlayTutorialDisplayMessageFlag&&"true"===CaseConnect.showOutlineTutorial)$("#new-outline-modal").modal("show");else if("false"===CaseConnect.applicationOverlayTutorialDisplayMessageFlag&&"true"===CaseConnect.showOutlineTutorial)return}else if("true"===CaseConnect.showOutlineTutorial)$("#new-outline-modal").modal("show");else if("false"===CaseConnect.showOutlineTutorial)return;sessionTimeOut()},function(e){sessionAuthFails(e),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain,sessionTimeOut()})}function saveOutlineTutorialDisplayStatus(){CaseConnect.showOutlineTutorial="false";var e={userVO:{userId:localStorage.getItem("userId"),userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"BOOKSHELF_SAVE_USER_SETTINGS",pageNavigatingFrom:"Bookshelf",pageNavigatingTo:"Bookshelf"},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},userSettingsVO:{userId:localStorage.getItem("userId"),outlineTutorialDisplayMessageFlag:CaseConnect.showOutlineTutorial,createdBy:localStorage.getItem("userId"),modifiedBy:localStorage.getItem("userId")}};$.ajax({url:properties[properties.env]+"/manageUserService/saveOutlineTutorialMessageDisplayStatus",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(e)}).then(function(e){sessionTimeOut()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}function showOutlineNavInMoblie(){$("#outline-notes-menu-mobile")&&$("#outline-notes-menu-mobile").modal("hide"),$("#outline-nav-menu-mobile").modal("show")}function hideOutlineNavInMoblie(){$("#outline-nav-menu-mobile").modal("hide")}function showOutlineNotesMoblie(e){void 0!==$("#outline-notes-menu-mobile").data()["bs.modal"]?$("#outline-notes-menu-mobile").data()["bs.modal"].isShown?($("#outline-notes-menu-mobile").modal("hide"),$("div.ereader-page-info-modal-container .ereader-top-nav-cog").attr("onclick","showAccountMenuInMobile('"+e+"')"),$("div.common-book-info-modal-container .ereader-top-nav-cog").addClass("cc-header-account").removeClass("glyphicon glyphicon-remove")):($("#outline-notes-menu-mobile").modal("show"),$(".outline-notes-list-block").scrollTop(0),$(".ereader-assessment-content-area").scrollTop(0),$("div.common-book-info-modal-container .ereader-top-nav-cog").removeClass("cc-header-account").addClass("glyphicon glyphicon-remove"),$("div.common-book-info-modal-container .ereader-top-nav-cog").attr("onclick","closeOverlayInMobile('"+e+"')")):($("#outline-notes-menu-mobile").modal("show"),$("div.common-book-info-modal-container .ereader-top-nav-cog").removeClass("cc-header-account").addClass("glyphicon glyphicon-remove"),$("div.common-book-info-modal-container .ereader-top-nav-cog").attr("onclick","closeOverlayInMobile('"+e+"')")),$(".common-book-menu-dropdown").attr("onclick","showAccountMenuFromHamburger('"+e+"');")}function checkNewCustomOutlineCreated(){""!==tinyMCE.get("tinymce-outline-content").getContent()?saveOutlineButtonClicked():$("#outline-notes-menu-mobile").modal("show"),$("button#professor-book-shelf-cog").show()}function saveCustomOutlineFromAnywhere(){return customOutlineTobeSaved&&comingFromCustomOutline&&myNotesClicked||newCustomOutlineBeingCreated&&comingFromCustomOutline&&myNotesClicked||customOutlineTitleonBlur&&customOutlineTobeSaved&&myNotesClicked&&comingFromCustomOutline?(saveOutlineButtonClicked(),void setTimeout(function(){return customOutlineTobeSaved&&comingFromCustomOutline&&myNotesClicked||customOutlineTitleonBlur&&customOutlineTobeSaved&&myNotesClicked&&comingFromCustomOutline?(currentCustomOutlineId=customOutlineIdToDisplay,currentCustomOutlineTitle=customOutlineTitleToDisplay,myNotesClicked=!1,customOutlineTitleonBlur=!1,loadChapterNotesFromTab(),customOutlineIdToDisplay=null,void(customOutlineTitleToDisplay=null)):comingFromCustomOutline&&myNotesClicked?(currentCustomOutlineId=customOutlineIdToDisplay,currentCustomOutlineTitle=customOutlineTitleToDisplay,myNotesClicked=!1,customOutlineTitleonBlur=!1,loadChapterNotesFromTab(),customOutlineIdToDisplay=null,void(customOutlineTitleToDisplay=null)):(myNotesClicked=!1,customOutlineTitleonBlur=!1,customOutlineIdToDisplay=null,void(customOutlineTitleToDisplay=null))},1e3)):customOutlineTobeSaved&&nonEditableChapterOutline&&"bookNotes"===lastVisitedNotesLabel?""===$("#chapter-title-input-outline").val().trim()?(loadBookNotesFromCommonFunction=!0,saveOutlineButtonClicked(),void setTimeout(function(){"bookNotes"===lastVisitedNotesLabel?(lastViewedNotesTab="chapterOutlineInBook",$(".outline-my-notes-tab").removeClass("active"),$(".outline-book-notes-tab").addClass("active"),goToMenuNotesFlag="bookNotes",insideCustomOutline=!1,newCustomOutlineBeingCreated=!1,$(".editor-submit-wrapper").html(""),$("#chapter-title-input-outline").attr("disabled","disabled")):lastVisitedNotesLabel=null},1e3)):(saveOutlineButtonClicked(),void setTimeout(function(){"bookNotes"===lastVisitedNotesLabel?(lastViewedNotesTab="chapterOutlineInBook",$(".outline-my-notes-tab").removeClass("active"),$(".outline-book-notes-tab").addClass("active"),goToMenuNotesFlag="bookNotes",insideCustomOutline=!1,newCustomOutlineBeingCreated=!1,$(".editor-submit-wrapper").html(""),$("#chapter-title-input-outline").attr("disabled","disabled"),comingFromCustomOutline&&!insideCustomOutline?(lastVisitedNonEditableChapterId?CaseConnect.currentChapterId=lastVisitedNonEditableChapterId:lastVisitedNonEditableChapterId||(CaseConnect.currentChapterId=""),setTimeout(function(){getAnnotationsForChapterOutline()},500),$("#chapter-title-input-outline").attr("disabled","disabled")):!comingFromCustomOutline||insideCustomOutline||currentCustomOutlineId||(loadBookNotesFromCommonFunction=!0),lastVisitedNotesLabel=null):lastVisitedNotesLabel=null},1e3)):customOutlineTobeSaved&&comingFromCustomOutline&&newCustomOutlineBeingCreated?(customOutlineTobeSaved&&comingFromCustomOutline&&newCustomOutlineBeingCreated&&currentCustomAnnotationId?(updateOutlineFromCommonSaveFunction=!0,saveOutlineButtonClicked()):customOutlineTobeSaved&&comingFromCustomOutline&&newCustomOutlineBeingCreated&&!currentCustomAnnotationId&&(saveNewOutlineFromCommonSaveFunction=!0),saveOutlineButtonClicked(),void(CaseConnect.currentChapterId=null)):void(customOutlineTitleonBlur&&myNotesClicked&&!customOutlineTobeSaved?customOutlineTitleonBlur&&myNotesClicked&&!customOutlineTobeSaved&&!currentCustomOutlineId?saveTitleFromCommonSaveFunction=!0:customOutlineTitleonBlur&&myNotesClicked&&!customOutlineTobeSaved&&currentCustomOutlineId?updateTitleFromCommonSaveFunction=!0:(myNotesClicked=!1,customOutlineIdToDisplay=null,customOutlineTitleToDisplay=null):$("#page-loading-spinner").hide())}function loadOutlineViewableChapterList(){reqData={userVO:{userId:CaseConnect.currentUserId,userRole:localStorage.getItem("userRole"),userRoleId:localStorage.getItem("userRoleId"),userActivityVO:{lastActivityCode:"OUTLINE_GET_RECENT_NOTES",pageNavigatingFrom:navigatingFromClassInsightsToOutline?"ClassInsight":"Outline",pageNavigatingTo:"Outline",lastReadBookId:CaseConnect.currentBookId,lastReadPageNum:CaseConnect.currentPageNumber,lastReadChapterId:navigatingFromClassInsightsToOutline?"":CaseConnect.currentChapterId,lastReadChapterTitle:navigatingFromClassInsightsToOutline?"":CaseConnect.currentChapterTitle,lastReadSectionId:CaseConnect.currentSectionId,lastReadSubSectionId:"subsec01",lastReadParagraphId:"para01",lastViewedOutlineId:2,lastViewedOutlineType:"chapterOutline"},sessionVO:{appType:CaseConnect.appType,deviceType:CaseConnect.deviceType,deviceOS:CaseConnect.deviceOS,deviceMacId:CaseConnect.deviceMacId,keepMeLoggedInFlag:CaseConnect.keepMeLoggedInFlag,browserName:CaseConnect.browserName,sessionAuthenticationToken:localStorage.getItem("sessionAuthenticationToken")}},outlineVO:{bookId:CaseConnect.currentBookId,recentNotesFlag:"allNotes"}},$.ajax({url:properties[properties.env]+"/manageOutlineService/getOutlineNotes",type:"POST",contentType:"application/json",accept:"application/json",data:JSON.stringify(reqData)}).then(function(e){void 0!==e.sessionAuthenticationToken&&localStorage.setItem("sessionAuthenticationToken",e.sessionAuthenticationToken),void 0!==e.outlineVO&&null!==e.outlineVO?e.outlineVO.chapterOutlineVO?e.outlineVO.chapterOutlineVO.length>0?outlineViewChapterList=e.outlineVO.chapterOutlineVO:outlineViewChapterList.push(e.outlineVO.chapterOutlineVO):alertMessagesModal(e.responseJSON.errorMessg):alertMessagesModal(exceptionMsg.systemError),void 0!==e.casesFlag?(CaseConnect.casesFlag=e.casesFlag,"true"===CaseConnect.casesFlag?CaseConnect.bookType?"oer"!==CaseConnect.bookType&&$(".hide-case-page-class").show():$(".hide-case-page-class").show():$(".hide-case-page-class").hide()):$(".hide-case-page-class").hide(),void 0!==e.newsFeedFlag?(CaseConnect.newsFeedFlag=e.newsFeedFlag,"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide()):$(".hide-news-feed-class").hide(),"true"===CaseConnect.newsFeedFlag&&"true"==CaseConnect.adminNewsFlag?$(".hide-news-feed-class").show():$(".hide-news-feed-class").hide()},function(e){sessionAuthFails(e),sessionTimeOut(),Utility.handleSessionAuthentication(e.responseJSON)?($("#page-loading-spinner").hide(),alertMessagesModal(e.responseJSON.errorMessg)):window.location=properties.ui_domain})}